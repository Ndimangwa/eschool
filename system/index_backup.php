<?php 
if (session_status() == PHP_SESSION_NONE)	{
	session_start();
}
if (! isset($_SESSION['login'][0]['id']))	{
	header("Location: ../");
	exit();
}
$config="../config.php";
include($config);
require_once("../common/validation.php");
require_once("../class/system.php");
require_once("../server/authorization.php");
require_once("../server/accounting.php");
$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
$profile1 = null;
$login1 = null;
$registeredUser1 = null;
$__profileId = Profile::getProfileReference($database, $conn);
try {
	$profile1 = new Profile($database, $__profileId , $conn);
	$login1 = new Login($database, $_SESSION['login'][0]['id'], $conn);
	$profile1->loadXMLFolder("../data/profile");
	$registeredUser1 = Login::getUserWithThisLogin($database, $conn, $login1);
	if (is_null($registeredUser1)) Object::shootException("Could not pull this user type");
} catch (Exception $e)	{
	die($e->getMessage());
}
mysql_close($conn);
//Will redirect Automatically If Necessary
System::systemSSLTLSCertificateVerification($profile1);
Object::$iconPath="../sysimage/";
if (! $profile1->isInstallationComplete())	{
	header("Location: ../installation/");
	exit();
}
if ($login1->isUsingDefaultPassword())	{
	header("Location: ../profile/");
	exit();
}
if ($login1->isStudent() && ! $registeredUser1->isDiscontinued() && $registeredUser1->shouldIAdvanceYearOrSemester($profile1))	{
	header("Location: ../profile/");
	exit();
}
$thispage = $_SERVER['PHP_SELF'];
$page = null;
if (isset($_REQUEST['page'])) $page = $_REQUEST['page'];
//You may use extraFilter to store path of the photo , user the setExtraFilter of login
if ($login1->getUserType()->getTypeCode() == UserType::$__COURSEINSTRUCTOR)	{
	$login1->setExtraFilter("../data/instructors/photo/".$login1->getPhoto());
} else if ($login1->getUserType()->getTypeCode() == UserType::$__STUDENT)	{
	$login1->setExtraFilter("../data/students/photo/".$login1->getPhoto());
} else if ($login1->getUserType()->getTypeCode() == UserType::$__USER)	{
	$login1->setExtraFilter("../data/users/photo/".$login1->getPhoto());
} else {
	die("The System Could not identify this Type of the User");
}
$dataFolder = "data";
$studentFolder = "../data/students";
$themeFolder = "sunny"; //--set this as a default 
if (! is_null($profile1->getTheme())) $themeFolder = $profile1->getTheme()->getThemeFolder();
if (! is_null($login1->getTheme())) $themeFolder = $login1->getTheme()->getThemeFolder();
//We Just need to get A Default Timezone so we can extra a year
$timezone="Africa/Dar_es_Salaam";
if (! is_null($profile1->getPHPTimezone())) $timezone = $profile1->getPHPTimezone()->getZoneName();
date_default_timezone_set($timezone);
$date=date("Y:m:d:H:i:s");
$__systemDayOffset = 0;
if (! is_null($profile1->getFirstDayOfAWeek()))	{
	$__systemDayOffset = $profile1->getFirstDayOfAWeek()->getOffsetValue();
}
if (! is_null($login1->getFirstDayOfAWeek()))	{
	$__systemDayOffset = $login1->getFirstDayOfAWeek()->getOffsetValue();
}
$systemDate1 = new DateAndTime("Ndimangwa", $date, "Fadhili");
$systemTime1 = $systemDate1;
$pagenumber = -1;
$prevpagenumber = 9999;
$thispage=$_SERVER['PHP_SELF'];
if (isset($_REQUEST['pagenumber']))	{ $pagenumber=intval($_REQUEST['pagenumber']); }
if (isset($_REQUEST['prevpagenumber']))	{ $prevpagenumber=intval($_REQUEST['prevpagenumber']); }
?>
<html>
<head>
<title><?= $profile1->getProfileName() ?></title>
<link rel="stylesheet" type="text/css" media="all" href="../client/jquery-ui-1.11.3/themes/<?= $themeFolder ?>/jquery-ui.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/plugin/twbsPagination/twbsPagination.min.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/plugin/wickedpicker/wp/wickedpicker.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/plugin/printArea/PrintArea.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/css/fonts/font-awesome.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/plugin/fileMenu/fileMenu.min.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/css/purecss/pure-min.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/css/purecss/grids-responsive-min.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/plugin/chromose/chromoselector-2.1.8/chromoselector.css"/>
<link rel="stylesheet" type="text/css" media="all" href="../client/css/site.css"/>
<style type="text/css">

</style>
<script type="text/javascript" src="../client/jquery.js"></script>
<script type="text/javascript" src="../client/jquery-ui-1.11.3/jquery-ui.js"></script>
<script type="text/javascript" src="../client/jquery-easy-ticker-master/jquery.easy-ticker.js"></script>
<script type="text/javascript" src="../client/plugin/twbsPagination/jquery.twbsPagination.min.js"></script>
<script type="text/javascript" src="../client/plugin/wickedpicker/wp/wickedpicker.js"></script>
<script type="text/javascript" src="../client/plugin/printArea/jquery.PrintArea.js"></script>
<script type="text/javascript" src="../client/plugin/fileMenu/fileMenu.js"></script>
<script type="text/javascript" src="../client/plugin/chromoselector-2.1.8/chromoselector.min.js"></script>
<script type="text/javascript" src="../client/js/jvalidation.js"></script>
<script type="text/javascript" src="../client/js/page.js"></script>
<script type="text/javascript">
(function($)	{
	$(function()	{
		/*Date Handling*/
		$('.datepicker').datepicker({
			dateFormat: 'dd/mm/yy',
			firstDay: <?= $__systemDayOffset ?>,
			changeYear: true,
			yearRange:'1932:2099'
		});
		//Begin Testing 
		$('.timepicker').wickedpicker({
			twentyFour: true,
			upArrow: 'wickedpicker__controls__control-up',
			downArrow: 'wickedpicker__controls__control-down',
			title: 'Pick Time'
		});
		//Color Picker
		$('input.ui-sys-color-picker').each(function(i, val)	{
			var $colorPicker1 = $(val);
			var $targetForColorPicker1 = $colorPicker1.closest('div.color-picker-container');
			if ($targetForColorPicker1.length)	{
				var targetId = $targetForColorPicker1.attr('id');
				if (targetId)	{
					$colorPicker1.chromoselector({
						target: "#" + targetId,
						autoshow: false,
						create: function()	{
							$(this).chromoselector("show", 0);
						},
						width: 128
					});
				}
				$targetForColorPicker1.css({
					border: '1px solid',
					float: 'left',
					padding: '1em',
					backgroundColor: '#e4ccc1',
					clear: 'both'
				});
			}
			$colorPicker1.css({
				width: '100%'
			});
		});
		//General Clear 
		$('div.pure-control-group').css({
			clear: 'both'
		});
	});
})(jQuery);
</script>
</head>
<body class="ui-sys-body">
<div id="__id_general_dialog_holder">
<!--Holding Popup dialogs, they shoud use absolute positioning -->
</div>
<div class="ui-sys-main">
	<div class="ui-sys-menubar">
		<ul class="ui-sys-navigation-menu">
			<li>System
				<ul>
					<li><i class="fa fa-fw fa-file"></i> <a href="./">Home<kbd>Ctrl+H</kbd></a></li>
					<li><i class="fa fa-fw fa-file"></i> <a href="../profile/">My Profile</a><kbd>Alt+P</kbd></li>
<?php 
		if ($login1->isRoot() && Authorize::isAllowable($config, "menu_system", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Settings
						<ul>
<?php 
						if ($login1->isRoot() && Authorize::isAllowable($config, "managecontextmanager", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managecontextmanager">Last Resort for Don't Care</a></li>
<?php 
						}
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="#">System Policies</a></li>
<?php 
						if ($login1->isRoot() && Authorize::isAllowable($config, "manageprofile", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageprofile">System Settings</a></li>
<?php 
						}
						if ($login1->isRoot() && Authorize::isAllowable($config, "manageapprovalsequenceschema", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageapprovalsequenceschema">General Approval Schema</a></li>
<?php 
						}
						if ($login1->isRoot() && Authorize::isAllowable($config, "manageapprovalsequencedata", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageapprovalsequencedata">Approval Sequence Progress</a></li>
<?php 
						}
?>
						</ul>
					</li>
<?php 
				if ($login1->isRoot() && Authorize::isAllowable($config, "managesystemlogs", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managesystemlogs">System Logs</a></li>
<?php 
				}
		}
?>
					<li><i class="fa fa-fw fa-file"></i> <a class="ui-sys-logout-control" data-error-control="__ui_common_errors" data-next-page="../" data-server-directory="../server" title="Logout, <?= $login1->getFullname() ?>" href="#">Logout</a><kbd>Esc</kbd></li>
				</ul>
			</li>
<?php
		if ($login1->isStudent() && Authorize::isAllowable($config, "menu_studentportal", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>My Portal
				<ul>
<?php 
				if ($login1->isStudent() && Authorize::isAllowable($config, "studentportal_subject", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=studentportal_subject">My Subjects</a></li>
<?php	
				}
				if ($login1->isStudent() && ! $registeredUser1->isAlreadyGraduated() && Authorize::isAllowable($config, "studentportal_results", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=studentportal_results">My Results</a></li>
<?php	
				}
				if ($login1->isStudent() && $registeredUser1->isAlreadyGraduated() && Authorize::isAllowable($config, "studentportal_transcript", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=studentportal_transcript">My Transcript</a></li>
<?php	
				}
				if ($login1->isStudent() && Authorize::isAllowable($config, "studentportal_payment_history", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=studentportal_payment_history">My Payment History</a></li>
<?php	
				}
?>
				</ul>
			</li>
<?php
		}
		if (Authorize::isAllowable($config, "menu_users", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Users
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managegroup", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managegroup">Groups<kbd>Alt+G</kbd></a></li>
<?php
				}
				if (Authorize::isAllowable($config, "managejobtitle", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managejobtitle">Job Titles<kbd>Alt+J</kbd></a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managecourseinstructor", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managecourseinstructor">Course Instructors<kbd>Alt+I</kbd></a></li>
<?php 
				}
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managestudent">Students<kbd>Alt+U</kbd></a></li>
<?php 
				if (Authorize::isAllowable($config, "manageuser", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageuser">System Users</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managelogin", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managelogin&userinformation=true">User Account Management</a></li>
<?php 
				}
?>
					<li>---------------------------------------</li>
<?php
				if (Authorize::isAllowable($config, "managestudent_registration_progress", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a title="View Status of Registration Progress" href="<?= $thispage ?>?page=managestudent_registration_progress">Non Admitted Students</a></li>
<?php 
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_courses", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Courses
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managedepartment", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managedepartment">Departments</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managecourse", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managecourse">Courses</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managesubject", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managesubject">Subjects/Modules</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managecourseandsubjecttransaction", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Course & Subject Mapping</a></li>
<?php 
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_registration", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Registration
				<ul>
<?php 
				if (Authorize::isAllowable($config, "manageadmission_open_close", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageadmission_open_close">Open/Close Registration</a></li>
<?php 
				}
				if (!$profile1->isAdmissionClosed() && Authorize::isAllowable($config, "managestudent_admit", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managestudent">Student Admission</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "manageprofile_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageprofile_edit&regnumbers=true">Registration & Examination Numbers</a></li>
<?php
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_accademics", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Accademics
				<ul>
<?php 
				if ($login1->isRoot() && Authorize::isAllowable($config, "manageprofile_advance_accademicyear", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageprofile_advance_accademicyear">Advance Accademic Year</a></li>
<?php 
				}
				if ($login1->isRoot() && Authorize::isAllowable($config, "manageprofile_change_semester", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageprofile_change_semester">Change Current Semester</a></li>
<?php 
				}
?>
				<li>---------------------------------------</li>
<?php
				if (Authorize::isAllowable($config, "manageeducationlevel", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageeducationlevel">Education Level</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "manageentrycriteria", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageentrycriteria">Entry Criteria</a></li>
<?php 
				}
?>
				<li>---------------------------------------</li>
<?php
				if (Authorize::isAllowable($config, "managegrade", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managegrade">Grading Policy</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "manageclassofaward", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageclassofaward">Class of Award</a></li>
<?php 
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_examination", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Examination
				<ul>
<?php 
				if (Authorize::isAllowable($config, "manageexaminationgroup", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageexaminationgroup">Examination Groups</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "manageexamination", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageexamination">Examination</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "manageexamination_signing_sheet", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li>---------------------------------------</li>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageexamination_signing_sheet">Examination Signing Sheet</a></li>
<?php
				}
				if (false)	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Examination Numbers 
						<ul>
							<li><i class="fa fa-fw fa-file"></i> Number Filters(ByPass)</li>
							<li><i class="fa fa-fw fa-file"></i> Number Scope</li>
							<li><i class="fa fa-fw fa-file"></i> Examination Number</li>
						</ul>
					</li>
<?php 
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_results", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Results
				<ul>
<?php 
				if (Authorize::isAllowable($config, "submenu_results_management", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Results Management
						<ul>
<?php 
						if (Authorize::isAllowable($config, "manageresultsgroup", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresultsgroup">Results Group</a></li>
<?php
						}
						if (Authorize::isAllowable($config, "manageresults", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresults">Results Manager</a></li>						
<?php	
						}
?>
							<li>---------------------------------------</li>
<?php
						if (Authorize::isAllowable($config, "managebriefcasegroup", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managebriefcasegroup">My Briefcase Group</a></li>						
<?php	
						}
						if (Authorize::isAllowable($config, "managebriefcase", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managebriefcase">My Results Briefcase</a></li>						
<?php	
						}
?>
						</ul>
					</li>
<?php
				}
				if (Authorize::isAllowable($config, "submenu_results_upload", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Uploads
						<ul>
<?php 
						if (Authorize::isAllowable($config, "manageresults_upload", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresults_upload">Upload Results</a></li>						
<?php	
						}
?>
						</ul>
					</li>
<?php	
				}
				if (Authorize::isAllowable($config, "submenu_results_download", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Downloads
						<ul>
<?php 
						if (Authorize::isAllowable($config, "manageresults_make_template", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresults_make_template">Download Template</a></li>
<?php
						}
						if (Authorize::isAllowable($config, "manageresults_download", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="#">Download Results</a></li>
<?php
						}
?>
						</ul>
					</li>
<?php
				}
				if (Authorize::isAllowable($config, "submenu_results_tools", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Tools
						<ul>
<?php 
						if (Authorize::isAllowable($config, "manageresults_change_maximum_score", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresults_change_maximum_score">Change Maximum Score</a></li>
<?php
						}
						if (Authorize::isAllowable($config, "manageresults_sort", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageresults_sort">Sort Results File</a></li>
<?php
						}
?>
						</ul>
					</li>
<?php
				}
				if (Authorize::isAllowable($config, "console_manage_results", "normal", "donotsetlog", "-1", "-1"))	{
?>				
					<li>---------------------------------------</li>
					<li><i class="fa fa-fw fa-file"></i> <a target="_blank" href="../results/">Results Management Console</a></li>
<?php
				}
?>
				</ul>
			</li>
<?php	
		}
		if (Authorize::isAllowable($config, "menu_resources", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Resources
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managevenue", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managevenue">Venue</a></li>
<?php 
				}
				if (false && Authorize::isAllowable($config, "manageholiday", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageholiday">Holidays</a></li>
<?php 
				}
				if (false && Authorize::isAllowable($config, "manageschedule", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=manageschedule">Schedule</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managetimetable", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managetimetable">Timetable</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managehumanresource", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Human Resource
						<ul>
<?php 
					if (Authorize::isAllowable($config, "managehumanresource_attendance", "normal", "donotsetlog", "-1", "-1"))	{
?>
						<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managehumanresource_attendance">Attendance</a></li>
<?php
					}
					if (false)	{
?>
							<li><i class="fa fa-fw fa-file"></i> Leave Approval Group</li>
							<li><i class="fa fa-fw fa-file"></i> Leave Approval Schema</li>
							<li><i class="fa fa-fw fa-file"></i> Apply for Leave</li>
							<li><i class="fa fa-fw fa-file"></i> Grant Leave</li>
<?php 
					}
?>
						</ul>
					</li>
<?php 
				}
?>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_accounts", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Accounts 
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managecurrency", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managecurrency">Currency</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "managefeestructure", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managefeestructure">Fee Structure</a></li>
<?php 
				}
				if (Authorize::isAllowable($config, "submenu_invoices", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li class="sub"><i class="fa fa-fw"></i>Invoices 
						<ul>
<?php
						if (Authorize::isAllowable($config, "managefeeinvoicegroup", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managefeeinvoicegroup">Invoice Group Manager</a></li>
<?php 
						}
						if (Authorize::isAllowable($config, "managefeeinvoice", "normal", "donotsetlog", "-1", "-1"))	{
?>
							<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=generateinvoices">Generate Invoices</a></li>
<?php 
						}
?>
						</ul>
					</li>
<?php 
				}
?>
					<li><i class="fa fa-fw fa-file"></i> Fee Payer Type</li>
					<li><i class="fa fa-fw fa-file"></i> Payment History</li>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_messaging", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Messaging
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managemessagepolicy", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managemessagepolicy&searchtext=io">Messaging Policy</a></li>
<?php 
				}
?>				
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_attendance", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Attendance
				<ul>
					<li><i class="fa fa-fw fa-file"></i> View Attendance</li>
				</ul>
			</li>
<?php 
		}
		if (Authorize::isAllowable($config, "menu_tools", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Tools
				<ul>
<?php 
				if (Authorize::isAllowable($config, "managefiles_compare", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managefiles_compare">Compare Files</a></li>
<?php
				}
				if (Authorize::isAllowable($config, "managepaper", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managepaper">Paper Management</a></li>
<?php
				}
				if (Authorize::isAllowable($config, "managedaysofaweek", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managedaysofaweek">Days of A Week</a></li>
<?php
				}
				if (Authorize::isAllowable($config, "managemonthofayear", "normal", "donotsetlog", "-1", "-1"))	{
?>
					<li><i class="fa fa-fw fa-file"></i> <a href="<?= $thispage ?>?page=managemonthofayear">Month Of A Year</a></li>
<?php				
				}
				if (Authorize::isAllowable($config, "managetheme", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "managecountry", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "managesecurityquestion", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "manageusertype", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "manageuserstatus", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "managesex", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
				if (Authorize::isAllowable($config, "managemarital", "normal", "donotsetlog", "-1", "-1"))	{
					
				}
?>
				</ul>
			</li>
<?php
		}
		if (Authorize::isAllowable($config, "menu_help", "normal", "donotsetlog", "-1", "-1"))	{
?>
			<li>Help
				<ul>
					<li><i class="fa fa-fw fa-file"></i> About Us</li>
					<li><i class="fa fa-fw fa-file"></i> User Guide Manual</li>
					<li><i class="fa fa-fw fa-file"></i> Contact Us</li>
				</ul>
			</li>
<?php 
		} //end-of Authorize Menus sequence
?>
		</ul>
	</div>
<script type="text/javascript">
(function($)	{
	$('ul.ui-sys-navigation-menu').fileMenu({ slideSpeed: 200 });
})(jQuery);	
</script>
<!--BEGINNING OF PUTTING CODE-->
<div class="ui-sys-bg-grid-green">
<?php
	 /*BEGIN Login Accounts INFORMATION*/if ($page == "managelogin_edit" && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && isset($_REQUEST['userinformation']) && Authorize::isAllowable($config, "managelogin_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		 $ulogin1 = null;
		 try	{
			 $ulogin1 = new Login($database, $_REQUEST['id'], $conn);
		 } catch (Exception $e)	{
			 die($e->getMessage());
		 }
		 $promise1 = new Promise();
		 $promise1->setReason("Nothing has been updated");
		 $enableUpdate = false;
		$statusId = mysql_real_escape_string($_REQUEST['statusId']);
		$jobId = mysql_real_escape_string($_REQUEST['jobId']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		if (is_null($ulogin1->getUserStatus()) || ($statusId != $ulogin1->getUserStatus()->getStatusId()))	{
			$ulogin1->setUserStatus($statusId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getJobTitle()) || ($jobId != $ulogin1->getJobTitle()->getJobId()))	{
			$ulogin1->setJobTitle($jobId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getGroup()) || ($groupId != $ulogin1->getGroup()->getGroupId()))	{
			$ulogin1->setGroup($groupId); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $ulogin1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$ulogin1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$ulogin1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EDIT REPORT FOR <br/>(<?= $ulogin1->getFullname() ?>)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Account <?= $ulogin1->getFullname() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in update User Account Information <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managelogin_detail&userinformation=true&id=<?= $ulogin1->getLoginId() ?>">Back to User Account's Details</a></div>
		</div>
<?php 
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managelogin_edit", "Edited ".$ulogin1->getLoginName());
	 } else if ($page == "managelogin_edit" && isset($_REQUEST['id']) && isset($_REQUEST['userinformation']) && Authorize::isAllowable($config, "managelogin_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		 $ulogin1 = null;
		 try	{
			 $ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			 $ulogin1->setExtraFilter(System::getCodeString(8));
			 $ulogin1->commitUpdate(); //Avoid Replay
		 } catch (Exception $e)	{
			 die($e->getMessage());
		 }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit General Information for <br/>(<?= $ulogin1->getFullname() ?>)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managelogin_edit"/>
					<input type="hidden" name="userinformation" value="true"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $ulogin1->getLoginId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $ulogin1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="statusId">User Status </label>
						<select id="statusId" name="statusId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select User Status">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = UserStatus::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getUserStatus()) && ($ulogin1->getUserStatus()->getStatusId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="jobId">Job Title </label>
						<select id="jobId" name="jobId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getJobTitle()) && ($ulogin1->getJobTitle()->getJobId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getGroup()) && ($ulogin1->getGroup()->getGroupId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managelogin&userinformation=true">Back to General User Accounts</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		 mysql_close($conn);
	 } else if ($page == "managelogin_detail" && isset($_REQUEST['id']) && isset($_REQUEST['userinformation']) && Authorize::isAllowable($config, "managelogin_detail", "normal", "setlog", "-1", "-1"))	{
		 $conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		 $ulogin1 = null;
		 try	{
			 $ulogin1 = new Login($database, $_REQUEST['id'], $conn);
		 } catch (Exception $e)	{
			 die($e->getMessage());
		 }
		 mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Details for <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<table class="pure-table">
					<thead>
						<tr>
							<th>Field Name</th>
							<th>Field Value</th>
						</tr>
					</thead>
					<tbody>
<?php if (! is_null($ulogin1->getLoginName()))	{ ?> <tr><td>Username</td><td><?= $ulogin1->getLoginName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getFirstname()))	{ ?> <tr><td>First Name</td><td><?= $ulogin1->getFirstname() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getMiddlename()))	{ ?> <tr><td>Middle Name</td><td><?= $ulogin1->getMiddlename() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getLastname()))	{ ?> <tr><td>Last Name</td><td><?= $ulogin1->getLastname() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getFullname()))	{ ?> <tr><td>Full Name</td><td><?= $ulogin1->getFullname() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getUserStatus()))	{ ?> <tr><td>Status</td><td><?= $ulogin1->getUserStatus()->getStatusName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getDOB()))	{ ?> <tr><td title="Date Of Birth">D.O.B</td><td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB()) ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getSex()))	{ ?> <tr><td>Sex</td><td><?= $ulogin1->getSex()->getSexName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getMarital()))	{ ?> <tr><td>Marriage Status</td><td><?= $ulogin1->getMarital()->getMaritalName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getJobTitle()))	{ ?> <tr><td>Job Title</td><td><?= $ulogin1->getJobTitle()->getJobName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getGroup()))	{ ?> <tr><td>Group</td><td><?= $ulogin1->getGroup()->getGroupName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getUserType()))	{ ?> <tr><td>User Type</td><td><?= $ulogin1->getUserType()->getTypeName() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getEmail()))	{ ?> <tr><td>Email</td><td><?= $ulogin1->getEmail() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getPhone()))	{ ?> <tr><td>Phone</td><td><?= $ulogin1->getPhone() ?></td></tr> <?php }?>
<?php if ($ulogin1->isRoot())	{ ?> <tr><td colspan="2"><b>IS ROOT USER</b></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getLastLoginTime()))	{ ?> <tr><td>Last Login Time</td><td><?= $ulogin1->getLastLoginTime()->getDateAndTimeString() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getAdmissionTime()))	{ ?> <tr><td>Time of Admission</td><td><?= $ulogin1->getAdmissionTime()->getDateAndTimeString() ?></td></tr> <?php }?>
<?php if (! is_null($ulogin1->getAdmittedBy()))	{ ?> <tr><td>Admitted By</td><td><?= $ulogin1->getAdmittedBy() ?></td></tr> <?php }?>
					</tbody>
				</table>
			</div>
			<div class="ui-sys-panel-footer">
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managelogin_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit/Modify User Account" href="<?= $thispage ?>?page=managelogin_edit&userinformation=true&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
?>
				</div>
				<a href="<?= $thispage ?>?page=managelogin&userinformation=true">Back to General User Accounts</a>
			</div>
		</div>
<?php
	 } else if ($page == "managelogin" && isset($_REQUEST['userinformation']) && Authorize::isAllowable($config, "managelogin", "normal", "setlog", "-1", "-1"))	{
		 //Saving Authorization rules
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managelogin_detail", "normal", "donotsetlog", "-1", "-1");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Login Accounts Management</div>
			<div class="ui-sys-panel-body">
<?php 
	//Beginning Search Query
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
	<!--Block ONE Begins-->
		<div class="ui-sys-query-container" style="position: relative; padding-bottom: 10px; border-bottom: 2px dotted blue; margin-bottom: 10px;">
			<form id="form1" class="pure-form pure-form-stacked" method="POST" action="<?= $thispage ?>" style="font-size: 0.8em;">
				<input type="hidden" name="page" value="managelogin"/>
				<input type="hidden" name="userinformation" value="true"/>
				<input type="hidden" name="searchquery" value="rndx"/>
				<fieldset class="ui-sys-data-capture">
					<legend>User Account Search</legend>
					<div class="pure-g">
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="firstname">First Name</label>
							<input type="text" id="firstname" name="firstname" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="First Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="middlename">Middle Name</label>
							<input type="text" id="middlename" name="middlename" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Middle Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="lastname">Last Name</label>
							<input type="text" id="lastname" name="lastname" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Last Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="firstname">User Name</label>
							<input type="text" id="loginName" name="loginName" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprUsername ?>" validate_message="User Name : <?= $msgUsername ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="email">Email Address</label>
							<input type="text" id="email" name="email" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprEmail ?>%<?= $exprL32Name ?>" validate_message="Email Format: <?= $msgEmail ?>%Email Length: <?= $msgL32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="phone">Phone Number</label>
							<input type="text" id="phone" name="phone" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprPhone ?>" validate_message="Phone : <?= $msgPhone ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="dob" title="Date Of Birth">D.O.B</label>
							<input class="datepicker pure-u-23-24" type="text" name="dob" id="dob" size="32" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="DOB: <?= $msgDate ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = Sex::loadAllData($database, $conn);
?>
							<label for="sexId">Sex</label>
							<select id="sexId" name="sexId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = Marital::loadAllData($database, $conn);
?>
							<label for="maritalId">Marriage Status</label>
							<select id="maritalId" name="maritalId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="admittedBy">Admitted By</label>
							<input type="text" id="admittedBy" name="admittedBy" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Admitted By : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = JobTitle::loadAllData($database, $conn);
?>
							<label for="jobId">Job Title</label>
							<select id="jobId" name="jobId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = Group::loadAllData($database, $conn);
?>
							<label for="groupId">Group</label>
							<select id="groupId" name="groupId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = UserType::loadAllData($database, $conn);
?>
							<label for="typeId">User Type</label>
							<select id="typeId" name="typeId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
<?php 
	$list = UserStatus::loadAllData($database, $conn);
?>
							<label for="statusId">User Status</label>
							<select id="statusId" name="statusId" class="pure-input-1-2">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</fieldset>
			</form>
			<div class="ui-sys-inline-controls-right" style="font-size: 1.3em;">
				<input id="__add_record" type="button" value="Fetch Results"/>
			</div>
		</div>
	<!--Block ONE Ends-->
<?php
	mysql_close($conn);
?>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
	<!--Block TWO Begin-->
<?php 
	if (isset($_REQUEST['searchquery']))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$collection1 = new Collection();
		if (trim($_REQUEST['firstname']) != "") { $firstname = mysql_real_escape_string($_REQUEST['firstname']); $collection1->addItem("login.firstname='$firstname'"); }
		if (trim($_REQUEST['middlename']) != "")	{ $middlename = mysql_real_escape_string($_REQUEST['middlename']); $collection1->addItem("login.middlename='$middlename'"); }
		if (trim($_REQUEST['lastname']) != "")	{ $lastname = mysql_real_escape_string($_REQUEST['lastname']); $collection1->addItem("login.lastname='$lastname'"); }
		if (trim($_REQUEST['loginName']) != "")	{ $loginName = mysql_real_escape_string($_REQUEST['loginName']); $collection1->addItem("login.loginName='$loginName'"); }
		if (trim($_REQUEST['email']) != "") 	{ $email = mysql_real_escape_string($_REQUEST['email']); $collection1->addItem("login.email='$email'"); }
		if (trim($_REQUEST['phone']) != "") 	{ $phone = mysql_real_escape_string($_REQUEST['phone']); $collection1->addItem("login.phone='$phone'"); }
		if (trim($_REQUEST['dob'])	!= "")	{ try {	$dob = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($_REQUEST['dob']); $collection1->addItem("login.dob='$dob'"); } catch(Exception $e)	{} }
		if (trim($_REQUEST['sexId']) != "")	{ $sexId = mysql_real_escape_string($_REQUEST['sexId']); $collection1->addItem("login.sexId='$sexId'"); }
		if (trim($_REQUEST['maritalId']) != "")	{ $maritalId = mysql_real_escape_string($_REQUEST['maritalId']); $collection1->addItem("login.maritalId='$maritalId'"); }
		if (trim($_REQUEST['admittedBy']) != "")	{ $admittedBy = mysql_real_escape_string($_REQUEST['admittedBy']); $collection1->addItem("login.admittedBy='$admittedBy'"); }
		if (trim($_REQUEST['jobId']) != "")	{ $jobId = mysql_real_escape_string($_REQUEST['jobId']); $collection1->addItem("login.jobId='$jobId'"); }
		if (trim($_REQUEST['groupId']) != "")	{ $groupId = mysql_real_escape_string($_REQUEST['groupId']); $collection1->addItem("login.groupId='$groupId'"); }
		if (trim($_REQUEST['typeId']) != "")	{ $typeId = mysql_real_escape_string($_REQUEST['typeId']); $collection1->addItem("login.typeId='$typeId'"); }
		if (trim($_REQUEST['statusId']) != "")	{ $statusId = mysql_real_escape_string($_REQUEST['statusId']); $collection1->addItem("login.statusId='$statusId'"); }
		//Building a query now 
		$query = "SELECT loginId FROM login";
		$collectionList = $collection1->getCollection();
		if (sizeof($collectionList) > 0)	{
			$count = 0;
			foreach ($collectionList as $item)	{
				if ($count == 0) $query .= " WHERE ".$item;
				else $query .= " AND ".$item;
				$count++;
			}
		}
?>
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Username</th>
				<th>Name</th>
				<th>Status</th>
				<th>D.O.B</th>
				<th>Type</th>
				<th>Email</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch user data from the storage ".mysql_error());
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$ulogin1 = null;
		try 	{
			$ulogin1 = new Login($database, $id, $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		if (true)	{ //For Compliance Only
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			//Begin Local Calculations
			$statusName = "";
			if (! is_null($ulogin1->getUserStatus())) $statusName = $ulogin1->getUserStatus()->getStatusName();
			$dob = "";
			if (! is_null($ulogin1->getDOB())) $dob = DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB());
			$typeName = "";
			if (! is_null($ulogin1->getUserType())) $typeName = $ulogin1->getUserType()->getTypeName();
			$email = "";
			if (! is_null($ulogin1->getEmail())) $email = $ulogin1->getEmail();
			//End Local Calculations
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $ulogin1->getLoginName() ?></td>
				<td><?= $ulogin1->getFullname() ?></td>
				<td><?= $statusName ?></td>
				<td><?= $dob ?></td>
				<td><?= $typeName ?></td>
				<td><?= $email ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a title="Detail Summary" href="<?= $thispage ?>?page=managelogin_detail&userinformation=true&id=<?= $ulogin1->getLoginId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>			
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-if-true
	} //end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<?php
		mysql_close($conn);	
	} //end-searchquery
?>
	<!--Block TWO Ends-->
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	 }/*END Login Accounts INFORMATION*/else /*TOOLS.RESULTS SORT BEGIN*/if ($page == "manageresults_sort" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_sort", "normal", "setlog", "-1", "-1"))	{
		$filename = $_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE SORTING TOOL (Resources Release)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if (file_exists($filename) && unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server, perhaps the file does not exists
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageresults_sort">Back to File Sort</a></div>
		</div>
<?php 
	} else if ($page == "manageresults_sort" && isset($_REQUEST['download']) && Authorize::isAllowable($config, "manageresults_sort", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$filename = "";
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		try {
			$filename1 = $_REQUEST['filename1'];
			if (! file_exists($filename1)) Object::shootException("Data file does not exists");
			$column1 = $_REQUEST['column1']; 
			$resultsFile1 = new ResultsFile($database, $filename1, $conn);
			if (! unlink($filename1)) Object::shootException("Could not remove a temporary data file");
			$resultsFile1 = $resultsFile1->customSort($column1, isset($_REQUEST['descending']));
			$filename = rand(1,100).$date;
			$filename = "../temp/".md5($filename).".csv";
			$resultsFile1->setFilename($filename);
			$resultsFile1->save();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE SORTING TOOL (Download)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in sorting your data <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if ($promise1->isPromising())	{
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageresults_sort&report=<?= $filename ?>">Proceed</a>
<?php
	}
?>			
			</div>
		</div>
<?php 
	} else if ($page == "manageresults_sort" && isset($_REQUEST['management']) && Authorize::isAllowable($config, "manageresults_sort", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$filename1 = "";
		$numberOfColumns = 0;
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		try {
			$maximumFileSize = 2097153;
			$dataFolder = "../temp/";
			$promise1 = Object::checkUploadedFile($_FILES['file1'], array("text/csv"), array("csv"), $maximumFileSize);
			if (! $promise1->isPromising()) Object::shootException("Original [Unsorted] File : ".$promise1->getReason());
			$filename1 = $dataFolder.md5(rand(1,100)).".csv";
			if (! move_uploaded_file($promise1->getResults(), $filename1)) Object::shootException("Could not save a temporary data file");
			$resultsFile1 = new ResultsFile($database, $filename1, $conn);
			$numberOfColumns = $resultsFile1->getColumnCount();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE SORTING TOOL (Management)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
<?php 
	if ($promise1->isPromising())	{
?>
				<form id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_sort"/>
					<input type="hidden" name="download" value="true"/>
					<input type="hidden" name="filename1" value="<?= $filename1 ?>"/>
						<div style="width: 90%; margin-left: auto; margin-right: auto;">
							<table class="pure-table pure-table-horizontal" style="width: 100%; margin-left: auto; margin-right: auto;">
								<thead>
									<tr>
										<th class="ui-sys-inline-controls-center" colspan="2">Management Window</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td><label for="column1">Sort According to Column </label>&nbsp;&nbsp;&nbsp;&nbsp;<label><input type="checkbox" name="descending" value="1" title="Check if in Descending Order"/> Descending Order?</label></td>
										<td>
											<select id="column1" name="column1" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Column">
												<option value="_@32767@_">--select--</option>
<?php 
	for ($i = 0; $i < $numberOfColumns; $i++)	{
?>
		<option value="<?= $i ?>">Column <?= $i + 1 ?></option>
<?php
	}
?>
											</select>
										</td>
									</tr>
									<tr><td colspan="2">&nbsp;</td></tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="2" id="perror" class="ui-sys-error-message"></td>
									</tr>
									<tr>
										<td colspan="2">
											<input type="button" value="Sort Files" id="__add_record"/>
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
				</form>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in the sorting process <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div> 
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresults_sort" && Authorize::isAllowable($config, "manageresults_sort", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE SORTING TOOL (Upload Files)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form id="form1" class="pure-form" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="manageresults_sort"/>
					<input type="hidden" name="management" value="true"/>
							<div style="width: 90%; margin-left: auto; margin-right: auto;">
						<table class="pure-table pure-table-horizontal" style="width: 100%;">
							<thead>
								<tr>
									<th></th><th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td><label title="Your Original Results File">Results File (Unsorted)</label></td>
									<td><input class="ui-sys-file-upload" data-capture="0" type="file" name="file1" accept="*.csv"/></td>
								</tr>
							</tbody>
						</table>
							</div>
					<div class="pure-controls ui-sys-error-message" id="perror"></div><br/><br/>
					<div class="pure-controls ui-sys-inline-controls-right"><input type="button" id="__add_record" value="Sort Files"/></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('input.ui-sys-file-upload').on('change', function(event)	{
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		var $fileList1 = $('input.ui-sys-file-upload');
		if (! $fileList1.length) return;
		var blnValid = true;
		$fileList1.each(function(i, file1)	{
			var $file1 = $(file1);
			blnValid = blnValid && (parseInt($file1.prop('data-capture')) == 1);
		});
		if (blnValid)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('File must be Uploaded')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php 
	} /*TOOLS.RESULTS SORT ENDS*/ else/*BEGIN Examination Signing Sheet*/if ($page == "manageexamination_signing_sheet" && isset($_REQUEST['pdfdownload']) && Authorize::isAllowable($config, "manageexamination_signing_sheet", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		//Working Folder ../temp/
		$folder = "../temp/";
		$pdfFile = $folder.Object::getRandomMD5Key().".pdf";
		try {
			$windowToDisplay = Examination::displayExaminationSigningSheet($database, $conn, $profile1, $_REQUEST['courseId'], $_REQUEST['year'], $_REQUEST['semester'], $_REQUEST['paperId'], $_REQUEST['controlFlags']);
			//Do HTML Wrapper 
			$htmlFileContent = Object::getWrappedHTMLFileContent("Examination Signing Sheet", $windowToDisplay);
			//Put Content to HML File
			$htmlFile = Object::getRandomMD5Key().".html";
			$htmlFullPath = $folder.$htmlFile;
			if (! file_put_contents($htmlFullPath, $htmlFileContent)) Object::shootException("Could not create a temporaty HTML File");
			//Execute the pdf creation 
			$sourceFile = "http://".$profile1->getServerIPAddress()."/school/temp/".$htmlFile;
			Object::linuxWKHTMLTOPDFCommand($sourceFile, $pdfFile);
			unlink($htmlFullPath); 
			if (! file_exists($pdfFile)) Object::shootException("The PDF File Could not be created, perhaps the host server operating system could not support");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setpromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Signing Sheet <br/>PDF Download</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Get your PDF Download <a target="_blank" href="<?= $pdfFile ?>">Here</a>
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in downloading the Pdf file <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination_signing_sheet" && isset($_REQUEST['printpreview']) && Authorize::isAllowable($config, "manageexamination_signing_sheet", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$windowToDisplay = "";
		$controlFlags = 0;
		if (isset($_REQUEST['includeNames'])) $controlFlags = Object::setControlFlagsAt($controlFlags, $_REQUEST['includeNames']);
		if (isset($_REQUEST['includeRegistrationNumbers'])) $controlFlags = Object::setControlFlagsAt($controlFlags, $_REQUEST['includeRegistrationNumbers']);
		try {
			$windowToDisplay = Examination::displayExaminationSigningSheet($database, $conn, $profile1, $_REQUEST['courseId'], $_REQUEST['year'], $_REQUEST['semester'], $_REQUEST['paperId'], $controlFlags);
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Signing Sheet</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-float-right"><a href="#" class="menu-icon menu-icon-print" data-content-container="__examination_signing_sheet"><img title="Click Here to Print" alt="PRT" src="../sysimage/print.png"/></a><a href="<?= $thispage ?>?page=manageexamination_signing_sheet&pdfdownload=true&courseId=<?= $_REQUEST['courseId'] ?>&year=<?= $_REQUEST['year'] ?>&semester=<?= $_REQUEST['semester'] ?>&paperId=<?= $_REQUEST['paperId'] ?>&controlFlags=<?= $controlFlags ?>" class="menu-icon" data-content-container="__examination_signing_sheet"><img title="Click to Dowload Pdf File" alt="PDF" src="../sysimage/pdf.png"/></a></div>
		<div class="ui-sys-clear-both">&nbsp;</div>
		<div style="background-color: black; overflow-x: scroll; padding: 5px;">
<?php 
	echo $windowToDisplay;
?>		
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems on creating your examination signing sheet <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageexamination_signing_sheet">Download Another Sheet</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination_signing_sheet" && Authorize::isAllowable($config, "manageexamination_signing_sheet", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Signing Sheet</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form id="form1" class="pure-form pure-form-aligned" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexamination_signing_sheet"/>
					<input type="hidden" name="printpreview" value="true"/>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option data-course-duration="0" value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year Signing Sheet belongs to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div> 
					<div class="pure-control-group">
						<label for="semester" title="Select Semester you are moving to">Current Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Semester">
							<option value="_@32767@_">--select--</option>
<?php 
	$semesterLimit = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $semesterLimit; $i++)	{
?>
		<option value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="paperId" title="The Paper will be used for both Print Preview and Printing">Printing Paper</label>
						<select id="paperId" name="paperId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Printing Paper">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = Paper::loadAllData($database, $conn);
	foreach ($list as $alist)	{
		$paper1 = new Paper($database, $alist['id'], $conn);
		$paperCaption = $paper1->getPaperName()." (".$paper1->getWidth()."mm X ".$paper1->getHeight()."mm)";
?>
		<option value="<?= $paper1->getPaperId() ?>"><?= $paperCaption ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<label><input type="checkbox" name="includeNames" value="<?= Examination::$__INCLUDE_NAMES ?>"/> Include Student Names</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<label><input type="checkbox" name="includeRegistrationNumbers" value="<?= Examination::$__INCLUDE_REGISTRATION_NUMBERS ?>"/> Include Registration Numbers</label>
					</div>
					<div class="pure-controls ui-sys-error-message" id="perror"></div>
					<div class="ui-sys-inline-controls-right"><input type="button" id="__add_record" value="Proceed"/></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*END Examination Signing Sheet*/else /*Wireless Connection BEGIN*/if ($page == "managewireless_disconnect" && isset($_REQUEST['report']) && isset($_REQUEST['id']) && isset($_REQUEST['userid']) && isset($_REQUEST['type']) && Authorize::isAllowable($config, "managewireless_disconnect", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$connection1 = null;
		try {
			$connection1 = new WirelessConnection($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Disconnect Device<br/><?= $connection1->getUsername() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$username = $connection1->getUsername();
	$radius1 = null;
	try {
		$radiusdb="radius";
		$radiusId = Radius::getReferenceFromUsername($radiusdb, $conn, $username);
		if (! is_null($radiusId)) $radius1 = new Radius($radiusdb, $radiusId, $conn);
		//Remove Radius first 
		if (! is_null($radius1))	{
			$radius1->commitDelete();
		}
		//Now delete the connection identifier 
		$connection1->commitDelete();
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The device identified with mac-address of <b><?= $username ?></b> has been removed successful from the system
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in remove the device identified with mac-address of <b><?= $username ?></b><br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['userid'] ?>">Back to User Detail Page</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managewireless_disconnect", "MAC : $username , disconnected");
	} else if ($page == "managewireless_disconnect" && isset($_REQUEST['id']) && isset($_REQUEST['userid']) && isset($_REQUEST['type']) && Authorize::isAllowable($config, "managewireless_disconnect", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$connection1 = null;
		try {
			$connection1 = new WirelessConnection($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Disconnect Device<br/><?= $connection1->getUsername() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove the machine with mac-address of <b><?= $connection1->getUsername() ?></b> from the system <br/>
					<b>NOTE</b> : This process can not be reversed
				</div>
				<div>
					<a class="button-link" href="<?= $thispage ?>?page=managewireless_disconnect&id=<?= $connection1->getConnectionId() ?>&type=<?= $_REQUEST['type'] ?>&userid=<?= $_REQUEST['userid'] ?>&report=true">CONFIRM REMOVE</a>&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['userid'] ?>">CANCEL</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managewireless_connect" && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && isset($_REQUEST['userid']) && isset($_REQUEST['type']) && Authorize::isAllowable($config, "managewireless_connect", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$username = strtolower(mysql_real_escape_string($_REQUEST['username']));
		$ulogin1 = null;
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Wireless Connection<br/><?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	try {
		if (trim($_REQUEST['rndx']) != $ulogin1->getExtraFilter()) Object::shootException("The System has detected you are replaying data in your Browser");
		if (isset($_REQUEST['vendorName']))	{
			$vendorName = mysql_real_escape_string($_REQUEST['vendorName']);
			$vendorOUI = MACOUILookup::getVendorOUIFromMacAddress($username);
			$extraFilter = System::getCodeString(8);
			$query = "INSERT INTO macOUILookup (vendorName, vendorOUI, extraFilter) VALUES ('$vendorName', '$vendorOUI', '$extraFilter')";
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Could not Add vendor [$vendorName] in the system");
		} //Vendor Name Processing ends here
		//Now do Insertion 
		/*
		Add the record first in the system , then add in radius 
		Use the Intefaces Generated in system.php 
		*/
		$wirelessId = WirelessConnection::add($database, $conn, $ulogin1->getLoginId(), $username, $systemTime1->getDateAndTimeString(), "WiFI-ID", System::getCodeString(8), mysql_real_escape_string($ulogin1->getFullname()), "15");
		//Now in Radius 
		$radiusdb = "radius";
		$attribute = "Auth-Type";
		$op = ":=";
		$value = "Accept";
		$radiusId = Radius::add($radiusdb, $conn, $username, $attribute, $op, $value);
		$ulogin1->setExtraFilter(System::getCodeString(8));
		$ulogin1->commitUpdate();
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The machine with a MAC Address of <?= $username ?> has been connected successful to the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in connecting your device <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['userid'] ?>">Back <?= $ulogin1->getFullname() ?> Page</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managewireless_connect", "MAC : $username , for ".$ulogin1->getFullname());
	} else if ($page == "managewireless_connect" && isset($_REQUEST['id']) && isset($_REQUEST['userid']) && isset($_REQUEST['type']) && Authorize::isAllowable($config, "managewireless_connect", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$ulogin1 = null;
		$username = $_REQUEST['username']; //No Database for now
		$vendorName = null;
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			$ulogin1->setExtraFilter(System::getCodeString(8));
			$ulogin1->commitUpdate();
			$vendorName = MACOUILookup::getVendorNameFromMacAddress($database, $conn, $username);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Wireless Connection<br/><?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to register a device with mac-address of <b><?= $username ?></b> to <b><?= $ulogin1->getFullname() ?></b><br/>
<?php 
	if (! is_null($vendorName))	{
		echo "Vendo is <b>$vendorName</b>";
	}
?>					
				</div>
				<div class="ui-sys-inline-controls-center">
					<form id="form1" class="pure-form" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managewireless_connect"/>
						<input type="hidden" name="id" value="<?= $ulogin1->getLoginId() ?>"/>
						<input type="hidden" name="userid" value="<?= $_REQUEST['userid'] ?>"/>
						<input type="hidden" name="type" value="<?= $_REQUEST['type'] ?>"/>
						<input type="hidden" name="report" value="true"/>
						<input type="hidden" name="rndx" value="<?= $ulogin1->getExtraFilter() ?>"/>
						<input type="hidden" name="username" value="<?= $username ?>"/>
<?php 
	if (is_null($vendorName))	{
?>
		<label>Vendor Name : <input type="text" id="vendorName" name="vendorName" size="32" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Vendor Name : <?= $msgA48Name ?>"/></label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<input type="button" value="Add Machine" id="__add_record"/>
<?php
	} else {
?>
		<div class="ui-sys-inline-controls-right"><input type="button" value="Add Machine" id="__add_record"/></div>
<?php
	}
?>
					</form>
					<div class="ui-sys-error-message" id="perror"></div>
				</div>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['userid'] ?>">Back <?= $ulogin1->getFullname() ?> Page</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror'); 
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managewireless" && isset($_REQUEST['id']) && isset($_REQUEST['userid']) && isset($_REQUEST['type']) && Authorize::isAllowable($config, "managewireless", "normal", "setlog", "-1", "-1"))	{
		$blnWirelessConnect = Authorize::isAllowable($config, "managewireless_connect", "normal", "donotsetlog", "-1", "-1");
		$blnWirelessDisconnect = Authorize::isAllowable($config, "managewireless_disconnect", "normal", "donotsetlog", "-1", "-1");
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$ulogin1 = null;
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Wireless Connection<br/>(<?= $ulogin1->getFullname() ?>)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<!--Already Connected Devices Begin-->
<?php 
	$list = WirelessConnection::getListOfConnectedDevicesForUser($database, $conn, $ulogin1->getLoginId());
	if (! is_null($list))	{
?>
		<div class="ui-widget ui-widget-content">
			<div class="ui-widget-header">List of Already Connected Devices</div>
			<div class="ui-sys-search-results">
				<table class="pure-table pure-table-horizontal ui-sys-table-search-results">
					<thead>
						<tr>
							<th></th>
							<th>Mac Address</th>
							<th>Vendor Name</th>
							<th>Time of Connection</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
<?php 
	$count=0;
	foreach ($list as $connectionId)	{
		$connection1 = null;
		$vendorName = "";
		$timeOfConnection = "";
		try {
			$connection1 = new WirelessConnection($database, $connectionId, $conn);
			$vendorName = MACOUILookup::getVendorNameFromMacAddress($database, $conn, $connection1->getUsername());
			if (is_null($vendorName)) $vendorName = "";
			if (! is_null($connection1->getTimeOfConnection())) $timeOfConnection = $connection1->getTimeOfConnection()->getDateAndTimeString();
		} catch (Exception $e)	{
			continue;
		}
		$count++;
?>
		<tr>
			<td><?= $count ?></td>
			<td><?= $connection1->getUsername() ?></td>
			<td><?= $vendorName ?></td>
			<td><?= $timeOfConnection ?></td>
			<td>
<?php 
	if ($blnWirelessDisconnect)	{
?>
				<a title="Remove <?= $connection1->getUsername() ?>" class="ui-sys-search-results-controls" href="<?= $thispage ?>?page=managewireless_disconnect&id=<?= $connection1->getConnectionId() ?>&type=<?= $_REQUEST['type'] ?>&userid=<?= $_REQUEST['userid'] ?>"><img src="../sysimage/buttondelete.png" alt="RM"/></a>
<?php
	}
?>			
			</td>
		</tr>
<?php
	}
?>
					</tbody>
				</table>
			</div>
			<div></div>
		</div><br/><br/>
<?php
	}
?>
<!--Already Connected Devices Ends-->
<!--Connect a new Machine Begin-->
<?php 
	if ($blnWirelessConnect)	{
?>
		<div class="ui-widget ui-widget-content">
			<div class="ui-widget-header">Connect a New Device</div>
			<div class="ui-sys-inline-controls-center">
				<form id="form1" class="pure-form" action="<?= $thispage ?>" method="POST">
					<input type="hidden" name="page" value="managewireless_connect"/>
					<input type="hidden" name="id" value="<?= $ulogin1->getLoginId() ?>"/>
					<input type="hidden" name="type" value="<?= $_REQUEST['type'] ?>"/>
					<input type="hidden" name="userid" value="<?= $_REQUEST['userid'] ?>"/>
					<label>Enter Mac Address : <input name="username" type="text" size="32" required pattern="<?= $exprMacAddress ?>" validate="true" validate_control="text" validate_expression="<?= $exprMacAddress ?>" validate_message="Mac Address , <?= $msgMacAddress ?>"/></label>&nbsp;&nbsp;<input type="button" id="__add_record" value="Add Machine"/><br/>
					<span id="perror" class="ui-sys-error-message"></span>
				</form>
			</div>
			<div></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror'); 
	});
})(jQuery);
</script>
<?php
	}
?>
<!--Connect a new Machine Ends-->
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['userid'] ?>">Back <?= $ulogin1->getFullname() ?> Page</a></div>
		</div>
<?php
		mysql_close($conn);
	}/*Wireless Connection ENDS*/else /*Paper BEGIN*/if ($page == "managepaper_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managepaper_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a></div>
		</div>
<?php
	} else if ($page == "managepaper_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managepaper_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Paper::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Paper[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$paper1 = null;
			try	{
				$paper1 = new Paper($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($paper1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managepaper_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managepaper_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managepaper_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managepaper_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managepaper_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managepaper_csv" && Authorize::isAllowable($config, "managepaper_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managepaper_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Paper::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managepaper_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managepaper_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$paper1 = null;
		try {
			 $paper1 = new Paper($database, $_REQUEST['id'], $conn);
			 $paper1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Paper which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Paper <?= $paper1->getPaperName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Paper <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managepaper_delete", "Deleted ".$paper1->getPaperName());
	} else if ($page == "managepaper_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managepaper_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$paper1 = null;
		try {
			$paper1 = new Paper($database, $_REQUEST['id'], $conn);
			$paper1->setExtraFilter(System::getCodeString(8));
			$paper1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Paper <b><?= $paper1->getPaperName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Paper <?= $paper1->getPaperName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managepaper_delete&report=io&id=<?= $paper1->getPaperId() ?>&rndx=<?= $paper1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managepaper">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managepaper_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managepaper_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$paper1 = null;
		try {
			$paper1 = new Paper($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$paperName = mysql_real_escape_string($_REQUEST['paperName']);
		$width = mysql_real_escape_string($_REQUEST['width']);
		$height = mysql_real_escape_string($_REQUEST['height']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($paperName != $paper1->getPaperName())	{
			$paper1->setPaperName($paperName); $enableUpdate = true;
		}
		if ($width != $paper1->getWidth())	{
			$paper1->setWidth($width); $enableUpdate = true;
		}
		if ($height != $paper1->getHeight())	{
			$paper1->setHeight($height); $enableUpdate = true;
		}
		if ($extraInformation != $paper1->getExtraInformation())	{
			$paper1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $paper1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$paper1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$paper1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Paper Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Paper <?= $paper1->getPaperName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the paper <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managepaper_edit", "Edited ".$paper1->getPaperName());
	} else if ($page == "managepaper_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managepaper_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$paper1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$paper1 = new Paper($database, $_REQUEST['id'], $conn);
			$paper1->setExtraFilter($extraFilter);
			$paper1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Paper <?= $paper1->getPaperName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managepaper_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $paper1->getPaperId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $paper1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="paperName">Paper Name </label>
						<input value="<?= $paper1->getPaperName() ?>" type="text" name="paperName" id="paperName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Paper Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="width">Width (mm) </label>
						<input value="<?= $paper1->getWidth() ?>" type="text" name="width" id="width" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Width: <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="height">Height (mm) </label>
						<input value="<?= $paper1->getHeight() ?>" type="text" name="height" id="height" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Height: <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $paper1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managepaper_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managepaper_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$paper1 = null;
		try {
			$paper1 = new Paper($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $paper1->getPaperName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Paper Name</td>
						<td><?= $paper1->getPaperName() ?></td>
					</tr>
					<tr>
						<td>Paper Width (mm) </td>
						<td><?= $paper1->getWidth() ?></td>
					</tr>
					<tr>
						<td>Paper Height (mm) </td>
						<td><?= $paper1->getHeight() ?></td>
					</tr>
<?php 
	if (! is_null($paper1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $paper1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managepaper_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $paper1->getPaperName() ?>" href="<?= $thispage ?>?page=managepaper_edit&id=<?= $paper1->getPaperId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managepaper_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $paper1->getPaperName() ?>" href="<?= $thispage ?>?page=managepaper_delete&id=<?= $paper1->getPaperId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managepaper_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managepaper_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$paperName = mysql_real_escape_string($_REQUEST['paperName']);
		$width = mysql_real_escape_string($_REQUEST['width']);
		$height = mysql_real_escape_string($_REQUEST['height']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $paperName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO paper (paperName, width, height, extraFilter, extraInformation) VALUES('$paperName', '$width', '$height', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Paper[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Paper <?= $paperName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the paper<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another Paper";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managepaper_add", "Added $paperName");
	} else if ($page == "managepaper_add" && Authorize::isAllowable($config, "managepaper_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Paper</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managepaper_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="paperName">Paper Name </label>
						<input type="text" name="paperName" id="paperName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Paper Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="width">Width (mm) </label>
						<input type="text" name="width" id="width" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Width: <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="height">Height (mm) </label>
						<input type="text" name="height" id="height" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Height: <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managepaper">Back to Paper Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managepaper" && Authorize::isAllowable($config, "managepaper", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Papers Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managepaper" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managepaper_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Paper Name</th>
				<th>Width (mm)</th>
				<th>Height (mm)</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Paper::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch paper data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$paper1 = null;
		try {
			$paper1 = new Paper($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($paper1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $paper1->getPaperName() ?></td>
				<td><?= $paper1->getWidth() ?></td>
				<td><?= $paper1->getHeight() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managepaper_detail&id=<?= $paper1->getPaperId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managepaper_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managepaper_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managepaper_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Paper" href="<?= $thispage ?>?page=managepaper_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer">
				
			</div>
		</div>
<?php
	}/*Paper End*/ else/*Briefcase Nullify BEGIN*/ if ($page == "managebriefcase_edit" && isset($_REQUEST['nullify']) &&  isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		$briefcaseName = "";
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			$briefcaseName = $briefcase1->getBriefcaseName();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase Nullification</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
			try {
				if (trim($_REQUEST['rndx']) != $briefcase1->getExtraFilter()) Object::shootException("The System has detected you are replaying data in the Browser");
				$briefcase1->setExtraInformation("../data/briefcase/"); //Save the datafolder for a while here 
				$briefcase1->nullifyMe();
				$enableUpdate = true;
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
			if ($promise1->isPromising())	{
?>
				<div class="ui-state-highlight">
					You have successful Nulified Briefcase, identified by <b><?= $briefcaseName ?></b>
				</div>
<?php
			} else {
?>
				<div class="ui-state-error">
					The Nullification process could not complete successful, kindly try again <br/>
					Details: <?= $promise1->getReason() ?>
				</div>
<?php
			}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">Back to Briefcase Details</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_edit", "Nulified $briefcaseName");
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['nullify'])&& isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		$briefcaseName = "";
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			$briefcaseName = $briefcase1->getBriefcaseName();
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase Nullification</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					<b>WARNING</b>: Are you sure you want to remove results identified by <b><?= $briefcaseName ?></b> from the system?
				</div><br/>
				<div class="ui-sys-inline-controls-center">
					<form method="POST" action="<?= $thispage ?>"> 
						<input type="hidden" name="page" value="managebriefcase_edit"/>
						<input type="hidden" name="rndx" value="<?= $briefcase1->getExtraFilter() ?>"/>
						<input type="hidden" name="id" value="<?= $briefcase1->getBriefcaseId() ?>"/>
						<input type="hidden" name="nullify" value="<?= $_REQUEST['nullify'] ?>"/>
						<input type="hidden" name="report" value="true"/>
						<input type="submit" value="Proceed (Yes)"/>&nbsp;&nbsp;<a class="button-link" href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">No (Cancel)</a>
					</form>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} /*Briefcase Nullify Ends*/else  /*TOOLS.FILES COMPARE BEGIN*/if ($page == "managefiles_compare" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managefiles_compare", "normal", "setlog", "-1", "-1"))	{
		$filename = $_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE COMPARISON TOOL (Resources Release)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if (file_exists($filename) && unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server, perhaps the file does not exists
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managefiles_compare">Back to File Compare</a></div>
		</div>
<?php 
	} else if ($page == "managefiles_compare" && isset($_REQUEST['download']) && Authorize::isAllowable($config, "managefiles_compare", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$filename = "";
		try {
			$filename1 = $_REQUEST['filename1'];
			$filename2 = $_REQUEST['filename2'];
			if (! file_exists($filename1)) Object::shootException("Data file does not exists");
			if (! file_exists($filename2)) Object::shootException("Reference file does not exists");
			$fileManager1 = new FileManager($filename1);
			if (! unlink($filename1)) Object::shootException("Could not remove a temporary data file");
			$fileManager2 = new FileManager($filename2);
			if (! unlink($filename2)) Object::shootException("Could not remove a temporary reference file");
			$filename = rand(1,100).$date;
			$filename = "../temp/".md5($filename).".csv";
			$outputFilemanager1 = FileManager::compareFileManagers($fileManager1, $fileManager2, $filename, $_REQUEST['column1'], $_REQUEST['column2'], isset($_REQUEST['chkmatch1']), 0);
			$outputFilemanager1->save();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE COMPARISON TOOL (Download)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in matching your data <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if ($promise1->isPromising())	{
?>
		<a class="button-link" href="<?= $thispage ?>?page=managefiles_compare&report=<?= $filename ?>">Proceed</a>
<?php
	}
?>			
			</div>
		</div>
<?php 
	} else if ($page == "managefiles_compare" && isset($_REQUEST['management']) && Authorize::isAllowable($config, "managefiles_compare", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$headerLine1 = null;
		$headerLine2 = null;
		$filename1 = "";
		$filename2 = "";
		try {
			$maximumFileSize = 2097153;
			$dataFolder = "../temp/";
			$promise1 = Object::checkUploadedFile($_FILES['file1'], array("text/csv"), array("csv"), $maximumFileSize);
			if (! $promise1->isPromising()) Object::shootException("Data File : ".$promise1->getReason());
			$filename1 = $dataFolder.md5(rand(1,100)).".csv";
			if (! move_uploaded_file($promise1->getResults(), $filename1)) Object::shootException("Could not save a temporary data file");
			$promise1 = Object::checkUploadedFile($_FILES['file2'], array("text/csv"), array("csv"), $maximumFileSize);
			if (! $promise1->isPromising()) Object::shootException("Reference File : ".$promise1->getReason());
			$filename2 = $dataFolder.md5(rand(101,200)).".csv";
			if (! move_uploaded_file($promise1->getResults(), $filename2)) Object::shootException("Could not save a temporary reference file");
			$headerLine1 = FileHeader::getFileHeaderFromFile($filename1);
			$headerLine2 = FileHeader::getFileHeaderFromFile($filename2);
			if (is_null($headerLine1)) Object::shootException("Empty HeaderLine1 were returned");
			if (is_null($headerLine2)) Object::shootException("Empty HeaderLine2 were returned");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE COMPARISON TOOL (Management)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
<?php 
	if ($promise1->isPromising())	{
?>
				<form id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefiles_compare"/>
					<input type="hidden" name="download" value="true"/>
					<input type="hidden" name="filename1" value="<?= $filename1 ?>"/>
					<input type="hidden" name="filename2" value="<?= $filename2 ?>"/>
						<div style="width: 90%; margin-left: auto; margin-right: auto;">
							<table class="pure-table pure-table-horizontal">
								<thead>
									<tr>
										<th class="ui-sys-inline-controls-center" colspan="2">Management Window</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td><label for="column1">Column in the Data File </label></td>
										<td>
											<select id="column1" name="column1" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Data Column">
												<option value="_@32767@_">--select--</option>
<?php 
	$list = $headerLine1->getListOfHeaders();
	if (! is_null($list))	{
		foreach ($list as $item)	{
?>
			<option value="<?= $item ?>"><?= $item ?></option>
<?php
		}
	}
?>
											</select>
										</td>
									</tr>
									<tr>
										<td><label for="column1">Column in the Referece File </label></td>
										<td>
											<select id="column2" name="column2" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Reference Column">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = $headerLine2->getListOfHeaders();
	if (! is_null($list))	{
		foreach ($list as $item)	{
?>
			<option value="<?= $item ?>"><?= $item ?></option>
<?php
		}
	}
?>
											</select>
										</td>
									</tr>
									<tr><td colspan="2">&nbsp;</td></tr>
								</tbody>
								<tfoot>
									<tr>
										<td colspan="2" id="perror" class="ui-sys-error-message"></td>
									</tr>
									<tr>
										<td colspan="2">
											<label title="If you check this box, only lines matching in both data and reference file will be returned, otherwise only colums which are in data file but not in reference file"><input type="checkbox" name="chkmatch1" value="1"/> Match Columns</label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
											<input type="button" value="Compare Files" id="__add_record"/>
										</td>
									</tr>
								</tfoot>
							</table>
						</div>
				</form>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in the comparison process <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div> 
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managefiles_compare" && Authorize::isAllowable($config, "managefiles_compare", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FILE COMPARISON TOOL (Upload Files)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form id="form1" class="pure-form" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="managefiles_compare"/>
					<input type="hidden" name="management" value="true"/>
							<div style="width: 90%; margin-left: auto; margin-right: auto;">
						<table class="pure-table pure-table-horizontal" style="width: 100%;">
							<thead>
								<tr>
									<th></th><th></th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td><label title="The File which contains your data">Data File</label></td>
									<td><input class="ui-sys-file-upload" data-capture="0" type="file" name="file1" accept="*.csv"/></td>
								</tr>
								<tr>
									<td><label title="The File which contains the reference data">Reference File</label></td>
									<td><input class="ui-sys-file-upload" data-capture="0" type="file" name="file2" accept="*.csv"/></td>
								</tr>
							</tbody>
						</table>
							</div>
					<div class="pure-controls ui-sys-error-message" id="perror"></div><br/><br/>
					<div class="pure-controls ui-sys-inline-controls-right"><input type="button" id="__add_record" value="Compare Files"/></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('input.ui-sys-file-upload').on('change', function(event)	{
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		var $fileList1 = $('input.ui-sys-file-upload');
		if (! $fileList1.length) return;
		var blnValid = true;
		$fileList1.each(function(i, file1)	{
			var $file1 = $(file1);
			blnValid = blnValid && (parseInt($file1.prop('data-capture')) == 1);
		});
		if (blnValid)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('Both of the Two files must be uploaded')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php 
	} /*TOOLS.FILES COMPARE ENDS*/ else/*EntryCriteria BEGIN*/if ($page == "manageentrycriteria_add" && isset($_REQUEST['bulk']) && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		try {
			$promise1 = EntryCriteria::addBulkEntryCriterias($database, $conn, $_REQUEST['levelId'], $_REQUEST['criteria']);
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Bulk Entry Criteria Management</div>
			<div class="ui-sys-panel-body ui-widget-content ui-sys-data-capture ui-sys-inline-controls-center">
<?php 
	if ($promise1->isPromising())	{
?>
			<div class="ui-state-highlight">
				Congratulations, you have successful updated entry criterias
			</div>
<?php
	} else {
		$enableUpdate = false;
?>
			<div class="ui-state-error">
				There were problems in adding criterias <br/>
				Details : <?= $promise1->getReason() ?>
			</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageentrycriteria">Back to Entry Criteria Management</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_add", "Bulk Add Criteria");
	} else if ($page == "manageentrycriteria_add" && isset($_REQUEST['bulk']) && isset($_REQUEST['levelId']) && Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$count = intval($_REQUEST['count']);
		$level1 = null;
		try {
			$level1 = new EducationLevel($database, $_REQUEST['levelId'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Bulk Entry Criteria Management<br/>(<?= $level1->getLevelName() ?>)</div>
			<div class="ui-sys-panel-body ui-widget-content ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageentrycriteria_add"/>
					<input type="hidden" name="bulk" value="<?= $_REQUEST['bulk'] ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="levelId" value="<?= $level1->getLevelId() ?>"/>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	for ($i=0; $i < $count; $i++)	{
?>
					<div class="pure-control-group">
						<label for="_criteria<?= $i ?>">Entry Criteria (<?= $i + 1 ?>) </label>
						<select id="_criteria<?= $i ?>" name="criteria[<?= $i ?>]" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Criteria at Row <?= $i+1 ?>">
							<option value="_@32767@_">--select--</option>
<?php 
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php
	} //--end-for
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Bulk Entry Criterias"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageentrycriteria">Back to Entry Criteria Management</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_add" && isset($_REQUEST['bulk']) && Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Bulk Entry Criteria Management</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageentrycriteria_add"/>
					<input type="hidden" name="bulk" value="<?= $_REQUEST['bulk'] ?>"/>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label title="These are number of Education Levels , a student need to have as Entry Criteria" for="weight">Number of Criterias</label>
						<input class="text-can-not-be-zero" type="text" name="count" id="count" size="16" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Criteria Count : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Bulk Entry Criterias"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageentrycriteria">Back to Entry Criteria Management</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Criteria Count Can not be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_exclusioncriterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Targets Map from ".$criteria1->getCourse()->getCourseName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Dettach");
			$listToUpdate = Object::detachIdListFromObjectList($criteria1->getExclusionCriteriaList(), $_REQUEST['did']);
			$criteria1->setExclusionCriteriaList($listToUpdate);
			$criteria1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Criteria List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Criteria List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_edit", "Detach Criteria Lists for ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_exclusioncriterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Criteria List to ".$criteria1->getCourse()->getCourseName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($criteria1->getExclusionCriteriaList(), $_REQUEST['did']);
			$criteria1->setExclusionCriteriaList($listToUpdate);
			$criteria1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Criteria List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Criteria List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_edit", "Attach Criteria Lists for ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_exclusioncriterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Criteria List to ".$criteria1->getCourse()->getCourseName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($criteria1->getExclusionCriteriaList()) && sizeof($criteria1->getExclusionCriteriaList()) > 0)	{
		$objectList1 = $criteria1->getExclusionCriteriaList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="manageentrycriteria_edit"/>
				<input type="hidden" name="id" value="<?= $criteria1->getCriteriaId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_exclusioncriterialist" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
					<tr>
						<th colspan="4">Criteria List</th>
					</tr>
					<tr>
						<th></th>
						<th>S/N</th>
						<th>Level Name</th>
						<th>Level Code</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getLevelId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getLevelName() ?></td>
			<td><?= $obj1->getLevelCode() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Criteria List"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageentrycriteria_edit&id=<?= $criteria1->getCriteriaId() ?>&attach_exclusioncriterialist=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="manageentrycriteria_edit"/>
		<input type="hidden" name="id" value="<?= $criteria1->getCriteriaId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_exclusioncriterialist" value="true"/>
		<table class="pure-table ui-sys-search-results-2 ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Level Name</th>
					<th>Level Code</th>
				</tr>
			</thead>
<?php 
	$query = EducationLevel::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new EducationLevel($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getLevelId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getLevelName() ?></td>
				<td><?= $transaction1->getLevelCode() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Criteria List"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_criterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Targets Map from ".$criteria1->getCourse()->getCourseName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Dettach");
			$listToUpdate = Object::detachIdListFromObjectList($criteria1->getCriteriaList(), $_REQUEST['did']);
			$criteria1->setCriteriaList($listToUpdate);
			$criteria1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Criteria List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Criteria List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_edit", "Detach Criteria Lists for ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_criterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Criteria List to ".$criteria1->getCourse()->getCourseName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($criteria1->getCriteriaList(), $_REQUEST['did']);
			$criteria1->setCriteriaList($listToUpdate);
			$criteria1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Criteria List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Criteria List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_edit", "Attach Criteria Lists for ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_criterialist']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		$headerText = "UNKNOWN";
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Criteria List to ".$criteria1->getCourse()->getCourseName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($criteria1->getCriteriaList()) && sizeof($criteria1->getCriteriaList()) > 0)	{
		$objectList1 = $criteria1->getCriteriaList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="manageentrycriteria_edit"/>
				<input type="hidden" name="id" value="<?= $criteria1->getCriteriaId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_criterialist" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
					<tr>
						<th colspan="4">Criteria List</th>
					</tr>
					<tr>
						<th></th>
						<th>S/N</th>
						<th>Level Name</th>
						<th>Level Code</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getLevelId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getLevelName() ?></td>
			<td><?= $obj1->getLevelCode() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Criteria List"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageentrycriteria_edit&id=<?= $criteria1->getCriteriaId() ?>&attach_criterialist=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="manageentrycriteria_edit"/>
		<input type="hidden" name="id" value="<?= $criteria1->getCriteriaId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_criterialist" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Level Name</th>
					<th>Level Code</th>
				</tr>
			</thead>
<?php 
	$query = EducationLevel::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new EducationLevel($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getLevelId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getLevelName() ?></td>
				<td><?= $transaction1->getLevelCode() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Criteria List"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageentrycriteria_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
	} else if ($page == "manageentrycriteria_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageentrycriteria_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = EntryCriteria::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("EntryCriteria[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$criteria1 = null;
			try	{
				$criteria1 = new EntryCriteria($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($criteria1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageentrycriteria_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageentrycriteria_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageentrycriteria_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageentrycriteria_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageentrycriteria_csv" && Authorize::isAllowable($config, "manageentrycriteria_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageentrycriteria_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, EntryCriteria::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageentrycriteria_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageentrycriteria_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$criteria1 = null;
		try {
			 $criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			 $criteria1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a EntryCriteria which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The EntryCriteria <?= $criteria1->getCourse()->getCourseName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the EntryCriteria <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_delete", "Deleted ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageentrycriteria_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$criteria1 = null;
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$criteria1->setExtraFilter(System::getCodeString(8));
			$criteria1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a EntryCriteria <b><?= $criteria1->getCourse()->getCourseName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the EntryCriteria <?= $criteria1->getCourse()->getCourseName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageentrycriteria_delete&report=io&id=<?= $criteria1->getCriteriaId() ?>&rndx=<?= $criteria1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageentrycriteria">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$criteria1 = null;
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$equivalent = 0;
		if (isset($_REQUEST['equivalent'])) $equivalent = 1;
		if (is_null($criteria1->getCourse()) || ($criteria1->getCourse()->getCourseId() != $courseId))	{
			$criteria1->setCourse($courseId); $enableUpdate = true;
		}
		if (($equivalent == 1) xor $criteria1->isEquivalentEnabled())	{
			$criteria1->setEquivalentEnabled($equivalent); $enableUpdate = true;
		}
		if ($extraInformation != $criteria1->getExtraInformation())	{
			$criteria1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $criteria1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$criteria1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$criteria1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriteria Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			EntryCriteria for <?= $criteria1->getCourse()->getCourseName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the criteria <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_edit", "Edited ".$criteria1->getCourse()->getCourseName());
	} else if ($page == "manageentrycriteria_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$criteria1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
			$criteria1->setExtraFilter($extraFilter);
			$criteria1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit EntryCriteria</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageentrycriteria_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $criteria1->getCriteriaId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $criteria1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$selected = "";
		if (! is_null($criteria1->getCourse()) && ($criteria1->getCourse()->getCourseId() == $course1->getCourseId())) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
<?php 
	$checked = "";
	if ($criteria1->isEquivalentEnabled()) $checked = "checked";
?>
						<label title="If Checked, it will cause the system to check if the student can enter with equivalent (Same UQF Level)"><input <?= $checked ?> type="checkbox" name="equivalent" value="1"/>&nbsp;&nbsp; Enable/Disable Equivalent</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $criteria1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageentrycriteria_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$criteria1 = null;
		try {
			$criteria1 = new EntryCriteria($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for Entry Criteria</div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
<?php 
	if (! is_null($criteria1->getCourse()))	{
?>
					<tr>
						<td>Course </td>
						<td><?= $criteria1->getCourse()->getCourseName() ?> (<?= $criteria1->getCourse()->getCourseCode() ?>)</td>
					</tr>
<?php
	}
	$equivalentText = "Equivalent Check is NOT Enabled";
	if ($criteria1->isEquivalentEnabled()) $equivalentText = "Equivalent check is ENABLED";
?>
					<tr>
						<td colspan="2"><?= $equivalentText ?></td>
					</tr>
<?php
	if (! is_null($criteria1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $criteria1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table> <br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($criteria1->getCriteriaList()) && sizeof($criteria1->getCriteriaList()) > 0)	{
		$objectList1 = $criteria1->getCriteriaList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="3">Criteria List</th>
					</tr>
					<tr>
						<th></th>
						<th>Level Name</th>
						<th>Level Code</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getLevelName() ?></td>
			<td><?= $obj1->getLevelCode() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($criteria1->getExclusionCriteriaList()) && sizeof($criteria1->getExclusionCriteriaList()) > 0)	{
		$objectList1 = $criteria1->getExclusionCriteriaList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-2">
				<thead>
					<tr>
						<th colspan="3">Exclusion Criteria List</th>
					</tr>
					<tr>
						<th></th>
						<th>Level Name</th>
						<th>Level Code</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getLevelName() ?></td>
			<td><?= $obj1->getLevelCode() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit Entry Criteria" href="<?= $thispage ?>?page=manageentrycriteria_edit&id=<?= $criteria1->getCriteriaId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageentrycriteria_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete Entry Criteria" href="<?= $thispage ?>?page=manageentrycriteria_delete&id=<?= $criteria1->getCriteriaId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageentrycriteria_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach/Detach Criteria List" href="<?= $thispage ?>?page=manageentrycriteria_edit&id=<?= $criteria1->getCriteriaId() ?>&attach_criterialist=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
		<a title="Attach/Detach Exclusion Criteria List" href="<?= $thispage ?>?page=manageentrycriteria_edit&id=<?= $criteria1->getCriteriaId() ?>&attach_exclusioncriterialist=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "manageentrycriteria_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$criteriaName = "";
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for Entry Criteria</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO entryCriteria (courseId, extraFilter, extraInformation) VALUES('$courseId', '$extraFilter', '$extraInformation')";
	try {
		$course1 = new Course($database, $courseId, $conn);
		$criteriaName = $course1->getCourseName();
		mysql_db_query($database, $query, $conn) or Object::shootException("EntryCriteria[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The EntryCriteria for <?= $criteriaName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the criteria<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another EntryCriteria";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageentrycriteria_add", "Added $criteriaName");
	} else if ($page == "manageentrycriteria_add" && Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New EntryCriteria</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageentrycriteria_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageentrycriteria">Back to EntryCriteria Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageentrycriteria" && Authorize::isAllowable($config, "manageentrycriteria", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EntryCriterias Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageentrycriteria" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageentrycriteria_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Course Name</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = EntryCriteria::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch criteria data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$criteria1 = null;
		try {
			$criteria1 = new EntryCriteria($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($criteria1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$courseName = "";
			if (! is_null($criteria1->getCourse())) $courseName = $criteria1->getCourse()->getCourseName()." (".$criteria1->getCourse()->getCourseCode().")";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $courseName ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageentrycriteria_detail&id=<?= $criteria1->getCriteriaId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageentrycriteria_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageentrycriteria_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageentrycriteria_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System EntryCriteria" href="<?= $thispage ?>?page=manageentrycriteria_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
		<a title="Add Bulk Criterias" href="<?= $thispage ?>?page=manageentrycriteria_add&bulk=true"><img alt="DAT" src="../sysimage/bulk.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer">
				
			</div>
		</div>
<?php
	}/*EntryCriteria End*/ else /*Briefcase BEGIN*//*Publish Briefcase Results Begin*/if ($page == "managebriefcase_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_published']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$updatedName = $briefcase1->getBriefcaseName();
			if (trim($_REQUEST['rndx']) != $briefcase1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $briefcase1->isPublishResultsEnabled()))	{
				Object::shootException("Nothing to be done, There is no change on the Publish Status");
			}
			$briefcase1->setPublishResultsEnabled($action);
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unpublishing 
		$successMessage = "You have successful Unpublished the Briefcase";
		$errorMessage = "The Briefcase could not be Unpublished";
		$logName = "UNPUBLISHED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Published the Briefcase";
			$errorMessage = "The Briefcase could not be Published";
			$logName = "PUBLISHED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">PUBLISH/UNPUBLISH RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_edit", $logName);
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['service_published']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Published Status 
		$userText = "You are about to PUBLISH Briefcase Results, The results will be visible to students. Do you want to proceed?";
		$buttonText = "(YES) Publish Briefcase Results";
		$action="1";
		if ($briefcase1->isPublishResultsEnabled())	{
			$userText = "You are about to UNPUBLISH Briefcase Results, The results will be no longer visible to students. Do you want to proceed?";
			$buttonText = "(YES) Unpublish Briefcase Results";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">PUBLISH/UNPUBLISH RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcase_edit"/>
					<input type="hidden" name="service_published" value="<?= $_REQUEST['service_published'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $briefcase1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End Briefcase Publish*/else /* Lock Briefcase BEGIN */if ($page == "managebriefcase_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$updatedName = $briefcase1->getBriefcaseName();
			if (trim($_REQUEST['rndx']) != $briefcase1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $briefcase1->isResultsLocked()))	{
				Object::shootException("Nothing to be done, There is no change on the Lock Status");
			}
			$briefcase1->setResultsLocked($action);
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unlocking 
		$successMessage = "You have successful Unlocked the Briefcase";
		$errorMessage = "The Briefcase could not be Unlocked";
		$logName = "UNLOCKED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Locked the Briefcase";
			$errorMessage = "The Briefcase could not be Locked";
			$logName = "LOCKED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_edit", $logName);
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Locked Status 
		$userText = "You are About to Lock the Briefcase, Please make sure All Briefcase Belonging to This Briefcase have been uploaded successful. Once the Briefcase is Locked further results will not be received by the system<br/>Are you sure you want to Lock Briefcase?";
		$buttonText = "(YES) Lock Briefcase";
		$action="1";
		if ($briefcase1->isResultsLocked())	{
			$userText = "You are About to Unlock the Briefcase, This will Allow Briefcase to be Appended to the Existing Briefcase, However the System will have to re-grade the results. <br/>Are you sure you want to Unlock Briefcase?";
			$buttonText = "(YES) Unlock Briefcase";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcase_edit"/>
					<input type="hidden" name="service_locked" value="<?= $_REQUEST['service_locked'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $briefcase1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End Briefcase Lock*/else if ($page == "managebriefcase_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['id']) && isset($_REQUEST['upload_results']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);			
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Uploaded Results for <?= $briefcase1->getBriefcaseName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	//Doing Real Business 
	try {	
		if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
		if ($briefcase1->getExtraFilter() != trim($_REQUEST['rndx'])) Object::shootException("The system has detected a malicious attempt to upload results");
		$promise1 = Object::checkUploadedFile($_FILES['resultsfile'], array("text/csv"), array("csv"), 2097153);
		if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
		//Now Upload, remember the filename is in getResults of a promise object 
		$briefcase1->setExtraFilter(System::getCodeString(8));
		$promise1 = Results::uploadResults($database, $conn, $briefcase1, $promise1->getResults(), "../data/briefcase/", $systemTime1, isset($_REQUEST['overwrite']), Results::$__BRIEFCASE_MODE);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Congratulations, you have successful uploaded your results to your briefcase 
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in uploading results to your briefcase <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">Back to Briefcase Details</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_edit", "[Uploaded Results] ".$briefcase1->getBriefcaseName());
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['id']) && isset($_REQUEST['upload_results']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if ($briefcase1->isResultsLocked()) Object::shootException("You have bypassed the system and you want to upload into the Already Locked Briefcase");
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Upload Results for <?= $briefcase1->getBriefcaseName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="managebriefcase_edit"/>
					<input type="hidden" name="id" value="<?= $briefcase1->getBriefcaseId() ?>"/>
					<input type="hidden" name="upload_results" value="true"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $briefcase1->getExtraFilter() ?>"/>
					<div class="ui-sys-data-capture ui-sys-inline-controls-center">
						<input class="ui-sys-file-upload" id="resultsfile" data-capture="0" type="file" name="resultsfile" accept="*.csv"/> &nbsp;&nbsp;<input type="button" id="__add_record" value="Upload Results"/> 
					</div>
					<div class="pure-controls ui-sys-inline-controls-center">
						<label><input type="checkbox" name="overwrite" value="1"/>&nbsp;&nbsp; Overwrite existing results (If Any)?</label>
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>">Back to Briefcase Details</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#resultsfile').on('change', function(event)	{
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $file1 = $('#resultsfile');
		if (! $file1.length) return;
		if (parseInt($file1.prop('data-capture')) == 1)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('You have not selected the file to upload')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managebriefcase_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managebriefcase_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<?php
	} else if ($page == "managebriefcase_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managebriefcase_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Briefcase::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Briefcase[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$briefcase1 = null;
			try	{
				$briefcase1 = new Briefcase($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($briefcase1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managebriefcase_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcase_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managebriefcase_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcase_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managebriefcase_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managebriefcase_csv" && Authorize::isAllowable($config, "managebriefcase_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managebriefcase_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Briefcase::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managebriefcase_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managebriefcase_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$briefcase1 = null;
		try {
			 $briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			 if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			 $briefcase1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Briefcase which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Briefcase <?= $briefcase1->getBriefcaseName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Briefcase <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_delete", "Deleted ".$briefcase1->getBriefcaseName());
	} else if ($page == "managebriefcase_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$briefcase1->setExtraFilter(System::getCodeString(8));
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Briefcase <b><?= $briefcase1->getBriefcaseName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Briefcase <?= $briefcase1->getBriefcaseName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managebriefcase_delete&report=io&id=<?= $briefcase1->getBriefcaseId() ?>&rndx=<?= $briefcase1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managebriefcase">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$briefcaseName = mysql_real_escape_string($_REQUEST['briefcaseName']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$weight = mysql_real_escape_string($_REQUEST['weight']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($briefcaseName != $briefcase1->getBriefcaseName())	{
			$briefcase1->setBriefcaseName($briefcaseName); $enableUpdate = true;
		}
		if (is_null($briefcase1->getGroup()) || ($groupId != $briefcase1->getGroup()->getGroupId()))	{
			$briefcase1->setGroup($groupId); $enableUpdate = true;
		}
		if ($weight != $briefcase1->getWeight())	{
			$briefcase1->setWeight($weight); $enableUpdate = true;
		}
		if ($extraInformation != $briefcase1->getExtraInformation())	{
			$briefcase1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $briefcase1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$briefcase1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
				$briefcase1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Briefcase <?= $briefcase1->getBriefcaseName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the briefcase <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_edit", "Edited ".$briefcase1->getBriefcaseName());
	} else if ($page == "managebriefcase_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$briefcase1->setExtraFilter($extraFilter);
			$briefcase1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Briefcase <?= $briefcase1->getBriefcaseName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcase_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $briefcase1->getBriefcaseId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $briefcase1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="briefcaseName">Briefcase Name </label>
						<input value="<?= $briefcase1->getBriefcaseName() ?>" type="text" name="briefcaseName" id="briefcaseName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Briefcase Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = BriefcaseGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$group1 = new BriefcaseGroup($database, $alist1['id'], $conn);
		if (! $group1->isAuthorizedOwner($login1->getLoginId())) continue; 
		$selected = "";
		if (! is_null($briefcase1->getGroup()) && ($briefcase1->getGroup()->getGroupId() == $alist1['id'])) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label title="This feature operates on a ratio" for="weight">Results Weight</label>
						<input value="<?= $briefcase1->getWeight() ?>" class="text-can-not-be-zero" type="text" name="weight" id="weight" size="16" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Results Weight : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $briefcase1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Weight CAN NOT BE ZERO')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcase_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcase_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $_REQUEST['id'], $conn);
			if (is_null($briefcase1->getGroup()) || ! $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
		} catch (Exception $e)	{die($e->getMessage());}
		$percentageWeight = "0%";
		try {
			$percentageWeight = $briefcase1->getPercentageWeightInAGroup();
			$percentageWeight .= "%";
		} catch (Exception $e)	{
			$percentageWeight = "#";
		}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $briefcase1->getBriefcaseName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Briefcase Name</td>
						<td><?= $briefcase1->getBriefcaseName() ?></td>
					</tr>
<?php 
	if (! is_null($briefcase1->getGroup()))	{
?>
					<tr>
						<td>Belong to Group </td>
						<td><a href="<?= $thispage ?>?page=managebriefcasegroup_detail&id=<?= $briefcase1->getGroup()->getGroupId() ?>"><?= $briefcase1->getGroup()->getGroupName() ?></a></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Weight</td>
						<td><?= $percentageWeight ?></td>
					</tr>
<?php
	$lockedText = "Results are NOT YET LOCKED";
	if ($briefcase1->isResultsLocked()) $lockedText = "Results HAS BEEN LOCKED";
?>
					<tr>
						<td colspan="2"><?= $lockedText ?></td>
					</tr>
<?php
	$publishedText = "Not Elligible for Publication";
	if ($briefcase1->isEligibleForPublication()) $publishedText = "Eligible for Publication";
?>
					<tr><td colspan="2"><?= $publishedText ?></td></tr>
<?php
	if (! is_null($briefcase1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $briefcase1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php
	if ($briefcase1->isResultsLocked() && ! $briefcase1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Publish/Unpublish Results" href="<?= $thispage ?>?page=managebriefcase_edit&service_published=raheli&id=<?= $briefcase1->getBriefcaseId() ?>"><img alt="DAT" src="../sysimage/buttonpublish.png"/></a>
<?php
	}
	if (! $briefcase1->isResultsLocked() && ! $briefcase1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Nulify Briefcase Results" href="<?= $thispage ?>?page=managebriefcase_edit&nullify=zk601&id=<?= $briefcase1->getBriefcaseId() ?>"><img alt="DAT" src="../sysimage/buttonnull.png"/></a>
<?php
	}
	if (! $briefcase1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Lock/Unlock Results" href="<?= $thispage ?>?page=managebriefcase_edit&id=<?= $briefcase1->getBriefcaseId() ?>&service_locked=true"><img alt="DAT" src="../sysimage/buttonlocked.png"/></a>
<?php
	}
	if (! $briefcase1->isResultsLocked() && Authorize::isAllowable($config, "managebriefcase_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Upload Results for <?= $briefcase1->getBriefcaseName() ?>" href="<?= $thispage ?>?page=managebriefcase_edit&id=<?= $briefcase1->getBriefcaseId() ?>&upload_results=true"><img alt="DAT" src="../sysimage/buttonupload.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresults_monitor_devel", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Results Monitor" href="<?= $thispage ?>?page=manageresults_monitor_devel&controlFlags=<?= Results::$__BRIEFCASE_MODE ?>&classname=Briefcase&id=<?= $briefcase1->getBriefcaseId() ?>"><img alt="DAT" src="../sysimage/buttonmonitor.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcase_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $briefcase1->getBriefcaseName() ?>" href="<?= $thispage ?>?page=managebriefcase_edit&id=<?= $briefcase1->getBriefcaseId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcase_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $briefcase1->getBriefcaseName() ?>" href="<?= $thispage ?>?page=managebriefcase_delete&id=<?= $briefcase1->getBriefcaseId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a>
		</div>
	</div>
<?php
	} else if ($page == "managebriefcase_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managebriefcase_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$briefcaseName = mysql_real_escape_string($_REQUEST['briefcaseName']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$weight = mysql_real_escape_string($_REQUEST['weight']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $briefcaseName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO briefcase (briefcaseName, groupId, weight, extraFilter, extraInformation) VALUES('$briefcaseName', '$groupId', '$weight', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Briefcase[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Briefcase <?= $briefcaseName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the briefcase<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Briefcase";
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase_add"><?= $captionText ?></a>&nbsp;&nbsp;<a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcase_add", "Added $briefcaseName");
	} else if ($page == "managebriefcase_add" && Authorize::isAllowable($config, "managebriefcase_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Briefcase</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcase_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="briefcaseName">Briefcase Name </label>
						<input type="text" name="briefcaseName" id="briefcaseName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Briefcase Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = BriefcaseGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label title="This feature operates on a ratio" for="weight">Results Weight</label>
						<input class="text-can-not-be-zero" type="text" name="weight" id="weight" size="16" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Results Weight : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcase">Back to Briefcase Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Weight CAN NOT BE ZERO')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcase" && Authorize::isAllowable($config, "managebriefcase", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Briefcase Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-briefcase-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managebriefcase" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managebriefcase_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Status</th>
				<th>Name</th>
				<th>Group</th>
				<th>Weight(%)</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Briefcase::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch briefcase data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$briefcase1 = null;
		try {
			$briefcase1 = new Briefcase($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if (! is_null($briefcase1->getGroup()) && $briefcase1->getGroup()->isAuthorizedOwner($login1->getLoginId()) && $briefcase1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$bgcolor = "blue";
			if ($briefcase1->isResultsLocked()) $bgcolor = "gold";
			$groupname = "";
			if (! is_null($briefcase1->getGroup())) $groupname = $briefcase1->getGroup()->getGroupName();
			$percentageWeight = 0;
			try {
				$percentageWeight = $briefcase1->getPercentageWeightInAGroup();
			} catch (Exception $e)	{
				$percentageWeight = "#";
			}
			$publishedControl = "";
			if ($briefcase1->isEligibleForPublication())	$publishedControl = "&nbsp;<a title=\"Eligible for Publication\" class=\"ui-sys-search-results-controls\"><img src=\"../sysimage/buttonpublish.png\" alt=\"Pub\"/></a>";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><?= $publishedControl ?></td>
				<td><?= $briefcase1->getBriefcaseName() ?></td>
				<td><?= $groupname ?></td>
				<td><?= $percentageWeight ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managebriefcase_detail&id=<?= $briefcase1->getBriefcaseId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managebriefcase_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managebriefcase_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcase_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Briefcase" href="<?= $thispage ?>?page=managebriefcase_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Briefcase End*/ else /*Publish BriefcaseGroup Results Begin*/if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_published']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$updatedName = $group1->getGroupName();
			if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $group1->isPublishResultsEnabled()))	{
				Object::shootException("Nothing to be done, There is no change on the Publish Status");
			}
			$group1->setPublishResultsEnabled($action);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unpublishing 
		$successMessage = "You have successful Unpublished the BriefcaseGroup";
		$errorMessage = "The BriefcaseGroup could not be Unpublished";
		$logName = "UNPUBLISHED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Published the BriefcaseGroup";
			$errorMessage = "The BriefcaseGroup could not be Published";
			$logName = "PUBLISHED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">PUBLISH/UNPUBLISH RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", $logName);
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['service_published']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the Authorized Owner of the briefcase");
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Published Status 
		$userText = "You are about to PUBLISH BriefcaseGroup Results, The results will be visible to students. Do you want to proceed?";
		$buttonText = "(YES) Publish BriefcaseGroup Results";
		$action="1";
		if ($group1->isPublishResultsEnabled())	{
			$userText = "You are about to UNPUBLISH BriefcaseGroup Results, The results will be no longer visible to students. Do you want to proceed?";
			$buttonText = "(YES) Unpublish BriefcaseGroup Results";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">PUBLISH/UNPUBLISH RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
					<input type="hidden" name="service_published" value="<?= $_REQUEST['service_published'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=managebriefcasegroup_detail&id=<?= $group1->getGroupId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End BriefcaseGroup Publish*/else/*Begin Briefcase Group Lock*/if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			$updatedName = $group1->getGroupName();
			if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $group1->isResultsLocked()))	{
				Object::shootException("Nothing to be done, There is no change on the Lock Status");
			}
			$group1->setResultsLocked($action);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unlocking 
		$successMessage = "You have successful Unlocked the Briefcase Group";
		$errorMessage = "The Briefcase Group could not be Unlocked";
		$logName = "UNLOCKED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Locked the Briefcase Group";
			$errorMessage = "The Briefcase Group could not be Locked";
			$logName = "LOCKED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS GROUP</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", $logName);
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Locked Status 
		$userText = "You are About to Lock the Briefcase Group, Please make sure All Results Belonging to This Briefcase Group have been uploaded successful. Once the Briefcase Group is Locked further results will not be received by the system<br/>Are you sure you want to Lock Group Results?";
		$buttonText = "(YES) Lock Group Results";
		$action="1";
		if ($group1->isResultsLocked())	{
			$userText = "You are About to Unlock the Briefcase Group, This will Allow Results to be Appended to the Existing Results, However the System will have to re-grade the results. <br/>Are you sure you want to Unlock Group Results?";
			$buttonText = "(YES) Unlock Group Results";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS GROUP</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
					<input type="hidden" name="service_locked" value="<?= $_REQUEST['service_locked'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=managebriefcasegroup_detail&id=<?= $group1->getGroupId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End Briefcase Group Lock*/else/*BriefcaseGroup BEGIN*/if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['service_compile']) && isset($_REQUEST['report']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Compilation Tool <br/><?= $group1->getGroupName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$list = null;
	try {
		$targetMaximumScore = mysql_real_escape_string($_REQUEST['maximumScore']);
		$list = BriefcaseGroup::getBriefcaseListBelongingToAGroup($database, $conn, $group1->getGroupId());
		if (is_null($list)) Object::shootException("There is no briefcase belonging to this group");
		$bestCount = 0;
		if (intval($_REQUEST['radAll']) == 1)	{
			$bestCount = sizeof($list);
		} else if (intval($_REQUEST['radAll']) == 0)	{
			if (! isset($_REQUEST['bestCount'])) Object::shootException("The number of briefcase results to take were not found");
			$bestCount = intval($_REQUEST['bestCount']);
			//Best Count can not exceed the total number of briefcase 
			if ($bestCount > sizeof($list)) $bestCount = sizeof($list);
			//Initialize the list is null, the ones which must be included 
			$list = null;
			if (isset($_REQUEST['briefcase']))	{
				$list = array();
				foreach ($_REQUEST['briefcase'] as $briefcaseId)	{
					$list[sizeof($list)] = $briefcaseId;
				}
				//bestCount can not be less than the briefcase which must be included 
				if ($bestCount < sizeof($list)) $bestCount = sizeof($list);
			} //--briefcase --if-end
		} else {
			Object::shootException("Mixed Instruction, Could not decide if all or some of briefcase should be taken");
		}
		$promise1 = BriefcaseGroup::compileBriefcaseGroup($database, $conn, $targetMaximumScore, $systemTime1, $group1->getGroupId(), "../data/briefcase/", $list, $bestCount, 0);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
		$enableUpdate = true;
?>
		<div class="ui-state-highlight">
			You have successful compiled your briefcase results
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in compiling your briefcase <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		$groupName = $group1->getGroupName();
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", "Compiled [$groupName] Results");
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['service_compile']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Compilation Tool <br/><?= $group1->getGroupName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$list = null;
	try {
		$list = BriefcaseGroup::getBriefcaseListBelongingToAGroup($database, $conn, $group1->getGroupId());
		if (is_null($list)) Object::shootException("There is no briefcase belonging to this group");
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if (! is_null($list) && $promise1->isPromising())	{
		$isStillValidBriefcase = true;
		$briefcaseFolder = "../data/briefcase/";
?>
			<form id="form1" method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
				<input type="hidden" name="service_compile" value="<?= $_REQUEST['service_compile'] ?>"/>
				<input type="hidden" name="report" value="io"/>
				<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
		<table class="pure-table pure-table-horizontal" style="width: 100%;">
			<thead>
				<tr>
					<th style="ui-sys-inline-controls-center" colspan="7">Compilation Tool for <?= $group1->getGroupName() ?></th>
				</tr>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Briefcase Name</th>
					<th>Weight (Ratio)</th>
					<th>Status</th>
					<th>Storage</th>
					<th>Comment</th>
				</tr>
			</thead>
			<tbody>
<?php 
	$count = 0;
	foreach ($list as $briefcaseId)	{
		$briefcase1 = null;
		try	{
			$briefcase1 = new Briefcase($database, $briefcaseId, $conn);
		} catch (Exception $e)	{
			$isStillValidBriefcase = false;
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			break;
		}
		$lockedText = "OPEN";
		if ($briefcase1->isResultsLocked()) $lockedText = "LOCKED";
		$bgcolor = "red";
		$commentText = "Data Files Are Missing";
		$rawFilename = $briefcaseFolder.$briefcase1->getRawMarksCSVFile();
		$gradedFilename = $briefcaseFolder.$briefcase1->getGradedMarksCSVFile();
		$blnFound = false;
		if (! is_null($briefcase1->getRawMarksCSVFile()) && ! is_null($briefcase1->getGradedMarksCSVFile()))	{
			$passedIntegrity = false;
			if (file_exists($rawFilename) && (md5_file($rawFilename) == $briefcase1->getRawMarksCSVFileChecksum()))	{
				$commentText = "Integrity Check has PASSED";
				$bgcolor = "blue";
				$passedIntegrity = true;
			} else {
				$commentText = "[Data] Integrity is Compromised";
				$bgcolor = "gold";
				$passedIntegrity = false;
			}
			if ($passedIntegrity && file_exists($gradedFilename) && (md5_file($gradedFilename) == $briefcase1->getGradedMarksCSVFileChecksum()))	{
				$commentText = "Integrity Check has PASSED";
				$bgcolor = "blue";
			} else if ($passedIntegrity) {
				$commentText = "[Graded] Integrity is Compromised";
				$bgcolor = "gold";
				$passedIntegrity = false;
			}
			$blnFound = $passedIntegrity;
		}
		$isStillValidBriefcase = $isStillValidBriefcase && $blnFound;
?>
		<tr>
			<td><input class="control_select" checked type="checkbox" name="briefcase[<?= $count ?>]" value="<?= $briefcase1->getBriefcaseId() ?>"/></td>
			<td><?= $count + 1 ?></td>
			<td><?= $briefcase1->getBriefcaseName() ?></td>
			<td><?= $briefcase1->getWeight() ?></td>
			<td><?= $lockedText ?></td>
			<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
			<td><?= $commentText ?></td>
		</tr>
<?php
		$count++;
	} //end-foreach
?>			
			</tbody>
			<tfoot>
				<tr><td colspan="7">&nbsp;</td></tr>
				<tr>
					<td></td>
					<td class="ui-sys-inline-controls-center" colspan="5"><label>Maximum Score <input name="maximumScore" type="text" size="3" class="text-can-not-be-zero" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Maximum Score : <?= $msg4Number ?>"/></label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label><input checked class="radAll" type="radio" name="radAll" value="1"/> Include All</label>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<span style="background-color: #e1e1e1;"><label><input class="radAll" type="radio" name="radAll" value="0"/>Best &nbsp;&nbsp;</label><input disabled class="text-can-not-be-zero bestCount" type="text" size="2" name="bestCount" placeholder="1" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Include best <?= $msg2Number ?>"/></span></td>
					<td></td>
				</tr>
				<tr>
					<td colspan="7" class="ui-sys-error-message" id="perror"></td>
				</tr>
			</tfoot>
		</table>
			</form>
<?php
		if ($isStillValidBriefcase)	{
?>
			<div class="ui-sys-inline-controls-right">
				<input type="button" id="__add_record" value="Compile"/>
			</div>
<?php	
		} else {
?>
			<div class="ui-state-error">
				There were problem on initial compilation process, kindly review and check on the comment area of each briefcase
			</div>
<?php
		}
	} else {
?>
		<div class="ui-state-error">
			Perhaps the Group is Empty <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$(function()	{
		$('input.radAll').on('change', function(event)	{
			if (parseInt($(this).val()) == 1)	{
				$('input.control_select').prop('checked', true);
				$('input.bestCount').prop('disabled', true);
			} else {
				$('input.control_select').prop('checked', false);
				$('input.bestCount').prop('disabled', false);
			}
		});
		$('#__add_record').on('click', function(event)	{
			var $target1 = $('#perror');
			if (! $target1.length) return;
			var enableSubmit = true;
			$('input.text-can-not-be-zero').each(function(i, v)	{
				var $text1 = $(v);
				if (! $text1.prop('disabled')) enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
			});
			if (enableSubmit)	{
				generalFormSubmission(this, 'form1', 'perror');
			} else {
				$target1.empty();
				$('<span/>').html('Neither Best Count nor Maximum Score can be Zero')
					.appendTo($target1);
			}
		});
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_login']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$briefcaseGroup1 = null;
		$headerText = "UNKNOWN";
		try {
			$briefcaseGroup1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Creators Map from ".$briefcaseGroup1->getGroupName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($briefcaseGroup1->getListOfOwners(), $_REQUEST['did']);
			//Note The Primary Owner can not be Detached 
			$collection1 = new Collection();
			$collection1->addCommaSeparatedList($listToUpdate);
			$primaryOwner1 = $briefcaseGroup1->getLogin();
			if (is_null($primaryOwner1)) Object::shootException("Primary Owner were not found");
			if (! $collection1->isItemInACollection($primaryOwner1->getLoginId())) Object::shootException("The Primary Owner Can not be removed");
			$briefcaseGroup1->setListOfOwners($listToUpdate);
			$briefcaseGroup1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Owner List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Owner List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcasegroup">Back to BriefcaseGroup Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", "Detach Owners for ".$briefcaseGroup1->getGroupName());
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$briefcaseGroup1 = null;
		$headerText = "UNKNOWN";
		try {
			$briefcaseGroup1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Owner Map to ".$briefcaseGroup1->getGroupName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($briefcaseGroup1->getListOfOwners(), $_REQUEST['did']);
			$briefcaseGroup1->setListOfOwners($listToUpdate);
			$briefcaseGroup1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Owner List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Owner List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcasegroup">Back to BriefcaseGroup Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", "Attach Owners for ".$briefcaseGroup1->getGroupName());
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$briefcaseGroup1 = null;
		$headerText = "UNKNOWN";
		try {
			$briefcaseGroup1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Owner Map to ".$briefcaseGroup1->getGroupName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($briefcaseGroup1->getListOfOwners()) && sizeof($briefcaseGroup1->getListOfOwners()) > 0)	{
		$objectList1 = $briefcaseGroup1->getListOfOwners();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
				<input type="hidden" name="id" value="<?= $briefcaseGroup1->getGroupId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_login" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
						<th colspan="6">BriefcaseGroupd By</th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Name</th>
							<th>Email</th>
							<th>Phone</th>
							<th>Status</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getLoginId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Owners"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managebriefcasegroup_edit&id=<?= $briefcaseGroup1->getGroupId() ?>&attach_login=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
		<input type="hidden" name="id" value="<?= $briefcaseGroup1->getGroupId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_login" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Name</th>
					<th>Email</th>
					<th>Phone</th>
					<th>Status</th>
				</tr>
			</thead>
<?php 
	$query = Login::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Login($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getLoginId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getFullname() ?></td>
				<td><?= $transaction1->getEmail() ?></td>
				<td><?= $transaction1->getPhone() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getUserStatus()))	{
		echo $transaction1->getUserStatus()->getStatusName();
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Owners"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managebriefcasegroup">Back to BriefcaseGroup Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managebriefcasegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a></div>
		</div>
<?php
	} else if ($page == "managebriefcasegroup_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managebriefcasegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = BriefcaseGroup::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("BriefcaseGroup[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$group1 = null;
			try	{
				$group1 = new BriefcaseGroup($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($group1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managebriefcasegroup_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managebriefcasegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcasegroup_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managebriefcasegroup_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managebriefcasegroup_csv" && Authorize::isAllowable($config, "managebriefcasegroup_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managebriefcasegroup_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, BriefcaseGroup::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managebriefcasegroup_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managebriefcasegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			 $group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			 if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not an Authorized owner of the group");
			 $group1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a BriefcaseGroup which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The BriefcaseGroup <?= $group1->getGroupName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the BriefcaseGroup <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_delete", "Deleted ".$group1->getGroupName());
	} else if ($page == "managebriefcasegroup_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not an Authorized owner of the group");
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a BriefcaseGroup <b><?= $group1->getGroupName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the BriefcaseGroup <?= $group1->getGroupName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managebriefcasegroup_delete&report=io&id=<?= $group1->getGroupId() ?>&rndx=<?= $group1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managebriefcasegroup">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$examinationId = mysql_real_escape_string($_REQUEST['examinationId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($groupName != $group1->getGroupName())	{
			$group1->setGroupName($groupName); $enableUpdate = true;
		}
		if (is_null($group1->getCourse()) || ($group1->getCourse()->getCourseId() != $courseId))	{
			$group1->setCourse($courseId); $enableUpdate = true;
		}
		if ($year != $group1->getYear())	{
			$group1->setYear($year); $enableUpdate = true;
		}
		if (is_null($group1->getBatch()) || ($group1->getBatch()->getAccademicYearId() != $batchId))	{
			$group1->setBatch($batchId); $enableUpdate = true;
		}
		if (is_null($group1->getExamination()) || ($group1->getExamination()->getExaminationId() != $examinationId))	{
			$group1->setExamination($examinationId); $enableUpdate = true;
		}
		if ($extraInformation != $group1->getExtraInformation())	{
			$group1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$group1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not an Authorized owner of the group");
				$group1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroup Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			BriefcaseGroup <?= $group1->getGroupName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the group <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_edit", "Edited ".$group1->getGroupName());
	} else if ($page == "managebriefcasegroup_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the owner of this group");
			$group1->setExtraFilter($extraFilter);
			$group1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit BriefcaseGroup <?= $group1->getGroupName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcasegroup_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<input type="hidden" id="dataStore" value="0" data-current-year="<?= $group1->getYear() ?>"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input value="<?= $group1->getGroupName() ?>" type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="BriefcaseGroup Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option data-course-duration="0" value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$selected = "";
		if (! is_null($group1->getCourse()) && ($group1->getCourse()->getCourseId() == $alist1['id'])) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="Results for Year">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="batchId" title="Current Accademic Year">Accademic Year </label>
						<select class="__do_perform_ui_maintainance" id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Academic Year (The Academic Year these results belongs to)">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		try {
			$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
			if ($accademicYear1->getAccademicYearNumber() == $controlAccademicCounter) $selected = "selected";
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="examinationId">Examination </label>
						<select id="examinationId" name="examinationId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Examination">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Examination::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($group1->getExamination()) && ($group1->getExamination()->getExaminationId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $group1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	function uiMaitainance($course1, $currentYear1, $dataStore1)	{
		if (! $course1.length) return;
		if (! $currentYear1.length) return;
		if (! $dataStore1.length) return;
		var option1 = $course1.find('option:selected');
		var $option1 = $(option1);
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		var currentYear = $dataStore1.attr('data-current-year');
		if (! currentYear) { currentYear = 0; }
		currentYear = parseInt(currentYear);
		//Now you need to wipe currentYear1 control 
		$currentYear1.empty();
		$('<option/>').attr('value', '_@32767@_')
			.html('--select--')
			.appendTo($currentYear1);
		for (var i = 1; i <= duration; i++)	{
			var $option1 = $('<option/>').attr('value', i)
				.html(i);
			if (i == currentYear)	$option1.prop("selected", true);
			$option1.appendTo($currentYear1);
		}
	}
	uiMaitainance($('#courseId'), $('#year'), $('#dataStore'));
	$('#courseId').on('change', function(event)	{
		uiMaitainance($(this), $('#year'), $('#dataStore'));
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managebriefcasegroup_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $_REQUEST['id'], $conn);
			if (! $group1->isAuthorizedOwner($login1->getLoginId())) Object::shootException("You are not the owner of this group");
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $group1->getGroupName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Name</td>
						<td><?= $group1->getGroupName() ?></td>
					</tr>
<?php 
	if (! is_null($group1->getLogin()))	{
?>
					<tr>
						<td>Primary Owner</td>
						<td><?= $group1->getLogin()->getFullname() ?></td>
					</tr>
<?php
	}
	if (! is_null($group1->getCourse()))	{
?>
					<tr>
						<td>Course</td>
						<td><?= $group1->getCourse()->getCourseName() ?> (<?= $group1->getCourse()->getCourseCode() ?>)</td>
					</tr>
<?php
	}
	if (! is_null($group1->getBatch()))	{
?>
					<tr>
						<td>Academic Year</td>
						<td><?= $group1->getBatch()->getAccademicYear() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Year of Study</td>
						<td><?= $group1->getYear() ?></td>
					</tr>
<?php
	if (! is_null($group1->getExamination()))	{
?>
					<tr>
						<td>Examination</td>
						<td><?= $group1->getExamination()->getExaminationName() ?> (<?= $group1->getExamination()->getExaminationCode() ?>)</td>
					</tr>
<?php
	}
	$lockedText = "Results are NOT YET LOCKED";
	if ($group1->isResultsLocked()) $lockedText = "Results HAS BEEN LOCKED";
?>
					<tr>
						<td colspan="2"><?= $lockedText ?></td>
					</tr>
<?php
	$publishedText = "Not Elligible for Publication";
	if ($group1->isEligibleForPublication()) $publishedText = "Eligible for Publication";
?>
					<tr><td colspan="2"><?= $publishedText ?></td></tr>
<?php
	if (! is_null($group1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $group1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table><br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($group1->getListOfOwners()) && sizeof($group1->getListOfOwners()) > 0)	{
		$objectList1 = $group1->getListOfOwners();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="5">Owned By</th>
					</tr>
					<tr>
						<th></th>
						<th>Name</th>
						<th>Email</th>
						<th>Phone</th>
						<th>Status</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if ($group1->isResultsLocked() && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Publish/Unpublish Results" href="<?= $thispage ?>?page=managebriefcasegroup_edit&service_published=kezia&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonpublish.png"/></a>
<?php
	}
	//Allow Only Unlock
	if ($group1->isResultsLocked() && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Lock/Unlock Results Group" href="<?= $thispage ?>?page=managebriefcasegroup_edit&id=<?= $group1->getGroupId() ?>&service_locked=true"><img alt="DAT" src="../sysimage/buttonlocked.png"/></a>
<?php
	}
	if (! $group1->isResultsLocked() && Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Compile Group Results" href="<?= $thispage ?>?page=managebriefcasegroup_edit&id=<?= $group1->getGroupId() ?>&service_compile=true"><img alt="DAT" src="../sysimage/buttoncalculate.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresults_monitor_devel", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Results Monitor" href="<?= $thispage ?>?page=manageresults_monitor_devel&controlFlags=<?= Results::$__BRIEFCASE_MODE ?>&classname=BriefcaseGroup&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonmonitor.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managebriefcasegroup_edit&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcasegroup_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managebriefcasegroup_delete&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcasegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach/Detach Group Owners. You can share your ownership with others" href="<?= $thispage ?>?page=managebriefcasegroup_edit&id=<?= $group1->getGroupId() ?>&attach_login=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a>
		</div>
	</div>
<?php
	} else if ($page == "managebriefcasegroup_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managebriefcasegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$examinationId = mysql_real_escape_string($_REQUEST['examinationId']);
		$loginId = $_SESSION['login'][0]['id'];
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $groupName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO briefcaseGroup (groupName, courseId, _year, batchId, examinationId, loginId, listOfOwners, extraFilter, extraInformation) VALUES('$groupName', '$courseId', '$year', '$batchId', '$examinationId', '$loginId', '$loginId', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("BriefcaseGroup[Adding]: Could not Add a Record into the System ");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The BriefcaseGroup <?= $groupName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the group<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Briefcase Group";
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup_add"><?= $captionText ?></a>&nbsp;&nbsp;<a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managebriefcasegroup_add", "Added $groupName");
	} else if ($page == "managebriefcasegroup_add" && Authorize::isAllowable($config, "managebriefcasegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New BriefcaseGroup</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managebriefcasegroup_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="BriefcaseGroup Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="Results for Year">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="batchId" title="Current Accademic Year">Accademic Year </label>
						<select class="__do_perform_ui_maintainance" id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Academic Year (The Academic Year these results belongs to)">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		try {
			$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
			if ($accademicYear1->getAccademicYearNumber() != $controlAccademicCounter) continue;
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="examinationId">Examination </label>
						<select id="examinationId" name="examinationId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Examination">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Examination::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managebriefcasegroup">Back to Briefcase Group Management</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managebriefcasegroup" && Authorize::isAllowable($config, "managebriefcasegroup", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">BriefcaseGroups Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managebriefcasegroup" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managebriefcasegroup_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>Name</th>
				<th>Primary Owner</th>
				<th>Examination</th>
				<th>Course</th>
				<th>Academic <br/>Year</th>
				<th>Year <br/>of Study</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = BriefcaseGroup::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch group data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$group1 = null;
		try {
			$group1 = new BriefcaseGroup($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($group1->isAuthorizedOwner($login1->getLoginId()) && $group1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$bgcolor = "blue";
			if ($group1->isResultsLocked()) $bgcolor="gold";
			$examinationName = "";
			if (! is_null($group1->getExamination())) $examinationName = $group1->getExamination()->getExaminationName();
			$courseName = "";
			if (! is_null($group1->getCourse())) $courseName = $group1->getCourse()->getCourseName();
			$batchName = "";
			if (! is_null($group1->getBatch())) $batchName = $group1->getBatch()->getAccademicYear();
			$fullname = "";
			if (! is_null($group1->getLogin())) $fullname = $group1->getLogin()->getFullname();
			$publishedControl = "";
			if ($group1->isEligibleForPublication())	$publishedControl = "&nbsp;<a title=\"Eligible for Publication\" class=\"ui-sys-search-results-controls\"><img src=\"../sysimage/buttonpublish.png\" alt=\"Pub\"/></a>";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><?= $publishedControl ?></td>
				<td><?= $group1->getGroupName() ?></td>
				<td><?= $fullname ?></td>
				<td><?= $examinationName ?></td>
				<td><?= $courseName ?></td>
				<td><?= $batchName ?></td>
				<td><?= $group1->getYear() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managebriefcasegroup_detail&id=<?= $group1->getGroupId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managebriefcasegroup_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managebriefcasegroup_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managebriefcasegroup_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System BriefcaseGroup" href="<?= $thispage ?>?page=managebriefcasegroup_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*BriefcaseGroup End*/ else /*Human Resource Begin*/if ($page == "managehumanresource_attendance" && isset($_REQUEST['upload_attendance']) && Authorize::isAllowable($config, "managehumanresource_attendance", "normal", "setlog", "-1", "-1"))	{
			$promise1 = new Promise();
			$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Human Resource Manager (Attendance)</div>
			<div class="ui-sys-panel-body">
<?php 
	$validTypes = array("text/csv");
	$validExtensions = array("csv");
	$maximumUploadedSize = 2097153;
	//Filename 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$temporaryFolder = "../temp";
	$biometric1 = null;
	$biometricAttendance1 ="";
	try {
		$promise1 = Object::saveUploadedFile($_FILES['attendancefile'], $temporaryFolder, $filename, $validTypes, $validExtensions, $maximumUploadedSize);
		if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
		$filename = $promise1->getResults(); //return a full file name path 
		$biometric1 = new Biometric($filename);
		$biometric1 = $biometric1->analyseBiometricFile();
		$biometricAttendance1 = Biometric::showBiometricAttendance($biometric1, $profile1);
		if (is_null($biometricAttendance1)) Object::shootException("Attendance Window were not found");
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
		echo $biometricAttendance1;
	} else {
?>
		<div class="ui-state-error">
			There were problems during in uploading the files <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "managehumanresource_attendance" && Authorize::isAllowable($config, "managehumanresource_attendance", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Human Resource Manager (Attendance)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form id="form1" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="managehumanresource_attendance"/>
					<input type="hidden" name="upload_attendance" value="true"/>
					<div class="ui-sys-data-capture ui-sys-inline-controls-center">
						<input class="ui-sys-file-upload" id="resultsfile" data-capture="0" type="file" name="attendancefile" accept="*.csv"/> &nbsp;&nbsp;<input type="button" id="__add_record" value="Upload File"/> 
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#resultsfile').on('change', function(event)	{ 
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $file1 = $('#resultsfile');
		if (! $file1.length) return;
		if (parseInt($file1.prop('data-capture')) == 1)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('You have not selected the file to upload')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
	}/*Human Resource End*/ else /*ApprovalSequenceData Begin*/if ($page == "manageapprovalsequencedata" && isset($_REQUEST['id']) && $login1->isRoot() && Authorize::isAllowable($config, "manageapprovalsequencedata", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$data1 = null;
		try {
			$data1 = new ApprovalSequenceData($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Approval Progress</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<table class="pure-table">
					<thead>
						<tr>
							<th></th><th></th>
						</tr>
					</thead>
					<tbody>
<?php 
		$bgcolor = "red";
		$completeApprovalText = "Approval in Progress";
		if ($data1->isApprovingComplete()) {
			$bgcolor = "blue";
			$completeApprovalText = "Approval COMPLETED";
		}
		$nextJobToApprove = "";
		if (! $data1->isApprovingComplete() && ! is_null($data1->getNextJobToApprove()))	{
			$nextJobToApprove = $data1->getNextJobToApprove()->getJobName();
		}
		$requestedBy = "";
		if (! is_null($data1->getRequestedBy()))	{
			$requestedBy = $data1->getRequestedBy()->getFullname();
		}
		$registrationTime = "";
		if (! is_null($data1->getTimeOfRegistration()))	{
			$registrationTime = $data1->getTimeOfRegistration()->getDateAndTimeString();
		}
?>
			<tr><td colspan="2"><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $completeApprovalText ?></td></tr>
			<tr><td>Requested By </td><td><?= $requestedBy ?></td></tr>
			<tr><td>Next Job To Approve </td><td><?= $nextJobToApprove ?></td></tr>
			<tr><td>Request Time</td><td><?= $registrationTime ?></td></tr>			
					</tbody>
				</table><br/>
<?php 
		if (! is_null($data1->getAlreadyApprovedList()))	{
?>
			<table class="pure-table">
				<thead>
					<tr>
						<th colspan="3" style="text-align: center;">Already <?= $data1->getSchema()->getDefaultApproveText() ?></th>
					</tr>
				</thead>
				<tbody>
<?php 
	$count = 0;
	foreach ($data1->getAlreadyApprovedList() as $ulogin1)	{
		$count++;
?>
					<tr>
						<td><?= $count ?></td>
						<td><?= $ulogin1->getFullname() ?></td>
						<td><?= $ulogin1->getJobTitle()->getJobName() ?></td>
					</tr>
<?php
	}
?>				
				</tbody>
			</table>
<?php
		}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageapprovalsequencedata">Back to Approval Sequence Data Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequencedata" && isset($_REQUEST['code']) && $login1->isRoot() && Authorize::isAllowable($config, "manageapprovalsequencedata", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$list = null;
		try {
			$list = ApprovalSequenceSchema::getSchemaListFromCode($database, $conn, $_REQUEST['code']);
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Approval Progress</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
		$tableCount = 0;
		foreach ($list as $schemaId)	{
			$tableCount++;
			$schema1 = null;
			$dataList1 = null;
			try {
				$schema1 = new ApprovalSequenceSchema($database, $schemaId, $conn);
				$dataList1 = ApprovalSequenceData::getApprovalSequenceDataListFromSchema($database, $conn, $schema1->getSchemaId());
				if (is_null($dataList1)) Object::shootException("The System returned an empty data");
			} catch (Exception $e)	{
				continue;
			}
?>
				<br/><table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-<?= $tableCount ?>">
					<thead>
						<tr>
							<th colspan="6"><?= $schema1->getSchemaName() ?></th>
						</tr>
						<tr>
							<th></th>
							<th>Status</th>
							<th>Requested By</th>
							<th>Next Job to <br/>Approve</th>
							<th>Request<br/>Time</th>
							<th></th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($dataList1 as $dataId)	{
		$data1 = null;
		try {
			$data1 = new ApprovalSequenceData($database, $dataId, $conn);
		} catch (Exception $e)	{
			continue;
		}
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
		//Table Data 
		$bgcolor = "red";
		if ($data1->isApprovingComplete()) $bgcolor = "blue";
		$nextJobToApprove = "";
		if (! $data1->isApprovingComplete() && ! is_null($data1->getNextJobToApprove()))	{
			$nextJobToApprove = $data1->getNextJobToApprove()->getJobName();
		}
		$requestedBy = "";
		if (! is_null($data1->getRequestedBy()))	{
			$requestedBy = $data1->getRequestedBy()->getFullname();
		}
		$registrationTime = "";
		if (! is_null($data1->getTimeOfRegistration()))	{
			$registrationTime = $data1->getTimeOfRegistration()->getDateAndTimeString();
		}
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
			<td><?= $requestedBy ?></td>
			<td><?= $nextJobToApprove ?></td>
			<td><?= $registrationTime ?></td>
			<td><a href="<?= $thispage ?>?page=manageapprovalsequencedata&id=<?= $data1->getDataId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table><br/>
				<ul class="ui-sys-pagination-<?= $tableCount ?>"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-<?= $tableCount ?>').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-<?= $tableCount ?> tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
<?php
		} //--for-each-schema_id
	} else {
?>
		<div class="ui-state-error">
			There was a problem in in loading Approval List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageapprovalsequencedata">Back to Approval Sequence Data Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequencedata" && $login1->isRoot() && Authorize::isAllowable($config, "manageapprovalsequencedata", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Approval Progress</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageapprovalsequencedata"/>
					<div class="pure-control-group">
						<label for="code">Operation Name </label>
						<select id="code" name="code" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the operation">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = ApprovalSequenceSchema::getSchemaDB();
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['code'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Next"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} /*ApprovalSequenceData End*/else /*Semester Change Begin*/if ($page == "manageprofile_change_semester" && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && $login1->isRoot() && Authorize::isAllowable($config, "manageprofile_change_semester", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$uprofile1 = null;
		try {
			$uprofile1 = new Profile($database, $__profileId, $conn);
			if ($uprofile1->getExtraFilter() != trim($_REQUEST['rndx'])) Object::shootException("The system has detected you are replaying data on the browser");
			if (intval($uprofile1->getCurrentSemester()) != intval($semester))	{
				$uprofile1->setCurrentSemester($semester);
				$enableUpdate = true;
			}
			if ($enableUpdate)	{
				$uprofile1->setExtraFilter(System::getCodeString(8));
				$uprofile1->commitUpdate();
			}
			if (! $enableUpdate) Object::shootException("Perhaps you did not update anything");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">SEMESTER CHANGING TOOL</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Congratulations, you have updated the Current Semester Successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in changing the semester <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_change_semester", "Changed semester to $semester");
	} else if ($page == "manageprofile_change_semester" && $login1->isRoot() && Authorize::isAllowable($config, "manageprofile_change_semester", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$uprofile1 = null;
		try {
			$uprofile1 = new Profile($database, $__profileId, $conn);
			$uprofile1->setExtraFilter(System::getCodeString(8));
			$uprofile1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">SEMESTER CHANGING TOOL</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form id="form1" class="pure-form" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageprofile_change_semester"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $uprofile1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="semester" title="Select Semester you are moving to">Current Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Semester">
							<option value="_@32767@_">--select--</option>
<?php 
	$semesterLimit = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $semesterLimit; $i++)	{
		$selected = "";
		if (intval($profile1->getCurrentSemester()) == $i) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div><br/>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Update Current Semester"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*Semester Change Ends*/else /*ApprovalSequenceSchema BEGIN*/if ($page == "manageapprovalsequenceschema_edit" && isset($_REQUEST['isapproving']) && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_jobtitle']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schema1 = null;
		$headerText = "UNKNOWN";
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Approving/Approved List from ".$schema1->getSchemaName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = null;
			if (trim($_REQUEST['isapproving']) == "isapproving")	{
				$listToUpdate = Object::detachIdListFromObjectList($schema1->getApprovingJobList(), $_REQUEST['did']);
				$schema1->setApprovingJobList($listToUpdate);
			} else {
				$listToUpdate = Object::detachIdListFromObjectList($schema1->getApprovedJobList(), $_REQUEST['did']);
				$schema1->setApprovedJobList($listToUpdate);
			}
			$schema1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Detach Approving/Approved List</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Approving/Approved List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Approving/Approved List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageapprovalsequenceschema_edit", "Detach Approving/Approved List for ".$schema1->getSchemaName());
	} else if ($page == "manageapprovalsequenceschema_edit" && isset($_REQUEST['isapproving']) && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_jobtitle']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schema1 = null;
		$headerText = "UNKNOWN";
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Approving/Approved List to ".$schema1->getSchemaName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = null;
			if (trim($_REQUEST['isapproving']) == "isapproving")	{
				$listToUpdate = Object::attachIdListToObjectList($schema1->getApprovingJobList(), $_REQUEST['did']);
			} else {
				$listToUpdate = Object::attachIdListToObjectList($schema1->getApprovedJobList(), $_REQUEST['did']);
			}
			/*
			We do not have anything to verify at this point
			*/
			if (trim($_REQUEST['isapproving']) == "isapproving")	{
				$schema1->setApprovingJobList($listToUpdate);
			} else {
				$schema1->setApprovedJobList($listToUpdate);
			}
			$schema1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Approving/Approved List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Approving/Approved List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageapprovalsequenceschema_edit", "Attach Approving/Approved List for ".$schema1->getSchemaName());
	} else if ($page == "manageapprovalsequenceschema_edit" && isset($_REQUEST['isapproving']) && isset($_REQUEST['id']) && isset($_REQUEST['attach_jobtitle']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schema1 = null;
		$headerText = "UNKNOWN";
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Approving/Approved List to ".$schema1->getSchemaName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (((trim($_REQUEST['isapproving']) == "isapproving") && ! is_null($schema1->getApprovingJobList()) && sizeof($schema1->getApprovingJobList()) > 0) || ((trim($_REQUEST['isapproving']) != "isapproving") && ! is_null($schema1->getApprovedJobList()) && sizeof($schema1->getApprovedJobList()) > 0))	{
		$objectList1 = null;
		$headerText = "";
		if (trim($_REQUEST['isapproving']) == "isapproving")	{
			$objectList1 = $schema1->getApprovingJobList();
			$headerText = "Approving List";
		} else {
			$objectList1 = $schema1->getApprovedJobList();
			$headerText = "Approved List";
		}
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="manageapprovalsequenceschema_edit"/>
				<input type="hidden" name="id" value="<?= $schema1->getSchemaId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_jobtitle" value="true"/>
				<input type="hidden" name="isapproving" value="<?= $_REQUEST['isapproving'] ?>"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
						<th colspan="3"><?= $headerText ?></th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Job Name</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getJobId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getJobName() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Approving/Approved List"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageapprovalsequenceschema_edit&id=<?= $schema1->getSchemaId() ?>&attach_jobtitle=true&isapproving=<?= $_REQUEST['isapproving'] ?>" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="manageapprovalsequenceschema_edit"/>
		<input type="hidden" name="id" value="<?= $schema1->getSchemaId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_jobtitle" value="true"/>
		<input type="hidden" name="isapproving" value="<?= $_REQUEST['isapproving'] ?>"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Job Name</th>
				</tr>
			</thead>
<?php 
	$query = JobTitle::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new JobTitle($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getJobId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getJobName() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Job Title"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequenceschema_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ApprovalSequenceSchema CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
	} else if ($page == "manageapprovalsequenceschema_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ApprovalSequenceSchema CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = ApprovalSequenceSchema::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("ApprovalSequenceSchema[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$schema1 = null;
			try	{
				$schema1 = new ApprovalSequenceSchema($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($schema1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageapprovalsequenceschema_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequenceschema_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ApprovalSequenceSchema CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageapprovalsequenceschema_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageapprovalsequenceschema_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageapprovalsequenceschema_csv" && Authorize::isAllowable($config, "manageapprovalsequenceschema_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ApprovalSequenceSchema CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageapprovalsequenceschema_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, ApprovalSequenceSchema::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageapprovalsequenceschema_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schema1 = null;
		try {
			 $schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			 $schema1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a ApprovalSequenceSchema which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ApprovalSequenceSchema Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The ApprovalSequenceSchema <?= $schema1->getSchemaName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the ApprovalSequenceSchema <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageapprovalsequenceschema_delete", "Deleted ".$schema1->getSchemaName());
	} else if ($page == "manageapprovalsequenceschema_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$schema1 = null;
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			$schema1->setExtraFilter(System::getCodeString(8));
			$schema1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a ApprovalSequenceSchema <b><?= $schema1->getSchemaName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the ApprovalSequenceSchema <?= $schema1->getSchemaName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageapprovalsequenceschema_delete&report=io&id=<?= $schema1->getSchemaId() ?>&rndx=<?= $schema1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageapprovalsequenceschema">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequenceschema_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schema1 = null;
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$operationCode = mysql_real_escape_string($_REQUEST['operationCode']);
		$validity = mysql_real_escape_string($_REQUEST['validity']);
		$defaultApproveText = mysql_real_escape_string($_REQUEST['defaultApproveText']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$schemaName = ApprovalSequenceSchema::getSchemaCaptionFromCode($operationCode);
		$isDefaultApprove = 0;
		if (isset($_REQUEST['isDefaultApprove'])) $isDefaultApprove = 1;
		if ($operationCode != $schema1->getOperationCode())	{
			$schema1->setOperationCode($operationCode); 
			$schema1->setSchemaName($schemaName);
			$enableUpdate = true;
		}
		if ($validity != $schema1->getNumberOfValidDays())	{
			$schema1->setNumberOfValidDays($validity); $enableUpdate = true;
		}
		if ($defaultApproveText != $schema1->getDefaultApproveText())	{
			$schema1->setDefaultApproveText($defaultApproveText); $enableUpdate = true;
		}
		if ($extraInformation != $schema1->getExtraInformation())	{
			$schema1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		if (($isDefaultApprove == 1) xor $schema1->isDefaultApprove())	{
			$schema1->setDefaultApprove($isDefaultApprove); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $schema1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$schema1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$schema1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Approval Sequence Schema Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Approval Sequence Schema <?= $schema1->getSchemaName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the schema <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageapprovalsequenceschema_edit", "Edited ".$schema1->getSchemaName());
	} else if ($page == "manageapprovalsequenceschema_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schema1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
			$schema1->setExtraFilter($extraFilter);
			$schema1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Approval Sequence Schema <?= $schema1->getSchemaName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageapprovalsequenceschema_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $schema1->getSchemaId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $schema1->getExtraFilter() ?>"/>
					 <div class="pure-control-group">
						<label for="operationCode">Operation Name </label>
						<select id="operationCode" name="operationCode" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Operation Name">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ApprovalSequenceSchema::getSchemaDB();
	foreach ($list1 as $alist1)	{
		$selected = "";
		if ($schema1->getOperationCode() == $alist1['code']) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $alist1['code'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label title="Number of Days since the operation is initiated to finish" for="validity">Validity (Days) </label>
						<input value="<?= $schema1->getNumberOfValidDays() ?>" class="text-can-not-be-zero" type="text" name="validity" id="validity" size="4" placeholder="7" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Validity (Days) : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="defaultApproveText">Default Approve Text </label>
						<input value="<?= $schema1->getDefaultApproveText() ?>" type="text" name="defaultApproveText" id="defaultApproveText" size="48" placeholder="Approved By" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Default Approve Text : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-controls">
<?php 
	$chkIsDefaultApprove = "";
	if ($schema1->isDefaultApprove()) $chkIsDefaultApprove = "checked";
?>
						<label title="We Strong Recommend not to check this box. If you allow Approve by Default, The <?= $schema1->getSchemaName() ?> operation will be given a green light whether Approved List is not set or Approving List is not set"><input <?= $chkIsDefaultApprove ?> type="checkbox" id="isDefaultApprove" name="isDefaultApprove" value="1"/>&nbsp;&nbsp; Should Approve by Default?</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $schema1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Validity (Days) can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequenceschema_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schema1 = null;
		try {
			$schema1 = new ApprovalSequenceSchema($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $schema1->getSchemaName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Schema Name</td>
						<td><?= $schema1->getSchemaName() ?></td>
					</tr>
					<tr>
						<td>Operation Code</td>
						<td><?= $schema1->getOperationCode() ?></td>
					</tr>
					<tr>
						<td>Validity in (Days)</td>
						<td><?= $schema1->getNumberOfValidDays() ?></td>
					</tr>
					<tr>
						<td>Default Approve Text</td>
						<td><?= $schema1->getDefaultApproveText() ?></td>
					</tr>
<?php 
	$defaultApproveText = "STRONG: Approving as Defined";
	if ($schema1->isDefaultApprove()) $defaultApproveText = "WEAK: Default Approving if no rules defined";
?>
					<tr><td colspan="2"><?= $defaultApproveText ?></td></tr>
<?php
	if (! is_null($schema1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $schema1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schema1->getApprovedJobList()) && sizeof($schema1->getApprovedJobList()) > 0)	{
		$objectList1 = $schema1->getApprovedJobList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="5">Job Titles Approved</th>
					</tr>
					<tr>
						<th></th>
						<th>Job Name</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getJobName() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schema1->getApprovingJobList()) && sizeof($schema1->getApprovingJobList()) > 0)	{
		$objectList1 = $schema1->getApprovingJobList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-2">
				<thead>
					<tr>
						<th colspan="6">Approving Job Titles</th>
					</tr>
					<tr>
						<th></th>
						<th>Job Name</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getJobName() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $schema1->getSchemaName() ?>" href="<?= $thispage ?>?page=manageapprovalsequenceschema_edit&id=<?= $schema1->getSchemaId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageapprovalsequenceschema_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $schema1->getSchemaName() ?>" href="<?= $thispage ?>?page=manageapprovalsequenceschema_delete&id=<?= $schema1->getSchemaId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageapprovalsequenceschema_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach APPROVED PARTIES, Approved Parts are Job Titles allowed to carry <?= $schema1->getSchemaName() ?> operation" href="<?= $thispage ?>?page=manageapprovalsequenceschema_edit&id=<?= $schema1->getSchemaId() ?>&attach_jobtitle=true&isapproving=false"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
		<a title="Attach APPROVING PARTIES, Approving Parts are Job Titles which will approve <?= $schema1->getSchemaName() ?> operation. These parties will not initiate the operation, however they will approve others to carry on the <?= $schema1->getSchemaName() ?> operation" href="<?= $thispage ?>?page=manageapprovalsequenceschema_edit&id=<?= $schema1->getSchemaId() ?>&attach_jobtitle=true&isapproving=isapproving"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "manageapprovalsequenceschema_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageapprovalsequenceschema_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$operationCode = mysql_real_escape_string($_REQUEST['operationCode']);
		$validity = mysql_real_escape_string($_REQUEST['validity']);
		$defaultApproveText = mysql_real_escape_string($_REQUEST['defaultApproveText']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$schemaName = ApprovalSequenceSchema::getSchemaCaptionFromCode($operationCode);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $schemaName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO approvalSequenceSchema (schemaName, operationCode, validity, defaultApproveText, extraFilter, extraInformation) VALUES('$schemaName', '$operationCode', '$validity', '$defaultApproveText', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("ApprovalSequenceSchema[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Approval Sequence Schema <?= $schemaName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the schema<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Approval Sequence Schema";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema_add"><?= $captionText ?></a> &nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageapprovalsequenceschema_add", "Added $schemaName");
	} else if ($page == "manageapprovalsequenceschema_add" && Authorize::isAllowable($config, "manageapprovalsequenceschema_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Approval Sequence Schema</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageapprovalsequenceschema_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="operationCode">Operation Name </label>
						<select id="operationCode" name="operationCode" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Operation Name">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ApprovalSequenceSchema::getSchemaDB();
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['code'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label title="Number of Days since the operation is initiated to finish" for="validity">Validity (Days) </label>
						<input class="text-can-not-be-zero" type="text" name="validity" id="validity" size="4" placeholder="7" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Validity (Days) : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="defaultApproveText">Default Approve Text </label>
						<input type="text" name="defaultApproveText" id="defaultApproveText" size="48" placeholder="Approved By" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Default Approve Text : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageapprovalsequenceschema">Back to Approval Sequence Schema Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Validity (Days) can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageapprovalsequenceschema" && Authorize::isAllowable($config, "manageapprovalsequenceschema", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Approval Sequence Schema</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-schema-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageapprovalsequenceschema" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageapprovalsequenceschema_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>Schema Name</th>
				<th>Validity (in days)</th>
				<th>Default Approve Text</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = ApprovalSequenceSchema::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch schema data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$schema1 = null;
		try {
			$schema1 = new ApprovalSequenceSchema($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($schema1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$bgcolor = "blue";
			$title1 = "";
			if ($schema1->isDefaultApprove())	{
				$bgcolor = "gold";
				$title1 = "title=\"Default Approve is ON\"";
			}
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><span <?= $title1 ?> style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
				<td><?= $schema1->getSchemaName() ?></td>
				<td><?= $schema1->getNumberOfValidDays() ?></td>
				<td><?= $schema1->getDefaultApproveText() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageapprovalsequenceschema_detail&id=<?= $schema1->getSchemaId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageapprovalsequenceschema_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageapprovalsequenceschema_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageapprovalsequenceschema_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System ApprovalSequenceSchema" href="<?= $thispage ?>?page=manageapprovalsequenceschema_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*ApprovalSequenceSchema End*/ else/*Begin Group Closing Results*/if ($page == "manageresultsgroup_edit" && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['service_finalize']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$resultsFolder = "../data/results/";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$groupName = "";
		$group1 = null;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FINALIZING GROUP RESULTS</div>
			<div class="ui-sys-panel-body">
<?php 
				try {
					$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
					$groupName = $group1->getExaminationGroup()->getGroupName();
					if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
					$promise1 = ResultsGroup::groupResultsCompilation($database, $conn, $profile1, $systemTime1, $group1->getGroupId(), "../data/results/", 51);
					$group1->setExtraFilter(System::getCodeString(8));
					$group1->setResultsLocked("1"); //We need to make sure everything is locked
					$group1->commitUpdate();
				} catch (Exception $e)	{
					$promise1->setReason($e->getMessage());
					$promise1->setPromise(false);
				}
				if ($promise1->isPromising())	{
					$enableUpdate = true;
?>
					<div class="ui-state-highlight">
						You have successful Compiled the group results for <b><?= $group1->getExaminationGroup()->getGroupName() ?></b>
					</div>
<?php
				} else {
?>
					<div class="ui-state-error">
						There were problems in compiling the Group Results<br/>
						Details : <?= $promise1->getReason() ?>
					</div>
<?php
				}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresultsgroup_edit", "Finalized $groupName");
	} else if ($page == "manageresultsgroup_edit" && isset($_REQUEST['service_finalize']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$resultsFolder = "../data/results/";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FINALIZING GROUP RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
		$individualResultsAreFine = true;
?>
<!--Begin Summary Of Individual Results-->
				<div>
					<table class="pure-table">
						<thead>
							<tr>
								<th colspan="7">Summary of Individual Results in a Group "<?= $group1->getExaminationGroup()->getGroupName() ?>"</th>
							</tr>
							<tr>
								<th></th>
								<th>Examination Name</th>
								<th>Type of Examination</th>
								<th>Semester</th>
								<th>Status</th>
								<th>Storage</th>
								<th>Comment</th>
							</tr>
						</thead>
						<tbody>
<?php 
	$list1 = null;
	try {
		$list1 = ResultsGroup::getResultsBelongingToAGroup($database, $conn, $group1->getGroupId(), false);
	} catch (Exception $e)	{
		
	}
	if (! is_null($list1))	{
		for ($i=0; $i < sizeof($list1); $i++)	{
			$results1 = null;
			try {
				$results1 = new Results($database, $list1[$i], $conn);
			} catch (Exception $e)	{
				continue;
			}
			$primaryText = "N/A";
			$examinationName = "";
			$semesterText = "";
			$statusText = "OPEN";
			$storageColor = "red";
			$commentText = "Data File Not Found";
			$rawFileIsOkay = false;
			$gradedFileIsOkay = false;
			$fileIsFound = false;
			if (! is_null($results1->getExamination()))	{
				$examinationName = $results1->getExamination()->getExaminationName();
				if (! is_null($results1->getRawMarksCSVFile()) && file_exists($resultsFolder.$results1->getRawMarksCSVFile()))	{
					$fileIsFound = true;
					$commentText = "Data File is Present, However the Integrity of Data is Compromised";
					$storageColor = "gold";
					if (md5_file($resultsFolder.$results1->getRawMarksCSVFile()) == $results1->getRawMarksCSVFileChecksum())	{
						$commentText = "Data File is Present, and the Data has passed the Integrity Check";
						$storageColor = "blue";
						$rawFileIsOkay = true;
					}
				}
				//We need to check graded file too 
				if ($rawFileIsOkay && ! is_null($results1->getGradedMarksCSVFile()) && file_exists($resultsFolder.$results1->getGradedMarksCSVFile()))	{
					$commentText = "[Graded] Data File is Present, However the Integrity of Data is Compromised";
					$storageColor = "gold";
					if (md5_file($resultsFolder.$results1->getGradedMarksCSVFile()) == $results1->getGradedMarksCSVFileChecksum())	{
						$commentText = "[Graded] Data File is Present, and the Data has passed the Integrity Check";
						$storageColor = "blue";
						$gradedFileIsOkay = true;
					}
				}
				
				if ($results1->getExamination()->isPrimary())	{
					$primaryText = "Primary";
					$semesterText = $results1->getExamination()->getSemester();
					$individualResultsAreFine = $individualResultsAreFine && $rawFileIsOkay && $gradedFileIsOkay;
				} else if ($results1->getExamination()->isSupplimentary())	{
					$primaryText = "Supplimentary";
					$semesterText = "N/A";
					if ($fileIsFound) $individualResultsAreFine = $individualResultsAreFine && $rawFileIsOkay && $gradedFileIsOkay;
				}
			}
			if ($results1->isResultsLocked())	{
				$statusText = "LOCKED";
			}
			
?>
			<tr>
				<td><?= $i + 1 ?></td>
				<td><?= $examinationName ?></td>
				<td><?= $primaryText ?></td>
				<td><?= $semesterText ?></td>
				<td><?= $statusText ?></td>
				<td><span style="background-color: <?= $storageColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
				<td><?= $commentText ?></td>
			</tr>
<?php
		} //end-foreach
	}
?>						
						</tbody>
					</table>
				</div>
<!--End Summary of Individual Results-->	
<?php 
		if ($individualResultsAreFine)	{
			try {
				$group1->setExtraFilter(System::getCodeString(8));
				$group1->commitUpdate();
			} catch (Exception $e)	{
				die($e->getMessage());
			}
?>
			<br/><br/>
			<div class="ui-widget ui-widget-content">
				<div class="ui-widget-header">Finalize Results for Group <?= $group1->getExaminationGroup()->getGroupName() ?></div>
				<div>
					<div class="ui-sys-warning">
						<b>IMPORTANT : </b> You are doing this operation to the Group and its corresponding Results it contains. Make sure all the results for this group are uploaded properly. This operation will lock the entire group together with its corresponding results. This operation will have NO EFFECT on results data or grades for individual results, however it will only affect the combined Group results and Grades
					</div>
					<div>
						<form id="form1" method="POST" action="<?= $thispage ?>">
							<input type="hidden" name="page" value="manageresultsgroup_edit"/>
							<input type="hidden" name="report" value="io"/>
							<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
							<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
							<input type="hidden" name="service_finalize" value="true"/>
							<span id="perror">&nbsp;</span>
							<div class="ui-sys-inline-controls-right">
								<input type="button" id="__add_record" value="Finalize Group Results"/>
							</div>
						</form>
					</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
				</div>
				<div></div>
			</div>
<?php
		} else {
?>
			<div class="ui-state-error">
				Kindly review the tabular above, one or more of the results were not found, try reading on the comment area 
			</div>
<?php
		}
	} else {
?>
		<div class="ui-state-error">
			There were some problems in processing your request<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>		
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	}/*End Group Closing Results*/else /*Begin Results Lock*/if ($page == "manageresults_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			if (! is_null($results1->getExamination())) $updatedName = $results1->getExamination()->getExaminationName();
			if (trim($_REQUEST['rndx']) != $results1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $results1->isResultsLocked()))	{
				Object::shootException("Nothing to be done, There is no change on the Lock Status");
			}
			$results1->setResultsLocked($action);
			$results1->setExtraFilter(System::getCodeString(8));
			$results1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unlocking 
		$successMessage = "You have successful Unlocked the Results";
		$errorMessage = "The Results could not be Unlocked";
		$logName = "UNLOCKED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Locked the Results";
			$errorMessage = "The Results could not be Locked";
			$logName = "LOCKED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_edit", $logName);
	} else if ($page == "manageresults_edit" && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			$results1->setExtraFilter(System::getCodeString(8));
			$results1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Locked Status 
		$userText = "You are About to Lock the Results, Please make sure All Results Belonging to This Results have been uploaded successful. Once the Results is Locked further results will not be received by the system<br/>Are you sure you want to Lock Results?";
		$buttonText = "(YES) Lock Results";
		$action="1";
		if ($results1->isResultsLocked())	{
			$userText = "You are About to Unlock the Results, This will Allow Results to be Appended to the Existing Results, However the System will have to re-grade the results. <br/>Are you sure you want to Unlock Results?";
			$buttonText = "(YES) Unlock Results";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_edit"/>
					<input type="hidden" name="service_locked" value="<?= $_REQUEST['service_locked'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $results1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=manageresults_detail&id=<?= $results1->getResultsId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End Results Lock*/else /*Begin Results Group Lock*/if ($page == "manageresultsgroup_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$action = mysql_real_escape_string($_REQUEST['action']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$updatedName = "";
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
			if (! is_null($group1->getExaminationGroup())) $updatedName = $group1->getExaminationGroup()->getGroupName();
			if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	Object::shootException("The System has Detected you are replaying data in your Browser window");
			if (! ((intval($action) == 1) xor $group1->isResultsLocked()))	{
				Object::shootException("Nothing to be done, There is no change on the Lock Status");
			}
			$group1->setResultsLocked($action);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Default We are Unlocking 
		$successMessage = "You have successful Unlocked the Results Group";
		$errorMessage = "The Results Group could not be Unlocked";
		$logName = "UNLOCKED ".$updatedName;
		if (intval($action) == 1)	{
			$successMessage = "You have successful Locked the Results Group";
			$errorMessage = "The Results Group could not be Locked";
			$logName = "LOCKED ".$updatedName;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS GROUP</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			<?= $successMessage ?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			<?= $errorMessage ?><br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresultsgroup_edit", $logName);
	} else if ($page == "manageresultsgroup_edit" && isset($_REQUEST['service_locked']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		//Default We do assume Not Locked Status 
		$userText = "You are About to Lock the Results Group, Please make sure All Results Belonging to This Results Group have been uploaded successful. Once the Results Group is Locked further results will not be received by the system<br/>Are you sure you want to Lock Group Results?";
		$buttonText = "(YES) Lock Group Results";
		$action="1";
		if ($group1->isResultsLocked())	{
			$userText = "You are About to Unlock the Results Group, This will Allow Results to be Appended to the Existing Results, However the System will have to re-grade the results. <br/>Are you sure you want to Unlock Group Results?";
			$buttonText = "(YES) Unlock Group Results";
			$action = "0";
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">LOCK/UNLOCK RESULTS GROUP</div>
			<div class="ui-sys-panel-body ui-sys-data-capture ui-sys-inline-controls-center">
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresultsgroup_edit"/>
					<input type="hidden" name="service_locked" value="<?= $_REQUEST['service_locked'] ?>"/>
					<input type="hidden" name="id" value="<?= $_REQUEST['id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="action" value="<?= $action ?>"/>
					<div class="ui-sys-warning">
						<?= $userText ?>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="ui-sys-center-text">
						<a id="__add_record" class="button-link-warning" href="#"><?= $buttonText ?></a>&nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=manageresultsgroup_detail&id=<?= $group1->getGroupId() ?>">No (Cancel)</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*End Results Group Lock*/else/*Results Monitor Begin*/ if ($page == "manageresults_monitor_devel" && isset($_REQUEST['controlFlags']) && isset($_REQUEST['classname']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_monitor_devel", "normal", "setlog", "-1", "-1") && Authorize::isAllowable($config, "manage".strtolower($_REQUEST['classname'])."_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		//classname we expects to be a ResultsGroup or Results 
		$controlFlags = intval($_REQUEST['controlFlags']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$results1 = null;
		$resultsFolder = "";
		if (Results::isResultsMode($controlFlags))	{
			$resultsFolder = "../data/results/";
		} else if (Results::isBriefcaseMode($controlFlags)) {
			$resultsFolder = "../data/briefcase/";
		}
		$rawMarksResultsFile1 = null;
		$gradedMarksResultsFile1 = null;
		$displayResultsData = "";
		$classname=$_REQUEST['classname'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Monitor</div>
			<div class="ui-sys-panel-body">
<?php
			try {
				$results1 = ClassRegistry::getObjectReference($database, $conn, $_REQUEST['classname'], $_REQUEST['id']);
				if (is_null($results1)) Object::shootException("Could not find Results Reference");
				if (is_null($results1->getRawMarksCSVFile())) Object::shootException("Raw Marks CSV File is not yet set");
				$filename = $resultsFolder.$results1->getRawMarksCSVFile();
				$rawMarksResultsFile1 = new ResultsFile($database, $filename, $conn);
				if (is_null($results1->getGradedMarksCSVFile())) Object::shootException("Graded Marks CSV File is not yet set");
				$filename = $resultsFolder.$results1->getGradedMarksCSVFile();
				$gradedMarksResultsFile1 = new ResultsFile($database, $filename, $conn);
				//Beginning of playing with data 
				/*$trawMarksResultsFile1 = $rawMarksResultsFile1->getTransactionResultsFile(101);
				$trawMarksResultsFile1 = $trawMarksResultsFile1->merge($rawMarksResultsFile1->getTransactionResultsFile(98), $systemTime1, true, false);
				$trawMarksResultsFile1 = $trawMarksResultsFile1->merge($rawMarksResultsFile1->getStudentResultsFile(1), $systemTime1, true, false);
				*/
				//$trawMarksResultsFile1 = $rawMarksResultsFile1->getStudentResultsFile(1);
				//$trawMarksResultsFile1 = $trawMarksResultsFile1->merge($rawMarksResultsFile1->getStudentResultsFile(1), $systemTime1, true, false);
				
				
				//$rawMarksResultsFile1 = $rawMarksResultsFile1->merge($rawMarksResultsFile1->getStudentResultsFile(1), $systemTime1, true, false);
				//$trawMarksResultsFile1 = $rawMarksResultsFile1->getCustomTransactionResultsFile(array("101","95","100"));
				$trawMarksResultsFile1 = $rawMarksResultsFile1;
				//$tgradedMarksResultsFile1 = $gradedMarksResultsFile1;
				$tgradedMarksResultsFile1 = $gradedMarksResultsFile1;
				//End of playing with data
				$displayResultsData = Results::monitorResults($database, $conn, $trawMarksResultsFile1, $tgradedMarksResultsFile1);
				
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
			if ($promise1->isPromising())	{
?>
				<div>
<?php
					echo $displayResultsData;
?>
				</div>
<?php
			} else {
?>
				<div class="ui-state-error">
					There were problems in displaying Results Data <br/>
					Details : <?= $promise1->getReason() ?>
				</div>
<?php
			}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manage<?= strtolower($classname) ?>_detail&id=<?= $_REQUEST['id'] ?>">Back to <?= $classname ?></a></div>
		</div>
<?php
		mysql_close($conn);
	} /*Results Monitor Ends*/else/*View Registration Progress Begins*/if ($page == "managestudent_registration_progress" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managestudent_registration_progress", "normal", "setlog", "-1", "-1"))	{
		$allowDelete = Authorize::isAllowable($config, "managestudent_delete", "normal", "donotsetlog", "-1", "-1");
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$firstname = null;
		$middlename = null;
		$lastname = null;
		$code = null;
		$dob = null;
		if ($_REQUEST['firstname'] != "")	{
			$firstname = mysql_real_escape_string($_REQUEST['firstname']); 
		}
		if ($_REQUEST['middlename'] != "")	{
			$middlename = mysql_real_escape_string($_REQUEST['middlename']); 
		}
		if ($_REQUEST['lastname'] != "")	{
			$lastname = mysql_real_escape_string($_REQUEST['lastname']); 
		}
		if ($_REQUEST['code'] != "")	{
			$code = mysql_real_escape_string($_REQUEST['code']); 
		}
		if ($_REQUEST['dob'] != "")	{
			$dob = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($_REQUEST['dob']); 
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">View the Status of Registration</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$studentArray1 = array();
	try {
		$list = Login::getLoginIdsForAnyOfTheAccounts($database, $conn, $firstname, $middlename, $lastname, $dob, $code);
		if (is_null($list)) Object::shootException("There is no record associated with your search");
		foreach ($list as $loginId)	{
			$studentId = Student::getStudentIdFromLoginId($database, $conn, $loginId);
			if (is_null($studentId)) continue;
			$studentArray1[sizeof($studentArray1)] = new Student($database, $studentId, $conn);
		}
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<table class="pure-table">
			<thead>
				<tr>
					<th></th>
					<th>Code</th>
					<th>Firstname</th>
					<th>Middlename</th>
					<th>Lastname</th>
					<th>D.O.B</th>
					<th>Page</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
<?php 
		for ($i=0; $i < sizeof($studentArray1); $i++)	{
			$student1 = $studentArray1[$i];
			$ulogin1 = $student1->getLogin();
			if (! $ulogin1->isAdmitted())	{
?>
				<tr>
					<td><?= ($i + 1) ?></td>
					<td><?= $student1->getReferenceNumber() ?></td>
					<td><?= $ulogin1->getFirstname() ?></td>
					<td><?= $ulogin1->getMiddlename() ?></td>
					<td><?= $ulogin1->getLastname() ?></td>
					<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB()) ?></td>
					<td>
<?php 
	try {
		$progressPage = AdmissionProgress::getProgressPageNameFromPageNumber($database, $conn, $student1->getApplicationCounter());
		echo $progressPage;
	} catch (Exception $e)	{
		echo "N/A";
	}
?>					
					</td>
					<td>
<?php 
	if ($allowDelete)	{
?>
						<span class="ui-sys-search-controls">
							<a href="<?= $thispage ?>?page=managestudent_delete&id=<?= $student1->getStudentId() ?>" title="Delete Student (<?= $student1->getReferenceNumber() ?>)"><img alt="ICN" src="../sysimage/buttondelete.png"/></a>
						</span>
<?php 
	}
?>
					</td>
				</tr>
<?php
			}
		}
?>
			</tbody>
		</table>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in getting Registration Progress for Student<br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent_registration_progress">Back to Registration Progress Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_registration_progress" && Authorize::isAllowable($config, "managestudent_registration_progress", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">View the Status of Registration</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div style="font-size: 0.9em; font-weight: bold;">
					You can fill any of the fields below
				</div>
				<form id="form1" class="pure-form pure-form-aligned" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managestudent_registration_progress"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="code">Application Code </label>
						<input type="text" name="code" id="code" size="32" notrequired="ture" validate="true" validate_control="text" validate_expression="<?= $exprL16Name ?>" validate_message="Application Code : <?= $msgL16Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="firstname">Firstname </label>
						<input type="text" name="firstname" id="firstname" size="32" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Firstname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="middlename">Middlename </label>
						<input type="text" name="middlename" id="middlename" size="32" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Middlename : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lastname">Lastname </label>
						<input type="text" name="lastname" id="lastname" size="32" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Lastname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="dob">Your Date of Birth </label>
						<input class="datepicker" type="text" name="dob" id="dob" size="32" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Date: <?= $msgDate ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="View Student Registration Progress"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} /*View Registration Progress Ends*/else/*Payment History Begins*/if ($page == "managefeepayment_delete" && isset($_REQUEST['report']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeepayment_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body"></div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeepayment_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeepayment_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body"></div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeepayment_add" && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeepayment_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$invoiceId = mysql_real_escape_string($_REQUEST['invoiceId']);
		$payerId = mysql_real_escape_string($_REQUEST['payerId']);
		$paymentNumber = mysql_real_escape_string($_REQUEST['paymentNumber']);
		$amount = mysql_real_escape_string($_REQUEST['amount']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$student1 = null;
		$ulogin1 = null;
		$logname = "";
		$invoice1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			if (trim($_REQUEST['rndx']) != $student1->getExtraFilter()) Object::shootException("The System has Detected you are replaying data in your Browser window");
			$studentId = $student1->getStudentId();
			$paymentTime = $systemTime1->getDateAndTimeString();
			$invoice1 = new FeeInvoice($database, $invoiceId, $conn);
			if (is_null($invoice1->getGroup())) Object::shootException("Invoice Group is not initialized");
			if (is_null($invoice1->getGroup()->getCurrency())) Object::shootException("Invoice Currency is not Initialized");
			$query = "INSERT INTO feePayments (invoiceId, payerId, paymentNumber, paymentTime, amount, extraInformation) VALUES('$invoiceId', '$payerId', '$paymentNumber', '$paymentTime', '$amount', '$extraInformation')";
			$results = mysql_db_query($database, $query, $conn) or Object::shootException("There were problems in Registering the payment");
			$student1->setExtraFilter(System::getCodeString(8));
			$student1->commitUpdate();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Payment Registration for <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
		$enableUpdate = true;
		$logname = $invoice1->getGroup()->getCurrency()->getCurrencyCode()." ".Number::getCommaSeparatorFormat($amount)." paid by ".$ulogin1->getFullname();
?>
		<div class="ui-state-highlight">
			Fee Payment for student <?= $ulogin1->getFullname() ?> has been registered successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			Fee Payment for student <?= $ulogin1->getFullname() ?> could not be completed<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeepayment_detail&id=<?= $_REQUEST['id'] ?>">Back to Fee Payment History</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeepayment_add", $logname);
	} else if ($page == "managefeepayment_add" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeepayment_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			$student1->setExtraFilter(System::getCodeString(8));
			$student1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Payment Registration for <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form id="form1" class="pure-form pure-form-aligned" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeepayment_add"/>
					<input type="hidden" name="id" value="<?= $student1->getStudentId() ?>"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $student1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="invoiceId" title="Invoice you are Paying Agaist to">Invoice </label>
						<select id="invoiceId" name="invoiceId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select an Invoice for this Student">
							<option data-invoice-currency="" value="_@32767@_">--select--</option>
<?php 
	$list1 = null;
	try {
		$list1 = FeeInvoice::getInvoicesBelongingToStudent($database, $conn, $student1->getStudentId());
	} catch (Exception $e)	{
		die("err ".$e->getMessage());
	}
	if (! is_null($list1))	{
		foreach ($list1 as $invoiceId)	{
			$invoice1 = null;
			try {
				$invoice1 = new FeeInvoice($database, $invoiceId, $conn);
				if (is_null($invoice1->getGroup())) Object::shootException("Fee Invoice Group were not found");
				if (is_null($invoice1->getGroup()->getCurrency())) Object::shootException("Fee Invoice Group Currency were not initialized");
			} catch (Exception $e)	{
				continue;
			}
?>
			<option data-invoice-currency="in <?= $invoice1->getGroup()->getCurrency()->getCurrencyCode() ?>" value="<?= $invoice1->getInvoiceId() ?>"><?= $invoice1->getInvoiceNumber() ?>, <?= $invoice1->getGroup()->getGroupName() ?></option>
<?php
		} //--end-for-each
	} else {
?>
		<option value="_@32767@_">No Invoice Found</option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="payerId" title="This fee is payed by">Fee Payer </label>
						<select id="payerId" name="payerId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Fee Payer">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = FeePayer::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="paymentNumber">Payment Receipt Number </label>
						<input type="text" name="paymentNumber" id="paymentNumber" size="32" required pattern="<?= $exprL48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL48Name ?>" validate_message="Receipt Number : <?= $msgL48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="amount">Amount <span id="labelCurrencyCode"></span></label>
						<input class="text-can-not-be-zero" type="text" id="amount" name="amount" size="12" required pattern="<?= $exprAmount ?>" validate="true" validate_control="text" validate_expression="<?= $exprAmount ?>" validate_message="Amount: <?= $msgAmount ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Register Fee Payment"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeepayment_detail&id=<?= $_REQUEST['id'] ?>">Back to Fee Payment History</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('select#invoiceId').on('change', function(event)	{
		event.preventDefault();
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		$('#labelCurrencyCode').html($option1.attr('data-invoice-currency'));
	});
	$('#__add_record').on('click', function(event)	{
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Amount Can NOT Be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managefeepayment_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeepayment_detail", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = Authorize::isAllowable($config, "managefeepayment_delete", "normal", "donotsetlog", "-1", "-1");
		$enableAdd = Authorize::isAllowable($config, "managefeepayment_add", "normal", "donotsetlog", "-1", "-1");
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$student1 = null;
		$ulogin1 = null;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Payment History For <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$paymentHistory = "";
	$counter1 = new Counter();
	try {
		$paymentHistory = FeeInvoice::drawFeePaymentForStudent($database, $conn, $student1->getStudentId(), $counter1, $enableUpdate);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-data-capture">
			<!--Begin Loading Results-->
<?php 
			echo $paymentHistory;
?>
			<!--End Loading Results-->
		</div>
		<div class="ui-sys-inline-controls-right">
<?php 
		if ($enableAdd)	{
?>
			<form id="form1" method="POST" action="<?= $thispage ?>">
				<span id="perror">&nbsp;</span>
				<input type="hidden" name="page" value="managefeepayment_add"/>
				<input type="hidden" name="id" value="<?= $student1->getStudentId() ?>"/>
				<input type="button" id="__add_record" value="Register Fee Payment"/>
			</form>
<?php 
		}
?>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in fetching the Payment History<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent_detail&id=<?= $_REQUEST['id'] ?>">Back to Student Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} /*Payment History Ends*/else/*Password Token Change Begin*/if ($page == "managelogin_edit" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['id']) && isset($_REQUEST['password_token']) && Authorize::isAllowable($config, "managelogin_edit", "normal", "setlog", "-1", "-1")) {
		//id, loginId of the victim 
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$ulogin1 = null;
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			if (trim($_REQUEST['rndx']) != $ulogin1->getExtraFilter()) Object::shootException("The System has Detected you are replaying data in your Browser window");
			$ulogin1->setPassword(sha1($_REQUEST['password']));
			$ulogin1->setExtraFilter(System::getCodeString(8));
			$ulogin1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Password Update for <i><?= $ulogin1->getFullname() ?></i></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Password tokens for <?= $ulogin1->getFullname() ?> has been updated successful 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in updating this user password<br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managelogin_edit", "Password Update for ".$ulogin1->getFullname());
	} else if ($page == "managelogin_edit" && isset($_REQUEST['id']) && isset($_REQUEST['password_token']) && Authorize::isAllowable($config, "managelogin_edit", "normal", "setlog", "-1", "-1")) {
		//id, loginId of the victim 
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$ulogin1 = null;
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			$ulogin1->setExtraFilter(System::getCodeString(8));
			$ulogin1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Password Change for <i><?= $ulogin1->getFullname() ?></i></div>
			<div class="ui-sys-panel-body">
				<form id="form1" class="pure-form pure-form-aligned" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managelogin_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $ulogin1->getExtraFilter() ?>"/>
					<input type="hidden" name="id" value="<?= $ulogin1->getLoginId() ?>"/>
					<input type="hidden" name="password_token" value="<?= $_REQUEST['password_token'] ?>"/>
					<div class="pure-control-group">
						<label for="password">Enter New Password </label>
						<input type="password" name="password" id="password" size="32" required pattern="<?= $exprL48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL48Name ?>" validate_message="Password : <?= $msgL48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="password">Confirm Password </label>
						<input type="password" id="cpassword" size="32" required pattern="<?= $exprL48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL48Name ?>" validate_message="Password(2) : <?= $msgL48Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Change Password"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		if ($('#password').val() == $('#cpassword').val())	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$('#perror').html('Password Mismatch');
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} /*Password Token Change End*/ else /*Advance Accademic Year Begin*/if ($page == "manageprofile_advance_accademicyear" && $login1->isRoot() && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageprofile_advance_accademicyear", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Advance Accademic Year<br/>(Report)</div>
			<div class="ui-sys-panel-body">
<?php 
	$accademicYear = "";
	try {
		if (trim($_REQUEST['rndx']) != $profile1->getExtraFilter()) Object::shootException("The System has Detected you are replaying data in your Browser window");
		$accademicYear1 = new AccademicYear($database, $_REQUEST['batchId'], $conn);
		$accademicYear = $accademicYear1->getAccademicYear();
		$revisionNumber = $profile1->getRevisionNumber(); //Older One
		$profile1 = new Profile($database, $__profileId, $conn);
		$profile1->setCurrentAccademicYear($_REQUEST['batchId']);
		$profile1->setRevisionNumber(intval($revisionNumber) + 1);
		$profile1->setRevisionTime($systemTime1->getDateAndTimeString());
		$profile1->setExtraFilter(System::getCodeString(8));
		$profile1->commitUpdate();
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			You have successful advanced the system to Accademic Year <b><?= $accademicYear ?></b>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in updating the Accademic Year<br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_advance_accademicyear", "Advanced to $accademicYear");
	} else if ($page == "manageprofile_advance_accademicyear" && $login1->isRoot() && Authorize::isAllowable($config, "manageprofile_advance_accademicyear", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services"); 
		$profile1 = null;
		try {
			$profile1 = new Profile($database, $__profileId, $conn);
			$profile1->setExtraFilter(System::getCodeString(8));
			$profile1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Advance Accademic Year</div>
			<div class="ui-sys-panel-body ui-sys-inline-controls-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageprofile_advance_accademicyear"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $profile1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="batchId" title="Accademic Year to advance to">Accademic Year to Join </label>
						<select id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select an accademic year to join">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
		if (intval($accademicYear1->getAccademicYearNumber()) > intval($controlAccademicCounter))	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
		}
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Advance Accademic Year"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} /*Advance Accademic Year End*/else /*Invoice Generation Begin*/if ($page == "generateinvoices" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managefeeinvoice", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$group1 = null;
		try {
			$group1 = new FeeInvoiceGroup($database, $groupId, $conn);
			$promise1 = FeeInvoice::generateAutoInvoices($database, $conn, $profile1, $groupId, $extraInformation);
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Invoices Generation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Invoices have been Generated successful <br/>
			Group Year Name : <?= $group1->getGroupName() ?><br/>
			Student for Course: <?= $group1->getCourse()->getCourseName() ?><br/>
			Currently Students in year: <?= $group1->getYear() ?><br/><br/>
			Info: <i><?= $promise1->getReason() ?></i>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating Invoices<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeeinvoice", "Generated Invoices for ".$group1->getGroupName());
	} else if ($page == "generateinvoices" && Authorize::isAllowable($config, "managefeeinvoice", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Invoices Generation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="generateinvoices"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupId">Fee Invoice Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Fee Invoice Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = FeeInvoiceGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$group1 = null;
		try {
			$group1 = new FeeInvoiceGroup($database, $alist1['id'], $conn);
		} catch (Exception $e)	{
			$message = $e->getMessage();
			die("<option>$message</option>");
		}
		if ($group1->isAutoGenerated() && ! $group1->isInvoicesAlreadyGenerated())	{
?>
			<option value="<?= $group1->getGroupId() ?>"><?= $group1->getGroupName() ?></option>
<?php
		}
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*Invoice Generation End*/ else /*FeeInvoiceGroup BEGIN*/if ($page == "managefeeinvoicegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_feestructure']) && Authorize::isAllowable($config, "managefeeinvoicegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		$headerText = "UNKNOWN";
		try {
			$group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Creators Map from ".$group1->getGroupName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($group1->getStructureIdList(), $_REQUEST['did']);
			$group1->setStructureIdList($listToUpdate);
			$group1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Fee Structure List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Fee Structure List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeeinvoicegroup_edit", "Detach Fee Structures for ".$group1->getGroupName());
	} else if ($page == "managefeeinvoicegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_feestructure']) && Authorize::isAllowable($config, "managefeeinvoicegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		$headerText = "UNKNOWN";
		try {
			$group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Fee Structure Map to ".$group1->getGroupName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($group1->getStructureIdList(), $_REQUEST['did']);
			$listArr1 = explode(",", $listToUpdate);
			foreach ($listArr1 as $structureId)	{
				$structure1 = new FeeStructure($database, $structureId, $conn);
				if (is_null($group1->getCourse()) || is_null($structure1->getCourse()) || is_null($group1->getCurrency()) || is_null($structure1->getCurrency()) || ($group1->getYear() != $structure1->getYear()) || ($group1->getCourse()->getCourseId() != $structure1->getCourse()->getCourseId()) || ($group1->getCurrency()->getCurrencyId() != $structure1->getCurrency()->getCurrencyId()) || ($group1->isCitizen() != $structure1->isCitizen())) Object::shootException("One of the fee structure can not be added to the Group");
			}
			$group1->setStructureIdList($listToUpdate);
			$group1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Fee Structure List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Fee Structure List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeeinvoicegroup_edit", "Attach Fee Structures for ".$group1->getGroupName());
	} else if ($page == "managefeeinvoicegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_feestructure']) && Authorize::isAllowable($config, "managefeeinvoicegroup_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		$headerText = "UNKNOWN";
		try {
			$group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Fee Structure Map to ".$group1->getGroupName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($group1->getStructureIdList()) && sizeof($group1->getStructureIdList()) > 0)	{
		$objectList1 = $group1->getStructureIdList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managefeeinvoicegroup_edit"/>
				<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_feestructure" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
						<th colspan="10">Attached Fee Structures</th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Title</th>
							<th>Course</th>
							<th>Year</th>
							<th>Valid From</th>
							<th>Amount</th>
							<th>Currency</th>
							<th>Is Citizen</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getStructureId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getTitle() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
?>
		<?= $obj1->getCourse()->getCourseName() ?> (<?= $obj1->getCourse()->getCourseCode() ?>)
<?php
	}
?>				
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getValidFrom()))	{
		echo DateAndTime::convertFromDateTimeObjectToGUIDateFormat($obj1->getValidFrom());
	}
?>			
			</td>
			<td><?= Number::getCommaSeparatorFormat($obj1->getAmount()) ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCurrency()))	{
		echo $obj1->getCurrency()->getCurrencyCode();
	}
?>				
			</td>
			<td>
<?php 
	$citizen = "Foreigner";
	if ($obj1->isCitizen()) $citizen = "Native Citizen";
	echo $citizen;
?>				
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Fee Structures"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managefeeinvoicegroup_edit&id=<?= $group1->getGroupId() ?>&attach_feestructure=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managefeeinvoicegroup_edit"/>
		<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_feestructure" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Title</th>
					<th>Course</th>
					<th>Year</th>
					<th>Valid From</th>
					<th>Amount</th>
					<th>Currency</th>
					<th>Is Citizen</th>
				</tr>
			</thead>
<?php 
	$query = FeeStructure::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new FeeStructure($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		//Load Only FeeStructure which matches the group {year, course and currency}
		if (($transaction1->searchMatrix($matrix1)->evaluateResult()) && ($transaction1->getYear() == $group1->getYear()) && ! is_null($transaction1->getCourse()) && ! is_null($group1->getCourse()) &&($transaction1->getCourse()->getCourseId() == $group1->getCourse()->getCourseId()) && ! is_null($transaction1->getCurrency()) && ! is_null($group1->getCurrency()) && ($transaction1->getCurrency()->getCurrencyId() == $group1->getCurrency()->getCurrencyId()) && ($group1->isCitizen() == $transaction1->isCitizen()))	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getStructureId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getTitle() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getCourse()))	{
?>
		<?= $transaction1->getCourse()->getCourseName() ?> (<?= $transaction1->getCourse()->getCourseCode() ?>)
<?php
	}
?>				
				</td>
				<td><?= $transaction1->getYear() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getValidFrom()))	{
		echo DateAndTime::convertFromDateTimeObjectToGUIDateFormat($transaction1->getValidFrom());
	}
?>			
				</td>
				<td><?= Number::getCommaSeparatorFormat($transaction1->getAmount()) ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getCurrency()))	{
		echo $transaction1->getCurrency()->getCurrencyCode();
	}
?>				
				</td>
				<td>
<?php 
	$citizen = "Foreigner";
	if ($transaction1->isCitizen()) $citizen = "Native Citizen";
	echo $citizen;
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Fee Structure"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeeinvoicegroup_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managefeeinvoicegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroup CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
<?php
	} else if ($page == "managefeeinvoicegroup_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managefeeinvoicegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroup CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = FeeInvoiceGroup::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("FeeInvoiceGroup[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$group1 = null;
			try	{
				$group1 = new FeeInvoiceGroup($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($group1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managefeeinvoicegroup_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeeinvoicegroup_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managefeeinvoicegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroup CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeeinvoicegroup_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managefeeinvoicegroup_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managefeeinvoicegroup_csv" && Authorize::isAllowable($config, "managefeeinvoicegroup_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroup CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managefeeinvoicegroup_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, FeeInvoiceGroup::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managefeeinvoicegroup_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managefeeinvoicegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			 $group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
			 //We need to delete also the referenced Invoices 
			 Object::shootException("This feature has been temporarily disabled, why => If you delete this group we need to synchronize with the already Invoices which has been sent to students");
			 $group1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroup Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The FeeInvoiceGroup <?= $group1->getGroupName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the FeeInvoiceGroup <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeeinvoicegroup_delete", "Deleted ".$group1->getGroupName());
	} else if ($page == "managefeeinvoicegroup_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeeinvoicegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$group1 = null;
		try {
			$group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a FeeInvoiceGroup <b><?= $group1->getGroupName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					All Invoices which has already sent to students will be deleted, this will leave any payment which has been paid against generated invoice to be orphan
					<br/>
					Are You Sure You want to remove the FeeInvoiceGroup <?= $group1->getGroupName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managefeeinvoicegroup_delete&report=io&id=<?= $group1->getGroupId() ?>&rndx=<?= $group1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managefeeinvoicegroup">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeeinvoicegroup_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeeinvoicegroup_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new FeeInvoiceGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $group1->getGroupName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Group Name</td>
						<td><?= $group1->getGroupName() ?></td>
					</tr>
<?php 
	if (! is_null($group1->getCourse()))	{
?>
					<tr>
						<td>Course</td>
						<td><?= $group1->getCourse()->getCourseName() ?>&nbsp;(<?= $group1->getCourse()->getCourseCode() ?>)</td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Year</td>
						<td><?= $group1->getYear() ?></td>
					</tr>
<?php
	if (! is_null($group1->getCurrency()))	{
?>
					<tr>
						<td>Amount</td>
						<td><?= Number::getCommaSeparatorFormat($group1->getTotalAmount()) ?></td>
					</tr>
					<tr>
						<td colspan="2">
							<span><?= $group1->getCurrency()->getCurrencyName() ?></span><br/>
							<span style="font-size: 0.8em; font-style: italic;"><?= Number::convertToWord($group1->getTotalAmount()) ?></span>
						</td>
					</tr>
					<tr>
						<td>Currency</td>
						<td><?= $group1->getCurrency()->getCurrencyName() ?>&nbsp;(<?= $group1->getCurrency()->getCurrencyCode() ?>)</td>
					</tr>
<?php
	}
	if (! is_null($group1->getGenerationTime()))	{
?>
					<tr>
						<td>Generation Time</td>
						<td><?= $group1->getGenerationTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
	$autoGenerated = "Invoices Is Manually Generated";
	if ($group1->isAutoGenerated())	{
		$autoGenerated = "Invoices will be Automatically Generated";
		if ($group1->isInvoicesAlreadyGenerated())	$autoGenerated = "Invoices has been Automatically Generated";
	}
?>
					<tr>
						<td colspan="2"><?= $autoGenerated ?></td>
					</tr>
<?php 
	$citizen = "Invoices will target only Foreign Students<br/>For this case is a non ".$profile1->getCountry()->getCountryName()."ns students";
	if ($group1->isCitizen()) $citizen = "Invoices will target only Native Citizen Students<br/>For this case is ".$profile1->getCountry()->getCountryName()."ns students";
?>
					<tr>
						<td colspan="2"><?= $citizen ?></td>
					</tr>
					<tr>
						<td>Invoice Prefix</td>
						<td><?= $group1->getInvoicePrefix() ?></td>
					</tr>
					<tr>
						<td>Payment Prefix</td>
						<td><?= $group1->getPaymentPrefix() ?></td>
					</tr>
<?php
	if (! is_null($group1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $group1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table><br/>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($group1->getStructureIdList()) && sizeof($group1->getStructureIdList()) > 0)	{
		$objectList1 = $group1->getStructureIdList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="9">Attached Fee Structures</th>
					</tr>
					<tr>
						<th>S/N</th>
						<th>Title</th>
						<th>Course</th>
						<th>Year</th>
						<th>Valid From</th>
						<th>Amount</th>
						<th>Currency</th>
						<th>Is Citizen</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getTitle() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
?>
		<?= $obj1->getCourse()->getCourseName() ?> (<?= $obj1->getCourse()->getCourseCode() ?>)
<?php
	}
?>				
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getValidFrom()))	{
		echo DateAndTime::convertFromDateTimeObjectToGUIDateFormat($obj1->getValidFrom());
	}
?>			
			</td>
			<td><?= Number::getCommaSeparatorFormat($obj1->getAmount()) ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCurrency()))	{
		echo $obj1->getCurrency()->getCurrencyCode();
	}
?>				
			</td>
			<td>
<?php 
	$citizen = "Foreigner";
	if ($obj1->isCitizen()) $citizen = "Native Citizen";
	echo $citizen;
?>				
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managefeeinvoicegroup_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managefeeinvoicegroup_delete&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managefeeinvoicegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach/Detach Fee Structure" href="<?= $thispage ?>?page=managefeeinvoicegroup_edit&id=<?= $group1->getGroupId() ?>&attach_feestructure=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managefeeinvoicegroup_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managefeeinvoicegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$generationTime = $systemTime1->getDateAndTimeString();
		$currencyId = mysql_real_escape_string($_REQUEST['currencyId']);
		$invoicePrefix = mysql_real_escape_string($_REQUEST['invoicePrefix']);
		$paymentPrefix = mysql_real_escape_string($_REQUEST['paymentPrefix']);
		$flags = 15;
		if (isset($_REQUEST['chkAutoGenerate'])) $flags = $flags + 32;
		if (! isset($_REQUEST['isForeigner']))  $flags = $flags + 128; //bit 7 for citizen default
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $groupName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO feeInvoiceGroup (groupName, courseId, _year, generationTime, currencyId, invoicePrefix, paymentPrefix, extraFilter, extraInformation, flags) VALUES('$groupName', '$courseId', '$year', '$generationTime', '$currencyId', '$invoicePrefix', '$paymentPrefix', '$extraFilter', '$extraInformation', '$flags')";
	try {
		if (! FeeInvoiceGroup::isInvoicePrefixAvailable($database, $conn, $invoicePrefix)) Object::shootException("Invoice Prefix is not Available, kindly try another Invoice Prefix");
		if (! FeeInvoiceGroup::isPaymentPrefixAvailable($database, $conn, $paymentPrefix)) Object::shootException("Payment Prefix is not Available, kindly try another Payment Prefix");
		if ($invoicePrefix == $paymentPrefix) Object::shootException("Prefices for Invoice and Payment can not be the same");
		mysql_db_query($database, $query, $conn) or Object::shootException("FeeInvoiceGroup[Adding]: Could not Add a Record into the System ".mysql_error());
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The FeeInvoiceGroup <?= $groupName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the feeInvoiceGroup<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Fee Invoice Group";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeeinvoicegroup_add", "Added $groupName");
	} else if ($page == "managefeeinvoicegroup_add" && Authorize::isAllowable($config, "managefeeinvoicegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New FeeInvoiceGroup</div> 
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeeinvoicegroup_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Group Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The target year for this invoice">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="currencyId">Currency </label>
						<select id="currencyId" name="currencyId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Currency">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Currency::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<label title="Tick if is a fee Group is for foreigner student else do not tick"><input type="checkbox" id="isForeigner" name="isForeigner" value="1"/>&nbsp;&nbsp; For Foreigner Student?</label>
					</div>
					<div class="pure-control-group">
						<label title="This will be prepended to all Invoices referencing this fee structure, ie CBOqwehT" for="invoicePrefix">Invoice Prefix</label>
						<input type="text" id="invoicePrefix" name="invoicePrefix" size="16" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Invoice Prefix: <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="This will be prepended to all Payment Receipts if not manual receipts referencing invoices for this fee structure, ie PEOqwehT" for="paymentPrefix">Payment Prefix</label>
						<input type="text" id="paymentPrefix" name="paymentPrefix" size="16" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Payment Prefix: <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-controls">
						<label title="Enable Invoices to be generated Automatically to target recepient"><input checked type="checkbox" name="chkAutoGenerate" value="1"/>&nbsp;&nbsp; Enable Invoice Auto-Generate</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeeinvoicegroup">Back to Fee Invoice Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managefeeinvoicegroup" && Authorize::isAllowable($config, "managefeeinvoicegroup", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeInvoiceGroups Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-feeInvoiceGroup-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managefeeinvoicegroup" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managefeeinvoicegroup_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Invoice<br/>Group Name</th>
				<th>Course</th>
				<th>Year</th>
				<th>Amount</th>
				<th>Currency</th>
				<th>Generation <br/>Time</th>
				<th>Auto</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = FeeInvoiceGroup::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch feeInvoiceGroup data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$group1 = null;
		try {
			$group1 = new FeeInvoiceGroup($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($group1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $group1->getGroupName() ?></td>
				<td>
<?php 
	if (! is_null($group1->getCourse()))	{
?>
		<?= $group1->getCourse()->getCourseName() ?>
<?php
	}
?>				
				</td>
				<td><?= $group1->getYear() ?></td>
				<td title="<?= Number::convertToWord($group1->getTotalAmount()) ?>"><?= Number::getCommaSeparatorFormat($group1->getTotalAmount()) ?></td>
				<td>
<?php 
	if (! is_null($group1->getCurrency()))	{
		echo $group1->getCurrency()->getCurrencyCode();
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($group1->getGenerationTime()))	{
		echo $group1->getGenerationTime()->getDateAndTimeString();
	}
?>				
				</td>
				<td>
<?php 
	$autoText = "Manually Generated";
	if ($group1->isAutoGenerated())	$autoText = "Auto Generated";
	echo $autoText;
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managefeeinvoicegroup_detail&id=<?= $group1->getGroupId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managefeeinvoicegroup_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managefeeinvoicegroup_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managefeeinvoicegroup_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System FeeInvoiceGroup" href="<?= $thispage ?>?page=managefeeinvoicegroup_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*FeeInvoiceGroup End*/ else/*FeeStructure BEGIN*/if ($page == "managefeestructure_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managefeestructure_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a></div>
		</div>
<?php
	} else if ($page == "managefeestructure_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managefeestructure_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = FeeStructure::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("FeeStructure[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$structure1 = null;
			try	{
				$structure1 = new FeeStructure($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($structure1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managefeestructure_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeestructure_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managefeestructure_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeestructure_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managefeestructure_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managefeestructure_csv" && Authorize::isAllowable($config, "managefeestructure_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managefeestructure_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, FeeStructure::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managefeestructure_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managefeestructure_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$structure1 = null;
		try {
			 $structure1 = new FeeStructure($database, $_REQUEST['id'], $conn);
			 $structure1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a FeeStructure which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The FeeStructure <?= $structure1->getTitle() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the FeeStructure <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeestructure_delete", "Deleted ".$structure1->getTitle());
	} else if ($page == "managefeestructure_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeestructure_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$structure1 = null;
		try {
			$structure1 = new FeeStructure($database, $_REQUEST['id'], $conn);
			$structure1->setExtraFilter(System::getCodeString(8));
			$structure1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a FeeStructure <b><?= $structure1->getTitle() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the FeeStructure <?= $structure1->getTitle() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managefeestructure_delete&report=io&id=<?= $structure1->getStructureId() ?>&rndx=<?= $structure1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managefeestructure">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managefeestructure_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managefeestructure_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$structure1 = null;
		try {
			$structure1 = new FeeStructure($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$invoicePrefixIsChanging = false;
		$paymentPrefixIsChanging = false;
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$validFrom = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($_REQUEST['validFrom']);
		$amount = mysql_real_escape_string($_REQUEST['amount']);
		$currencyId = mysql_real_escape_string($_REQUEST['currencyId']);
		$citizen = 1;
		if (isset($_REQUEST['isForeigner'])) $citizen = 0;
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if (is_null($structure1->getCourse()) || ($structure1->getCourse()->getCourseId() != $courseId))	{
			$structure1->setCourse($courseId); $enableUpdate = true;
		}
		if ($year != $structure1->getYear())	{
			$structure1->setYear($year); $enableUpdate = true;
		}
		if (is_null($structure1->getValidFrom()) || ($structure1->getValidFrom()->getDateAndTimeString() != $validFrom))	{
			$structure1->setValidFrom($validFrom); $enableUpdate = true;
		}
		if ($amount != $structure1->getAmount())	{
			$structure1->setAmount($amount); $enableUpdate = true;
		}
		if (is_null($structure1->getCurrency()) || ($structure1->getCurrency()->getCurrencyId() != $currencyId))	{
			$structure1->setCurrency($currencyId); $enableUpdate = true;
		}
		if (($citizen == 1) != $structure1->isCitizen())	{
			$structure1->setCitizen($citizen); $enableUpdate = true;
		}
		if ($extraInformation != $structure1->getExtraInformation())	{
			$structure1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $structure1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$structure1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$structure1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructure Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Fee Structure has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the Fee Structure <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeestructure_edit", "Edited Fee Structure");
	} else if ($page == "managefeestructure_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeestructure_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$structure1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$structure1 = new FeeStructure($database, $_REQUEST['id'], $conn);
			$structure1->setExtraFilter($extraFilter);
			$structure1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit FeeStructure ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeestructure_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $structure1->getStructureId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $structure1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="extraInformation">Fee Title </label>
						<input value="<?= $structure1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" required pattern="<?= $exprL64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Fee Title : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$selected = "";
		if (! is_null($structure1->getCourse()) && ($structure1->getCourse()->getCourseId() == $course1->getCourseId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
<?php 
	if (! is_null($structure1->getCourse()))	{
		$duration = intval($structure1->getCourse()->getDuration());
		for ($i=1; $i<= $duration; $i++)	{
			$selected = "";
			if (intval($structure1->getYear()) == $i) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $i ?>"><?= $i ?></option>
<?php
		}
	}
?>
						</select>
					</div>
<?php 
	$validFrom = "";
	if (! is_null($structure1->getValidFrom()))	{
		$validFrom = DateAndTime::convertFromDateTimeObjectToGUIDateFormat($structure1->getValidFrom());
	}
?>
					<div class="pure-control-group">
						<label for="validFrom">Valid From</label>
						<input value="<?= $validFrom ?>" class="datepicker"type="text" name="validFrom" id="validFrom" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid From (Date) : <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="amount">Amount</label>
						<input value="<?= $structure1->getAmount() ?>" class="text-can-not-be-zero" type="text" id="amount" name="amount" size="12" required pattern="<?= $exprAmount ?>" validate="true" validate_control="text" validate_expression="<?= $exprAmount ?>" validate_message="Amount: <?= $msgAmount ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="currencyId">Currency </label>
						<select id="currencyId" name="currencyId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Currency">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Currency::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($structure1->getCurrency()) && ($structure1->getCurrency()->getCurrencyId() == $alist1['id'])) $selected="selected";	
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	$chkForeigner = "checked";
	if ($structure1->isCitizen()) $chkForeigner = "";
?>
					<div class="pure-controls">
						<label title="Tick if is a fee structure for foreigner student else do not tick"><input <?= $chkForeigner ?> type="checkbox" id="isForeigner" name="isForeigner" value="1"/>&nbsp;&nbsp; For Foreigner Student?</label>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Amount can not be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managefeestructure_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managefeestructure_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$structure1 = null;
		try {
			$structure1 = new FeeStructure($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Fee Structure Details</div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Fee Title</td>
						<td><?= $structure1->getExtraInformation() ?></td>
					</tr>
<?php 
	if ( ! is_null($structure1->getCourse()))	{
?>
					<tr>
						<td>Course</td>
						<td><?= $structure1->getCourse()->getCourseName() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Year</td>
						<td><?= $structure1->getYear() ?></td>
					</tr>
<?php
	if (! is_null($structure1->getValidFrom()))	{
?>
					<tr>
						<td>Valid From</td>
						<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($structure1->getValidFrom()) ?></td>
					</tr>
<?php
	}
	if (! is_null($structure1->getCurrency()))	{
?>
					<tr>
						<td>Amount</td>
						<td><span style="font-size: 1.1em; font-weight: bold;"><?= Number::getCommaSeparatorFormat($structure1->getAmount()) ?></span>&nbsp;<span><b><i><?= $structure1->getCurrency()->getCurrencyCode() ?></i></b></span></td>
					</tr>
					<tr>
						<td colspan="2">
							<span><?= $structure1->getCurrency()->getCurrencyName() ?></span><br/>
							<span style="font-size: 0.8em; font-style: italic;"><?= Number::convertToWord($structure1->getAmount()) ?></span>
						</td>
					</tr>
<?php
	}
	$citizen = "For Foreign Students";
	if ($structure1->isCitizen()) $citizen = "For Native Citizen Students";
	if (! is_null($structure1->getExtraInformation()))	{
?>
					<tr>
						<td colspan="2"><?= $citizen ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managefeestructure_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit" href="<?= $thispage ?>?page=managefeestructure_edit&id=<?= $structure1->getStructureId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managefeestructure_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete" href="<?= $thispage ?>?page=managefeestructure_delete&id=<?= $structure1->getStructureId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managefeestructure_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managefeestructure_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$validFrom = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($_REQUEST['validFrom']);
		$amount = mysql_real_escape_string($_REQUEST['amount']);
		$currencyId = mysql_real_escape_string($_REQUEST['currencyId']);
		$citizen = 1;
		if (isset($_REQUEST['isForeigner'])) $citizen = 0;
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for Adding Fee Structure</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO feeStructure (courseId, year, validFrom, amount, currencyId, citizen, extraFilter, extraInformation) VALUES('$courseId', '$year', '$validFrom', '$amount', '$currencyId', '$citizen', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("FeeStructure[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The FeeStructure has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the feeStructure<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another Fee Structure";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managefeestructure_add", "Added Fee Structure");
	} else if ($page == "managefeestructure_add" && Authorize::isAllowable($config, "managefeestructure_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New FeeStructure</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managefeestructure_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="extraInformation" title="i.e Tuition Fee">Fee Title </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" required pattern="<?= $exprL64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Fee Title : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="validFrom">Valid From</label>
						<input class="datepicker"type="text" name="validFrom" id="validFrom" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid From (Date) : <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="amount">Amount</label>
						<input class="text-can-not-be-zero" type="text" id="amount" name="amount" size="12" required pattern="<?= $exprAmount ?>" validate="true" validate_control="text" validate_expression="<?= $exprAmount ?>" validate_message="Amount: <?= $msgAmount ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="currencyId">Currency </label>
						<select id="currencyId" name="currencyId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Currency">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Currency::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<label title="Tick if is a fee structure for foreigner student else do not tick"><input type="checkbox" id="isForeigner" name="isForeigner" value="1"/>&nbsp;&nbsp; For Foreigner Student?</label>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managefeestructure">Back to Fee Structure Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Amount can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managefeestructure" && Authorize::isAllowable($config, "managefeestructure", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">FeeStructures Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-feeStructure-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managefeestructure" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managefeestructure_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Title</th>
				<th>Course</th>
				<th>Year</th>
				<th>Valid From</th>
				<th>Amount</th>
				<th>Currency</th>
				<th>Is Citizen</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = FeeStructure::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch feeStructure data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$structure1 = null;
		try {
			$structure1 = new FeeStructure($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($structure1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $structure1->getTitle() ?></td>
				<td>
<?php 
	if (! is_null($structure1->getCourse()))	{
?>
		<?= $structure1->getCourse()->getCourseName() ?> (<?= $structure1->getCourse()->getCourseCode() ?>)
<?php
	}
?>				
				</td>
				<td><?= $structure1->getYear() ?></td>
				<td>
<?php 
	if (! is_null($structure1->getValidFrom()))	{
		echo DateAndTime::convertFromDateTimeObjectToGUIDateFormat($structure1->getValidFrom());
	}
?>				
				</td>
				<td><?= Number::getCommaSeparatorFormat($structure1->getAmount()) ?></td>
				<td>
<?php 
	if (! is_null($structure1->getCurrency()))	{
		echo $structure1->getCurrency()->getCurrencyCode();
	}
?>				
				</td>
				<td>
<?php 
	$citizen = "Foreigner";
	if ($structure1->isCitizen()) $citizen = "Native Citizen";
	echo $citizen;
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managefeestructure_detail&id=<?= $structure1->getStructureId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managefeestructure_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managefeestructure_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managefeestructure_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System FeeStructure" href="<?= $thispage ?>?page=managefeestructure_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*FeeStructure End*/ else/*Currency BEGIN*/if ($page == "managecurrency_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecurrency_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a></div>
		</div>
<?php
	} else if ($page == "managecurrency_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecurrency_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Currency::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Currency[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$currency1 = null;
			try	{
				$currency1 = new Currency($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($currency1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managecurrency_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecurrency_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managecurrency_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecurrency_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managecurrency_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecurrency_csv" && Authorize::isAllowable($config, "managecurrency_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managecurrency_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Currency::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecurrency_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecurrency_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$currency1 = null;
		try {
			 $currency1 = new Currency($database, $_REQUEST['id'], $conn);
			 $currency1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Currency which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Currency <?= $currency1->getCurrencyName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Currency <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecurrency_delete", "Deleted ".$currency1->getCurrencyName());
	} else if ($page == "managecurrency_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecurrency_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$currency1 = null;
		try {
			$currency1 = new Currency($database, $_REQUEST['id'], $conn);
			$currency1->setExtraFilter(System::getCodeString(8));
			$currency1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Currency <b><?= $currency1->getCurrencyName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Currency <?= $currency1->getCurrencyName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managecurrency_delete&report=io&id=<?= $currency1->getCurrencyId() ?>&rndx=<?= $currency1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managecurrency">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecurrency_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecurrency_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$currency1 = null;
		try {
			$currency1 = new Currency($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$currencyName = mysql_real_escape_string($_REQUEST['currencyName']);
		$currencyCode = mysql_real_escape_string($_REQUEST['currencyCode']);
		$countryId = mysql_real_escape_string($_REQUEST['countryId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($currencyName != $currency1->getCurrencyName())	{
			$currency1->setCurrencyName($currencyName); $enableUpdate = true;
		}
		if ($currencyCode != $currency1->getCurrencyCode())	{
			$currency1->setCurrencyCode($currencyCode); $enableUpdate = true;
		}
		if (is_null($currency1->getCountry()) || ($currency1->getCountry()->getCountryId() != $countryId))	{
			$currency1->setCountry($countryId); $enableUpdate = true;
		}
		if ($extraInformation != $currency1->getExtraInformation())	{
			$currency1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $currency1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$currency1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$currency1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currency Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Currency <?= $currency1->getCurrencyName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the currency <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecurrency_edit", "Edited ".$currency1->getCurrencyName());
	} else if ($page == "managecurrency_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecurrency_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$currency1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$currency1 = new Currency($database, $_REQUEST['id'], $conn);
			$currency1->setExtraFilter($extraFilter);
			$currency1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Currency <?= $currency1->getCurrencyName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecurrency_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $currency1->getCurrencyId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $currency1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="currencyName">Currency Name </label>
						<input value="<?= $currency1->getCurrencyName() ?>" type="text" name="currencyName" id="currencyName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Currency Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="currencyCode">Currency Code </label>
						<input value="<?= $currency1->getCurrencyCode() ?>" type="text" name="currencyCode" id="currencyCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Currency Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="countryId">Country </label>
						<select id="countryId" name="countryId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Country">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Country::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($currency1->getCountry()) && ($currency1->getCountry()->getCountryId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $currency1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecurrency_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecurrency_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$currency1 = null;
		try {
			$currency1 = new Currency($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $currency1->getCurrencyName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Currency Name</td>
						<td><?= $currency1->getCurrencyName() ?></td>
					</tr>
					<tr>
						<td>Currency Code</td>
						<td><?= $currency1->getCurrencyCode() ?></td>
					</tr>
<?php 
	if (! is_null($currency1->getCountry()))	{
?>
					<tr>
						<td>Country</td>
						<td><?= $currency1->getCountry()->getCountryName() ?></td>
					</tr>
<?php
	}
	if (! is_null($currency1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $currency1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecurrency_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $currency1->getCurrencyName() ?>" href="<?= $thispage ?>?page=managecurrency_edit&id=<?= $currency1->getCurrencyId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecurrency_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $currency1->getCurrencyName() ?>" href="<?= $thispage ?>?page=managecurrency_delete&id=<?= $currency1->getCurrencyId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managecurrency_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managecurrency_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$currencyName = mysql_real_escape_string($_REQUEST['currencyName']);
		$currencyCode = mysql_real_escape_string($_REQUEST['currencyCode']);
		$countryId = mysql_real_escape_string($_REQUEST['countryId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $currencyName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO currency (currencyName, currencyCode, countryId, extraFilter, extraInformation) VALUES('$currencyName', '$currencyCode', '$countryId', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Currency[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Currency <?= $currencyName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the currency<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Currency";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecurrency_add", "Added $currencyName");
	} else if ($page == "managecurrency_add" && Authorize::isAllowable($config, "managecurrency_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Currency</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecurrency_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="currencyName">Currency Name </label>
						<input type="text" name="currencyName" id="currencyName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Currency Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="currencyCode">Currency Code </label>
						<input type="text" name="currencyCode" id="currencyCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Currency Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="countryId">Country </label>
						<select id="countryId" name="countryId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Country">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Country::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecurrency">Back to Currency Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecurrency" && Authorize::isAllowable($config, "managecurrency", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Currencys Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-currency-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managecurrency" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managecurrency_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Currency Name</th>
				<th>Currency Code</th>
				<th>Origin</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Currency::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch currency data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$currency1 = null;
		try {
			$currency1 = new Currency($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($currency1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $currency1->getCurrencyName() ?></td>
				<td><?= $currency1->getCurrencyCode() ?></td>
				<td>
<?php 
	if (! is_null($currency1->getCountry()))	{
		echo $currency1->getCountry()->getCountryName();
	}
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managecurrency_detail&id=<?= $currency1->getCurrencyId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecurrency_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managecurrency_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecurrency_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Currency" href="<?= $thispage ?>?page=managecurrency_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Currency End*/ else/*MessageAccessList BEGIN*/ if ($page == "managemessagepolicy_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managemessagepolicy_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$policy1 = null;
		try {
			 $policy1 = new MessageAccessList($database, "../data/message/policy.csv", $conn);
			 $policy1->removeRule($_REQUEST['id']);
			 $policy1->saveRules();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MessageAccessList Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The MessageAccessList has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the MessageAccessList <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managemessagepolicy_delete", "Deleted ");
	} else if ($page == "managemessagepolicy_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managemessagepolicy_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$policy1 = null;
		try {
			$policy1 = new MessageAccessList($database, "../data/message/policy.csv", $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a MessageAccessList with sequence Number <b><?= $_REQUEST['id'] ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the MessageAccessList, sequence number = <?= $_REQUEST['id'] ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managemessagepolicy_delete&report=io&id=<?= $_REQUEST['id'] ?>&rndx=10">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managemessagepolicy&searchtext=io">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	}  else if ($page == "managemessagepolicy_detail" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managemessagepolicy_detail", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$messageType = mysql_real_escape_string($_REQUEST['messageType']);
		$sCategory = mysql_real_escape_string($_REQUEST['sCategory']);
		$sAddress = mysql_real_escape_string($_REQUEST['sAddress']);
		$dCategory = mysql_real_escape_string($_REQUEST['dCategory']);
		$dAddress = mysql_real_escape_string($_REQUEST['dAddress']);
		/*
		We need to do correction of usernames if category is Login 
		*/
		if ($sCategory == MessageAccessList::$__MESSAGE_ACCESS_LOGIN)	{
			$sAddress = Login::getLoginIdFromUsernameOrEmail($database, $conn, $sAddress);
		}
		if ($dCategory == MessageAccessList::$__MESSAGE_ACCESS_LOGIN)	{
			$dAddress = Login::getLoginIdFromUsernameOrEmail($database, $conn, $dAddress);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Message Policy Access List</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	//Working now 
	$policy1 = null;
	$isRuleAccepted = false;
	$sequenceNumber = 0;
	$loadDetails = false;
	try {
		$policy1 = new MessageAccessList($database, "../data/message/policy.csv", $conn);
		$policy1 = $policy1->loadMyRules($sAddress, $messageType, $sCategory);
		$isRuleAccepted = $policy1->isAccepted($dCategory, $dAddress);
		$sequenceNumber = $policy1->getSequenceNumber();
		$loadDetails = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
		$captionText = "Denied";
		$bgcolor = "red";
		$captionDetails = "Denied at Sequence Number $sequenceNumber";
		if ($sequenceNumber == MessageAccessList::$__EOF_REACHED)	{
			$captionDetails = "Implicit Denied Reached";
			$sequenceNumber = "EOF";
			$loadDetails = false;
		} else if ($isRuleAccepted)	{
			$captionText = "Accepted";
			$captionDetails = "Accepted at Sequence Number $sequenceNumber";
			$bgcolor = "blue";
			$loadDetails = true;
		}
?>
		<table class="pure-table">
			<thead>
				<tr>
					<th colspan="4">Message Policy Viewer</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><?= $sequenceNumber ?></td>
					<td><span style="background-color: <?= $bgcolor; ?>">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
					<td><span><?= $captionText ?></span></td>
					<td><span style="font-size: 0.9em;"><?= $captionDetails ?></span></td>
				</tr>
			</tbody>
		</table>
<?php
		if ($loadDetails)	{
?>
			<br/>
	<table class="pure-table">
		<thead>
			<tr>
				<th colspan="7">Details of Affecting Rule</th>
			</tr>
			<tr>
				<th>Sequence<br/>Number</th>
				<th>Message Type</th>
				<th>Source <br/>Category</th>
				<th>Source <br/>Address</th>
				<th>Destination <br/>Category</th>
				<th>Destination <br/>Address</th>
				<th>Action</th>
			</tr>
		</thead>
<?php		
		/*Preparing cells*/ 
		$lineStructure1 = $policy1->getRecordAtSequenceNumber($sequenceNumber);
		$sequenceNumber = $lineStructure1[0];
		//MessageTye
		$messageType = "";
		if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_ALL)	$messageType = "Any";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_LOCAL) $messageType = "Local";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_EMAIL) $messageType = "Email";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_SMS) $messageType = "Sms";
		//Source Category && Source Address 
		$sourceCategory = "";
		$sourceAddress = "";
		if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_ALL) {
			$sourceCategory = "Any";
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) {
			$sourceCategory = "User";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$ulogin1 = new Login($database, $lineStructure1[3], $conn);
					$sourceAddress = $ulogin1->getFullname();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE) {
			$sourceCategory = "Job Title";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$job1 = new JobTitle($database, $lineStructure1[3], $conn);
					$sourceAddress = $job1->getJobName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_GROUP) {
			$sourceCategory = "Group";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$group1 = new Group($database, $lineStructure1[3], $conn);
					$sourceAddress = $group1->getGroupName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		}
		//Destination Category && Destination Address 
		$destinationCategory = "";
		$destinationAddress = "";
		if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_ALL) {
			$destinationCategory = "Any";
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) {
			$destinationCategory = "User";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$ulogin1 = new Login($database, $lineStructure1[5], $conn);
					$destinationAddress = $ulogin1->getFullname();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE) {
			$destinationCategory = "Job Title";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$job1 = new JobTitle($database, $lineStructure1[5], $conn);
					$destinationAddress = $job1->getJobName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_GROUP) {
			$destinationCategory = "Group";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$group1 = new Group($database, $lineStructure1[5], $conn);
					$destinationAddress = $group1->getGroupName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		}
		//Action Accept vs Reject
		$action = "";
		if ($lineStructure1[6] == MessageAccessList::$__ACTION_ACCEPT)	{
			$action = "<span title=\"Accept Rule\" style=\"background-color: blue;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
		} else if ($lineStructure1[6] == MessageAccessList::$__ACTION_REJECT)	{
			$action = "<span title=\"Reject Rule\" style=\"background-color: red;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
		}
?>
		<tbody>
			<tr>
				<td><?= $sequenceNumber ?></td>
				<td><?= $messageType ?></td>
				<td><?= $sourceCategory ?></td>
				<td><?= $sourceAddress ?></td>
				<td><?= $destinationCategory ?></td>
				<td><?= $destinationAddress ?></td>
				<td><?= $action ?></td>
			</tr>
		</tbody>
	</table>
<?php
		} //end-if-loadDetails
	} else {
?>
		<div class="ui-state-error">
			There were problems in pulling the rules<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managemessagepolicy_detail" && Authorize::isAllowable($config, "managemessagepolicy_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Message Policy Access List</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" action="<?= $thispage ?>" method="POST">
					<input type="hidden" name="page" value="managemessagepolicy_detail"/>
					<input type="hidden" name="report" value="io"/>
					<div class="ui-widget ui-widget-content ui-sys-inline-controls-center">
						<div class="ui-widget-header">Message Type</div>
						<div>
							<label><input checked type="radio" name="messageType" value="<?= MessageType::$__MESSAGE_TYPE_ALL ?>"/> Any</label>&nbsp;<label><input type="radio" name="messageType" value="<?= MessageType::$__MESSAGE_TYPE_LOCAL ?>"/> Local</label>&nbsp;<label><input type="radio" name="messageType" value="<?= MessageType::$__MESSAGE_TYPE_EMAIL ?>"/> Email</label>&nbsp;<label><input type="radio" name="messageType" value="<?= MessageType::$__MESSAGE_TYPE_SMS ?>"/> Sms</label>
						</div>
					</div>
					<div class="ui-sys-oi-left-half mobile-collapse">
						<div class="ui-widget ui-widget-content ui-sys-message">
							<div class="ui-widget-header"></div>
							<div class="data-policy-container">
								<div class="ui-widget-header">&nbsp; Message Source Category</div>
								<div class="control-group-container">
									<div class="pure-group-control">
										<label><input class="chkControls" checked type="radio" name="sCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_ALL ?>"/> Any</label>
										<input name="sAddress" type="hidden" value="Any"/>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="sCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>"/> Group </label>
										<select disabled name="sAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="0">--Any--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="sCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>"/> Job Title </label>
										<select disabled name="sAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="0">--Any--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="sCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_LOGIN ?>"/> Username (Email) </label>
										<input title="Username or Email Address" disabled type="text" name="sAddress" size="32" required="true" validate="true" validate_control="text" validate_expression="<?= $exprL32Name ?>" validate_message="Username or Email <?= $msgL32Name ?>"/>
									</div>
								</div>
							</div>
							<div></div>
						</div>
					</div>
					<div class="ui-sys-oi-left-half mobile-collapse">
						<div class="ui-widget ui-widget-content ui-sys-message">
							<div class="ui-widget-header"></div>
							<div class="data-policy-container">
								<div class="ui-widget-header">&nbsp; Message Destination Category</div>
								<div class="control-group-container">
									<div class="pure-group-control">
										<label><input class="chkControls" checked type="radio" name="dCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_ALL ?>"/> Any</label>
										<input name="dAddress" type="hidden" value="Any"/>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="dCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>"/> Group </label>
										<select disabled name="dAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="0">--Any--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="dCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>"/> Job Title </label>
										<select disabled name="dAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="0">--Any--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
									</div>
									<div class="pure-group-control">
										<label><input class="chkControls" type="radio" name="dCategory" value="<?= MessageAccessList::$__MESSAGE_ACCESS_LOGIN ?>"/> Username (Email) </label>
										<input title="Username or Email Address" disabled type="text" name="dAddress" size="32" required="true" validate="true" validate_control="text" validate_expression="<?= $exprL32Name ?>" validate_message="Username or Email <?= $msgL32Name ?>"/>
									</div>
								</div>
							</div>
							<div></div>
						</div>
					</div>
					<div class="pure-controls ui-sys-clear-both ui-sys-inline-controls-center">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls ui-sys-inline-controls-center">
						<input id="__add_record" type="button" value="View Policy"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('input.chkControls').on('change', function(event)	{
		var $button1 = $(this);
		var $group1 = $button1.closest('div.control-group-container');
		if (! $group1.length) return;
		var $currentSubgroup1 = $button1.closest('div.pure-group-control');
		if (! $currentSubgroup1.length) return;
		//Disable everything 
		$group1.find('input').prop('disabled', true);
		$group1.find('select').prop('disabled', true);
		//Enable Only this current Subgroup 
		$currentSubgroup1.find('input').prop('disabled', false);
		$currentSubgroup1.find('select').prop('disabled', false);
		//Enable all radio buttons 
		$group1.find('input.chkControls').prop('disabled', false);
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managemessagepolicy_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managemessagepolicy_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$sequenceNumber = mysql_real_escape_string($_REQUEST['sequenceNumber']);
		$messageType = mysql_real_escape_string($_REQUEST['messageType']);
		$sourceCategory = mysql_real_escape_string($_REQUEST['sourceCategory']);
		$sourceAddress = MessageAccessList::$__MESSAGE_ADDRESS_ALL;
		if (isset($_REQUEST['sourceAddress'])) $sourceAddress = mysql_real_escape_string($_REQUEST['sourceAddress']);
		$destinationCategory = mysql_real_escape_string($_REQUEST['destinationCategory']);
		$destinationAddress = MessageAccessList::$__MESSAGE_ADDRESS_ALL;
		if (isset($_REQUEST['destinationAddress'])) $destinationAddress = mysql_real_escape_string($_REQUEST['destinationAddress']);
		$action = mysql_real_escape_string($_REQUEST['action']);		
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary for Addition of A New Policy</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	try {
		$policy1 = new MessageAccessList($database, "../data/message/policy.csv", $conn);
		//We need to set propely the source and destination address esp if username were specified 
		if (($sourceCategory == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) && ($sourceAddress != "".MessageAccessList::$__MESSAGE_ADDRESS_ALL))	{
			$sourceAddress = Login::getLoginIdFromUsernameOrEmail($database, $conn, $sourceAddress);
		}
		if (($destinationCategory == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) && ($destinationAddress != "".MessageAccessList::$__MESSAGE_ADDRESS_ALL))	{
			$destinationAddress = Login::getLoginIdFromUsernameOrEmail($database, $conn, $destinationAddress);
		}
		$policy1->addRule($sequenceNumber, $messageType, $sourceCategory, $sourceAddress, $destinationCategory, $destinationAddress, $action);
		$policy1->saveRules();
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Message Policy were added succesful to the system 
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the message policy<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managemessagepolicy_add", "Added Policy");
	} else if ($page == "managemessagepolicy_add" && Authorize::isAllowable($config, "managemessagepolicy_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Policy</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managemessagepolicy_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="sequenceNumber">Sequence Number</label>
						<input class="text-can-not-be-zero" type="text" id="sequenceNumber" name="sequenceNumber" size="4" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Sequence Number: <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="messageType">Message Type</label>
						<select id="messageType" name="messageType" validate="true" validate_control="select" validate_expression="select" validate_message="You need to specify Message Type">
							<option value="0">Any</option>
<?php 
	$list1 = MessageType::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['code'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="sourceCategory">Source Category</label>
						<select id="sourceCategory" name="sourceCategory" validate="true" validate_control="select" validate_expression="select" validate_message="The Category Source need to be selected">
							<option data-control-text="__source_category_any" value="<?= MessageAccessList::$__MESSAGE_ACCESS_ALL ?>">Any</option>
							<option data-control-text="__source_category_login" value="<?= MessageAccessList::$__MESSAGE_ACCESS_LOGIN ?>">User</option>
							<option data-control-text="__source_category_jobtitle" value="<?= MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE ?>">Job Title</option>
							<option data-control-text="__source_category_group" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>">Group</option>
						</select>
					</div>
					<div id="__source_category_login" class="pure-control-group source-address-group ui-sys-hidden">
						<label for="sourceAddress">Source Username</label>
						<input disabled type="text" id="sourceAddress" name="sourceAddress" required pattern="<?= $exprL64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Username <?= $msgL64Name ?>"/>
					</div>
					<div id="__source_category_jobtitle" class="pure-control-group source-address-group ui-sys-hidden">
						<label for="sourceAddress">Source Job Title</label>
						<select disabled id="sourceAddress" name="sourceAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a source Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div id="__source_category_group" class="pure-control-group source-address-group ui-sys-hidden">
						<label for="sourceAddress">Source Group</label>
						<select disabled id="sourceAddress" name="sourceAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a source Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="destinationCategory">Destination Category</label>
						<select id="destinationCategory" name="destinationCategory" validate="true" validate_control="select" validate_expression="select" validate_message="The Category Destination need to be selected">
							<option data-control-text="__destination_category_any" value="<?= MessageAccessList::$__MESSAGE_ACCESS_ALL ?>">Any</option>
							<option data-control-text="__destination_category_login" value="<?= MessageAccessList::$__MESSAGE_ACCESS_LOGIN ?>">User</option>
							<option data-control-text="__destination_category_jobtitle" value="<?= MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE ?>">Job Title</option>
							<option data-control-text="__destination_category_group" value="<?= MessageAccessList::$__MESSAGE_ACCESS_GROUP ?>">Group</option>
						</select>
					</div>
					<div id="__destination_category_login" class="pure-control-group destination-address-group ui-sys-hidden">
						<label for="destinationAddress">Destination Username</label>
						<input disabled type="text" id="destinationAddress" name="destinationAddress" required pattern="<?= $exprL64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Username <?= $msgL64Name ?>"/>
					</div>
					<div id="__destination_category_jobtitle" class="pure-control-group destination-address-group ui-sys-hidden">
						<label for="destinationAddress">Destination Job Title</label>
						<select disabled id="destinationAddress" name="destinationAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a destination Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div id="__destination_category_group" class="pure-control-group destination-address-group ui-sys-hidden">
						<label for="destinationAddress">Destination Group</label>
						<select disabled id="destinationAddress" name="destinationAddress" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a destination Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
		<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="action">Action</label>
						<select id="action" name="action" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Action">
							<option value="_@32767@_">--select--</option>
							<option value="<?= MessageAccessList::$__ACTION_ACCEPT ?>">Accept</option>
							<option value="<?= MessageAccessList::$__ACTION_REJECT ?>">Reject</option>
						</select>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Policy"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#sourceCategory').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		var option1 = this.options[this.selectedIndex];
		var $option1 = $(option1);
		/*Hide all*/
		var $addressGroup1 = $('div.source-address-group').removeClass('ui-sys-hidden').addClass('ui-sys-hidden');
		$addressGroup1.find('input').prop('disabled', true);
		$addressGroup1.find('select').prop('disabled', true);
		/*Show if exists*/
		var $target1 = $('#' + $option1.attr('data-control-text'));
		if ($target1.length)	{
			$target1.removeClass('ui-sys-hidden');
			$target1.find('input').prop('disabled', false);
			$target1.find('select').prop('disabled', false);
		}
	});
	$('#destinationCategory').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		var option1 = this.options[this.selectedIndex];
		var $option1 = $(option1);
		/*Hide all*/
		var $addressGroup1 = $('div.destination-address-group').removeClass('ui-sys-hidden').addClass('ui-sys-hidden');
		$addressGroup1.find('input').prop('disabled', true);
		$addressGroup1.find('select').prop('disabled', true);
		/*Show if exists*/
		var $target1 = $('#' + $option1.attr('data-control-text'));
		if ($target1.length)	{
			$target1.removeClass('ui-sys-hidden');
			$target1.find('input').prop('disabled', false);
			$target1.find('select').prop('disabled', false);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0) && ((parseInt($text1.val()) % 10) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Sequence Number can neither be zero nor multiple of Ten[10x]')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managemessagepolicy" && Authorize::isAllowable($config, "managemessagepolicy", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Message Access List </div>
			<div class="ui-sys-panel-body">
<!--For Complience Let us define a searchtext-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>Sequence<br/>Number</th>
				<th>Message Type</th>
				<th>Source <br/>Category</th>
				<th>Source <br/>Address</th>
				<th>Destination <br/>Category</th>
				<th>Destination <br/>Address</th>
				<th>Action</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$policy1 = null;
	try {
		$policy1 = new MessageAccessList($database, "../data/message/policy.csv", $conn);
	} catch (Exception $e)	{
		die($e->getMessage());
	}
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	$ds1 = $policy1->getDataStructure();
	mysql_close($conn);
	$blnDelete = Authorize::isAllowable($config, "managemessagepolicy_delete", "normal", "donotsetlog", "-1", "-1");
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	for($index=0; $index < sizeof($ds1); $index++)	{
		$lineStructure1 = $ds1[$index]; //This is zero based
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
		/*Preparing cells*/ 
		$sequenceNumber = $lineStructure1[0];
		//MessageTye
		$messageType = "";
		if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_ALL)	$messageType = "Any";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_LOCAL) $messageType = "Local";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_EMAIL) $messageType = "Email";
		else if ($lineStructure1[1] == MessageType::$__MESSAGE_TYPE_SMS) $messageType = "Sms";
		//Source Category && Source Address 
		$sourceCategory = "";
		$sourceAddress = "";
		if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_ALL) {
			$sourceCategory = "Any";
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) {
			$sourceCategory = "User";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$ulogin1 = new Login($database, $lineStructure1[3], $conn);
					$sourceAddress = $ulogin1->getFullname();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE) {
			$sourceCategory = "Job Title";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$job1 = new JobTitle($database, $lineStructure1[3], $conn);
					$sourceAddress = $job1->getJobName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[2] == MessageAccessList::$__MESSAGE_ACCESS_GROUP) {
			$sourceCategory = "Group";
			if ($lineStructure1[3] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$sourceAddress = "Any";
			} else {
				try {
					$group1 = new Group($database, $lineStructure1[3], $conn);
					$sourceAddress = $group1->getGroupName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		}
		//Destination Category && Destination Address 
		$destinationCategory = "";
		$destinationAddress = "";
		if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_ALL) {
			$destinationCategory = "Any";
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_LOGIN) {
			$destinationCategory = "User";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$ulogin1 = new Login($database, $lineStructure1[5], $conn);
					$destinationAddress = $ulogin1->getFullname();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_JOBTITLE) {
			$destinationCategory = "Job Title";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$job1 = new JobTitle($database, $lineStructure1[5], $conn);
					$destinationAddress = $job1->getJobName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		} else if ($lineStructure1[4] == MessageAccessList::$__MESSAGE_ACCESS_GROUP) {
			$destinationCategory = "Group";
			if ($lineStructure1[5] == MessageAccessList::$__MESSAGE_ADDRESS_ALL)	{
				$destinationAddress = "Any";
			} else {
				try {
					$group1 = new Group($database, $lineStructure1[5], $conn);
					$destinationAddress = $group1->getGroupName();
				} catch (Exception $e)	{
					die($e->getMessage());
				}
			}
		}
		//Action Accept vs Reject
		$action = "";
		if ($lineStructure1[6] == MessageAccessList::$__ACTION_ACCEPT)	{
			$action = "<span title=\"Accept Rule\" style=\"background-color: blue;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
		} else if ($lineStructure1[6] == MessageAccessList::$__ACTION_REJECT)	{
			$action = "<span title=\"Reject Rule\" style=\"background-color: red;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
		}
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sequenceNumber ?></td>
			<td><?= $messageType ?></td>
			<td><?= $sourceCategory ?></td>
			<td><?= $sourceAddress ?></td>
			<td><?= $destinationCategory ?></td>
			<td><?= $destinationAddress ?></td>
			<td><?= $action ?></td>
			<td class="ui-sys-search-controls">
<?php 
	if ($blnDelete)	{
?>
		<a href="<?= $thispage ?>?page=managemessagepolicy_delete&id=<?= $sequenceNumber ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;	
	}//end-for
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managemessagepolicy_detail", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Specific Policy Detail & Policy Testing" href="<?= $thispage ?>?page=managemessagepolicy_detail"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managemessagepolicy_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Message Policy" href="<?= $thispage ?>?page=managemessagepolicy_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*MessageAccessList End*/ else/*Results Upload Begin*/if ($page == "manageresults_change_maximum_score" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_change_maximum_score", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Change Maximum Score <br/>Temporary File Cleaning</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "manageresults_change_maximum_score" && isset($_REQUEST['downloadfile']) &&  Authorize::isAllowable($config, "manageresults_change_maximum_score", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$maximumScore = mysql_real_escape_string($_REQUEST['maximumScore']);
		try {
			//We need to save uploaded file temporaliy
			$validTypes = array("text/csv");
			$validExtensions = array("csv");
			$maximumUploadedSize = 2097153;
			//Filename 
			$filename="";
			$tfname=$filename.$date;
			$tfname=$tfname.rand(100,999);
			$filename=sha1($tfname);
			$temporaryFolder = "../temp";
			$promise1 = Object::saveUploadedFile($_FILES['resultsfile'], $temporaryFolder, $filename, $validTypes, $validExtensions, $maximumUploadedSize);
			if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
			$filename = $promise1->getResults(); //return a full file name path 
			Results::updateMaximumScore($database, $conn, $filename, $maximumScore, $systemTime1);
			if (! $promise1->isPromising())	Object::shootException($promise1->getReason());
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Change Maximum Score</div>
			<div class="ui-sys-panel-body ui-sys-inline-controls-center">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in uploading results <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if ($promise1->isPromising())	{
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageresults_change_maximum_score&report=<?= $filename ?>">Proceed</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_change_maximum_score", "Maximum Score Updated");
	} else if ($page == "manageresults_change_maximum_score"  && isset($_REQUEST['uploadfile']) && Authorize::isAllowable($config, "manageresults_change_maximum_score", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Change Maximum Score</div>
			<div class="ui-sys-panel-body ui-sys-inline-controls-center">
				<div class="ui-sys-warning">
					Kindly note: The Marks in the original file will be changed according to the new maximum score, and the value of the maximum score will be updated <br/>
					Example: if the marks was 22 and the maximum score was 40, and now you are putting the new maximum score to 100, then the new score will be 55 <br />
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Meaning ; New Marks = (New Max Score * old Marks) / Old Max Score
				</div>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="manageresults_change_maximum_score"/>
					<input type="hidden" name="downloadfile" value="true"/>
					<input type="hidden" name="maximumScore" value="<?= $_REQUEST['maximumScore'] ?>"/>
					<div class="ui-sys-data-capture ui-sys-inline-controls-center">
						<input class="ui-sys-file-upload" id="resultsfile" data-capture="0" type="file" name="resultsfile" accept="*.csv"/> &nbsp;&nbsp;<input type="button" id="__add_record" value="Upload File"/> 
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#resultsfile').on('change', function(event)	{ 
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $file1 = $('#resultsfile');
		if (! $file1.length) return;
		if (parseInt($file1.prop('data-capture')) == 1)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('You have not selected the file to upload')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresults_change_maximum_score" && Authorize::isAllowable($config, "manageresults_change_maximum_score", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Change Maximum Score</div>
			<div class="ui-sys-panel-body ui-sys-inline-controls-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_change_maximum_score"/>
					<input type="hidden" name="uploadfile" value="true"/>
					<div class="pure-control-group">
						<label for="maximumScore">Maximum Score </label>
						<input class="text-can-not-be-zero" type="text" name="maximumScore" id="maximumScore" size="4" required placeholder="100" validate="true" pattern="<?= $exprD4Number ?>" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Maximum Score : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input type="button" id="__add_record" value="Proceed to File Upload"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Maximum Score Can NOT be ZERO')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresults_upload" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_upload", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		try {
			$results1 = new Results($database, $_REQUEST['resultsId'], $conn);
			if ($results1->getExtraFilter() != trim($_REQUEST['rndx'])) Object::shootException("The system has detected a malicious attempt to upload results");
			//We need to save uploaded file temporaliy
			$validTypes = array("text/csv");
			$validExtensions = array("csv");
			$maximumUploadedSize = 2097153;
			//Filename ---- nYou do not need to create temporary files you already have temporary file
			$filename="";
			$tfname=$filename.$date;
			$tfname=$tfname.rand(100,999);
			$filename=sha1($tfname);
			$temporaryFolder = "../temp";
			$promise1 = Object::saveUploadedFile($_FILES['resultsfile'], $temporaryFolder, $filename, $validTypes, $validExtensions, $maximumUploadedSize);
			if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
			$filename = $promise1->getResults();
			$results1->setExtraFilter(System::getCodeString(8)); //Update value
			$promise1 = Results::uploadResults($database, $conn, $results1, $filename, "../data/results/", $systemTime1, isset($_REQUEST['overwrite']), Results::$__RESULTS_MODE);
			unlink($filename);
			if (! $promise1->isPromising())	Object::shootException($promise1->getReason());
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Upload Tool Report</div>
			<div class="ui-sys-panel-body ui-sys-inline-controls-center">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Results have been uploaded successful
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in uploading results <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_upload", "Results Uploaded");
	} else if ($page == "manageresults_upload" && isset($_REQUEST['uploadfile']) && Authorize::isAllowable($config, "manageresults_upload", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$results1 = null;
		$overwrite = 0;
		if (isset($_REQUEST['overwrite'])) $overwrite = 1;
		try {
			$results1 = new Results($database, $_REQUEST['resultsId'], $conn);
			if ($results1->isResultsLocked()) Object::shootException("Results is Locked");
			if ($results1->getGroup()->isResultsLocked()) Object::shootException("Results Group is Locked");
			if (! Results::isResultsDataForThisResultsManager($database, $conn, $_REQUEST['resultsId'], $_REQUEST['batchId'], $_REQUEST['courseId'], $_REQUEST['year'], $_REQUEST['semester'])) Object::shootException("Kindly check the data you have supplied. The data you supplied does not belong the selected Results Manager");
			$results1->setExtraFilter(System::getCodeString(8));
			$results1->commitUpdate();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Upload Tool</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>" enctype="multipart/form-data">
					<input type="hidden" name="page" value="manageresults_upload"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="resultsId" value="<?= $_REQUEST['resultsId'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $results1->getExtraFilter() ?>"/>
					<input type="hidden" name="overwrite" value="<?= $overwrite ?>"/>
					<div class="ui-sys-data-capture ui-sys-inline-controls-center">
						<input class="ui-sys-file-upload" id="resultsfile" data-capture="0" type="file" name="resultsfile" accept="*.csv"/> &nbsp;&nbsp;<input type="button" id="__add_record" value="Upload File"/> 
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</form>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems with your data <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
 ?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#resultsfile').on('change', function(event)	{
		event.preventDefault();
		var $file1 = $(this);
		$file1.prop('data-capture', '1');
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $file1 = $('#resultsfile');
		if (! $file1.length) return;
		if (parseInt($file1.prop('data-capture')) == 1)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			var $target1 = $('#perror');
			if (! $target1.length) return;
			$target1.empty();
			$('<span/>').html('You have not selected the file to upload')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_upload" && Authorize::isAllowable($config, "manageresults_upload", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect eo a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Upload Tool</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_upload"/>
					<input type="hidden" name="uploadfile" value="true"/>
					<div class="pure-control-group">
						<label for="batchId" title="Current Accademic Year">Accademic Year </label>
						<select class="__do_perform_ui_maintainance" id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Batch (Accademic Year this group joined the college)">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		try {
			$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
			if ($accademicYear1->getAccademicYearNumber() != $controlAccademicCounter) continue;
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select class="__do_perform_ui_maintainance" id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select class="__do_perform_ui_maintainance" id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester" title="The semester this results belong to">Semester </label>
						<select class="__do_perform_ui_maintainance" id="semester" name="semester">
							<option value="0">--N/A--</option>
<?php 
	$semesterLimit = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $semesterLimit; $i++)	{
?>
		<option value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="resultsId">Results Manager</label>
						<select id="resultsId" name="resultsId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Results Manager">
							<option value="_@32767@_">--select--</option>
						</select>
						<div id="__id_results_store" class="ui-sys-hidden">
<?php 
	$list1 = Results::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$results1 = null;
		$courseId="0";
		$year = "0";
		$semester = "0";
		$batchId = "0";
		try {
			$results1 = new Results($database, $alist1['id'], $conn);
			if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getCourse())) $courseId = $results1->getGroup()->getCourse()->getCourseId();
			if (! is_null($results1->getGroup())) $year = $results1->getGroup()->getYear();
			if (! is_null($results1->getExamination())) $semester = $results1->getExamination()->getSemester();
			if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getBatch())) $batchId = $results1->getGroup()->getBatch()->getAccademicYearId();
			if ($results1->isResultsLocked()) Object::shootException("Do not Include Locked Results");
		} catch (Exception $e)	{
			continue;
		}
?>
			<option data-option='{"courseId":"<?= $courseId ?>","year":"<?= $year ?>","semester":"<?= $semester ?>","batchId":"<?= $batchId ?>"}' value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>						
						</div>
					</div>
					<div class="pure-controls">
						<label><input type="checkbox" name="overwrite" value="1"/>&nbsp;&nbsp; Overwrite existing results (If Any)?</label>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input title="This file should have the format made by a Template making tool , Found in Results Menu > Downloads > Download Template" id="__add_record" type="button" value="Proceed Results File Upload"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	function uiMaintainance()	{
		var $select1 = $('#resultsId');
		if (! $select1.length) return;
		var $store1 = $('#__id_results_store');
		if (! $store1.length) return;
		/*Now fetching Inputs */
		var $courseId =$('#courseId');
		if (! $courseId.length) return;
		var courseId = $courseId.val();
		if (courseId == '_@32767@_') courseId = 0;
		var $year = $('#year');
		if (! $year.length) return;
		var year = $year.val();
		if (year == '_@32767@_') year = 0;
		var $semester = $('#semester');
		if (! $semester.length) return;
		var semester = $semester.val();
		if (semester == '_@32767@_') semester = 0;
		var $batchId = $('#batchId');
		if (! $batchId.length) return;
		var batchId = $batchId.val();
		if (batchId == '_@32767@_') batchId = 0;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--').appendTo($select1);
		$store1.find('option').each(function(i, option)	{
			var $option1 = $(option);
			var data1 = "";
			try {
				data1 = $.parseJSON($option1.attr('data-option'));
			} catch (err)	{
				return "Data parsing error " + err.message;
			}
			if (((courseId == 0) || (courseId == parseInt(data1.courseId))) && ((year == 0) || (year == data1.year)) && ((semester == 0) || (semester == data1.semester)) && ((batchId == 0) || (batchId == data1.batchId)))	{
				$option1.clone().appendTo($select1);
			}
		});
	}
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Examination Weight Point can not be zero')
				.appendTo($target1);
		}
	});
	$('select.__do_perform_ui_maintainance').on('change', function(event)	{
		uiMaintainance();
	});
	$(function()	{
		uiMaintainance();
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	}/*Results Upload End*/else/*Results Make Template Begins*/if ($page == "manageresults_make_template" && isset($_REQUEST['report']) && isset($_REQUEST['downloadtemplate']) && Authorize::isAllowable($config, "manageresults_make_template", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Template Making Tool <br/>Temporary File Cleaning</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "manageresults_make_template" && isset($_REQUEST['downloadtemplate']) && Authorize::isAllowable($config, "manageresults_make_template", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$maximumScore = mysql_real_escape_string($_REQUEST['maximumScore']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$filename="";
		$tfname=$filename.$date;
		$tfname=$tfname.rand(100,999);
		$filename=sha1($tfname);
		$filename=$filename.".csv";
		$folderPath = "../temp/";
		try {
			if (! isset($_REQUEST['transactionId'])) Object::shootException("You did not load any subject, kindy restart the tool and pick atleast ONE subject");
			$promise1 = Results::downloadResultsTemplate($database, $conn, $profile1, $folderPath, $filename, $systemTime1, $batchId, $courseId, $year, $semester, $maximumScore, $_REQUEST['transactionId']);
			$filename = $promise1->getResults();
			//We need to sort based on the 3rd column [zero based so column no 2], which is Index Number/Exam Number/Registration Number 
			$resultsFile1 = new ResultsFile($database, $filename, $conn);
			$resultsFile1->save(); //Save Again in the same file -- during saving sorting will happend
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Template Making Tool</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Your template is ready for downloading<br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in making a results template <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if ($promise1->isPromising())	{
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageresults_make_template&downloadtemplate=true&report=<?= $filename ?>">Proceed</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_make_template" && isset($_REQUEST['loadsubjects']) && Authorize::isAllowable($config, "manageresults_make_template", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$maximumScore = mysql_real_escape_string($_REQUEST['maximumScore']);
		$backLink = "";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$transactionList1 = null;
		try {
			$transactionList1 = CourseAndSubjectTransaction::getTransactionListFromCourseYearAndSemester($database, $conn, $courseId, $year, $semester);
			if (is_null($transactionList1)) Object::shootException("There are no subjects Associated with the combination you supplied");
			$batchId = AccademicYear::getBatchFromCurrentAccademicYear($database, $conn, $batchId, $year);
		} catch (Exception $e)	{
			$promise1->setPromise(false);
			$promise1->setReason($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Template Making Tool</div>
			<div class="ui-sys-panel-body">
				<!--Begin of a Pickup Box Widget-->
<?php 
	if ($promise1->isPromising())	{
?>
				<div class="ui-sys-pickup-container">
					<div class="ui-sys-pickup-panel ui-sys-pickup-pickuplist">
						<div class="oi">
							<div class="ui-widget ui-content">
								<div class="ui-widget-header pickup-header">Select From List</div>
								<div class="pickup-body">
									<ol class="pickup-data">
<?php 
	for ($i=0; $i < sizeof($transactionList1); $i++)	{
		$transactionId = $transactionList1[$i];
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $transactionId, $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<li><input type="hidden" name="transactionId[<?= $i ?>]" value="<?= $transaction1->getTransactionId() ?>"/><a class="ui-widget ui-widget-header selectable-item not-selected"><?= $transaction1->getSubject()->getSubjectName() ?> (<?= $transaction1->getSubject()->getSubjectCode() ?>)</a></li>
<?php
	}//end-for-each-transactionId 
?>
									</ol>
								</div>
								<div class="pickup-footer"></div>
							</div>
						</div>
					</div>
					<div class="ui-sys-pickup-panel ui-sys-pickup-pickedlist">
						<div class="oi">
							<div class="ui-widget ui-content">
								<div class="ui-widget-header pickup-header">Selected Subjects</div>
								<div class="pickup-body">
									<form method="POST" id="form1" action="<?= $thispage ?>">
										<input type="hidden" name="page" value="manageresults_make_template"/>
										<input type="hidden" name="downloadtemplate" value="true"/>
										<input type="hidden" name="batchId" value="<?= $batchId ?>"/>
										<input type="hidden" name="courseId" value="<?= $courseId ?>"/>
										<input type="hidden" name="year" value="<?= $year ?>"/>
										<input type="hidden" name="semester" value="<?= $semester ?>"/>
										<input type="hidden" name="maximumScore" value="<?= $maximumScore ?>"/>
										<ol class="pickup-data"></ol>
									</form>
								</div>
								<div class="pickup-footer"></div>
							</div>
						</div>
					</div>
					<div class="ui-sys-clear-both"></div>
					<div id="perror"></div>
					<div class="ui-sys-right">
						<input id="__add_record" type="button" value="Proceed to Template Download"/>
					</div>
				</div>
<?php 
	} else {
?>
		<div class="ui-state-error">
			The Results Template tool could not proceed <br/>
			Details : <?= $promise1->getReason() ?> <br/>
		</div>
<?php
		$tempLink = $thispage."?page=manageresults_make_template";
		$backLink = "<a href=\"$tempLink\">Click Here </a> to go start again the tool";
	}
?>
				<!--End of a Pickup Box Widget-->
			</div>
			<div class="ui-sys-panel-footer"><?= $backLink ?></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_make_template" && Authorize::isAllowable($config, "manageresults_make_template", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Template Making Tool</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_make_template"/>
					<input type="hidden" name="loadsubjects" value="io"/>
					<div class="pure-control-group">
						<label for="batchId" title="The current Accademic Year">Accademic Year </label>
						<select id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Batch (Accademic Year this group joined the college)">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		try {
			$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
			if ($accademicYear1->getAccademicYearNumber() != $controlAccademicCounter) continue;
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester" title="The semester this results belong to">Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select the Semester">
							<option value="0">--select--</option>
<?php 
	$semesterLimit = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $semesterLimit; $i++)	{
?>
		<option value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="maximumScore">Maximum Score </label>
						<input class="text-can-not-be-zero" type="text" name="maximumScore" id="maximumScore" size="4" required placeholder="100" validate="true" pattern="<?= $exprD4Number ?>" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Maximum Score : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Proceed to Subject Selection"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Examination Weight Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} /*Results Make Template Ends*/else/*Results BEGIN*/if ($page == "manageresults_nulify" && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_nulify", "normal", "setlog", "-1", "-1"))	{
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		$resultsName = "";
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			$resultsName = $results1->getExamination()->getExaminationName();
			$resultsName .= " (".$results1->getGroup()->getCourse()->getCourseCode().")";
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Nullification</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
			try {
				if (trim($_REQUEST['rndx']) != $results1->getExtraFilter()) Object::shootException("The System has detected you are replaying data in the Browser");
				$results1->setExtraInformation("../data/results/"); //Save the datafolder for a while here 
				$results1->nullifyMe();
				$enableUpdate = true;
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
			if ($promise1->isPromising())	{
?>
				<div class="ui-state-highlight">
					You have successful Nulified Results, identified by <b><?= $resultsName ?></b>
				</div>
<?php
			} else {
?>
				<div class="ui-state-error">
					The Nullification process could not complete successful, kindly try again <br/>
					Details: <?= $promise1->getReason() ?>
				</div>
<?php
			}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=manageresults_detail&id=<?= $results1->getResultsId() ?>">Back to Results Details</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_nulify", "Nulified $resultsName");
	} else if ($page == "manageresults_nulify" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_nulify", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		$resultsName = "";
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			$resultsName = $results1->getExamination()->getExaminationName();
			$resultsName .= " (".$results1->getGroup()->getCourse()->getCourseCode().")";
			$results1->setExtraFilter(System::getCodeString(8));
			$results1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Nullification</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					<b>WARNING</b>: Are you sure you want to remove results identified by <b><?= $resultsName ?></b> from the system?
				</div><br/>
				<div class="ui-sys-inline-controls-center">
					<form method="POST" action="<?= $thispage ?>"> 
						<input type="hidden" name="page" value="manageresults_nulify"/>
						<input type="hidden" name="rndx" value="<?= $results1->getExtraFilter() ?>"/>
						<input type="hidden" name="id" value="<?= $results1->getResultsId() ?>"/>
						<input type="hidden" name="report" value="true"/>
						<input type="submit" value="Proceed (Yes)"/>&nbsp;&nbsp;<a class="button-link" href="<?= $thispage ?>?page=manageresults_detail&id=<?= $results1->getResultsId() ?>">No (Cancel)</a>
					</form>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_synchronize" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_synchronize", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Synchronization Tool</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	try {
		$accademicYear1 = new AccademicYear($database, $_REQUEST['batchId'], $conn);
		$promise1 = Results::synchronize($database, $conn, $_REQUEST['batchId']);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
		$enableUpdate = true;
?>
		<div class="ui-state-highlight">
			All results for accademic year <?= $accademicYear1->getAccademicYear() ?> has been synchronized successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in synchronizing results<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php	
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_synchronize", "Synchronize Results and Examination");
	} else if ($page == "manageresults_synchronize" && Authorize::isAllowable($config, "manageresults_synchronize", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Synchronization Tool</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_synchronize"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label title="Synchronize Results for Accademic Year" for="batchId">Current Accademic Year </label>
						<select id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Batch whose results need to be synchronized">
							<option value="_@32767@_">--select--</option>
<?php 
	$controlAccademicCounter = $profile1->getCurrentAccademicYear()->getAccademicYearNumber();
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		try {
			$accademicYear1 = new AccademicYear($database, $alist1['id'], $conn);
			if ($accademicYear1->getAccademicYearNumber() != $controlAccademicCounter) continue;
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Synchronize Results and Examination"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageresults_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<?php
	} else if ($page == "manageresults_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageresults_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Results::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Results[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$results1 = null;
			try	{
				$results1 = new Results($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($results1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageresults_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageresults_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageresults_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresults_csv" && Authorize::isAllowable($config, "manageresults_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageresults_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Results::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresults_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageresults_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$results1 = null;
		try {
			 $results1 = new Results($database, $_REQUEST['id'], $conn);
			 if ($results1->isResultsLocked()) Object::shootException("Results is Locked");
			 if ($results1->getGroup()->isResultsLocked()) Object::shootException("Results Belongs to a Locked Group");
			 $results1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Results which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Results has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Results <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_delete", "Deleted Results");
	} else if ($page == "manageresults_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$results1 = null;
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			$results1->setExtraFilter(System::getCodeString(8));
			$results1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Results from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Results from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageresults_delete&report=io&id=<?= $results1->getResultsId() ?>&rndx=<?= $results1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageresults">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageresults_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$examinationId = mysql_real_escape_string($_REQUEST['examinationId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$isAttentionRequired = false;
		$sourceResultsAreLocked = false;
		if ($results1->isResultsLocked() || $results1->getGroup()->isResultsLocked()) {
			$sourceResultsAreLocked = true;
		}
		if (is_null($results1->getGroup()) || ($groupId != $results1->getGroup()->getGroupId()))	{
			$results1->setGroup($groupId); $enableUpdate = true; $isAttentionRequired = true;
		}
		if (is_null($results1->getExamination()) || ($examinationId != $results1->getExamination()->getExaminationId()))	{
			$results1->setExamination($examinationId); $enableUpdate = true; $isAttentionRequired = true;
		}
		if ($extraInformation != $results1->getExtraInformation())	{
			$results1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $results1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$results1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				if ($sourceResultsAreLocked) Object::shootException("Either Results is Locked or The Host Results Group is Locked");
				//Do Validation Here 
				//1. examination and resultsGroup should belong to the same examinationGroup 
				if (! ExaminationGroup::isExaminationAndResultsGroupBelongToTheSameExaminationGroup($database, $conn, $examinationId, $groupId)) Object::shootException("The reference Examination and the Results Group for this results does not belong to the same Examination Group");
				//2. The reference examination should appear only once in the resultsGroup 
				if ($isAttentionRequired && ResultsGroup::isReferenceExaminationAlreadyLinkedToResultsGroup($database, $conn, $examinationId, $groupId)) Object::shootException("The reference Examination has already being linked to the Results Group");
				//3. CounterCheck the examination group should be closed, just use the resultsGroup to get hook to an examination Group 
				if ($results1->getGroup()->isResultsLocked()) Object::shootException("The Target Results Group is Locked");
				$results1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Update Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Results has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the results <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_edit", "Edited Results");
	} else if ($page == "manageresults_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
			$results1->setExtraFilter($extraFilter);
			$results1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Results</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $results1->getResultsId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $results1->getExtraFilter() ?>"/>
					 <div class="pure-control-group">
						<label for="groupId">Results Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Results Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$examinationGroupId = "";
	$list1 = ResultsGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $alist1['id'], $conn);
			if ($group1->isResultsLocked()) continue;
		} catch (Exception $e)	{
			die("Failed ".$e->getMessage());
		}
		$selected = "";
		if (! is_null($results1->getGroup()) && ($results1->getGroup()->getGroupId() == $alist1['id'])) {
			$selected="selected";
			$examinationGroupId = $alist1['pEId'];
		}
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>" data-examination-id="<?= $alist1['pEId'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<div id="hExaminationId" class="ui-sys-hidden">
<?php 
	$list1 = Examination::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>" data-examination-id="<?= $alist1['pEId'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</div>
						<label for="examinationId">Reference Examination </label>
						<select id="examinationId" name="examinationId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Reference Examination">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Examination::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		if ($alist1['pEId'] == $examinationGroupId)	{
			$selected = "";
			if (! is_null($results1->getExamination()) && ($results1->getExamination()->getExaminationId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>" data-examination-id="<?= $alist1['pEId'] ?>"><?= $alist1['val'] ?></option>
<?php
		}
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $results1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('select#groupId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var $examination1 = $('#examinationId');
		if (! $examination1.length) return;
		var $store1 = $('#hExaminationId');
		if (! $store1.length) return;
		$examination1.empty();
		$('<option/>').attr('value', '_@32767@_')
				.html('--select--').appendTo($examination1);
		var examinationId = $option1.attr('data-examination-id');
		if (! examinationId) return;
		$store1.find('option').each(function(i, option)	{
			var $option1 = $(option);
			if ($option1.attr('data-examination-id') == examinationId)	{
				$option1.clone().appendTo($examination1);
			}
		});
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresults_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$results1 = null;
		try {
			$results1 = new Results($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Results Management Details</div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
<?php 
	if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getExaminationGroup()))	{
?>
					<tr>
						<td>Results Group</td>
						<td><?= $results1->getGroup()->getExaminationGroup()->getGroupName() ?></td>
					</tr>
<?php
	}
	if (! is_null($results1->getExamination()))	{
?>
					<tr>
						<td>Reference Examination</td>
						<td><?= $results1->getExamination()->getExaminationName() ?> (<?= $results1->getExamination()->getExaminationCode() ?>)</td>
					</tr>
					<tr>
						<td>Annual Weight</td>
						<td>
<?php 
	$weight = "NAN";
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	try {
		$weight = Examination::percentageWeightInAGroup($database, $conn, $results1->getExamination());
	} catch (Exception $e)	{
		$weight = "###";
	}
	mysql_close($conn);
	echo $weight;
?>							
						</td>
					</tr>
					<tr>
						<td>Semester Weight</td>
						<td>
<?php 
	$weight = "NAN";
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	try {
		$weight = Examination::percentageWeightInAGroupInASemester($database, $conn, $results1->getExamination());
	} catch (Exception $e)	{
		$weight = "###";
	}
	mysql_close($conn);
	echo $weight;
?>							
						</td>
					</tr>
<?php
	} 
	if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getCourse()))	{
		$coursename = $results1->getGroup()->getCourse()->getCourseName()." (".$results1->getGroup()->getCourse()->getCourseCode().")";
?>
					<tr>
						<td>Course</td>
						<td><?= $coursename ?></td>
					</tr>
<?php
	}
	$lockedStatus = "Results is Open for Upload and Edits";
	if ($results1->isResultsLocked())	$lockedStatus = "Results is Locked (No Further Editing is Possible)";
?>
					<tr><td colspan="2"><?= $lockedStatus ?></td></tr>
<?php
	if (! is_null($results1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $results1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (! $results1->isResultsLocked() && ! $results1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "manageresults_nulify", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Nulify Results" href="<?= $thispage ?>?page=manageresults_nulify&id=<?= $results1->getResultsId() ?>"><img alt="DAT" src="../sysimage/buttonnull.png"/></a>
<?php
	}
	if (! $results1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "manageresults_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Lock/Unlock Results" href="<?= $thispage ?>?page=manageresults_edit&id=<?= $results1->getResultsId() ?>&service_locked=true"><img alt="DAT" src="../sysimage/buttonlocked.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresults_monitor_devel", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Results Monitor" href="<?= $thispage ?>?page=manageresults_monitor_devel&controlFlags=<?= Results::$__RESULTS_MODE ?>&classname=Results&id=<?= $results1->getResultsId() ?>"><img alt="DAT" src="../sysimage/buttonmonitor.png"/></a>
<?php
	}
	if (! $results1->isResultsLocked() && ! $results1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "manageresults_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit Results Manager" href="<?= $thispage ?>?page=manageresults_edit&id=<?= $results1->getResultsId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (! $results1->isResultsLocked() && ! $results1->getGroup()->isResultsLocked() && Authorize::isAllowable($config, "manageresults_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete Results Manager" href="<?= $thispage ?>?page=manageresults_delete&id=<?= $results1->getResultsId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageresults_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresults_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$examinationId = mysql_real_escape_string($_REQUEST['examinationId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for Results Creation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO results (groupId, examinationId, extraFilter, extraInformation) VALUES('$groupId', '$examinationId', '$extraFilter', '$extraInformation')";
	try {
		//Do Validation Here 
		//1. examination and resultsGroup should belong to the same examinationGroup 
		if (! ExaminationGroup::isExaminationAndResultsGroupBelongToTheSameExaminationGroup($database, $conn, $examinationId, $groupId)) Object::shootException("The reference Examination and the Results Group for this results does not belong to the same Examination Group");
		//2. The reference examination should appear only once in the resultsGroup 
		if (ResultsGroup::isReferenceExaminationAlreadyLinkedToResultsGroup($database, $conn, $examinationId, $groupId)) Object::shootException("The reference Examination has already being linked to the Results Group");
		//3. CounterCheck the examination group should be closed, just use the resultsGroup to get hook to an examination Group 
		$group1 = new ResultsGroup($database, $groupId, $conn);
		if ($group1->isResultsLocked()) Object::shootException("Can not add results to a Locked Results Group");
		mysql_db_query($database, $query, $conn) or Object::shootException("Results[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">Results has been successful created</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the results<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Results";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresults_add", "Results Created");
	} else if ($page == "manageresults_add" && Authorize::isAllowable($config, "manageresults_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Results</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresults_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupId">Results Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Results Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ResultsGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $alist1['id'], $conn);
			if ($group1->isResultsLocked()) continue;
		} catch (Exception $e)	{
			die("Failed ".$e->getMessage());
		}
?>
			<option value="<?= $alist1['id'] ?>" data-examination-id="<?= $alist1['pEId'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<div id="hExaminationId" class="ui-sys-hidden">
<?php 
	$list1 = Examination::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{	
?>
			<option value="<?= $alist1['id'] ?>" data-examination-id="<?= $alist1['pEId'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</div>
						<label for="examinationId">Reference Examination </label>
						<select id="examinationId" name="examinationId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Reference Examination">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresults">Back to Results Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('select#groupId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var $examination1 = $('#examinationId');
		if (! $examination1.length) return;
		var $store1 = $('#hExaminationId');
		if (! $store1.length) return;
		$examination1.empty();
		$('<option/>').attr('value', '_@32767@_')
				.html('--select--').appendTo($examination1);
		var examinationId = $option1.attr('data-examination-id');
		if (! examinationId) return;
		$store1.find('option').each(function(i, option)	{
			var $option1 = $(option);
			if ($option1.attr('data-examination-id') == examinationId)	{
				$option1.clone().appendTo($examination1);
			}
		});
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresults" && Authorize::isAllowable($config, "manageresults", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-results-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageresults" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageresults_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>Results Group</th>
				<th>Reference <br/>Examination</th>
				<th>Accademic<br/>Year</th>
				<th>Course</th>
				<th>Year</th>
				<th>Semester</th>
				<th>Annual <br/>Weight</th>
				<th>Semester<br/>Weight</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Results::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch results data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$results1 = null;
		try {
			$results1 = new Results($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($results1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td>
<?php 
	$flagLocked = "<span style=\"background-color: blue;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
	if ($results1->isResultsLocked())	$flagLocked = "<span title=\"Results is Locked\" style=\"background-color: gold;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
	echo $flagLocked;
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getExaminationGroup()))	{
		echo $results1->getGroup()->getExaminationGroup()->getGroupName();
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getExamination()))	{
?>
		<?= $results1->getExamination()->getExaminationName() ?> (<?= $results1->getExamination()->getExaminationCode() ?>)
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getBatch()))	{
		echo $results1->getGroup()->getBatch()->getAccademicYear();
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getGroup()) && ! is_null($results1->getGroup()->getCourse()))	{
		$coursename = $results1->getGroup()->getCourse()->getCourseName()." (".$results1->getGroup()->getCourse()->getCourseCode().")";
		echo $coursename;
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getGroup()))	{
		echo $results1->getGroup()->getYear();
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($results1->getExamination()))	{
		echo $results1->getExamination()->getSemester();
	}
?>				
				</td>
				<td>
<?php 
	$weight = "NAN";
	try {
		if (is_null($results1->getExamination())) Object::shootException("###");
		$weight = Examination::percentageWeightInAGroup($database, $conn, $results1->getExamination());
	} catch (Exception $e)	{
		$weight = "###";
	}
	echo $weight;
?>				
				</td>
				<td>
<?php 
	$weight = "NAN";
	try {
		if (is_null($results1->getExamination())) Object::shootException("###");
		$weight = Examination::percentageWeightInAGroupInASemester($database, $conn, $results1->getExamination());
	} catch (Exception $e)	{
		$weight = "###";
	}
	echo $weight;
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageresults_detail&id=<?= $results1->getResultsId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageresults_synchronize", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Synchronize Results inline with the corresponding Examination Definition" href="<?= $thispage ?>?page=manageresults_synchronize"><img alt="DAT" src="../sysimage/synchronize.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresults_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageresults_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresults_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Results" href="<?= $thispage ?>?page=manageresults_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Results End*/ else/*ResultsGroup BEGIN*/if ($page == "manageresultsgroup_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageresultsgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ResultsGroup CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a></div>
		</div>
<?php
	} else if ($page == "manageresultsgroup_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageresultsgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ResultsGroup CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = ResultsGroup::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("ResultsGroup[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$group1 = null;
			try	{
				$group1 = new ResultsGroup($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($group1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageresultsgroup_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresultsgroup_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageresultsgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ResultsGroup CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresultsgroup_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageresultsgroup_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresultsgroup_csv" && Authorize::isAllowable($config, "manageresultsgroup_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ResultsGroup CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageresultsgroup_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, ResultsGroup::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageresultsgroup_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageresultsgroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			 $group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
			 if ($group1->isResultsLocked()) Object::shootException("You can not delete a Locked Results");
			 $group1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ResultsGroup Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The ResultsGroup has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the ResultsGroup <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresultsgroup_delete", "Deleted a Results Group");
	} else if ($page == "manageresultsgroup_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a ResultsGroup from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the ResultsGroup from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageresultsgroup_delete&report=io&id=<?= $group1->getGroupId() ?>&rndx=<?= $group1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageresultsgroup">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageresultsgroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$isAttentionRequired = false;
		if (is_null($group1->getExaminationGroup()) || ($group1->getExaminationGroup()->getGroupId() != $groupId))	{
			$group1->setExaminationGroup($groupId); $enableUpdate = true; $isAttentionRequired = true;
		}
		if (is_null($group1->getBatch()) || ($group1->getBatch()->getAccademicYearId() != $batchId))	{
			$group1->setBatch($batchId); $enableUpdate = true; $isAttentionRequired = true;
		}
		if (is_null($group1->getCourse()) || ($group1->getCourse()->getCourseId() != $courseId))	{
			$group1->setCourse($courseId); $enableUpdate = true; $isAttentionRequired = true;
		}
		if ($year != $group1->getYear())	{
			$group1->setYear($year); $enableUpdate = true; $isAttentionRequired =true;
		}
		if ($extraInformation != $group1->getExtraInformation())	{
			$group1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$group1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				if ($isAttentionRequired && ResultsGroup::isResultsGroupBatchCourseAndYearAlreadyAddedInExaminationGroup($database, $conn, $groupId, $batchId, $courseId, $year)) Object::shootException("The course, year and semester for the examination group is already belonging to this Results Group");
				$group1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Group Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Results Group has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the Results Group <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresultsgroup_edit", "Edited Results Group");
	} else if ($page == "manageresultsgroup_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter($extraFilter);
			$group1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Results Group</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresultsgroup_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="groupId">Examination Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Examination Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ExaminationGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($group1->getExaminationGroup()) && ($group1->getExaminationGroup()->getGroupId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="batchId" title="This is the Accademic Year this group joined at <?= $profile1->getProfileName() ?>">Batch of </label>
						<select id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Batch (Accademic Year this group joined the college)">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($group1->getBatch()) && ($group1->getBatch()->getAccademicYearId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$selected = "";
		if (! is_null($group1->getCourse()) && ($group1->getCourse()->getCourseId() == $course1->getCourseId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
<?php 
	if (! is_null($group1->getCourse()))	{
		$duration = intval($group1->getCourse()->getDuration());
		for ($i=1; $i<= $duration; $i++)	{
			$selected = "";
			if (intval($group1->getYear()) == $i) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $i ?>"><?= $i ?></option>
<?php
		}
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $group1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresultsgroup_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageresultsgroup_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for Results Group</div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
<?php 
	if (! is_null($group1->getExaminationGroup()))	{
?>
		<tr>
			<td>Examination Group</td>
			<td><?= $group1->getExaminationGroup()->getGroupName() ?></td>
		</tr>
<?php
	}
	if (! is_null($group1->getBatch()))	{
?>
		<tr>
			<td>Batch Of</td>
			<td><?= $group1->getBatch()->getAccademicYear() ?></td>
		</tr>
<?php
	}
	if (! is_null($group1->getCourse()))	{
?>
		<tr>
			<td>Course</td>
			<td><?= $group1->getCourse()->getCourseName() ?></td>
		</tr>
<?php
	}
?>
		<tr>
			<td>Year</td>
			<td><?= $group1->getYear() ?></td>
		</tr>
<?php
	$locked = "Results Are Not Yet Locked";
	if ($group1->isResultsLocked()) $locked = "Results Are Already Locked";
?>
		<tr>
			<td style="text-align: center;" colspan="2"><b><?= $locked ?></b></td>
		</tr>
<?php
	$afterSupplimentaryText = "BEFORE SUPPLIMENTARY";
	if ($group1->isAfterSupplimentary()) $afterSupplimentaryText = "AFTER SUPPLIMENTARY";
?>
		<tr><td style="text-align: center;" colspan="2"><b><?= $afterSupplimentaryText ?></b></td></tr>
<?php
	if (! is_null($group1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $group1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (! $group1->isResultsLocked() && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Finalize Group Results" href="<?= $thispage ?>?page=manageresultsgroup_edit&id=<?= $group1->getGroupId() ?>&service_finalize=true"><img alt="DAT" src="../sysimage/buttoncalculate.png"/></a>
<?php
	}
	//Allow Only Unlock
	if ($group1->isResultsLocked() && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Lock/Unlock Results Group" href="<?= $thispage ?>?page=manageresultsgroup_edit&id=<?= $group1->getGroupId() ?>&service_locked=true"><img alt="DAT" src="../sysimage/buttonlocked.png"/></a>
<?php
	}
	if ($group1->isResultsLocked() && Authorize::isAllowable($config, "manageresults_monitor_devel", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Results Monitor" href="<?= $thispage ?>?page=manageresults_monitor_devel&controlFlags=<?= Results::$__RESULTS_MODE ?>&classname=ResultsGroup&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonmonitor.png"/></a>
<?php
	}
	if (! $group1->isResultsLocked() && Authorize::isAllowable($config, "manageresultsgroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit Results Group" href="<?= $thispage ?>?page=manageresultsgroup_edit&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (! $group1->isResultsLocked() && Authorize::isAllowable($config, "manageresultsgroup_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete Results Group" href="<?= $thispage ?>?page=manageresultsgroup_delete&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageresultsgroup_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageresultsgroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$batchId = mysql_real_escape_string($_REQUEST['batchId']);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for Results Group</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO resultsGroup (examinationGroupId, courseId, _year, batchId, extraFilter, extraInformation) VALUES('$groupId', '$courseId', '$year', '$batchId', '$extraFilter', '$extraInformation')";
	try {
		if (ResultsGroup::isResultsGroupBatchCourseAndYearAlreadyAddedInExaminationGroup($database, $conn, $groupId, $batchId, $courseId, $year)) Object::shootException("There exists a course for the submitted batch for the supplied year already attached to the Examination Group");
		mysql_db_query($database, $query, $conn) or Object::shootException("ResultsGroup[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Results Group has been successful added to the System</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the Results Group<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Results Group";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageresultsgroup_add", "Added Results Group");
	} else if ($page == "manageresultsgroup_add" && Authorize::isAllowable($config, "manageresultsgroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Results Group</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageresultsgroup_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupId">Examination Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Examination Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ExaminationGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="batchId" title="This is the Accademic Year this group joined at <?= $profile1->getProfileName() ?>">Batch of </label>
						<select id="batchId" name="batchId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Batch (Accademic Year this group joined the college)">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = AccademicYear::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
			<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year" title="The year this results will belong to">Year </label>
						<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Year this results belong to">
							<option value="_@32767@_">--select--</option>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageresultsgroup">Back to Results Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#courseId').on('change', function(event)	{
		var $select1 = $(this).closest('select');
		if (! $select1.length) return;
		var $option1 = $select1.find('option:selected');
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		//Getting year select 
		$select1 = $('#year');
		if (! $select1.length) return;
		$select1.empty();
		$('<option/>').attr('value', '_@32767@_').html('--select--')
			.appendTo($select1);
		for (var i = 1; i <= duration; i++)	{
			$('<option/>').attr('value', i).html(i)
				.appendTo($select1);
		}
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageresultsgroup" && Authorize::isAllowable($config, "manageresultsgroup", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Results Groups Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-department-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageresultsgroup" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageresultsgroup_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>Examination<br/>Group</th>
				<th>Course</th>
				<th>Batch</th>
				<th>Year</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = ResultsGroup::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch department data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$group1 = null;
		try {
			$group1 = new ResultsGroup($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($group1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td>
<?php 
	$flagLocked = "<span style=\"background-color: blue;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
	if ($group1->isResultsLocked())	$flagLocked = "<span title=\"Group Results is Locked\" style=\"background-color: gold;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>";
	echo $flagLocked;
?>				
				</td>
				<td>
<?php 
	if (! is_null($group1->getExaminationGroup()))	{
		echo $group1->getExaminationGroup()->getGroupName();
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($group1->getCourse()))	{
		echo $group1->getCourse()->getCourseName();
	}
?>
				</td>
				<td>
<?php 
	if (! is_null($group1->getBatch()))	{
		echo $group1->getBatch()->getAccademicYear();
	}
?>				
				</td>
				<td><?= $group1->getYear() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageresultsgroup_detail&id=<?= $group1->getGroupId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageresultsgroup_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageresultsgroup_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageresultsgroup_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System ResultsGroup" href="<?= $thispage ?>?page=manageresultsgroup_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*ResultsGroup End*/ else/*STUDENTPORTAL BEGIN*/if ($page == "studentportal_transcript" && $login1->isStudent() && Authorize::isAllowable($config, "studentportal_transcript", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">My Transcript</div>
			<div class="ui-sys-panel-body">
<?php 
	$transcript = "";
	try {
		$student1 = new Student($database, $registeredUser1->getStudentId(), $conn);
		$transcript = TranscriptFile::getTranscriptForStudent($database, $conn, $profile1, $student1, $systemTime1, "../data/results/", "../data/transcripts/", array());
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-content-window-scrollable">
			<div class="ui-sys-printable ui-sys-size-a4-potrait">
				<div class="ui-sys-printable-controls">
					<a><img alt="P" src="../sysimage/print.png"/></a>
				</div>
<?php 
					echo $transcript;
?>
			</div>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in loading the transcript <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "studentportal_payment_history" && $login1->isStudent() && Authorize::isAllowable($config, "studentportal_payment_history", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">My Payment History</div>
			<div class="ui-sys-panel-body">
<?php 
	$paymentHistory = "";
	try {
		$student1 = new Student($database, $registeredUser1->getStudentId(), $conn);
		$paymentHistory = FeeInvoice::drawFeePaymentForStudent($database, $conn, $student1->getStudentId(), new Counter(), false);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-data-capture">
<?php 
			echo $paymentHistory;
?>		
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in fetching payment history for you <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "studentportal_subject" && $login1->isStudent() && Authorize::isAllowable($config, "studentportal_subject", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">My Enrolled Subjects</div>
			<div class="ui-sys-panel-body">
<?php 
	$listToDisplay = "";
	try {
		$student1 = Login::getUserWithThisLogin($database, $conn, $login1);
		$listToDisplay = $student1->showMySubjectList($profile1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-data-capture">
<?php 
	echo $listToDisplay;
?>
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			The subject list you were enrolled to could not be loaded <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "studentportal_results" && $login1->isStudent() && Authorize::isAllowable($config, "studentportal_results", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">My Results</div>
			<div class="ui-sys-panel-body">
<?php 
	$listToDisplay = "";
	try {
		$student1 = Login::getUserWithThisLogin($database, $conn, $login1);
		$listToDisplay = array();
		$temp = $student1->showMyBriefcaseGroupResults($profile1, "../data/briefcase/", new DisplayList(), 15);
		if (! is_null($temp)) $listToDisplay[sizeof($listToDisplay)] = $temp;
		$temp = $student1->showMyBriefcaseResults($profile1, "../data/briefcase/", new DisplayList(), 15);
		if (! is_null($temp)) $listToDisplay[sizeof($listToDisplay)] = $temp;
		$temp = $student1->showMyCompiledResults($profile1, "../data/results/", new DisplayList(), 15);
		if (! is_null($temp)) $listToDisplay[sizeof($listToDisplay)] = $temp;
		$temp = $student1->showMyContinuousResults($profile1, "../data/results/", new DisplayList(), 15);
		if (! is_null($temp)) $listToDisplay[sizeof($listToDisplay)] = $temp;
		$windowToDisplay = null;
		if (sizeof($listToDisplay) > 0)	{
			$count = 0;
			foreach ($listToDisplay as $window1)	{
				if ($count == 0) $windowToDisplay = $window1;
				else $windowToDisplay .= "<br/><br/>".$window1;
				$count++;
			}
		}	
		//You need to proceed with continuous results
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-sys-data-capture">
<?php 
	if (is_null($windowToDisplay))	{
?>
		<div class="ui-state-highlight">
			Dear <?= $login1->getFullname() ?>; You do not have results yet
		</div>
<?php
	} else {
		echo $windowToDisplay;
	}
?>
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in Loading Your Results <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} /*STUDENTPORTAL END*/ else /*OPEN OR ClOSE Admission BEGIN*/ if ($page == "manageadmission_open_close" && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageadmission_open_close", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$action = intval($_REQUEST['report']);
		$actionText = "";
		if ($action == 0)	$actionText = "OPENED";
		else if ($action == 1) $actionText = "CLOSED";
		$promise1 = new Promise();
		$promise1->setReason("Nothing were updated");
		//Starting to update 
		$localProfile1 = null;
		try {
			$localProfile1 = new Profile($database, $profile1->getProfileId(), $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		if (($action == 1) xor $localProfile1->isAdmissionClosed())	{
			$localProfile1->setAdmissionClosed($action); $enableUpdate = true;
		}
		if (trim($_REQUEST['rndx']) != $localProfile1->getExtraFilter())	{
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
		if ($enableUpdate)	{
			try {
				$localProfile1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$enableUpdate = false;
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">OPEN or CLOSE ADMISSION PROCESS<br/>Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			You have successful <?= $actionText ?> the Admission process
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Close/Open the Admission process <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageadmission_open_close", "Admission was $actionText");
	} else if ($page == "manageadmission_open_close" && Authorize::isAllowable($config, "manageadmission_open_close", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$localProfile1 = null;
		try {
			$localProfile1 = new Profile($database, $profile1->getProfileId(), $conn);
			$localProfile1->setExtraFilter(System::getCodeString(8));
			$localProfile1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">OPEN or CLOSE ADMISSION PROCESS</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form" id="form1" action="<?= $thispage ?>" method="POST">
					<input type="hidden" name="page" value="manageadmission_open_close"/>
					<input type="hidden" name="rndx" value="<?= $localProfile1->getExtraFilter() ?>"/>
<?php 
	if ($profile1->isAdmissionClosed())	{
?>
		<input type="hidden" name="report" value="0"/>
		<div class="ui-sys-warning">
			Current Status: Admission is Closed <br/>
			By Clicking the Open Admission button, you are making the Admission system to be available for Student Registration as well for Student Admission, We recommend the Admission to be Closed once the registration and admission period is over 
		</div>
		<div class="ui-sys-center-text">
			<input type="submit" value="OPEN ADMISSION"/> &nbsp;&nbsp;
			<a class="button-link" href="<?= $thispage ?>">No (DO NOT OPEN)</a>
		</div>
<?php
	} else {
?>
		<input type="hidden" name="report" value="1"/>
		<div class="ui-sys-warning">
			Current Status: Admission is Open <br/>
			By Clicking the Close Admission button, you disabling Student Registration as well as Student Admission Procedures
		</div>
		<div class="ui-sys-center-text">
			<input type="submit" value="CLOSE ADMISSION"/> &nbsp;&nbsp;
			<a class="button-link" href="<?= $thispage ?>">No (DO NOT CLOSE)</a>
		</div>
<?php
	} //end-if-else-admission-closed
?>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} /*OPEN OR CLOSE Admission END*/ else/*Student BEGIN*/if ($page == "managestudent_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managestudent_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent">Back to Student Manager</a></div>
		</div>
<?php
	} else if ($page == "managestudent_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managestudent_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldDataExtended($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue'], $_REQUEST['datasource']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
		$csvProcessor1->setXMLDataPresent("1");
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Student::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Student[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$student1 = null;
			try	{
				$student1 = new Student($database, $id, $conn);
				$student1->loadXMLFolder("../data/students");
				/*Set Registered to the data */
				$registered = "0";
				if ($student1->isInCurrentAccademicYear($profile1) && $student1->isInCurrentSemester($profile1)) $registered="1";
				$student1->setRegistered($registered);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($student1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managestudent_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managestudent_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managestudent_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldDataExtended($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue'],$_REQUEST['datasource']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managestudent_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managestudent_csv" && Authorize::isAllowable($config, "managestudent_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managestudent_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Student::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent">Back to Student Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managestudent_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managestudent_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$student1 = null;
		$ulogin1 = null;
		try {
			 $student1 = new Student($database, $_REQUEST['id'], $conn);
			 $ulogin1 = $student1->getLogin();
			 if ($ulogin1->isAdmitted()) Object::shootException("Could not Remove an Admitted Student");
			 //Remove All Approval Data 
			 $list = ApprovalSequenceData::getMyApprovalSequenceWaitingToBeApproved($database, $conn, $ulogin1->getLoginId());
			 if (! is_null($list))	{
				foreach ($list as $dataId)	{
					$data1 = new ApprovalSequenceData($database, $dataId, $conn);
					$data1->commitDelete();
				}
			 }
			 $student1->commitDelete();
			 $ulogin1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Student which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Student <?= $ulogin1->getFullname() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Student <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent">Back to Student Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managestudent_delete", "Deleted ".$ulogin1->getLoginName());
	} else if ($page == "managestudent_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			$student1->setExtraFilter(System::getCodeString(8));
			$student1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Student <b><?= $ulogin1->getFullname() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Student <?= $ulogin1->getFullname() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managestudent_delete&report=io&id=<?= $student1->getStudentId() ?>&rndx=<?= $student1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managestudent">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_revoke" && ! $profile1->isAdmissionClosed() && Object::isACustomNewSubmission($config, "Login", $_REQUEST['id']) && isset($_REQUEST['revoke_admission']) && isset($_REQUEST['id']) && isset($_REQUEST['student_id']) && Authorize::isAllowable($config, "managestudent_admit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $login1->getLoginId(), ApprovalSequenceSchema::$__REVOKE_ADMISSION, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", "Login.".$_REQUEST['id']))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		//Submitted loginId 
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$ulogin1 = null;
		$student1 = null;
		$logText = "";
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			$student1 = new Student($database, $_REQUEST['student_id'], $conn);
			$ulogin1->setAdmitted("0");
			$student1->setContinuingStudent("0");
			//Check Browser Replay 
			if (trim($_REQUEST['rndx']) != $ulogin1->getExtraFilter()) Object::shootException("The System has Detected you are replaying data in your Browser window");
			$ulogin1->setExtraFilter($student1->getReferenceNumber());
			// We need to remove the Approval Record Prior Saving
			$schemaId = ApprovalSequenceSchema::getApprovedSchemaFromCodeAndLogin($database, $conn, $login1->getLoginId(), ApprovalSequenceSchema::$__REVOKE_ADMISSION);
			if (is_null($schemaId)) Object::shootException("The Approval Sequence Schema Can not be empty");
			$dataId = ApprovalSequenceData::getDataIdForRequesterInASchema($database, $conn, $login1->getLoginId(), $schemaId, "Login.".$_REQUEST['id']);
			if (is_null($dataId)) Object::shootException("There were not Approval Sequence Data Found");
			$data1 = new ApprovalSequenceData($database, $dataId, $conn);
			$ulogin1->commitUpdate();
			$student1->commitUpdate();
			$data1->commitDelete();
			$logText = "Revoke Admission for ".$ulogin1->getFullname();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Revoke Admission for <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Admission for <?= $ulogin1->getFullname() ?> has been revoked successful <br/>
			The student can amend the registration application anytime using the Application Reference Number of <b><?= $student1->getReferenceNumber() ?></b>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in revoking admission <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managestudent_detail&id=<?= $_REQUEST['student_id'] ?>">Back to Student Details</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managestudent_admit", $logText);
	} else if ($page == "managestudent_revoke" && ! $profile1->isAdmissionClosed() && isset($_REQUEST['revoke_admission']) && isset($_REQUEST['id']) && isset($_REQUEST['student_id']) && Authorize::isAllowable($config, "managestudent_admit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $login1->getLoginId(), ApprovalSequenceSchema::$__REVOKE_ADMISSION, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", "Login.".$_REQUEST['id']))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		//Submitted loginId 
		$ulogin1 = null;
		$she = "She";
		$her = "Her";
		try {
			$ulogin1 = new Login($database, $_REQUEST['id'], $conn);
			if (strtolower($ulogin1->getSex()->getSexName()) == "male")	{
				$she = "He";
				$her = "His";
			}
			$ulogin1->setExtraFilter(System::getCodeString(8));
			$ulogin1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage()); 
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Revoke Admission for <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are About to Revoke the Admission for <b><?= $ulogin1->getFullname() ?></b><br/>
					This will cause this student to be unadmitted. NOTE: This student is currently now a continuous student. <br/>
					<?= $she ?> may use Continuing Student tool on the future to recover <?= strtolower($her) ?> application<br/><br/>
					Are you sure you want to proceed?
				</div>
				<form id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managestudent_revoke"/>
					<input type="hidden" name="revoke_admission" value="io"/>
					<input type="hidden" name="id" value="<?= $ulogin1->getLoginId() ?>"/>
					<input type="hidden" name="student_id" value="<?= $_REQUEST['student_id'] ?>"/>
					<input type="hidden" name="rndx" value="<?= $ulogin1->getExtraFilter() ?>"/>
					<div class="ui-sys-inline-controls-center">
						<input type="submit" value="YES"/> &nbsp;&nbsp;&nbsp;&nbsp;
						<a class="button-link" href="<?= $thispage ?>?page=managestudent_detail&id=<?= $_REQUEST['student_id'] ?>">Cancel</a>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_admit" && ! $profile1->isAdmissionClosed() && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_admit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $_SESSION['admit_student_login_id'], ApprovalSequenceSchema::$__ADMIT_STUDENTS, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", null)) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$student1 = null;
		$ulogin1 = null;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			if (intval($ulogin1->getLoginId()) != intval($_SESSION['admit_student_login_id'])) {
				Object::shootException("The Student registered in the Approval Sequence is not the One you are dealing with<br/>Kindly restart the Admission System");
			}
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		if (trim($_REQUEST['rndx']) != $student1->getExtraFilter())	{
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Preparing a new extraFilter if we will get a chance to be updated 
		$student1->setExtraFilter(System::getCodeString(8));
		//For MRI Use Only 
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Admission For <i><?= $ulogin1->getFullname() ?></i><br/>Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
		try {
			//Deals with any Invoice for this student 
			$promise1 = FeeInvoice::generateAutoInvoicesForStudent($database, $conn, $student1->getStudentId(), $profile1, "Attached During Admission Process");
			//We need to check if this student is a finalist, this will be true especially for courses 
			// whose course duration is 1 and for some of continuing students 
			$student1->allocateToFinalYearIfFinalYear();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		//Now you can proceed with Admission
		if ($promise1->isPromising()) $promise1 = Student::admitStudent($database, $conn, $student1, $profile1, $systemTime1, $login1->getFullname()); //profile not necessary to be active 
		//Finalizing the Approval 
		try {
			$schemaId = ApprovalSequenceSchema::getApprovedSchemaFromCodeAndLogin($database, $conn, $_SESSION['admit_student_login_id'], ApprovalSequenceSchema::$__ADMIT_STUDENTS);
			if (is_null($schemaId)) Object::shootException("The Approval Sequence Schema Can not be empty");
			$dataId = ApprovalSequenceData::getDataIdForRequesterInASchema($database, $conn, $_SESSION['admit_student_login_id'], $schemaId, null);
			if (is_null($dataId)) Object::shootException("There were not Approval Sequence Data Found");
			$data1 = new ApprovalSequenceData($database, $dataId, $conn);
			$data1->commitDelete(); //Remove Approval Data 
		} catch (Exception $e)	{
			$message = "The Student has been Admitted, However there were problem in removing the Approval Data <br/> ".$e->getMessage();
			$promise1->setReason($message);
			$promise1->setPromise(false);
		}
		//You need to uset the session and remove the data 
		unset($_SESSION['admit_student_login_id']);
		if ($promise1->isPromising())	{
			$enableUpdate = true;
?>
			<div class="ui-state-highlight">
				You have successful admitted the student <b><?= $ulogin1->getFullname() ?></b> and <?= $ulogin1->getSex()->getPronoun("his") ?> registration number is <b><?= $student1->getRegistrationNumber() ?></b><br/>
				<a href="<?= $thispage ?>?page=managestudent">Click here</a> to admit another student
			</div>
<?php
		} else {
?>
			<div class="ui-state-error">
				There were problems in admitting this student <br/>
				Details : <?= $promise1->getReason() ?>
			</div>
<?php
		}
	} else {
?>
		<div class="ui-state-error">
			There were problems in admitting this student <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managestudent_admit", "Admitted ".$ulogin1->getFullname());
	} else if ($page == "managestudent_admit" && ! $profile1->isAdmissionClosed() && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_admit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $_SESSION['admit_student_login_id'], ApprovalSequenceSchema::$__ADMIT_STUDENTS, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", null)) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$student1 = null;
		$ulogin1 = null;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$extraFilter = System::getCodeString(8); 
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			$_SESSION['admit_student_login_id'] = $ulogin1->getLoginId();
			$student1->setExtraFilter($extraFilter);
			$student1->commitUpdate();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Admission For <i><?= $ulogin1->getFullname() ?></i><br/>Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are About to Admit a student by a name of <b><?= $ulogin1->getFullname() ?></b>&nbsp; ;This means you have verified <?= $ulogin1->getSex()->getPronoun("his") ?> documents and found the information filled by this student is according to <?= $ulogin1->getSex()->getPronoun("his") ?> document<br/>
					By Clicking the <i>Admit <?= $ulogin1->getFullname() ?></i> Button, you do confirm that everything is correct
				</div>
				<div class="ui-sys-data-capture">
					<form id="form1" class="pure-form" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managestudent_admit"/>
						<input type="hidden" name="report" value="true"/>
						<input type="hidden" name="id" value="<?= $student1->getStudentId() ?>"/>
						<input type="hidden" name="rndx" value="<?= $student1->getExtraFilter() ?>"/>
						<div class="pure-controls">
							<span id="perror" class="ui-sys-error-message"></span>
						</div>
						<div class="pure-controls">
							<br/><input id="__add_record" type="button" value="Admit <?= $ulogin1->getFullname() ?>"/> &nbsp;&nbsp;<a class="button-link" href="<?= $thispage ?>?page=managestudent">No (Cancel)</a>
						</div>
					</form>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_edit" && Object::isACustomNewSubmission($config, "Student", $_REQUEST['id'])&& isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_edit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $login1->getLoginId(), ApprovalSequenceSchema::$__EDIT_STUDENT_DATA, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", "Student.".$_REQUEST['id']))	{ 
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$currentYear = mysql_real_escape_string($_REQUEST['year']);
		$currentSemester = mysql_real_escape_string($_REQUEST['semester']);
		$currentBatchId = mysql_real_escape_string($_REQUEST['currentBatch']);
		$currentAccademicYearId = mysql_real_escape_string($_REQUEST['currentAccademicYear']);
		$postponded = 0;
		$discontinued = 0;
		$isNotRepeating = false;
		if (isset($_REQUEST['postponded'])) $postponded = 1;
		if (isset($_REQUEST['discontinued'])) $discontinued = 1;
		if (isset($_REQUEST['notrepeating'])) $isNotRepeating = true;
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			if (! $ulogin1->isAdmitted()) Object::shootException("You are dealing with a Non Admitted Student");
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		if (is_null($student1->getCourse()) || ($student1->getCourse()->getCourseId() != $courseId))	{
			$student1->setCourse($courseId); 
			//Update Registration Number 
			if (isset($_REQUEST['changeRegistrationNumber']))	{
				$promise1 = Student::generateRegistrationNumber($database, $conn, $profile1, $student1);
				if ($promise1->isPromising()) $student1->setRegistrationNumber($promise1->getResults());
				//sync.change.
				$promise1 = Student::generateExaminationNumber($database, $conn, $profile1, $student1);
				if ($promise1->isPromising()) $student1->setExaminationNumber($promise1->getResults());
			}
			$enableUpdate = true;
		}
		if (intval($student1->getCurrentYear()) != intval($currentYear))	{
			$student1->setCurrentYear($currentYear); $enableUpdate = true;
		}
		if (intval($student1->getCurrentSemester()) != intval($currentSemester))	{
			$student1->setCurrentSemester($currentSemester); $enableUpdate = true;
		}
		if (is_null($student1->getCurrentBatch()) || ($student1->getCurrentBatch()->getAccademicYearId() != $currentBatchId))	{
			$student1->setCurrentBatch($currentBatchId);
			if ($isNotRepeating)	{
				//The Batch List also will be updated to the currentBatch 
				$student1->setListOfBatches($currentBatchId);
			} else {
				//Default Repeating Mode
				//You need existing ones plus the new one 
				$list1 = array();
				$list1[0] = $currentBatchId;
				$listToUpdate = Object::attachIdListToObjectList($student1->getListOfBatches(), $list1);
				$student1->setListOfBatches($listToUpdate);
			}
			$enableUpdate = true;
		}
		if (is_null($student1->getCurrentAccademicYear()) || ($student1->getCurrentAccademicYear()->getAccademicYearId() != $currentAccademicYearId))	{
			$student1->setCurrentAccademicYear($currentAccademicYearId); $enableUpdate = true;
		}
		if (($postponded == 1) xor $student1->hasPospondedStudies())	{
			$student1->setPospondedStudies($postponded); $enableUpdate = true;
		}
		if (($discontinued == 1) xor $student1->isDiscontinued())	{
			$student1->setDiscontinued($discontinued); $enableUpdate = true;
			if ($discontinued == 1) $ulogin1->setAdmitted("0");
			else $ulogin1->setAdmitted("1");
		}
		try {
			if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
			if (trim($_REQUEST['rndx']) != $student1->getExtraFilter()) Object::shootException("The System has detected you are replaying with your browser window");
			if (! $enableUpdate) Object::shootException("There were no updates received by the system");
			$student1->setExtraFilter(System::getCodeString(8));
			//Proper Allocation 
			//We need to allocate this student in a proper group now 
			$promise1 = Student::reallocateStudent($database, $conn, $student1);
			if (! $promise1->isPromising()) Object::shootException($promise1->getReason());
			$ulogin1->setGroup($promise1->getResults());
			$student1->setAlreadyGraduated("0");
			$student1->graduateIfGraduated();
			$student1->setFinalYear("0");
			$student1->allocateToFinalYearIfFinalYear();
			//Make sure this belong to Student Job Title 
			$jobId = JobTitle::getStudentJobTitleId($database, $conn);
			$ulogin1->setJobTitle($jobId);
			$student1->commitUpdate();
			$ulogin1->commitUpdate();
			//Add Approval Sequence Function of removing the approval , define it in a static function in ApprovalSequenceData
			ApprovalSequenceData::clearApprovalSequenceData($database, $conn, ApprovalSequenceSchema::$__EDIT_STUDENT_DATA, null, $login1, "Student.".$_REQUEST['id'], 0);
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student Editor Tool for <br/><?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Data for <?= $ulogin1->getFullname() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in updating student data <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managestudent_detail&id=<?= $_REQUEST['id'] ?>">Back to Student Details</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managestudent_edit", "Edited ".$ulogin1->getFullname());
	} else if ($page == "managestudent_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_edit", "normal", "setlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $login1->getLoginId(), ApprovalSequenceSchema::$__EDIT_STUDENT_DATA, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", "Student.".$_REQUEST['id']))	{ 
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			if (! $ulogin1->isAdmitted()) Object::shootException("You are dealing with a Non Admitted Student");
			$student1->setExtraFilter(System::getCodeString(8));
			$student1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		$tabprefix = "__trustwill_legal_chambers_ide_1_";
		$course1 = $student1->getCourse();
		$batchList1 = $student1->getListOfBatches();
		$currentAccademicYear1 = $student1->getCurrentAccademicYear();
		$currentBatch1 = $student1->getCurrentBatch();
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student Editor Tool for <br/><?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body">
<!--Tabbed Pane Begin-->
<div class="ui-sys-oi-left-forty-percent">
	<div class="ui-sys-data-capture">
		<table class="pure-table">
			<thead>
				<tr>
					<th colspan="2">Summary Data for Student (<?= $ulogin1->getFirstname() ?>)</th>
				</tr>
			</thead>
			<tbody>
<?php 
	if (! is_null($course1))	{
?>
		<tr>
			<td>Course Name</td>
			<td><?= $course1->getCourseName() ?></td>
		</tr>
<?php
	}
?>
				<tr>
					<td>Current Year</td>
					<td><?= $student1->getCurrentYear() ?></td>
				</tr>
				<tr>
					<td>Current Semester</td>
					<td><?= $student1->getCurrentSemester() ?></td>
				</tr>
<?php 
	if (! is_null($batchList1))	{
?>
				<tr>
					<td>Member of Batches</td>
					<td>
						<ul>
<?php 
	foreach ($batchList1 as $batch1)	{
?>
		<li><?= $batch1->getAccademicYear() ?></li>
<?php
	}
?>						
						</ul>
					</td>
				</tr>
<?php
	}
	if (! is_null($currentBatch1))	{
?>
		<tr>
			<td>Current Batch</td>
			<td><?= $currentBatch1->getAccademicYear() ?></td>
		</tr>
<?php
	}
	if (! is_null($currentAccademicYear1))	{
?>
		<tr>
			<td>Current Academic Year</td>
			<td><?= $currentAccademicYear1->getAccademicYear() ?></td>
		</tr>
<?php
	}
	if ($student1->isFinalYear())	{
		echo "<tr><td colspan=\"2\">IS A FINAL YEAR</td></tr>";
	}
	if ($student1->isAlreadyGraduated())	{
		echo "<tr><td colspan=\"2\">IS ALREADY GRADUATED</td></tr>";
	}
	if ($student1->hasPospondedStudies())	{
		echo "<tr><td colspan=\"2\">HAS POSTPONDED STUDIES</td></tr>";
	}
	if ($student1->isDiscontinued())	{
		echo "<tr><td colspan=\"2\">IS DISCONTINUED</td></tr>";
	}
?>
			</tbody>
		</table>
	</div>
</div>
<div class="ui-sys-oi-left-sixty-percent">
	<div style="padding: 1px; border: 1px dashed blue;" class="ui-sys-data-capture">
		<form id="form1" method="POST" action="<?= $thispage ?>" class="pure-form pure-form-aligned">
			<input type="hidden" name="page" value="managestudent_edit"/>
			<input type="hidden" name="id" value="<?= $student1->getStudentId() ?>"/>
			<input type="hidden" name="rndx" value="<?= $student1->getExtraFilter() ?>"/>
			<input type="hidden" name="report" value="io"/>
			<input type="hidden" id="dataStore" value="0" data-current-year="<?= $student1->getCurrentYear() ?>"/>
			<div class="pure-control-group">
				<label for="courseId">Course </label>
				<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Course">
					<option data-course-duration="0" value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist1['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$selected = "";
		if (! is_null($student1->getCourse()) && ($student1->getCourse()->getCourseId() == $course1->getCourseId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
				</select>
			</div>
			<div class="pure-control-group">
				<label for="year">Current Year </label>
				<select id="year" name="year" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Current Year">
					<option value="_@32767@_">--select--</option>
				</select>
			</div>
			<div class="pure-control-group">
				<label for="semester">Current Semester </label>
				<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly select a Current Semester">
					<option value="_@32767@_">--select--</option>
<?php 
	$numberOfSemesters = intval($profile1->getNumberOfSemestersPerYear());
	for ($i=1; $i <= $numberOfSemesters; $i++)	{
		$selected = "";
		if ($i == intval($student1->getCurrentSemester())) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
				</select>
			</div>
			<div class="pure-control-group">
				<label for="currentBatch">Current Batch</label>
				<select id="currentBatch" name="currentBatch" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Current Batch">
					<option value="_@32767@_">--select--</option>
<?php 
	$list = AccademicYear::loadAllData($database, $conn);
	foreach ($list as $alist)	{
		$selected = "";
		if (! is_null($student1->getCurrentBatch()) && ($alist['id'] == $student1->getCurrentBatch()->getAccademicYearId())) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
				</select>
			</div>
			<div class="pure-control-group">
				<label for="currentAccademicYear">Current Academic Year</label>
				<select id="currentAccademicYear" name="currentAccademicYear" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Current Accademic Year">
					<option value="_@32767@_">--select--</option>
<?php 
	$list = AccademicYear::loadAllData($database, $conn);
	foreach ($list as $alist)	{
		$selected = "";
		if (! is_null($student1->getCurrentAccademicYear()) && ($alist['id'] == $student1->getCurrentAccademicYear()->getAccademicYearId())) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
				</select>
			</div>
<?php 
	$chkPostponded = "";
	if ($student1->hasPospondedStudies()) $chkPostponded="checked";
	$chkDiscontinued = "";
	if ($student1->isDiscontinued()) $chkDiscontinued="checked";
?>
			<div class="pure-controls">
				<label title="TICK if you need the registration number to be changed if the course is changed"><input type="checkbox" name="changeRegistrationNumber" value="1"/> Change Registration Number</label>
			</div>
			<div class="pure-controls">
				<label title="TICK if <?= $ulogin1->getFullname() ?> has postponded studies, else otherwise do not tick"><input <?= $chkPostponded ?> type="checkbox" name="postponded" value="1"/> Has Postponded Studies?</label>
			</div>
			<div class="pure-controls">
				<label title="TICK if <?= $ulogin1->getFullname() ?> has discontinued from studies, else otherwise do not tick"><input <?= $chkDiscontinued ?> type="checkbox" name="discontinued" value="1"/> Has Discontinued from Studies?</label>
			</div>
			<div class="ui-sys-warning pure-controls">
				<label title="BE CAREFUL: This has effect only if you change the Current Batch. If you change a current Batch which is not in your batches list, automatically it will be added in the batch list. TICK this box only if you are sure you were placed wrongly by the system and you are not repeating or jumping forward"><input type="checkbox" name="notrepeating" value="1"/> NOT REPEATING MODE (Significat Only if Current Batch is Changed)?</label>
			</div>
		</form>
		<div class="ui-sys-error-message" id="perror"></div>
		<div class="ui-sys-inline-controls-right"><input type="button" id="__add_record" value="Edit Data"/></div>
	</div>
</div>
<div class="ui-sys-clear-both">&nbsp;</div> 
<script type="text/javascript">
(function($)	{
	function uiMaitainance($course1, $currentYear1, $dataStore1)	{
		if (! $course1.length) return;
		if (! $currentYear1.length) return;
		if (! $dataStore1.length) return;
		var option1 = $course1.find('option:selected');
		var $option1 = $(option1);
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		var currentYear = $dataStore1.attr('data-current-year');
		if (! currentYear) { currentYear = 0; }
		currentYear = parseInt(currentYear);
		//Now you need to wipe currentYear1 control 
		$currentYear1.empty();
		$('<option/>').attr('value', '_@32767@_')
			.html('--select--')
			.appendTo($currentYear1);
		for (var i = 1; i <= duration; i++)	{
			var $option1 = $('<option/>').attr('value', i)
				.html(i);
			if (i == currentYear)	$option1.prop("selected", true);
			$option1.appendTo($currentYear1);
		}
	}
	uiMaitainance($('#courseId'), $('#year'), $('#dataStore'));
	$('#courseId').on('change', function(event)	{
		uiMaitainance($(this), $('#year'), $('#dataStore'));
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<!--Tabbed Pane Ends-->
			</div>
			<div class="ui-sys-panel-footer"><a href="<?= $thispage ?>?page=managestudent">Bact to Student</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managestudent_extradetail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$student1->loadXMLFolder("../data/students");
			$ulogin1 = $student1->getLogin();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Student Details Card</div>
			<div class="ui-sys-panel-body">
				<div>
		<div class="ui-sys-content-window-scrollable">
			<div class="ui-sys-printable ui-sys-size-a4-potrait">
				<div class="ui-sys-printable-controls">
					<a><img title="Print" alt="P" src="../sysimage/print.png"/></a>
				</div>
<!--Beginning of Display Container-->
<?php 
	$profile1->setExtraFilter("../data/profile/logo/".$profile1->getLogo());
	$student1->setExtraFilter("../data/students/photo/".$student1->getLogin()->getPhoto());
	include("../documentreader/student.php");
?>
<!--End of Display Container-->			
			</div>
		</div>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else  if ($page == "managestudent_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managestudent_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $_REQUEST['id'], $conn);
			$ulogin1 = $student1->getLogin();
			$photoname = "default.png";
			if (! is_null($ulogin1->getSex()))	{
				if (strtolower($ulogin1->getSex()->getSexName()) == "male") $photoname="default_male.png";
				else if (strtolower($ulogin1->getSex()->getSexName()) == "female") $photoname="default_female.png";
			}
			if (! is_null($ulogin1->getPhoto())) $photoname = $ulogin1->getPhoto();
			$ulogin1->setExtraFilter("../data/students/photo/".$photoname);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $ulogin1->getFullname() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td colspan="2">
							<div class="ui-sys-user-photo-detail"><img alt="PDET" src="<?= $ulogin1->getExtraFilter() ?>"/></div>
						</td>
					</tr>
					<tr>
						<td>Firstname</td>
						<td><?= $ulogin1->getFirstname() ?></td>
					</tr>
					<tr>
						<td>Middlename</td>
						<td><?= $ulogin1->getMiddlename() ?></td>
					</tr>
					<tr>
						<td>Lastname</td>
						<td><?= $ulogin1->getLastname() ?></td>
					</tr>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
					<tr>
						<td>Status</td>
						<td><?= $ulogin1->getUserStatus()->getStatusName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getDOB()))	{
?>
					<tr>
						<td>Date of Birth</td>
						<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB()) ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getSex()))	{
?>
					<tr>
						<td>Sex</td>
						<td><?= $ulogin1->getSex()->getSexName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getMarital()))	{
?>
					<tr>
						<td>Marital</td>
						<td><?= $ulogin1->getMarital()->getMaritalName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getUserType()))	{
?>
					<tr>
						<td>Type of User</td>
						<td><?= $ulogin1->getUserType()->getTypeName() ?></td>
					</tr>
<?php		
	}
	$rootStudentText = "Normal User";
	if ($ulogin1->isRoot()) $rootStudentText = "System User";
?>
					<tr>
						<td colspan="2">This is a <b><i><?= $rootStudentText ?></i></b></td>
					</tr>
					<tr>
						<td>Email</td>
						<td><?= $ulogin1->getEmail() ?></td>
					</tr>
					<tr>
						<td>Studentname </td>
						<td><?= $ulogin1->getLoginName() ?></td>
					</tr>
					<tr>
						<td>Phone</td>
						<td><?= $ulogin1->getPhone() ?></td>
					</tr>
<?php 
	if (! is_null($ulogin1->getJobTitle()))	{
?>
					<tr>
						<td>Job Title</td>
						<td><?= $ulogin1->getJobTitle()->getJobName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getGroup()))	{
?>
					<tr>
						<td>Group</td>
						<td><?= $ulogin1->getGroup()->getGroupName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getTheme()))	{
?>
					<tr>
						<td>Student Theme</td>
						<td><?= $ulogin1->getTheme()->getThemeName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getFirstDayOfAWeek()))	{
?>
					<tr>
						<td>First Day of a Week</td>
						<td><?= $ulogin1->getFirstDayOfAWeek()->getDayName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getAdmissionTime()))	{
?>
					<tr>
						<td>Time of Admission </td>
						<td><?= $ulogin1->getAdmissionTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getLastLoginTime()))	{
?>
					<tr>
						<td>Time of Last Login </td>
						<td><?= $ulogin1->getLastLoginTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
	$graduationText = null;
	if ($student1->isFinalYear()) $graduationText = "This is a Finalist Student";
	if ($student1->isAlreadyGraduated()) $graduationText = "This student has Already Graduated";
	if (! is_null($graduationText))	{
?>
		<tr>
			<td colspan="2"><?= $graduationText ?></td>
		</tr>
<?php
	}
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $ulogin1->getExtraInformation() ?><br/><?= $student1->getExtraInformation() ?></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if ($student1->isInCurrentAccademicYear($profile1) && $student1->isInCurrentSemester($profile1) && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managewireless", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Wireless Connection for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managewireless&id=<?= $ulogin1->getLoginId() ?>&type=student&userid=<?= $student1->getStudentId() ?>"><img alt="DAT" src="../sysimage/buttonwireless.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managefeepayment_detail", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Payment History for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managefeepayment_detail&id=<?= $student1->getStudentId() ?>"><img alt="DAT" src="../sysimage/buttonmoney.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managelogin_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Password Change for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managelogin_edit&id=<?= $ulogin1->getLoginId() ?>&password_token=true"><img alt="DAT" src="../sysimage/buttonpassword.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && $ulogin1->isAdmitted() && ! $profile1->isAdmissionClosed() && Authorize::isAllowable($config, "managestudent_admit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Revoke Admission for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managestudent_revoke&revoke_admission=true&id=<?= $ulogin1->getLoginId() ?>&student_id=<?= $student1->getStudentId() ?>"><img alt="DAT" src="../sysimage/buttonrevoke.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && ! $ulogin1->isAdmitted() && $student1->isCompleted() && ! $profile1->isAdmissionClosed() && Authorize::isAllowable($config, "managestudent_admit", "normal", "donotsetlog", "-1", "-1") && ApprovalSequenceData::isApprovalComplete($config, $ulogin1->getLoginId(), ApprovalSequenceSchema::$__ADMIT_STUDENTS, $exprA108Name, $msgA108Name, "../server/createnewapprovalsequence.php", null))	{
		$_SESSION['admit_student_login_id'] = $ulogin1->getLoginId();
?>
		<a title="Admit <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managestudent_admit&id=<?= $student1->getStudentId() ?>"><img alt="DAT" src="../sysimage/buttonadmit.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && $ulogin1->isAdmitted() && Authorize::isAllowable($config, "managestudent_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managestudent_edit&id=<?= $student1->getStudentId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall", "normal", "donsetlog", "-1", "-1"))	{
?>
		<a title="Set System Firewall for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttonfirewall.png"/></a>
<?php	
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="View Authorization Graph for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall_graph&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttongraph.png"/></a>
<?php	
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managestudent">Back to Student Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managestudent" && Authorize::isAllowable($config, "managestudent", "normal", "setlog", "-1", "-1"))	{
		//Saving Authorization rules
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managestudent_detail", "normal", "donotsetlog", "-1", "-1");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Students Management</div>
			<div class="ui-sys-panel-body">
<!--This is a beginning of serch query -->
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
?>
	<!--Block ONE Begin -->
		<div class="ui-sys-query-container" style="position: relative; padding-bottom: 10px; border-bottom: 2px dotted blue; margin-bottom: 10px;">
			<form id="form1" class="pure-form pure-form-stacked" method="POST" action="<?= $thispage ?>" style="font-size: 0.8em;">
				<input type="hidden" id="dataStore" value="0" data-current-year="0"/>
				<input type="hidden" name="page" value="managestudent"/>
				<input type="hidden" name="searchquery" value="rndx"/>
				<fieldset class="ui-sys-data-capture">
					<legend>Student Search</legend>
					<div class="pure-g">
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="firstname">First Name</label>
							<input type="text" id="firstname" name="firstname" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="First Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="middlename">Middle Name</label>
							<input type="text" id="middlename" name="middlename" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Middle Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="lastname">Last Name</label>
							<input type="text" id="lastname" name="lastname" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Last Name : <?= $msgA32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="registrationNumber">Registration Number</label>
							<input type="text" id="registrationNumber" name="registrationNumber" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprRegistrationNumber ?>" validate_message="Registration Number : <?= $msgRegistrationNumber ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="email">Email Address</label>
							<input type="text" id="email" name="email" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprEmail ?>%<?= $exprL32Name ?>" validate_message="Email Format: <?= $msgEmail ?>%Email Length: <?= $msgL32Name ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-3">
							<label for="phone">Phone Number</label>
							<input type="text" id="phone" name="phone" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprPhone ?>" validate_message="Phone : <?= $msgPhone ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="examinationNumber">Examination Number</label>
							<input type="text" id="examinationNumber" name="examinationNumber" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprRegistrationNumber ?>" validate_message="Examination Number : <?= $msgRegistrationNumber ?>"/>
						</div>
<?php 
	$list = UserStatus::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="statusId">Status</label>
							<select class="pure-input-1-2" id="statusId" name="statusId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = Course::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="courseId">Course</label>
							<select class="pure-input-1-2" id="courseId" name="courseId">
								<option value="" data-course-duration="0">--select--</option>
<?php 
	foreach ($list as $alist)	{
		$course1 = null;
		try {
			$course1 = new Course($database, $alist['id'], $conn);
		} catch (Exception $e)	{
			continue;
		}
?>
		<option value="<?= $course1->getCourseId() ?>" data-course-duration="<?= $course1->getDuration() ?>"><?= $course1->getCourseName() ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="year">Current Year</label>
							<select class="pure-input-1-2" id="year" name="currentYear">
								<option value="">--select--</option> 
							</select>
						</div>
<?php 
	$numberOfSemesters = intval($profile1->getNumberOfSemestersPerYear());
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="semester">Current Semester</label>
							<select class="pure-input-1-2" id="semester" name="currentSemester">
								<option value="">--select--</option>
<?php 
	for ($i=1; $i <= $numberOfSemesters; $i++)	{
?>
		<option value="<?= $i ?>"><?= $i ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = Sex::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="sexId">Sex</label>
							<select class="pure-input-1-2" id="sexId" name="sexId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = Marital::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="maritalId">Marital Status</label>
							<select class="pure-input-1-2" id="maritalId" name="maritalId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = Country::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="countryId">Country</label>
							<select class="pure-input-1-2" id="countryId" name="countryId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = Group::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="groupId">Group</label>
							<select class="pure-input-1-2" id="groupId" name="groupId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
<?php 
	$list = JobTitle::loadAllData($database, $conn);
?>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="jobId">Job Title</label>
							<select class="pure-input-1-2" id="jobId" name="jobId">
								<option value="">--select--</option>
<?php 
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="employed">Employed</label>
							<select class="pure-input-1-2" id="employed" name="employed">
								<option value="">--select--</option>
								<option value="1">Employed</option>
								<option value="0">Non Employed</option>
							</select>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="dob">Date of Birth</label>
							<input title="Example: 2010:09:23:03:15:32" type="text" id="dob" name="dob" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprSystemTime ?>" validate_message="Date of Birth : <?= $msgSystemTime ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="registrationTime">Registration Time</label>
							<input title="Example: 2010:09:23:03:15:32" type="text" id="registrationTime" name="registrationTime" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprSystemTime ?>" validate_message="Registration Time : <?= $msgSystemTime ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-4">
							<label for="admissionTime">Admission Time</label>
							<input title="Example: 2010:09:23:03:15:32" type="text" id="admissionTime" name="admissionTime" class="pure-u-23-24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprSystemTime ?>" validate_message="Admission Time : <?= $msgSystemTime ?>"/>
						</div>
						<div class="pure-u-1 pure-u-md-1-5">
							<label for="isAdmitted">Is Admitted</label>
							<input type="checkbox" id="isAdmitted" name="isAdmitted" value="1"/>
						</div>
					</div>
					<div class="ui-sys-error-message" id="perror"></div>
				</fieldset>
			</form>
			<div class="ui-sys-inline-controls-right" style="font-size: 1.3em;">
				<input id="__add_record" type="button" value="Fetch Results"/>
			</div>
		</div>
	<!--Block ONE Ends-->
	<!--Block TWO Begin-->
	<!--Block TWO Ends-->
<?php 
	mysql_close($conn); 
?>
	
<!--This is the end of search query -->
<script type="text/javascript">
(function($)	{
	function uiMaitainance($course1, $currentYear1, $dataStore1)	{
		if (! $course1.length) return;
		if (! $currentYear1.length) return;
		if (! $dataStore1.length) return;
		var option1 = $course1.find('option:selected');
		var $option1 = $(option1);
		if (! $option1.length) return;
		var duration = $option1.attr('data-course-duration');
		if (! duration) return;
		duration = parseInt(duration);
		var currentYear = $dataStore1.attr('data-current-year');
		if (! currentYear) { currentYear = 0; }
		currentYear = parseInt(currentYear);
		//Now you need to wipe currentYear1 control 
		$currentYear1.empty();
		$('<option/>').attr('value', '')
			.html('--select--')
			.appendTo($currentYear1);
		for (var i = 1; i <= duration; i++)	{
			var $option1 = $('<option/>').attr('value', i)
				.html(i);
			if (i == currentYear)	$option1.prop("selected", true);
			$option1.appendTo($currentYear1);
		}
	}
	uiMaitainance($('#courseId'), $('#year'), $('#dataStore'));
	$('#courseId').on('change', function(event)	{
		uiMaitainance($(this), $('#year'), $('#dataStore'));
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-user-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managestudent" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchquery']))	{
		//Building Query 
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$collection1 = new Collection();
		if (trim($_REQUEST['firstname']) != "")	{ $firstname = mysql_real_escape_string($_REQUEST['firstname']); $collection1->addItem("login.firstname='$firstname'"); }
		if (trim($_REQUEST['middlename']) != "")	{ $middlename = mysql_real_escape_string($_REQUEST['middlename']); $collection1->addItem("login.middlename='$middlename'"); }
		if (trim($_REQUEST['lastname']) != "")	{ $lastname = mysql_real_escape_string($_REQUEST['lastname']); $collection1->addItem("login.lastname='$lastname'"); }
		if (trim($_REQUEST['registrationNumber']) != "")	{ $registrationNumber = mysql_real_escape_string($_REQUEST['registrationNumber']); $collection1->addItem("students.registrationNumber='$registrationNumber'"); }
		if (trim($_REQUEST['examinationNumber']) != "")	{ $examinationNumber = mysql_real_escape_string($_REQUEST['examinationNumber']); $collection1->addItem("students.examinationNumber='$examinationNumber'"); }
		if (trim($_REQUEST['email']) != "")	{ $email = mysql_real_escape_string($_REQUEST['email']); $collection1->addItem("login.email='$email'"); }
		if (trim($_REQUEST['phone']) != "")	{ $phone = mysql_real_escape_string($_REQUEST['phone']); $collection1->addItem("login.phone='$phone'"); }
		if (trim($_REQUEST['statusId']) != "")	{ $statusId = mysql_real_escape_string($_REQUEST['statusId']); $collection1->addItem("login.statusId='$statusId'"); }
		if (trim($_REQUEST['courseId']) != "")	{ $courseId = mysql_real_escape_string($_REQUEST['courseId']); $collection1->addItem("students.courseId='$courseId'"); }
		if (trim($_REQUEST['currentYear']) != "")	{ $currentYear = mysql_real_escape_string($_REQUEST['currentYear']); $collection1->addItem("students.cyear='$currentYear'"); }
		if (trim($_REQUEST['currentSemester']) != "")	{ $currentSemester = mysql_real_escape_string($_REQUEST['currentSemester']); $collection1->addItem("students.csemester='$currentSemester'"); }
		if (trim($_REQUEST['sexId']) != "")	{ $sexId = mysql_real_escape_string($_REQUEST['sexId']); $collection1->addItem("login.sexId='$sexId'"); }
		if (trim($_REQUEST['maritalId']) != "")	{ $maritalId = mysql_real_escape_string($_REQUEST['maritalId']); $collection1->addItem("login.maritalId='$maritalId'"); }
		if (trim($_REQUEST['countryId']) != "")	{ $countryId = mysql_real_escape_string($_REQUEST['countryId']); $collection1->addItem("students.citizenshipId='$countryId'"); }
		if (trim($_REQUEST['jobId']) != "")	{ $jobId = mysql_real_escape_string($_REQUEST['jobId']); $collection1->addItem("login.jobId='$jobId'"); }
		if (trim($_REQUEST['groupId']) != "")	{ $groupId = mysql_real_escape_string($_REQUEST['groupId']); $collection1->addItem("login.groupId='$groupId'"); }
		if (trim($_REQUEST['employed']) != "")	{ $employed = mysql_real_escape_string($_REQUEST['employed']); $collection1->addItem("students.employed='$employed'"); }
		if (trim($_REQUEST['dob']) != "")	{ $dob = mysql_real_escape_string($_REQUEST['dob']); $collection1->addItem("login.dob='$dob'"); }
		if (trim($_REQUEST['registrationTime']) != "")	{ $registrationTime = mysql_real_escape_string($_REQUEST['registrationTime']); $collection1->addItem("students.registrationTime='$registrationTime'"); }
		if (trim($_REQUEST['admissionTime']) != "")	{ $admissionTime = mysql_real_escape_string($_REQUEST['admissionTime']); $collection1->addItem("login.admissionTime='$admissionTime'"); }
		if (isset($_REQUEST['isAdmitted'])) { $bitValue = pow(2, Login::$__IS_ADMITTED); $collection1->addItem("((login.flags & '$bitValue') = '$bitValue')"); }
		$query = "SELECT students.studentId FROM students, login WHERE students.loginId=login.loginId";
		$collectionList = $collection1->getCollection();
		if (sizeof($collectionList) > 0)	{
			foreach ($collectionList as $item)	{
				$query .= " AND ".$item;
			}
		} //gt than zero
?>
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name</th>
				<th>Status</th>
				<th>Sex</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Admission<br/>Status</th>
				<th></th>
				<th></th>
			</tr>
		</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch user data from the storage ".mysql_error());
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $id, $conn);
			$ulogin1 = $student1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		if (true)	{ //Just for compliance only
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $ulogin1->getFullname() ?></td>
				<td>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
		<?= $ulogin1->getUserStatus()->getStatusName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($ulogin1->getSex()))	{
?>
		<?= $ulogin1->getSex()->getSexName() ?>
<?php
	}
?>				
				</td>
				<td><?= $ulogin1->getEmail() ?></td>
				<td><?= $ulogin1->getPhone() ?></td>
				<td>
<?php 
	$style="background-color: red; color: white; font-weight: bold;";
	$admissionText = "Not Admitted";
	$symbol="X";
	if ($ulogin1->isAdmitted())	{
		$style="background-color: blue; color: white; font-weight: bold;";
		$admissionText = "Admitted";
		$symbol = "A";
		if ($student1->isAlreadyGraduated())	{
			$style="background-color: black; color: white; font-weight: bold;";
			$admissionText = "Graduated";
			$symbol = "G";
		} else if (! $student1->isInCurrentAccademicYear($profile1))	{
			//Only Non Graduate
			$style="background-color: gold; color: black; font-weight: bold;";
			$admissionText = "Not Registered";
			$symbol = "NR";
		} else if (! $student1->isInCurrentSemester($profile1))	{
			//Only Non Graduate
			$style="background-color: gold; color: black; font-weight: bold;";
			$admissionText = "Not Registered";
			$symbol = "NSR";
		}
	}
?>				
					<span style="<?= $style ?>">&nbsp;&nbsp;&nbsp;<?= $symbol ?>&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $admissionText ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a title="Detail Summary" href="<?= $thispage ?>?page=managestudent_detail&id=<?= $student1->getStudentId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a target="_blank" title="Detail for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managestudent_extradetail&id=<?= $student1->getStudentId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/extradetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<?php
		mysql_close($conn);
	} else if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name</th>
				<th>Status</th>
				<th>Sex</th>
				<th>Email</th>
				<th>Phone</th>
				<th>Admission<br/>Status</th>
				<th></th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Student::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch user data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$student1 = null;
		$ulogin1 = null;
		try {
			$student1 = new Student($database, $id, $conn);
			$ulogin1 = $student1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($student1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $ulogin1->getFullname() ?></td>
				<td>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
		<?= $ulogin1->getUserStatus()->getStatusName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($ulogin1->getSex()))	{
?>
		<?= $ulogin1->getSex()->getSexName() ?>
<?php
	}
?>				
				</td>
				<td><?= $ulogin1->getEmail() ?></td>
				<td><?= $ulogin1->getPhone() ?></td>
				<td>
<?php 
	$style="background-color: red; color: white; font-weight: bold;";
	$admissionText = "Not Admitted";
	$symbol="X";
	if ($ulogin1->isAdmitted())	{
		$style="background-color: blue; color: white; font-weight: bold;";
		$admissionText = "Admitted";
		$symbol = "A";
		if ($student1->isAlreadyGraduated())	{
			$style="background-color: black; color: white; font-weight: bold;";
			$admissionText = "Graduated";
			$symbol = "G";
		} else if (! $student1->isInCurrentAccademicYear($profile1))	{
			//Only Non Graduate 
			$style="background-color: gold; color: black; font-weight: bold;";
			$admissionText = "Not Registered";
			$symbol = "NR";
		} else if (! $student1->isInCurrentSemester($profile1))	{
			//Only Non Graduate
			$style="background-color: gold; color: black; font-weight: bold;";
			$admissionText = "Not Registered";
			$symbol = "NSR";
		}
	}
?>				
					<span style="<?= $style ?>">&nbsp;&nbsp;&nbsp;<?= $symbol ?>&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $admissionText ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a title="Detail Summary" href="<?= $thispage ?>?page=managestudent_detail&id=<?= $student1->getStudentId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a target="_blank" title="Detail for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managestudent_extradetail&id=<?= $student1->getStudentId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/extradetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managestudent_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managestudent_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Student End*/ else/*Examination BEGIN*/if ($page == "manageexamination_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageexamination_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a></div>
		</div>
<?php
	} else if ($page == "manageexamination_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageexamination_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Examination::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Examination[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$examination1 = null;
			try	{
				$examination1 = new Examination($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($examination1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageexamination_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageexamination_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexamination_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageexamination_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageexamination_csv" && Authorize::isAllowable($config, "manageexamination_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageexamination_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Examination::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageexamination_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageexamination_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$examination1 = null;
		try {
			 $examination1 = new Examination($database, $_REQUEST['id'], $conn);
			 if ($examination1->getGroup()->isGroupClosed())	Object::shootException("You are trying to delete an Examination which belongs to a closed Group");
			 $examination1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Examination which is no longer existing in the system or a None Empty Record or Belong to a Closed Group");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Examination <?= $examination1->getExaminationName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Examination <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexamination_delete", "Deleted ".$examination1->getExaminationName());
	} else if ($page == "manageexamination_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexamination_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$examination1 = null;
		try {
			$examination1 = new Examination($database, $_REQUEST['id'], $conn);
			$examination1->setExtraFilter(System::getCodeString(8));
			$examination1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Examination <b><?= $examination1->getExaminationName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Examination <?= $examination1->getExaminationName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageexamination_delete&report=io&id=<?= $examination1->getExaminationId() ?>&rndx=<?= $examination1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageexamination">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageexamination_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$examination1 = null;
		try {
			$examination1 = new Examination($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$specialUpdate = true;
		$enableUpdate = false;
		$examinationName = mysql_real_escape_string($_REQUEST['examinationName']);
		$examinationCode = mysql_real_escape_string($_REQUEST['examinationCode']);
		$examinationWeight = mysql_real_escape_string($_REQUEST['examinationWeight']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$minimumScorePercentage = mysql_real_escape_string($_REQUEST['minimumScorePercentage']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		//From System
		$primary = "1";
		$supplimentary = "0";
		if (isset($_REQUEST['primary']))	{
			$primary = "1";
			$supplimentary = "0";
			$sequenceNumber = "0";
		} else {
			$primary = "0";
			if (isset($_REQUEST['supplimentary']))	{
				$supplimentary = "1";
				$sequenceNumber = "1";
				$semester = 0; //Supplimentary Examination does not belong to any semester
			} else {
				$specialUpdate = false;
				$promise1->setReason("The Examination Can NOT Be Both a Non Primary as well as a Non Supplimentary");
				$promise1->setPromise(false);
			}
			
		}//--primary is set
		if ($examinationName != $examination1->getExaminationName())	{
			$examination1->setExaminationName($examinationName); $enableUpdate = true;
		}
		if ($examinationCode != $examination1->getExaminationCode())	{
			$examination1->setExaminationCode($examinationCode); $enableUpdate = true;
		}
		if ($examinationWeight != $examination1->getExaminationWeight())	{
			$examination1->setExaminationWeight($examinationWeight); $enableUpdate = true;
		}
		if (is_null($examination1->getGroup()) || ($examination1->getGroup()->getGroupId() != $groupId))	{
			$examination1->setGroup($groupId); $enableUpdate = true;
		}
		if (intval($semester) != intval($examination1->getSemester()))	{
			$examination1->setSemester($semester); $enableUpdate = true;
		}
		if ((intval($primary) == 1) xor $examination1->isPrimary())	{
			$examination1->setPrimary($primary); $enableUpdate = true;
		}
		if ((intval($supplimentary) == 1) xor $examination1->isSupplimentary())	{
			$examination1->setSupplimentary($supplimentary); $enableUpdate = true;
		}
		if ($minimumScorePercentage != $examination1->getMinimumScorePercentage())	{
			$examination1->setMinimumScorePercentage($minimumScorePercentage); $enableUpdate = true;
		}
		if ($extraInformation != $examination1->getExtraInformation())	{
			$examination1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $examination1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$examination1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate && $specialUpdate)	{
			try {
				if (! ExaminationGroup::isSemesterValidToAGroup($database, $conn, $groupId, $semester)) Object::shootException("Examination Belongs to Semester which is not defined within a Group");
				$examination1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} else {
			$enableUpdate = false; //To Handle the specialUpdate too
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Examination <?= $examination1->getExaminationName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the examination <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexamination_edit", "Edited ".$examination1->getExaminationName());
	} else if ($page == "manageexamination_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexamination_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$examination1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$examination1 = new Examination($database, $_REQUEST['id'], $conn);
			$examination1->setExtraFilter($extraFilter);
			$examination1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Examination <?= $examination1->getExaminationName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexamination_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $examination1->getExaminationId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $examination1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="examinationName">Examination Name </label>
						<input value="<?= $examination1->getExaminationName() ?>" type="text" name="examinationName" id="examinationName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Examination Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="examinationCode">Examination Code </label>
						<input value="<?= $examination1->getExaminationCode() ?>" type="text" name="examinationCode" id="examinationCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Examination Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="This feature operates on a ratio, All Examinations in a group which have a sequence Number of Zero OR in other words which are not supplimentary or carry over will be taken into account" for="examinationWeight">Examination Weight </label>
						<input value="<?= $examination1->getExaminationWeight() ?>" class="text-can-not-be-zero" type="text" name="examinationWeight" id="examinationWeight" size="16" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Examination Weight : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Examination Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Examination Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ExaminationGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($examination1->getGroup()) && ($examination1->getGroup()->getGroupId() == $alist1['id'])) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester">Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Semester for this Examination">
							<option value="_@32767@_">--select--</option>
<?php 
	$totalNumberOfSemestersPerYear = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $totalNumberOfSemestersPerYear; $i++)	{
		$selected = "";
		if ($i == $examination1->getSemester()) $selected="selected";
?>
			<option <?= $selected ?> value="<?=  $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	//Defaults 
	$chkPrimary = "";
	$chkSupplimentary = "";
	$nonPrimaryControlsDisabled = "";
	if ($examination1->isPrimary())	{
		$chkPrimary = "checked";
		$nonPrimaryControlsDisabled = "disabled";
	}
	if ($examination1->isSupplimentary() && ! $examination1->isPrimary())	{
		$chkSupplimentary = "checked";
	}
?>
					<div class="pure-controls">
						<label><input <?= $chkPrimary ?> type="checkbox" id="chkPrimary" name="primary" value="1"/>&nbsp;&nbsp; Is Primary Examination?</label>
					</div>
					<div class="pure-controls">
						<label><input <?= $chkSupplimentary ?> <?= $nonPrimaryControlsDisabled ?> class="non-primary-controls" type="checkbox" id="chkSupplimentary" name="supplimentary" value="1"/>&nbsp;&nbsp; Is Supplimentary Examination?</label>
					</div>
					<div class="pure-control-group">
						<label for="minimumScorePercentage">Minimum Score (in %) </label>
						<input value="<?= $examination1->getMinimumScorePercentage() ?>" type="text" name="minimumScorePercentage" id="minimumScorePercentage" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Minimum Score (%) : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $examination1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#chkPrimary').on('change', function(event)	{
		event.preventDefault();
		$('.non-primary-controls').prop('disabled', $(this).prop('checked'));
		//Stricly make sure supplimentary is checked if Primary Not Checked 
		$('#chkSupplimentary').prop('checked', ! $(this).prop('checked'));
	});
	$('#chkSupplimentary').on('change', function(event)	{
		event.preventDefault();
		$(this).prop('checked', true);
	});
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Examination Weight Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexamination_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$examination1 = null;
		try {
			$examination1 = new Examination($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $examination1->getExaminationName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Examination Name</td>
						<td><?= $examination1->getExaminationName() ?></td>
					</tr>
					<tr>
						<td>Examination Code</td>
						<td><?= $examination1->getExaminationCode() ?></td>
					</tr>
					<tr>
						<td>Examination Weight (In A Group)</td>
						<td>
<?php 
	$weight = "NAN";
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	try {
		$weight = Examination::percentageWeightInAGroup($database, $conn, $examination1);
	} catch (Exception $e)	{
		$weight = "###";
	}
	mysql_close($conn);
	echo $weight;
?>							
						</td>
					</tr>
					<tr>
						<td>Examination Weight (In A Semester)</td>
						<td>
<?php 
	$weight = "NAN";
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	try {
		$weight = Examination::percentageWeightInAGroupInASemester($database, $conn, $examination1);
	} catch (Exception $e)	{
		$weight = "###";
	}
	mysql_close($conn);
	echo $weight;
?>							
						</td>
					</tr>
<?php 
	if (! is_null($examination1->getGroup()))	{
?>
		<tr>
			<td>Examination Group</td>
			<td><?= $examination1->getGroup()->getGroupName() ?></td>
		</tr>
<?php
	}
	$primaryText = "NOT a Primary Examination";
	if ($examination1->isPrimary())	$primaryText = "a Primary Examination";
?>
	<tr>
		<td colspan="2">This is <?= $primaryText ?></td>
	</tr>
<?php
	$supplimentaryText = "NOT a Supplimentary Examination";
	if ($examination1->isSupplimentary() && ! $examination1->isPrimary()) $supplimentaryText = "a Supplimentary Examination";
?>
	<tr>
		<td colspan="2">This is <?= $supplimentaryText ?></td>
	</tr>
	<tr>
		<td>Examination for Semester</td>
		<td><?= $examination1->getSemester() ?></td>
	</tr>
	<tr>
		<td>Minimum Score </td>
		<td><?= $examination1->getMinimumScorePercentage() ?>%</td>
	</tr>
<?php
	if (! is_null($examination1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $examination1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageexamination_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $examination1->getExaminationName() ?>" href="<?= $thispage ?>?page=manageexamination_edit&id=<?= $examination1->getExaminationId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageexamination_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $examination1->getExaminationName() ?>" href="<?= $thispage ?>?page=manageexamination_delete&id=<?= $examination1->getExaminationId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageexamination_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageexamination_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$examinationName = mysql_real_escape_string($_REQUEST['examinationName']);
		$examinationCode = mysql_real_escape_string($_REQUEST['examinationCode']);
		$examinationWeight = mysql_real_escape_string($_REQUEST['examinationWeight']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$minimumScorePercentage = mysql_real_escape_string($_REQUEST['minimumScorePercentage']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $examinationName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO examination (examinationName, examinationCode, examinationWeight, groupId, semester, minimumScorePercentage, extraFilter, extraInformation) VALUES('$examinationName', '$examinationCode', '$examinationWeight', '$groupId', '$semester', '$minimumScorePercentage', '$extraFilter', '$extraInformation')";
	try {
		if (! ExaminationGroup::isSemesterValidToAGroup($database, $conn, $groupId, $semester)) Object::shootException("Examination Belongs to Semester which is not defined within a Group");
		 mysql_db_query($database, $query, $conn) or Object::shootException("Examination[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Examination <?= $examinationName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the examination<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Examination";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexamination_add", "Added $examinationName");
	} else if ($page == "manageexamination_add" && Authorize::isAllowable($config, "manageexamination_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Examination</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexamination_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="examinationName">Examination Name </label>
						<input type="text" name="examinationName" id="examinationName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Examination Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="examinationCode">Examination Code </label>
						<input type="text" name="examinationCode" id="examinationCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Examination Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="This feature operates on a ratio, All Examinations in a group which have a sequence Number of Zero OR in other words which are not supplimentary or carry over will be taken into account" for="examinationWeight">Examination Weight </label>
						<input class="text-can-not-be-zero" type="text" name="examinationWeight" id="examinationWeight" size="16" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Examination Weight : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Examination Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Examination Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = ExaminationGroup::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester">Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Semester for this Examination">
							<option value="_@32767@_">--select--</option>
<?php 
	$totalNumberOfSemestersPerYear = intval($profile1->getNumberOfSemestersPerYear());
	for ($i = 1; $i <= $totalNumberOfSemestersPerYear; $i++)	{
?>
			<option value="<?=  $i ?>"><?= $i ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="minimumScorePercentage">Minimum Score (in %) </label>
						<input type="text" name="minimumScorePercentage" id="minimumScorePercentage" size="8" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Minimum Score (%) : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexamination">Back to Examination Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Examination Weight Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageexamination" && Authorize::isAllowable($config, "manageexamination", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examinations Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-examination-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageexamination" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageexamination_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Examination <br/>Name</th>
				<th>Examination <br/>Code</th>
				<th>Examination <br/>Weight (Group)</th>
				<th>Semester<br/>Weight</th>
				<th>Group</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Examination::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch examination data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$examination1 = null;
		try {
			$examination1 = new Examination($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($examination1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $examination1->getExaminationName() ?></td>
				<td><?= $examination1->getExaminationCode() ?></td>
				<td>
<?php 
	$weight = "NAN";
	try {
		$weight = Examination::percentageWeightInAGroup($database, $conn, $examination1);
	} catch (Exception $e)	{
		$weight = "###";
	}
	echo $weight;
?>				
				</td>
				<td>
<?php 
	$weight = "NAN";
	try {
		$weight = Examination::percentageWeightInAGroupInASemester($database, $conn, $examination1);
	} catch (Exception $e)	{
		$weight = "###";
	}
	echo $weight;
?>				
				</td>
				<td>
<?php 
	if (! is_null($examination1->getGroup()))	{
		echo $examination1->getGroup()->getGroupName();
	}
?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageexamination_detail&id=<?= $examination1->getExaminationId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageexamination_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageexamination_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageexamination_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Examination" href="<?= $thispage ?>?page=manageexamination_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Examination End*/ else/*ExaminationGroup BEGIN*/if ($page == "manageexaminationgroup_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageexaminationgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a></div>
		</div>
<?php
	} else if ($page == "manageexaminationgroup_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageexaminationgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = ExaminationGroup::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("ExaminationGroup[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$group1 = null;
			try	{
				$group1 = new ExaminationGroup($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($group1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageexaminationgroup_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexaminationgroup_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageexaminationgroup_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexaminationgroup_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageexaminationgroup_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageexaminationgroup_csv" && Authorize::isAllowable($config, "manageexaminationgroup_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageexaminationgroup_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, ExaminationGroup::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageexaminationgroup_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageexaminationgroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			 $group1 = new ExaminationGroup($database, $_REQUEST['id'], $conn);
			 $group1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a ExaminationGroup which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The ExaminationGroup <?= $group1->getGroupName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the ExaminationGroup <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexaminationgroup_delete", "Deleted ".$group1->getGroupName());
	} else if ($page == "manageexaminationgroup_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexaminationgroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$group1 = null;
		try {
			$group1 = new ExaminationGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a ExaminationGroup <b><?= $group1->getGroupName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the ExaminationGroup <?= $group1->getGroupName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageexaminationgroup_delete&report=io&id=<?= $group1->getGroupId() ?>&rndx=<?= $group1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageexaminationgroup">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageexaminationgroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageexaminationgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new ExaminationGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($groupName != $group1->getGroupName())	{
			$group1->setGroupName($groupName); $enableUpdate = true;
		}
		if (is_null($group1->getEducationLevel()) || ($levelId != $group1->getEducationLevel()->getLevelId()))	{
			$group1->setEducationLevel($levelId); $enableUpdate = true;
		}
		if ($semester != $group1->getSemester())	{
			$group1->setSemester($semester); $enableUpdate = true;
		}
		if ($extraInformation != $group1->getExtraInformation())	{
			$group1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$group1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				if (! $group1->isGroupInAValidState()) Object::shootException("Group might contain examination which does not match semesters with the Group");
				$group1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ExaminationGroup Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			ExaminationGroup <?= $group1->getGroupName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the group <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexaminationgroup_edit", "Edited ".$group1->getGroupName());
	} else if ($page == "manageexaminationgroup_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexaminationgroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$group1 = new ExaminationGroup($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter($extraFilter);
			$group1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit ExaminationGroup <?= $group1->getGroupName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexaminationgroup_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input value="<?= $group1->getGroupName() ?>" type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Group Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected= "";
		if (! is_null($group1->getEducationLevel()) && ($alist1['id'] == $group1->getEducationLevel()->getLevelId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester">Group for Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group Semester">
							<option value="_@32767@_">--select--</option>
<?php 
	$dsemester = intval($group1->getSemester());
	$selected = "";
	if ($dsemester == 0) $selected="selected";
?>							
							<option <?= $selected ?> value="0">All Semesters</option>
<?php 
	for ($semester = 1; $semester <= intval($profile1->getNumberOfSemestersPerYear()); $semester++)	{
		$selected = "";
		if ($semester == $dsemester) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $semester ?>">Semester <?= $semester ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $group1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageexaminationgroup_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageexaminationgroup_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new ExaminationGroup($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $group1->getGroupName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Group Name</td>
						<td><?= $group1->getGroupName() ?></td>
					</tr>
<?php 
	if (! is_null($group1->getEducationLevel()))	{
?>
					<tr>
						<td>Education Level</td>
						<td><?= $group1->getEducationLevel()->getLevelName() ?></td>
					</tr>
<?php 
	} 
	$semester = $group1->getSemester();
	$semesterText = "";
	if (intval($semester) == 0)	{
		$semesterText = "Group for All Semesters";
	} else {
		$semesterText = "Group for ".System::scriptNumberAdjustment($semester)." Semester";
	}
?>
					<tr>
						<td colspan="2"><?= $semesterText ?></td>
					</tr>
<?php
	if (! is_null($group1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $group1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageexaminationgroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=manageexaminationgroup_edit&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageexaminationgroup_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=manageexaminationgroup_delete&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageexaminationgroup_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageexaminationgroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $groupName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO examinationGroup (groupName, levelId, semester, extraFilter, extraInformation) VALUES('$groupName', '$levelId', '$semester', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("ExaminationGroup[Adding]: Could not Add a Record into the System ".mysql_error());
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Examination Group <?= $groupName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the group<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Examination Group";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageexaminationgroup_add", "Added $groupName");
	} else if ($page == "manageexaminationgroup_add" && Authorize::isAllowable($config, "manageexaminationgroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Examination Group</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageexaminationgroup_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Group Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="semester">Group for Semester </label>
						<select id="semester" name="semester" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group Semester">
							<option value="_@32767@_">--select--</option>
							<option value="0">All Semesters</option>
<?php 
	for ($semester = 1; $semester <= intval($profile1->getNumberOfSemestersPerYear()); $semester++)	{
?>
		<option value="<?= $semester ?>">Semester <?= $semester ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageexaminationgroup">Back to Examination Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageexaminationgroup" && Authorize::isAllowable($config, "manageexaminationgroup", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Examination Groups Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageexaminationgroup" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageexaminationgroup_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Group Name</th>
				<th>Education Level</th>
				<th>Semester</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = ExaminationGroup::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch group data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$group1 = null;
		try {
			$group1 = new ExaminationGroup($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($group1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $group1->getGroupName() ?></td>
				<td>
<?php 
	if (! is_null($group1->getEducationLevel()))	{
		echo $group1->getEducationLevel()->getLevelName();
	}
?>				
				</td>
				<td>
<?php 
	$semesterText = "All";
	if (intval($group1->getSemester()) != 0)	{
		$semesterText = System::scriptNumberAdjustment($group1->getSemester());
	}
	echo $semesterText;
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageexaminationgroup_detail&id=<?= $group1->getGroupId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageexaminationgroup_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageexaminationgroup_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageexaminationgroup_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System ExaminationGroup" href="<?= $thispage ?>?page=manageexaminationgroup_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*ExaminationGroup End*/ else/*ContextManager BEGIN*/ if ($page == "managecontextmanager" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managecontextmanager", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$action = $_REQUEST['report'];
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$isAllowedByDefault = false;
		$enableUpdate = false;
		$contextManagerCaptionText = "";
		if (intval($action) == 1)	{
			$contextManagerCaptionText = " ALLOWED (OPEN MODE)";
		} else if (intval($action) == 0)	{
			$contextManagerCaptionText = " DENIED (CLOSED MODE)";
		}
		try {
			$isAllowedByDefault = ContextManager::isSystemDefaultAllowed($database, $conn);
			if (! ((intval($action) == 1) xor $isAllowedByDefault)) Object::shootException("No Change has been applied to the system");
			ContextManager::setSystemDefaultAllowed($database, $conn, $action);
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Last Resort for Do Not Care</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div>
			Congratulations, you have updated the Last Resort Value for Do Not Care
		</div>
		<div>
<?php 
	if (intval($action) == 1)	{
?>
		<div class="ui-state-error">
			The System Now is in an OPEN Mode. This settings pose security problems. We are not encouraging you to leave the system under these settings, if you are in a production enviroment kindly set your system in a CLOSED (DENIED) Mode
		</div>
<?php
	} else if (intval($action) == 0)	{
?>
		<div class="ui-state-highlight">
			The System Now is in a CLOSED Mode. This is the most secured settings for your system, We strongly recommend to leave the system in this state
		</div>
<?php		
	}
?>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were some problems in updating the Last Resort Value for Do Not Care <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php 
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecontextmanager", "Changed to $contextManagerCaptionText");
	} else if ($page == "managecontextmanager" && Authorize::isAllowable($config, "managecontextmanager", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$isAllowedByDefault = false;
		$okayButtonClass = "button-link";
		$report = 1;
		try {
			$isAllowedByDefault = ContextManager::isSystemDefaultAllowed($database, $conn);
			if ($isAllowedByDefault)	{
				$okayButtonClass = "button-link-warning";
				$report = 0;
			}
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Last Resort for Do Not Care</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<form class="pure-form" method="POST" action="<?= $thispage ?>" id="form1">
			<input type="hidden" name="page" value="managecontextmanager"/>
			<input type="hidden" name="report" value="<?= $report ?>"/>
<?php 
	if ($isAllowedByDefault)	{
?>
		<div>
			<div>
				By Clicking the <b>DENY Button</b>, will cause all actions which are set to <b>DO NOT CARE</b> in all levels {users, Job Title and Groups} <b>will be DENIED</b> by default
			</div>
			<div class="ui-sys-right">
				<input type="submit" value="DENY (Default)"/>&nbsp;&nbsp;&nbsp;&nbsp;<a class="button-link" href="<?= $thispage ?>">Cancel</a>
			</div>
		</div>
<?php
	} else {
?>
		<div class="ui-sys-warning">
			<div>
				By Clicking the <b>ALLOW Button</b>, will cause all actions which are set to <b>DO NOT CARE</b> in all levels {users, Job Title and Groups} <b>will be ALLOWED</b> by default<br/>
				We strongly DO NOT RECOMMEND to leave the system in an ALLOW state by default. 
				<br/>Kindly think and plan careful, as this might impose security holes in the system
			</div>
			<div class="ui-sys-right">
				<input type="submit" value="ALLOW (Default)"/>&nbsp;&nbsp;&nbsp;&nbsp;<a class="button-link" href="<?= $thispage ?>">Cancel</a>
			</div>
		</div>
<?php
	} //--end-ifIsAllowedByDefault
?>
		</form>
<?php
	} else {
?>
		<div class="ui-state-error">
			The system has encoutered a problem <br/>
			Details : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php 
		mysql_close($conn);
	} /*ContextManager END*/ else /*ClassOfAward BEGIN*/if ($page == "manageclassofaward_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageclassofaward_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a></div>
		</div>
<?php
	} else if ($page == "manageclassofaward_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageclassofaward_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = ClassOfAward::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("ClassOfAward[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$award1 = null;
			try	{
				$award1 = new ClassOfAward($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($award1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageclassofaward_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageclassofaward_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageclassofaward_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageclassofaward_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageclassofaward_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageclassofaward_csv" && Authorize::isAllowable($config, "manageclassofaward_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageclassofaward_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, ClassOfAward::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageclassofaward_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageclassofaward_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$award1 = null;
		try {
			 $award1 = new ClassOfAward($database, $_REQUEST['id'], $conn);
			 $award1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a ClassOfAward which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The ClassOfAward <?= $award1->getAwardName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the ClassOfAward <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageclassofaward_delete", "Deleted ".$award1->getAwardName());
	} else if ($page == "manageclassofaward_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageclassofaward_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$award1 = null;
		try {
			$award1 = new ClassOfAward($database, $_REQUEST['id'], $conn);
			$award1->setExtraFilter(System::getCodeString(8));
			$award1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a ClassOfAward <b><?= $award1->getAwardName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the ClassOfAward <?= $award1->getAwardName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageclassofaward_delete&report=io&id=<?= $award1->getAwardId() ?>&rndx=<?= $award1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageclassofaward">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageclassofaward_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageclassofaward_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$award1 = null;
		try {
			$award1 = new ClassOfAward($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$awardName = mysql_real_escape_string($_REQUEST['awardName']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$lowestGPA = mysql_real_escape_string($_REQUEST['lowestGPA']);
		$highestGPA = mysql_real_escape_string($_REQUEST['highestGPA']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$failed = 0;
		if (isset($_REQUEST['failed']))	{
			$failed = 1;
		}
		if ($awardName != $award1->getAwardName())	{
			$award1->setAwardName($awardName); $enableUpdate = true;
		}
		if (is_null($award1->getEducationLevel()) || ($award1->getEducationLevel()->getLevelId() != $levelId))	{
			$award1->setEducationLevel($levelId); $enableUpdate = true;
		}
		if ($lowestGPA != $award1->getLowestGPA())	{
			$award1->setLowestGPA($lowestGPA); $enableUpdate = true;
		}
		if ($highestGPA != $award1->getHighestGPA())	{
			$award1->setHighestGPA($highestGPA); $enableUpdate = true;
		}
		if (($failed == 1) xor $award1->isFailed())	{
			$award1->setFailed($failed); $enableUpdate = true;
		}
		if ($extraInformation != $award1->getExtraInformation())	{
			$award1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $award1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$award1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$award1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAward Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			ClassOfAward <?= $award1->getAwardName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the award <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageclassofaward_edit", "Edited ".$award1->getAwardName());
	} else if ($page == "manageclassofaward_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageclassofaward_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$award1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$award1 = new ClassOfAward($database, $_REQUEST['id'], $conn);
			$award1->setExtraFilter($extraFilter);
			$award1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit ClassOfAward <?= $award1->getAwardName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageclassofaward_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $award1->getAwardId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $award1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="awardName">ClassOfAward Name </label>
						<input value="<?= $award1->getAwardName() ?>" type="text" name="awardName" id="awardName" size="48" required placeholder="First Class" pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="ClassOfAward Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($award1->getEducationLevel()) && ($award1->getEducationLevel()->getLevelId() == $alist1['id'])) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="lowestGPA">Lowest GPA (Inclusive)</label>
						<input value="<?= $award1->getLowestGPA() ?>" type="text" name="lowestGPA" id="lowestGPA" size="12" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Lowest GPA : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="highestGPA">Highest GPA (Exclusive)</label>
						<input value="<?= $award1->getHighestGPA() ?>" type="text" name="highestGPA" id="highestGPA" size="12" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Highest GPA : <?= $msgL8Name ?>"/>
					</div>
<?php 
	$chkFailed = "";
	if ($award1->isFailed()) $chkFailed = "checked";
?>
					<div class="pure-controls">
						<label><input <?= $chkFailed ?> title="Check if this GPA Range Means Failed/Discontinuing" type="checkbox" name="failed" value="1"/>&nbsp;&nbsp;Is a Discontinuing GPA Range?</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $award1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('ClassOfAward Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageclassofaward_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageclassofaward_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$award1 = null;
		try {
			$award1 = new ClassOfAward($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $award1->getAwardName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>ClassOfAward Name</td>
						<td><?= $award1->getAwardName() ?></td>
					</tr>
<?php 
	if (! is_null($award1->getEducationLevel()))	{
?>
					<tr>
						<td>Education Level</td>
						<td><?= $award1->getEducationLevel()->getLevelName() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Lowest GPA</td>
						<td><?= $award1->getLowestGPA() ?></td>
					</tr>
					<tr>
						<td>Highest GPA</td>
						<td><?= $award1->getHighestGPA() ?></td>
					</tr>
<?php
	$failedText = "PASS GPA RANGE";
	if ($award1->isFailed()) $failedText = "<b style=\"background-color: red; color: white; font-size: 0.9em;\">DISCONTINUING GPA RANGE</b>";
?>
					<tr>
						<td colspan="2"><?= $failedText ?></td>
					</tr>
<?php
	if (! is_null($award1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $award1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageclassofaward_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $award1->getAwardName() ?>" href="<?= $thispage ?>?page=manageclassofaward_edit&id=<?= $award1->getAwardId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageclassofaward_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $award1->getAwardName() ?>" href="<?= $thispage ?>?page=manageclassofaward_delete&id=<?= $award1->getAwardId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageclassofaward_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageclassofaward_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$awardName = mysql_real_escape_string($_REQUEST['awardName']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$lowestGPA = mysql_real_escape_string($_REQUEST['lowestGPA']);
		$highestGPA = mysql_real_escape_string($_REQUEST['highestGPA']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$flags = 15;
		if (isset($_REQUEST['failed']))	{
			$flags = $flags | pow(2, ClassOfAward::$__IS_FAILED);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $awardName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO classOfAward (awardName, levelId, lowestGPA, highestGPA, extraFilter, extraInformation, flags) VALUES('$awardName', '$levelId', '$lowestGPA', '$highestGPA', '$extraFilter', '$extraInformation', '$flags')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("ClassOfAward[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The ClassOfAward <?= $awardName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the award<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Class of Award";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward_add"><?= $captionText ?></a> &nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageclassofaward_add", "Added $awardName");
	} else if ($page == "manageclassofaward_add" && Authorize::isAllowable($config, "manageclassofaward_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New ClassOfAward</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageclassofaward_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="awardName">ClassOfAward Name </label>
						<input type="text" name="awardName" id="awardName" size="48" required placeholder="First Class" pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="ClassOfAward Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="lowestGPA">Lowest GPA (Inclusive)</label>
						<input type="text" name="lowestGPA" id="lowestGPA" size="12" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Lowest Marks : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="highestGPA">Highest GPA (Exclusive)</label>
						<input type="text" name="highestGPA" id="highestGPA" size="12" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Highest Marks : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-controls">
						<label><input title="Check if this GPA Range Means Failed/Discontinuing" type="checkbox" name="failed" value="1"/>&nbsp;&nbsp;Is a Discontinuing GPA Range?</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageclassofaward">Back to Class of Award Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('ClassOfAward Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageclassofaward" && Authorize::isAllowable($config, "manageclassofaward", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">ClassOfAwards Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-award-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageclassofaward" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageclassofaward_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>ClassOfAward</th>
				<th>Level</th>
				<th title="Lowest GPA [Inclusive]">L.GPA</th>
				<th title="Highest GPA [Exclusive]">H.GPA</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = ClassOfAward::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch award data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$award1 = null;
		try {
			$award1 = new ClassOfAward($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($award1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$bgcolor = "blue";
			if ($award1->isFailed()) $bgcolor = "red";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
				<td><?= $award1->getAwardName() ?></td>
				<td>
<?php 
	if (! is_null($award1->getEducationLevel()))	{
		echo $award1->getEducationLevel()->getLevelName();
	}
?>				
				</td>
				<td><?= $award1->getLowestGPA() ?></td>
				<td><?= $award1->getHighestGPA() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageclassofaward_detail&id=<?= $award1->getAwardId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageclassofaward_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageclassofaward_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageclassofaward_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System ClassOfAward" href="<?= $thispage ?>?page=manageclassofaward_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*ClassOfAward End*/ else/*Grade BEGIN*/if ($page == "managegrade_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managegrade_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a></div>
		</div>
<?php
	} else if ($page == "managegrade_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managegrade_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Grade::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Grade[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$grade1 = null;
			try	{
				$grade1 = new Grade($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($grade1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managegrade_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managegrade_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managegrade_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegrade_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managegrade_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managegrade_csv" && Authorize::isAllowable($config, "managegrade_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managegrade_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Grade::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managegrade_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managegrade_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$grade1 = null;
		try {
			 $grade1 = new Grade($database, $_REQUEST['id'], $conn);
			 $grade1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Grade which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Grade <?= $grade1->getGradeName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Grade <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegrade_delete", "Deleted ".$grade1->getGradeName());
	} else if ($page == "managegrade_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegrade_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$grade1 = null;
		try {
			$grade1 = new Grade($database, $_REQUEST['id'], $conn);
			$grade1->setExtraFilter(System::getCodeString(8));
			$grade1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Grade <b><?= $grade1->getGradeName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Grade <?= $grade1->getGradeName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managegrade_delete&report=io&id=<?= $grade1->getGradeId() ?>&rndx=<?= $grade1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managegrade">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managegrade_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managegrade_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$grade1 = null;
		try {
			$grade1 = new Grade($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$gradeName = mysql_real_escape_string($_REQUEST['gradeName']);
		$gradePoint = mysql_real_escape_string($_REQUEST['gradePoint']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$lowestMarks = mysql_real_escape_string($_REQUEST['lowestMarks']);
		$highestMarks = mysql_real_escape_string($_REQUEST['highestMarks']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$failed = 0;
		$completefailed = 0;
		$incomplete = 0;
		if (isset($_REQUEST['failed'])) $failed = 1;
		if (isset($_REQUEST['completefailed']))	{
			$failed = 1;
			$completefailed = 1;
		}
		if (isset($_REQUEST['incomplete']))	{
			$incomplete = 1;
			$failed = 1;
		}
		if ($gradeName != $grade1->getGradeName())	{
			$grade1->setGradeName($gradeName); $enableUpdate = true;
		}
		if ($gradePoint != $grade1->getGradePoint())	{
			$grade1->setGradePoint($gradePoint); $enableUpdate = true;
		}
		if (is_null($grade1->getEducationLevel()) || ($grade1->getEducationLevel()->getLevelId() != $levelId))	{
			$grade1->setEducationLevel($levelId); $enableUpdate = true;
		}
		if ($lowestMarks != $grade1->getLowestMarks())	{
			$grade1->setLowestMarks($lowestMarks); $enableUpdate = true;
		}
		if ($highestMarks != $grade1->getHighestMarks())	{
			$grade1->setHighestMarks($highestMarks); $enableUpdate = true;
		}
		if (($failed == 1) xor $grade1->isFailed())	{
			$grade1->setFailed($failed); $enableUpdate = true;
		}
		if (($completefailed == 1) xor $grade1->isCompleteFailed())	{
			$grade1->setCompleteFailed($completefailed); $enableUpdate = true;
		}
		if (($incomplete == 1) xor $grade1->isIncomplete())	{
			$grade1->setIncomplete($incomplete); $enableUpdate = true;
		}
		if ($extraInformation != $grade1->getExtraInformation())	{
			$grade1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $grade1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$grade1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$grade1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grade Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Grade <?= $grade1->getGradeName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the grade <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegrade_edit", "Edited ".$grade1->getGradeName());
	} else if ($page == "managegrade_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegrade_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$grade1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$grade1 = new Grade($database, $_REQUEST['id'], $conn);
			$grade1->setExtraFilter($extraFilter);
			$grade1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Grade <?= $grade1->getGradeName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegrade_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $grade1->getGradeId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $grade1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="gradeName">Grade Name </label>
						<input value="<?= $grade1->getGradeName() ?>" type="text" name="gradeName" id="gradeName" size="12" required placeholder="A+" pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Grade Name : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="gradePoint">Grade Point </label>
						<input value="<?= $grade1->getGradePoint() ?>" type="text" name="gradePoint" id="gradePoint" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Grade Point : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($grade1->getEducationLevel()) && ($grade1->getEducationLevel()->getLevelId() == $alist1['id'])) $selected = "selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="lowestMarks">Lowest Marks (Inclusive)</label>
						<input value="<?= $grade1->getLowestMarks() ?>" type="text" name="lowestMarks" id="lowestMarks" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Lowest Marks : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="highestMarks">Highest Marks (Exclusive)</label>
						<input value="<?= $grade1->getHighestMarks() ?>" type="text" name="highestMarks" id="highestMarks" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Highest Marks : <?= $msgD4Number ?>"/>
					</div>
<?php 
	$chkFailed = "";
	$chkIncomplete = "";
	$chkCompleteFailed = "";
	if ($grade1->isFailed()) $chkFailed="checked";
	if ($grade1->isCompleteFailed()) $chkCompleteFailed="checked";
	if ($grade1->isIncomplete()) $chkIncomplete="checked";
?>
					<div class="pure-controls">
						<label><input <?= $chkFailed ?> title="Check if this Grade means failed" type="checkbox" name="failed" value="1"/>&nbsp;&nbsp;Is a Failed Grade?</label>
					</div>
					<div class="pure-controls">
						<label><input <?= $chkCompleteFailed ?> title="Check if this Grade means Complete Failed [Do not allow for Supplimentary]" type="checkbox" name="completefailed" value="1"/>&nbsp;&nbsp;Is a Complete Failed Grade?</label>
					</div>
					<div class="pure-controls">
						<label><input <?= $chkIncomplete ?> title="Check if this Grade means Incomplete, if incomplete the system will treat as failed too" type="checkbox" name="incomplete" value="1"/>&nbsp;&nbsp;Is an Incomplete Grade?</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $grade1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Grade Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managegrade_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegrade_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$grade1 = null;
		try {
			$grade1 = new Grade($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $grade1->getGradeName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Grade Name</td>
						<td><?= $grade1->getGradeName() ?></td>
					</tr>
					<tr>
						<td>Grade Point</td>
						<td><?= $grade1->getGradePoint() ?></td>
					</tr>
<?php 
	if (! is_null($grade1->getEducationLevel()))	{
?>
					<tr>
						<td>Education Level</td>
						<td><?= $grade1->getEducationLevel()->getLevelName() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Lowest Marks</td>
						<td><?= $grade1->getLowestMarks() ?></td>
					</tr>
					<tr>
						<td>Highest Marks</td>
						<td><?= $grade1->getHighestMarks() ?></td>
					</tr>
<?php
	$passCode = 0;
	if ($grade1->isFailed()) $passCode = $passCode | 4;
	if ($grade1->isCompleteFailed()) $passCode = $passCode | 2;
	if ($grade1->isIncomplete()) $passCode = $passCode | 1;
	$passText = "";
	switch ($passCode)	{
		case 0: $passText = "This is a PASS Grade"; break;
		case 1: $passText = "This is an Incomplete Grade"; break;
		case 2: $passText = "A Completely Failed Grade (Can not sit for Supplimentary)"; break;
		case 3: $passText = "This is an Incomplete Grade"; break;
		case 4: $passText = "This is a Failed Grade (Can sit for Supplimetary)"; break;
		case 5: $passText = "This is an Incomplete Grade"; break;
		case 6: $passText = "A Completely Failed Grade (Can not sit for Supplimentary)"; break;
		case 7: $passText = "This is an Incomplete Grade"; break;
		default: $passText = "This is an Unknown Option";
	}
?>
					<tr>
						<td colspan="2"><?= $passText ?></td>
					</tr>
<?php
	if (! is_null($grade1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $grade1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managegrade_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $grade1->getGradeName() ?>" href="<?= $thispage ?>?page=managegrade_edit&id=<?= $grade1->getGradeId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managegrade_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $grade1->getGradeName() ?>" href="<?= $thispage ?>?page=managegrade_delete&id=<?= $grade1->getGradeId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managegrade_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managegrade_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$gradeName = mysql_real_escape_string($_REQUEST['gradeName']);
		$gradePoint = mysql_real_escape_string($_REQUEST['gradePoint']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$lowestMarks = mysql_real_escape_string($_REQUEST['lowestMarks']);
		$highestMarks = mysql_real_escape_string($_REQUEST['highestMarks']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$flags = 15;
		if (isset($_REQUEST['failed']))	{
			$flags = $flags | pow(2, Grade::$__IS_FAILED);
		}
		if (isset($_REQUEST['completefailed']))	{
			$flags = $flags | pow(2, Grade::$__IS_COMPLETE_FAILED) | power(2, Grade::$__IS_FAILED);
		}
		if (isset($_REQUEST['incomplete']))	{
			$flags = $flags | pow(2, Grade::$__IS_INCOMPLETE) | pow(2, Grade::$__IS_FAILED);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $gradeName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO grades (gradeName, gradePoint, levelId, lowestMarks, highestMarks, extraFilter, extraInformation, flags) VALUES('$gradeName', '$gradePoint', '$levelId', '$lowestMarks', '$highestMarks', '$extraFilter', '$extraInformation', '$flags')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Grade[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Grade <?= $gradeName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the grade<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Grade";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegrade_add", "Added $gradeName");
	} else if ($page == "managegrade_add" && Authorize::isAllowable($config, "managegrade_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Grade</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegrade_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="gradeName">Grade Name </label>
						<input type="text" name="gradeName" id="gradeName" size="12" required placeholder="A+" pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Grade Name : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="gradePoint">Grade Point </label>
						<input type="text" name="gradePoint" id="gradePoint" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Grade Point : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select an Education Level">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="lowestMarks">Lowest Marks (Inclusive)</label>
						<input type="text" name="lowestMarks" id="lowestMarks" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Lowest Marks : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="highestMarks">Highest Marks (Exclusive)</label>
						<input type="text" name="highestMarks" id="highestMarks" size="12" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Highest Marks : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-controls">
						<label><input title="Check if this Grade means failed [Allow for Supplimentary]" type="checkbox" name="failed" value="1"/>&nbsp;&nbsp;Is a Failed Grade?</label>
					</div>
					<div class="pure-controls">
						<label><input title="Check if this Grade means Complete Failed [Do not allow for Supplimentary]" type="checkbox" name="completefailed" value="1"/>&nbsp;&nbsp;Is a Complete Failed Grade?</label>
					</div>
					<div class="pure-controls">
						<label><input title="Check if this Grade means Incomplete, if incomplete the system will treat as failed too" type="checkbox" name="incomplete" value="1"/>&nbsp;&nbsp;Is an Incomplete Grade?</label>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegrade">Back to Grade Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Grade Point can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managegrade" && Authorize::isAllowable($config, "managegrade", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Grades Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-grade-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managegrade" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managegrade_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th></th>
				<th>Grade</th>
				<th>Point</th>
				<th>Level</th>
				<th title="Lowest Marks [Inclusive]">L.M</th>
				<th title="Highest Marks [Exclusive]">H.M</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Grade::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch grade data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$grade1 = null;
		try {
			$grade1 = new Grade($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($grade1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$bgcolor = "blue";
			if ($grade1->isIncomplete())	$bgcolor = "gold";
			else if ($grade1->isFailed() || $grade1->isCompleteFailed())	$bgcolor = "red";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><span style="background-color: <?= $bgcolor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
				<td><?= $grade1->getGradeName() ?></td>
				<td><?= $grade1->getGradePoint() ?></td>
				<td>
<?php 
	if (! is_null($grade1->getEducationLevel()))	{
		echo $grade1->getEducationLevel()->getLevelName();
	}
?>				
				</td>
				<td><?= $grade1->getLowestMarks() ?></td>
				<td><?= $grade1->getHighestMarks() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managegrade_detail&id=<?= $grade1->getGradeId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managegrade_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managegrade_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managegrade_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Grade" href="<?= $thispage ?>?page=managegrade_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Grade End*/ else/*Timetable BEGIN*/if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_subject']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Subjects Map from ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($timetable1->getSubjectList(), $_REQUEST['did']);
			$timetable1->setSubjectList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Subject List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Subject List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Detach Subjects for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_subject']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Subject Map to ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($timetable1->getSubjectList(), $_REQUEST['did']);
			$timetable1->setSubjectList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Subject List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Subject List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Attach Subjects for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_subject']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Subject Map to ".$timetable1->getActivityName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getSubjectList()) && sizeof($timetable1->getSubjectList()) > 0)	{
		$objectList1 = $timetable1->getSubjectList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managetimetable_edit"/>
				<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_subject" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
							<th colspan="8">Subjects</th>
						</tr>
						<tr>
							<th></th>
							<th>S/N</th>
							<th>Name</th>
							<th>Code</th>
							<th title="Lecture Hours">L.H</th>
							<th title="Lecture Units">L.U</th>
							<th title="Practical Hours">P.H</th>
							<th title="Practical Units">P.U</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getSubjectId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getSubjectName() ?></td>
			<td><?= $obj1->getSubjectCode() ?></td>
			<td><?= $obj1->getLectureHours() ?></td>
			<td><?= $obj1->getLectureUnits() ?></td>
			<td><?= $obj1->getPracticalHours() ?></td>
			<td><?= $obj1->getPracticalUnits() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Subjects"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_subject=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managetimetable_edit"/>
		<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_subject" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Name</th>
					<th>Code</th>
					<th title="Lecture Hours">L.H</th>
					<th title="Lecture Units">L.U</th>
					<th title="Practical Hours">P.H</th>
					<th title="Practical Units">P.U</th>
				</tr>
			</thead>
<?php 
	$query = Subject::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Subject($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getSubjectId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getSubjectName() ?></td>
				<td><?= $transaction1->getSubjectCode() ?></td>
				<td><?= $transaction1->getLectureHours() ?></td>
				<td><?= $transaction1->getLectureUnits() ?></td>
				<td><?= $transaction1->getPracticalHours() ?></td>
				<td><?= $transaction1->getPracticalUnits() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Subject"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_groups']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Targets Map from ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Dettach");
			$listToUpdate = Object::detachIdListFromObjectList($timetable1->getGroupList(), $_REQUEST['did']);
			$timetable1->setGroupList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Group List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Group List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Detach Groups for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_groups']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Group Map to ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($timetable1->getGroupList(), $_REQUEST['did']);
			$listToUpdateArr = explode(",", $listToUpdate);
			$listToVerify = Object::detachArrayFromArray($listToUpdateArr, explode(",", Object::attachIdListToObjectList($timetable1->getGroupList(), array())));
			foreach ($listToVerify as $groupId)	{
				//login id 
				$group1 = new Group($database, $groupId, $conn);
				if (Timetable::isGroupAlreadyOccupied($database, $conn, $groupId, $timetable1->getDayOfAWeek()->getDayId(), $timetable1->getStartTime(), $timetable1->getEndTime(), $systemTime1)) Object::shootException("One of the Group has a conflicting timetable ".$group1->getGroupName());
			}
			$timetable1->setGroupList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Group List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Group List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Attach Groups for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_groups']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Group Map to ".$timetable1->getActivityName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getGroupList()) && sizeof($timetable1->getGroupList()) > 0)	{
		$objectList1 = $timetable1->getGroupList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managetimetable_edit"/>
				<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_groups" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
					<tr>
						<th colspan="7">Targeted Groups</th>
					</tr>
					<tr>
						<th></th>
						<th>S/N</th>
						<th>Group Name</th>
						<th>Parent Group</th>
						<th>Course</th>
						<th>Year</th>
						<th>Semester</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getGroupId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getParentGroup()))	{
		echo $obj1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
		echo $obj1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Groups"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_groups=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managetimetable_edit"/>
		<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_groups" value="true"/>
		<table class="pure-table ui-sys-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Group Name</th>
					<th>Parent Group</th>
					<th>Course</th>
					<th>Year</th>
					<th>Semester</th>
				</tr>
			</thead>
<?php 
	$query = Group::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Group($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getGroupId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $transaction1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($transaction1->getParentGroup()))	{
		echo $transaction1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($transaction1->getCourse()))	{
		echo $transaction1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $transaction1->getYear() ?></td>
			<td><?= $transaction1->getSemester() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Group"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_login']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Creators Map from ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($timetable1->getInstructorList(), $_REQUEST['did']);
			$timetable1->setInstructorList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Instructor List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Instructor List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Detach Instructors for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Instructor Map to ".$timetable1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($timetable1->getInstructorList(), $_REQUEST['did']);
			$listToUpdateArr = explode(",", $listToUpdate);
			$listToVerify = Object::detachArrayFromArray($listToUpdateArr, explode(",", Object::attachIdListToObjectList($timetable1->getInstructorList(), array())));
			foreach ($listToVerify as $loginId)	{
				//login id 
				$ulogin1 = new Login($database, $loginId, $conn);
				if (Timetable::isUserAlreadyOccupied($database, $conn, $loginId, $timetable1->getDayOfAWeek()->getDayId(), $timetable1->getStartTime(), $timetable1->getEndTime(), $systemTime1)) Object::shootException("One of the Instructor has a conflicting timetable ".$ulogin1->getFullname());
			}
			$timetable1->setInstructorList($listToUpdate);
			$timetable1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Instructor List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Instructor List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Attach Instructors for ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		$headerText = "UNKNOWN";
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Instructor Map to ".$timetable1->getActivityName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getInstructorList()) && sizeof($timetable1->getInstructorList()) > 0)	{
		$objectList1 = $timetable1->getInstructorList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managetimetable_edit"/>
				<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_login" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
						<th colspan="6">Timetabled By</th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Name</th>
							<th>Email</th>
							<th>Phone</th>
							<th>Status</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getLoginId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Instructors"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_login=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managetimetable_edit"/>
		<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_login" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Name</th>
					<th>Email</th>
					<th>Phone</th>
					<th>Status</th>
				</tr>
			</thead>
<?php 
	$query = Login::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Login($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getLoginId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getFullname() ?></td>
				<td><?= $transaction1->getEmail() ?></td>
				<td><?= $transaction1->getPhone() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getUserStatus()))	{
		echo $transaction1->getUserStatus()->getStatusName();
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Instructor"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managetimetable_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
	} else if ($page == "managetimetable_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managetimetable_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable CSV File <br/> (Download CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Timetable::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Timetable[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$timetable1 = null;
			try	{
				$timetable1 = new Timetable($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($timetable1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managetimetable_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managetimetable_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managetimetable_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managetimetable_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managetimetable_csv" && Authorize::isAllowable($config, "managetimetable_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managetimetable_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Timetable::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managetimetable_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managetimetable_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$timetable1 = null;
		try {
			 $timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			 $timetable1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Timetable which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Timetable <?= $timetable1->getActivityName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Timetable <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_delete", "Deleted ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managetimetable_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$timetable1 = null;
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$timetable1->setExtraFilter(System::getCodeString(8));
			$timetable1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Timetable <b><?= $timetable1->getActivityName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Timetable <?= $timetable1->getActivityName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managetimetable_delete&report=io&id=<?= $timetable1->getTimetableId() ?>&rndx=<?= $timetable1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managetimetable">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$timetable1 = null;
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$timetableName = mysql_real_escape_string($_REQUEST['timetableName']);
		$venueId = mysql_real_escape_string($_REQUEST['venueId']);
		$dayOfAWeekId = mysql_real_escape_string($_REQUEST['dayOfAWeekId']);
		$textColor = Color::convertFromGUIFormatToDbFormat(mysql_real_escape_string($_REQUEST['textColor']));
		$backgroundColor = Color::convertFromGUIFormatToDbFormat(mysql_real_escape_string($_REQUEST['backgroundColor']));
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$startTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['validFrom'], $_REQUEST['startTime']);
		$endTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['validTo'], $_REQUEST['endTime']);
		/*Further Time Processing*/
		$tempDate1 = new DateAndTime($database, $startTime, $conn);
		$validFrom = $tempDate1->getYear().":".$tempDate1->getMonth().":".$tempDate1->getDay().":*:*:*";
		$startTime = "*:*:*:".$tempDate1->getHour().":".$tempDate1->getMinute().":".$tempDate1->getSecond();
		$tempDate1 = new DateAndTime($database, $endTime, $conn);
		$validTo = $tempDate1->getYear().":".$tempDate1->getMonth().":".$tempDate1->getDay().":*:*:*";
		$endTime = "*:*:*:".$tempDate1->getHour().":".$tempDate1->getMinute().":".$tempDate1->getSecond();
		$checkVenue = false;
		if ($textColor == "")	$textColor = "000000";
		if ($backgroundColor == "") $backgroundColor = "ffffff";

		if ($timetableName != $timetable1->getActivityName())	{
			$timetable1->setActivityName($timetableName); $enableUpdate = true;
		}
		if (is_null($timetable1->getVenue()) || ($timetable1->getVenue()->getVenueId() != $venueId))	{
			$timetable1->setVenue($venueId); $enableUpdate = true; $checkVenue = true;
		}
		if (is_null($timetable1->getStartTime()) || ($timetable1->getStartTime()->getDateAndTimeString() != $startTime))	{
			$timetable1->setStartTime($startTime); $enableUpdate = true;
		}
		if (is_null($timetable1->getEndTime()) || ($timetable1->getEndTime()->getDateAndTimeString() != $endTime))	{
			$timetable1->setEndTime($endTime); $enableUpdate = true;
		}
		if (is_null($timetable1->getValidFrom()) || ($timetable1->getValidFrom()->getDateAndTimeString() != $validFrom))	{
			$timetable1->setValidFrom($validFrom); $enableUpdate = true;
		}
		if (is_null($timetable1->getValidTo()) || ($timetable1->getValidTo()->getDateAndTimeString() != $validTo))	{
			$timetable1->setValidTo($validTo); $enableUpdate = true;
		}
		if (is_null($timetable1->getDayOfAWeek()) || ($timetable1->getDayOfAWeek()->getDayId() != $dayOfAWeekId))	{
			$timetable1->setDayOfAWeek($dayOfAWeekId); $enableUpdate = true;
		}
		if ($textColor != $timetable1->getTextColor())	{
			$timetable1->setTextColor($textColor); $enableUpdate = true;
		}
		if ($backgroundColor != $timetable1->getBackgroundColor())	{
			$timetable1->setBackgroundColor($backgroundColor); $enableUpdate = true;
		}
		if ($extraInformation != $timetable1->getExtraInformation())	{
			$timetable1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $timetable1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$timetable1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$validFrom1 = new DateAndTime("Zoomtong", $validFrom, "Company");
				$validTo1 = new DateAndTime("Zoomtong", $validTo, "Company");
				if (! (($systemTime1->compareDateAndTime($validTo1) < 0) && ($validFrom1->compareDateAndTime($validTo1) < 0))) Object::shootException("Validity Range [Date Ranges], Ranges were not accepted");
				$startTime1 = new DateAndTime("zoomtong", $startTime, "company");
				$endTime1 = new DateAndTime("zoomtong", $endTime, "company");
				if (! ($startTime1->compareDateAndTime($endTime1) < 0)) Object::shootException("Validity Range [Time Range], Range could not be accepted");
				if ($checkVenue && Timetable::isVenueAlreadyBooked($database, $conn, $venueId, $dayOfAWeekId, $startTime1, $endTime1, $systemTime1)) Object::shootException("The venue you are allocating is already booked, kindly try another venue");
				$timetable1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetable Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Timetable <?= $timetable1->getActivityName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the timetable <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_edit", "Edited ".$timetable1->getActivityName());
	} else if ($page == "managetimetable_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managetimetable_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$timetable1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
			$timetable1->setExtraFilter($extraFilter);
			$timetable1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Timetable <?= $timetable1->getActivityName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managetimetable_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $timetable1->getTimetableId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $timetable1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="timetableName">Activity Name </label>
						<input value="<?= $timetable1->getActivityName() ?>" type="text" name="timetableName" id="timetableName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Timetable Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Venue </label>
						<select id="venueId" name="venueId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Venue">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Venue::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($timetable1->getVenue()) && ($timetable1->getVenue()->getVenueId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	$startTime = "";
	if (! is_null($timetable1->getStartTime()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($timetable1->getStartTime()->getDateAndTimeString());
		$startTime = $list['time'];
	}
?>
					<div class="pure-control-group">
						<label for="startTime">Start Time </label>
						<input value="<?= $startTime ?>" class="timepicker" type="text" name="startTime" size="12" required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="Start Time: <?= $msgTime ?>"/>
					</div>
<?php 
	$endTime = "";
	if (! is_null($timetable1->getEndTime()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($timetable1->getEndTime()->getDateAndTimeString());
		$endTime = $list['time'];
	}
?>
					<div class="pure-control-group">
						<label for="endTime">End Time </label>
						<input value="<?= $endTime ?>" class="timepicker" type="text" name="endTime" size="12" required required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="End Time: <?= $msgTime ?>" />
					</div>
<?php 
	$validFrom = "";
	if (! is_null($timetable1->getValidFrom()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($timetable1->getValidFrom()->getDateAndTimeString());
		$validFrom = $list['date'];
	}
?>
					<div class="pure-control-group">
						<label for="validFrom">Valid From </label>
						<input value="<?= $validFrom ?>" class="datepicker"type="text" name="validFrom" id="validFrom" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid From [Date] : <?= $msgDate ?>"/>
					</div>
<?php 
	$validTo  = "";
	if (! is_null($timetable1->getValidTo()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($timetable1->getValidTo()->getDateAndTimeString());
		$validTo = $list['date'];
	}
?>

					<div class="pure-control-group">
						<label for="validTo">Valid To </label>
						<input value="<?= $validTo ?>" class="datepicker"type="text" name="validTo" id="validTo" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid To [Date] : <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="dayOfAWeekId">Day </label>
						<select id="dayOfAWeekId" name="dayOfAWeekId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Day">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = DaysOfAWeek::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($timetable1->getDayOfAWeek()) && ($timetable1->getDayOfAWeek()->getDayId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div id="<?= System::getCodeString(8) ?>" class="pure-control-group color-picker-container">
						<label title="Color which will be used to show this timetable on the grid" for="textColor">Text Color </label>
						<input class="ui-sys-color-picker" value="<?= Color::convertFromDbFormatToGUIFormat($timetable1->getTextColor()) ?>" type="text" name="textColor" id="textColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div id="<?= System::getCodeString(8) ?>" class="pure-control-group color-picker-container">
						<label title="Background Color which will be used to show this timetable on the grid" for="backgroundColor">Background Color </label>
						<input class="ui-sys-color-picker" value="<?= Color::convertFromDbFormatToGUIFormat($timetable1->getBackgroundColor()) ?>" type="text" name="backgroundColor" id="backgroundColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					
					
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $timetable1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managetimetable_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$timetable1 = null;
		try {
			$timetable1 = new Timetable($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $timetable1->getActivityName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Activity Name</td>
						<td><?= $timetable1->getActivityName() ?></td>
					</tr>
<?php 
	if (! is_null($timetable1->getVenue()))	{
?>
					<tr>
						<td>Venue</td>
						<td><?= $timetable1->getVenue()->getVenueName() ?></td>
					</tr>
<?php
	}
	if (! is_null($timetable1->getStartTime()))	{
?>
		<tr>
			<td>Start Time</td>
			<td><?= DateAndTime::convertFromSystemDateAndTimeFormatToTimeOnlyFormat($timetable1->getStartTime()->getDateAndTimeString()) ?></td>
		</tr>
<?php
	}
	if (! is_null($timetable1->getEndTime()))	{
?>
		<tr>
			<td>End Time</td>
			<td><?= DateAndTime::convertFromSystemDateAndTimeFormatToTimeOnlyFormat($timetable1->getEndTime()->getDateAndTimeString()) ?></td>
		</tr>
<?php
	}
	if (! is_null($timetable1->getValidFrom()))	{
?>
		<tr>
			<td>Valid From</td>
			<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($timetable1->getValidFrom()) ?></td>
		</tr>
<?php	
	}
	if (! is_null($timetable1->getValidTo()))	{
?>
		<tr>
			<td>Valid To</td>
			<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($timetable1->getValidTo()) ?></td>
		</tr>
<?php
	}
	if (! is_null($timetable1->getDayOfAWeek()))	{
?>
		<tr>
			<td>Day</td>
			<td><?= $timetable1->getDayOfAWeek()->getDayName() ?></td>
		</tr>
<?php
	}
?>
					<tr>
						<td>Text Color</td>
						<td>
<?php 
	$textColor = $timetable1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
					<tr>
						<td>Background Color</td>
						<td>
<?php 
	$textColor = $timetable1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
<?php 
	if (! is_null($timetable1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $timetable1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table><br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getInstructorList()) && sizeof($timetable1->getInstructorList()) > 0)	{
		$objectList1 = $timetable1->getInstructorList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="5">Timetabled By</th>
					</tr>
					<tr>
						<th></th>
						<th>Name</th>
						<th>Email</th>
						<th>Phone</th>
						<th>Status</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getGroupList()) && sizeof($timetable1->getGroupList()) > 0)	{
		$objectList1 = $timetable1->getGroupList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-2">
				<thead>
					<tr>
						<th colspan="6">Targeted Groups</th>
					</tr>
					<tr>
						<th></th>
						<th>Group Name</th>
						<th>Parent Group</th>
						<th>Course</th>
						<th>Year</th>
						<th>Semester</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getParentGroup()))	{
		echo $obj1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
		echo $obj1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($timetable1->getSubjectList()) && sizeof($timetable1->getSubjectList()) > 0)	{
		$objectList1 = $timetable1->getSubjectList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-3">
				<thead>
					<tr>
						<th colspan="7">Subjects</th>
					</tr>
					<tr>
						<th></th>
						<th>Name</th>
						<th>Code</th>
						<th title="Lecture Hours">L.H</th>
						<th title="Lecture Units">L.U</th>
						<th title="Practical Hours">P.H</th>
						<th title="Practical Units">P.U</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getSubjectName() ?></td>
			<td><?= $obj1->getSubjectCode() ?></td>
			<td><?= $obj1->getLectureHours() ?></td>
			<td><?= $obj1->getLectureUnits() ?></td>
			<td><?= $obj1->getPracticalHours() ?></td>
			<td><?= $obj1->getPracticalUnits() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-3"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-3').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-3 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managetimetable_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $timetable1->getActivityName() ?>" href="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managetimetable_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $timetable1->getActivityName() ?>" href="<?= $thispage ?>?page=managetimetable_delete&id=<?= $timetable1->getTimetableId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managetimetable_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach Activity Creators (Teaching Staff)" href="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_login=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
		<a title="Attach Targeted Group" href="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_groups=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
		<a title="Attach Subjects List" href="<?= $thispage ?>?page=managetimetable_edit&id=<?= $timetable1->getTimetableId() ?>&attach_subject=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managetimetable_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managetimetable_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$timetableName = mysql_real_escape_string($_REQUEST['timetableName']);
		$venueId = mysql_real_escape_string($_REQUEST['venueId']);
		$dayOfAWeekId = mysql_real_escape_string($_REQUEST['dayOfAWeekId']);
		$textColor = Color::convertFromGUIFormatToDbFormat(mysql_real_escape_string($_REQUEST['textColor']));
		$backgroundColor = Color::convertFromGUIFormatToDbFormat(mysql_real_escape_string($_REQUEST['backgroundColor']));
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$startTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['validFrom'], $_REQUEST['startTime']);
		$endTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['validTo'], $_REQUEST['endTime']);
		/*Further Time Processing*/
		$tempDate1 = new DateAndTime($database, $startTime, $conn);
		$validFrom = $tempDate1->getYear().":".$tempDate1->getMonth().":".$tempDate1->getDay().":*:*:*";
		$startTime = "*:*:*:".$tempDate1->getHour().":".$tempDate1->getMinute().":".$tempDate1->getSecond();
		$tempDate1 = new DateAndTime($database, $endTime, $conn);
		$validTo = $tempDate1->getYear().":".$tempDate1->getMonth().":".$tempDate1->getDay().":*:*:*";
		$endTime = "*:*:*:".$tempDate1->getHour().":".$tempDate1->getMinute().":".$tempDate1->getSecond();
		if ($textColor == "")	$textColor = "000000";
		if ($backgroundColor == "") $backgroundColor = "ffffff";
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $timetableName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO timetable (ttName, venueId, validFrom, validTo, startTime, endTime, dayOfAWeekId, textColor, backgroundColor, extraFilter, extraInformation) VALUES('$timetableName', '$venueId', '$validFrom', '$validTo', '$startTime', '$endTime', '$dayOfAWeekId', '$textColor', '$backgroundColor', '$extraFilter', '$extraInformation')";
	try {
		$validFrom1 = new DateAndTime("Zoomtong", $validFrom, "Company");
		$validTo1 = new DateAndTime("Zoomtong", $validTo, "Company");
		if (! (($systemTime1->compareDateAndTime($validTo1) < 0) && ($validFrom1->compareDateAndTime($validTo1) < 0))) Object::shootException("Validity Range [Date Ranges], Ranges were not accepted");
		$startTime1 = new DateAndTime("zoomtong", $startTime, "company");
		$endTime1 = new DateAndTime("zoomtong", $endTime, "company");
		if (! ($startTime1->compareDateAndTime($endTime1) < 0)) Object::shootException("Validity Range [Time Range], Range could not be accepted");
		if (Timetable::isVenueAlreadyBooked($database, $conn, $venueId, $dayOfAWeekId, $startTime1, $endTime1, $systemTime1)) Object::shootException("The venue you are allocating is already booked, kindly try another venue");
		mysql_db_query($database, $query, $conn) or Object::shootException("Timetable[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Timetable <?= $timetableName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the timetable<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Timetable";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managetimetable_add", "Added $timetableName");
	} else if ($page == "managetimetable_add" && Authorize::isAllowable($config, "managetimetable_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Timetable</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managetimetable_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="timetableName">Activity Name </label>
						<input type="text" name="timetableName" id="timetableName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Activity Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Venue </label>
						<select id="venueId" name="venueId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Venue">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Venue::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="startTime">Start Time </label>
						<input class="timepicker" type="text" name="startTime" id="startTime" size="12" required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="Start Time: <?= $msgTime ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="endTime">End Time </label>
						
						<input class="timepicker" type="text" name="endTime" id="endTime" size="12" required required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="End Time: <?= $msgTime ?>" />
					</div>
					<div class="pure-control-group">
						<label for="validFrom">Valid From</label>
						<input class="datepicker"type="text" name="validFrom" id="validFrom" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid From (Date) : <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="validTo">Valid To</label>
						<input class="datepicker"type="text" name="validTo" id="validTo" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Valid To (Date) : <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="dayOfAWeekId">Day of A Week </label>
						<select id="dayOfAWeekId" name="dayOfAWeekId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Day of a week">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = DaysOfAWeek::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div id="<?= System::getCodeString(8) ?>" class="pure-control-group color-picker-container">
						<label title="Color which will be used to show this timetable on the grid" for="textColor">Text Color </label>
						<input readOnly class="ui-sys-color-picker" type="text" name="textColor" id="textColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div id="<?= System::getCodeString(8) ?>" class="pure-control-group color-picker-container">
						<label title="Background Color which will be used to show this timetable on the grid" for="backgroundColor">Background Color </label>
						<input readOnly class="ui-sys-color-picker" type="text" name="backgroundColor" id="backgroundColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managetimetable">Back to Timetable Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managetimetable" && Authorize::isAllowable($config, "managetimetable", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Timetables Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-timetable-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managetimetable" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managetimetable_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Activity <br/>Name</th>
				<th>Venue</th>
				<th>Day</th>
				<th>Start Time</th>
				<th>End Time</th>
				<th>Text Color</th>
				<th>Background<br/>Color</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Timetable::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch timetable data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$timetable1 = null;
		try {
			$timetable1 = new Timetable($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($timetable1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
			$statusColor = "red";
			if (Timetable::isValid($timetable1, $systemTime1)) $statusColor = "blue";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?>&nbsp;<span style="background-color: <?= $statusColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;</td>
				<td><?= $timetable1->getActivityName() ?></td>
				<td>
<?php 
	if (! is_null($timetable1->getVenue()))	{
?>
		<?= $timetable1->getVenue()->getVenueName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($timetable1->getDayOfAWeek()))	{
?>
		<?= $timetable1->getDayOfAWeek()->getDayAbbreviation() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($timetable1->getStartTime()))	{
?>
		<?= DateAndTime::convertFromSystemDateAndTimeFormatToTimeOnlyFormat($timetable1->getStartTime()->getDateAndTimeString()) ?>
<?php
	}
?>
				</td>
				<td>
<?php 
	if (! is_null($timetable1->getEndTime()))	{
?>
		<?= DateAndTime::convertFromSystemDateAndTimeFormatToTimeOnlyFormat($timetable1->getEndTime()->getDateAndTimeString()) ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	$textColor = $timetable1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	$textColor = $timetable1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managetimetable_detail&id=<?= $timetable1->getTimetableId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managetimetable_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managetimetable_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managetimetable_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Timetable" href="<?= $thispage ?>?page=managetimetable_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Timetable End*/ else/*Schedule BEGIN*/if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_groups']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Targets Map from ".$schedule1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Dettach");
			$listToUpdate = Object::detachIdListFromObjectList($schedule1->getGroupList(), $_REQUEST['did']);
			$schedule1->setGroupList($listToUpdate);
			$schedule1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Group List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Group List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_edit", "Detach Groups for ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_groups']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Group Map to ".$schedule1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($schedule1->getGroupList(), $_REQUEST['did']);
			$schedule1->setGroupList($listToUpdate);
			$schedule1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Group List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Group List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_edit", "Attach Groups for ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_groups']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Group Map to ".$schedule1->getActivityName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schedule1->getGroupList()) && sizeof($schedule1->getGroupList()) > 0)	{
		$objectList1 = $schedule1->getGroupList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="manageschedule_edit"/>
				<input type="hidden" name="id" value="<?= $schedule1->getScheduleId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_groups" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
					<tr>
						<th colspan="7">Targeted Groups</th>
					</tr>
					<tr>
						<th></th>
						<th>S/N</th>
						<th>Group Name</th>
						<th>Parent Group</th>
						<th>Course</th>
						<th>Year</th>
						<th>Semester</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getGroupId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getParentGroup()))	{
		echo $obj1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
		echo $obj1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Groups"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageschedule_edit&id=<?= $schedule1->getScheduleId() ?>&attach_groups=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="manageschedule_edit"/>
		<input type="hidden" name="id" value="<?= $schedule1->getScheduleId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_groups" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Group Name</th>
					<th>Parent Group</th>
					<th>Course</th>
					<th>Year</th>
					<th>Semester</th>
				</tr>
			</thead>
<?php 
	$query = Group::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Group($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getGroupId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $transaction1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($transaction1->getParentGroup()))	{
		echo $transaction1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($transaction1->getCourse()))	{
		echo $transaction1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $transaction1->getYear() ?></td>
			<td><?= $transaction1->getSemester() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Group"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_login']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "De-Assign Event Creators Map from ".$schedule1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($schedule1->getInstructorList(), $_REQUEST['did']);
			$schedule1->setInstructorList($listToUpdate);
			$schedule1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Instructor List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Instructor List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_edit", "Detach Instructors for ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Instructor Map to ".$schedule1->getActivityName();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($schedule1->getInstructorList(), $_REQUEST['did']);
			$schedule1->setInstructorList($listToUpdate);
			$schedule1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Instructor List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Instructor List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_edit", "Attach Instructors for ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_login']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		$headerText = "UNKNOWN";
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$headerText = "Assign Instructor Map to ".$schedule1->getActivityName();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
?>
		<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schedule1->getInstructorList()) && sizeof($schedule1->getInstructorList()) > 0)	{
		$objectList1 = $schedule1->getInstructorList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="manageschedule_edit"/>
				<input type="hidden" name="id" value="<?= $schedule1->getScheduleId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_login" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
					<thead>
						<tr>
						<th colspan="6">Scheduled By</th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Name</th>
							<th>Email</th>
							<th>Phone</th>
							<th>Status</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getLoginId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
				</table>
				<div class="ui-sys-right">
					<input type="submit" value="Detach Instructors"/>
				</div>
			</form>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
<?php
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageschedule_edit&id=<?= $schedule1->getScheduleId() ?>&attach_login=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="manageschedule_edit"/>
		<input type="hidden" name="id" value="<?= $schedule1->getScheduleId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_login" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Name</th>
					<th>Email</th>
					<th>Phone</th>
					<th>Status</th>
				</tr>
			</thead>
<?php 
	$query = Login::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new Login($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getLoginId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getFullname() ?></td>
				<td><?= $transaction1->getEmail() ?></td>
				<td><?= $transaction1->getPhone() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getUserStatus()))	{
		echo $transaction1->getUserStatus()->getStatusName();
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Instructor"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageschedule_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "manageschedule_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageschedule_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule CSV File <br/> (Download CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Schedule::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Schedule[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$schedule1 = null;
			try	{
				$schedule1 = new Schedule($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($schedule1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageschedule_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageschedule_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageschedule_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageschedule_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageschedule_csv" && Authorize::isAllowable($config, "manageschedule_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageschedule_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Schedule::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageschedule_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageschedule_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$schedule1 = null;
		try {
			 $schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			 $schedule1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Schedule which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Schedule <?= $schedule1->getActivityName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Schedule <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_delete", "Deleted ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageschedule_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$schedule1 = null;
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$schedule1->setExtraFilter(System::getCodeString(8));
			$schedule1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Schedule <b><?= $schedule1->getActivityName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Schedule <?= $schedule1->getActivityName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageschedule_delete&report=io&id=<?= $schedule1->getScheduleId() ?>&rndx=<?= $schedule1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageschedule">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schedule1 = null;
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$scheduleName = mysql_real_escape_string($_REQUEST['scheduleName']);
		$venueId = mysql_real_escape_string($_REQUEST['venueId']);
		$textColor = mysql_real_escape_string($_REQUEST['textColor']);
		$backgroundColor = mysql_real_escape_string($_REQUEST['backgroundColor']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$startTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['startDate'], $_REQUEST['startTime']);
		$endTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['endDate'], $_REQUEST['endTime']);
		if ($scheduleName != $schedule1->getActivityName())	{
			$schedule1->setActivityName($scheduleName); $enableUpdate = true;
		}
		if (is_null($schedule1->getVenue()) || ($schedule1->getVenue()->getVenueId() != $venueId))	{
			$schedule1->setVenue($venueId); $enableUpdate = true;
		}
		if (is_null($schedule1->getStartTime()) || ($schedule1->getStartTime()->getDateAndTimeString() != $startTime))	{
			$schedule1->setStartTime($startTime); $enableUpdate = true;
		}
		if (is_null($schedule1->getEndTime()) || ($schedule1->getEndTime()->getDateAndTimeString() != $endTime))	{
			$schedule1->setEndTime($endTime); $enableUpdate = true;
		}
		if ($textColor != $schedule1->getTextColor())	{
			$schedule1->setTextColor($textColor); $enableUpdate = true;
		}
		if ($backgroundColor != $schedule1->getBackgroundColor())	{
			$schedule1->setBackgroundColor($backgroundColor); $enableUpdate = true;
		}
		if ($extraInformation != $schedule1->getExtraInformation())	{
			$schedule1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $schedule1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$schedule1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$startTime1 = new DateAndTime("Zoomtong", $startTime, "Company");
				$endTime1 = new DateAndTime("Zoomtong", $endTime, "Company");
				if (! (($systemTime1->compareDateAndTime($startTime1) < 0) && ($startTime1->compareDateAndTime($endTime1) < 0))) Object::shootException("Schedule[Time Range]: Time range is not possible ");
				$schedule1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedule Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Schedule <?= $schedule1->getActivityName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the schedule <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_edit", "Edited ".$schedule1->getActivityName());
	} else if ($page == "manageschedule_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageschedule_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schedule1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
			$schedule1->setExtraFilter($extraFilter);
			$schedule1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Schedule <?= $schedule1->getActivityName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageschedule_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $schedule1->getScheduleId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $schedule1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="scheduleName">Schedule Name </label>
						<input value="<?= $schedule1->getActivityName() ?>" type="text" name="scheduleName" id="scheduleName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Schedule Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Venue </label>
						<select id="venueId" name="venueId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Venue">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Venue::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($schedule1->getVenue()) && ($schedule1->getVenue()->getVenueId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	$startDate = "";
	$startTime = "";
	if (! is_null($schedule1->getStartTime()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($schedule1->getStartTime()->getDateAndTimeString());
		$startDate = $list['date'];
		$startTime = $list['time'];
	}
?>
					<div class="pure-control-group">
						<label for="startDate">Start Time </label>
						<input value="<?= $startDate ?>" class="datepicker"type="text" name="startDate" id="startDate" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Start Date : <?= $msgDate ?>"/>
						<input value="<?= $startTime ?>" class="timepicker" type="text" name="startTime" size="12" required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="Start Time: <?= $msgTime ?>"/>
					</div>
<?php 
	$endDate = "";
	$endTime = "";
	if (! is_null($schedule1->getEndTime()))	{
		$list = DateAndTime::convertFromSystemDateAndTimeFormatToGUIDateAndTimeFormat($schedule1->getEndTime()->getDateAndTimeString());
		$endDate = $list['date'];
		$endTime = $list['time'];
	}
?>
					<div class="pure-control-group">
						<label for="startDate">End Time </label>
						<input value="<?= $endDate ?>" class="datepicker"type="text" name="endDate" id="endDate" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="End Date : <?= $msgDate ?>"/>
						<input value="<?= $endTime ?>" class="timepicker" type="text" name="endTime" size="12" required required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="End Time: <?= $msgTime ?>" />
					</div>
					<div class="pure-control-group">
						<label title="Color which will be used to show this schedule on the grid" for="textColor">Text Color </label>
						<input value="<?= $schedule1->getTextColor() ?>" type="text" name="textColor" id="textColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Background Color which will be used to show this schedule on the grid" for="backgroundColor">Background Color </label>
						<input value="<?= $schedule1->getBackgroundColor() ?>" type="text" name="backgroundColor" id="backgroundColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					
					
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $schedule1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageschedule_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$schedule1 = null;
		try {
			$schedule1 = new Schedule($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $schedule1->getActivityName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Schedule Name</td>
						<td><?= $schedule1->getActivityName() ?></td>
					</tr>
<?php 
	if (! is_null($schedule1->getVenue()))	{
?>
					<tr>
						<td>Venue</td>
						<td><?= $schedule1->getVenue()->getVenueName() ?></td>
					</tr>
<?php
	}
	if (! is_null($schedule1->getStartTime()))	{
?>
		<tr>
			<td>Start Time</td>
			<td><?= $schedule1->getStartTime()->getDateAndTimeString() ?></td>
		</tr>
<?php
	}
	if (! is_null($schedule1->getEndTime()))	{
?>
		<tr>
			<td>End Time</td>
			<td><?= $schedule1->getEndTime()->getDateAndTimeString() ?></td>
		</tr>
<?php
	}
?>
					<tr>
						<td>Text Color</td>
						<td>
<?php 
	$textColor = $schedule1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
					<tr>
						<td>Background Color</td>
						<td>
<?php 
	$textColor = $schedule1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
<?php 
	if (! is_null($schedule1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $schedule1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table><br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schedule1->getInstructorList()) && sizeof($schedule1->getInstructorList()) > 0)	{
		$objectList1 = $schedule1->getInstructorList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-1">
				<thead>
					<tr>
						<th colspan="5">Scheduled By</th>
					</tr>
					<tr>
						<th></th>
						<th>Name</th>
						<th>Email</th>
						<th>Phone</th>
						<th>Status</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getFullname() ?></td>
			<td><?= $obj1->getEmail() ?></td>
			<td><?= $obj1->getPhone() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getUserStatus()))	{
		echo $obj1->getUserStatus()->getStatusName();
	}
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
			<br/>
			<!--Begin of Cross Reference List Insertion-->
<?php 
	if (! is_null($schedule1->getGroupList()) && sizeof($schedule1->getGroupList()) > 0)	{
		$objectList1 = $schedule1->getGroupList();
?>
			<table class="pure-table pure-table-aligned ui-sys-table-search-results ui-sys-table-search-results-2">
				<thead>
					<tr>
						<th colspan="6">Targeted Groups</th>
					</tr>
					<tr>
						<th></th>
						<th>Group Name</th>
						<th>Parent Group</th>
						<th>Course</th>
						<th>Year</th>
						<th>Semester</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getGroupName() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getParentGroup()))	{
		echo $obj1->getParentGroup()->getGroupName();
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
		echo $obj1->getCourse()->getCourseName();
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
			<!--End of Cross Reference List Insertion-->
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageschedule_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $schedule1->getActivityName() ?>" href="<?= $thispage ?>?page=manageschedule_edit&id=<?= $schedule1->getScheduleId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageschedule_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $schedule1->getActivityName() ?>" href="<?= $thispage ?>?page=manageschedule_delete&id=<?= $schedule1->getScheduleId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageschedule_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach Activity Creators" href="<?= $thispage ?>?page=manageschedule_edit&id=<?= $schedule1->getScheduleId() ?>&attach_login=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
		<a title="Attach Targeted Group" href="<?= $thispage ?>?page=manageschedule_edit&id=<?= $schedule1->getScheduleId() ?>&attach_groups=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
		</div>
	</div>
<?php
	} else if ($page == "manageschedule_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageschedule_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$scheduleName = mysql_real_escape_string($_REQUEST['scheduleName']);
		$venueId = mysql_real_escape_string($_REQUEST['venueId']);
		$textColor = mysql_real_escape_string($_REQUEST['textColor']);
		$backgroundColor = mysql_real_escape_string($_REQUEST['backgroundColor']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$startTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['startDate'], $_REQUEST['startTime']);
		$endTime = DateAndTime::convertFromGUIDateAndTimeFormatToSystemDateAndTimeFormat($_REQUEST['endDate'], $_REQUEST['endTime']);
		if ($textColor == "")	$textColor = "000000";
		if ($backgroundColor == "") $backgroundColor = "ffffff";
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $scheduleName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO schedule (scheduleName, venueId, startTime, endTime, textColor, backgroundColor, extraFilter, extraInformation) VALUES('$scheduleName', '$venueId', '$startTime', '$endTime', '$textColor', '$backgroundColor', '$extraFilter', '$extraInformation')";
	try {
		$startTime1 = new DateAndTime("Zoomtong", $startTime, "Company");
		$endTime1 = new DateAndTime("Zoomtong", $endTime, "Company");
		if (! (($systemTime1->compareDateAndTime($startTime1) < 0) && ($startTime1->compareDateAndTime($endTime1) < 0))) Object::shootException("Schedule[Time Range]: Time range is not possible ");
		mysql_db_query($database, $query, $conn) or Object::shootException("Schedule[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Schedule <?= $scheduleName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the schedule<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageschedule_add", "Added $scheduleName");
	} else if ($page == "manageschedule_add" && Authorize::isAllowable($config, "manageschedule_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Schedule</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageschedule_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="scheduleName">Schedule Name </label>
						<input type="text" name="scheduleName" id="scheduleName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Schedule Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Venue </label>
						<select id="venueId" name="venueId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Venue">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Venue::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="startDate">Start Time </label>
						<input class="datepicker"type="text" name="startDate" id="startDate" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Start Date : <?= $msgDate ?>"/>
						<input class="timepicker" type="text" name="startTime" size="12" required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="Start Time: <?= $msgTime ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="startDate">End Time </label>
						<input class="datepicker"type="text" name="endDate" id="endDate" size="12" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="End Date : <?= $msgDate ?>"/>
						<input class="timepicker" type="text" name="endTime" size="12" required required pattern="<?= $exprTime ?>" validate="true" validate_control="text" validate_expression="<?= $exprTime ?>" validate_message="End Time: <?= $msgTime ?>" />
					</div>
					<div class="pure-control-group">
						<label title="Color which will be used to show this schedule on the grid" for="textColor">Text Color </label>
						<input type="text" name="textColor" id="textColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Background Color which will be used to show this schedule on the grid" for="backgroundColor">Background Color </label>
						<input type="text" name="backgroundColor" id="backgroundColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageschedule" && Authorize::isAllowable($config, "manageschedule", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Schedules Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-schedule-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageschedule" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageschedule_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Activity <br/>Name</th>
				<th>Venue</th>
				<th>Start Time</th>
				<th>End Time</th>
				<th>Text Color</th>
				<th>Background<br/>Color</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Schedule::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch schedule data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$schedule1 = null;
		try {
			$schedule1 = new Schedule($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($schedule1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $schedule1->getActivityName() ?></td>
				<td>
<?php 
	if (! is_null($schedule1->getVenue()))	{
?>
		<?= $schedule1->getVenue()->getVenueName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($schedule1->getStartTime()))	{
?>
		<?= $schedule1->getStartTime()->getDateAndTimeString() ?>
<?php
	}
?>
				</td>
				<td>
<?php 
	if (! is_null($schedule1->getEndTime()))	{
?>
		<?= $schedule1->getEndTime()->getDateAndTimeString() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	$textColor = $schedule1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	$textColor = $schedule1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageschedule_detail&id=<?= $schedule1->getScheduleId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageschedule_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageschedule_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageschedule_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Schedule" href="<?= $thispage ?>?page=manageschedule_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Schedule End*/ else/*Holiday BEGIN*/if ($page == "manageholiday_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageholiday_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "manageholiday_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageholiday_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday CSV File <br/> (Download CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Holiday::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Holiday[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$holiday1 = null;
			try	{
				$holiday1 = new Holiday($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($holiday1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageholiday_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageholiday_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageholiday_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageholiday_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageholiday_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageholiday_csv" && Authorize::isAllowable($config, "manageholiday_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageholiday_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Holiday::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageholiday_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageholiday_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$holiday1 = null;
		try {
			 $holiday1 = new Holiday($database, $_REQUEST['id'], $conn);
			 $holiday1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Holiday which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Holiday <?= $holiday1->getHolidayName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Holiday <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageholiday_delete", "Deleted ".$holiday1->getHolidayName());
	} else if ($page == "manageholiday_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageholiday_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$holiday1 = null;
		try {
			$holiday1 = new Holiday($database, $_REQUEST['id'], $conn);
			$holiday1->setExtraFilter(System::getCodeString(8));
			$holiday1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Holiday <b><?= $holiday1->getHolidayName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Holiday <?= $holiday1->getHolidayName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageholiday_delete&report=io&id=<?= $holiday1->getHolidayId() ?>&rndx=<?= $holiday1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageholiday">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageholiday_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageholiday_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$holiday1 = null;
		try {
			$holiday1 = new Holiday($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$holidayName = mysql_real_escape_string($_REQUEST['holidayName']);
		$holidayTime = mysql_real_escape_string($_REQUEST['holidayTime']);
		$textColor = mysql_real_escape_string($_REQUEST['textColor']);
		$backgroundColor = mysql_real_escape_string($_REQUEST['backgroundColor']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$holidayTime = $holidayTime."/*";
		$holidayTime = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($holidayTime); 
		if ($holidayName != $holiday1->getHolidayName())	{
			$holiday1->setHolidayName($holidayName); $enableUpdate = true;
		}
		if (is_null($holiday1->getHolidayTime()) || ($holiday1->getHolidayTime()->getDateAndTimeString() != $holidayTime))	{
			$holiday1->setHolidayTime($holidayTime); $enableUpdate = true;
		}
		if ($textColor != $holiday1->getTextColor())	{
			$holiday1->setTextColor($textColor); $enableUpdate = true;
		}
		if ($backgroundColor != $holiday1->getBackgroundColor())	{
			$holiday1->setBackgroundColor($backgroundColor); $enableUpdate = true;
		}
		if ($extraInformation != $holiday1->getExtraInformation())	{
			$holiday1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $holiday1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$holiday1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$holiday1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holiday Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Holiday <?= $holiday1->getHolidayName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the holiday <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageholiday_edit", "Edited ".$holiday1->getHolidayName());
	} else if ($page == "manageholiday_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageholiday_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$holiday1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$holiday1 = new Holiday($database, $_REQUEST['id'], $conn);
			$holiday1->setExtraFilter($extraFilter);
			$holiday1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Holiday <?= $holiday1->getHolidayName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageholiday_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $holiday1->getHolidayId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $holiday1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="holidayName">Holiday Name </label>
						<input value="<?= $holiday1->getHolidayName() ?>" type="text" name="holidayName" id="holidayName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Holiday Name : <?= $msgA48Name ?>"/>
					</div>
<?php 
	$holidayTime = $holiday1->getHolidayTime();
	if (! is_null($holidayTime))	{
		$holidayTime = System::numberWidthCorrection($holidayTime->getDay(), 2)."/".System::numberWidthCorrection($holidayTime->getMonth(), 2);
	} else {
		$holidayTime = "";
	}
?>
					<div class="pure-control-group">
						<label for="holidayTime">Date </label>
						<input value="<?= $holidayTime ?>" type="text" name="holidayTime" id="holidayTime" size="24" required pattern="<?= $exprDateNoYear ?>" validate="true" validate_control="text" validate_expression="<?= $exprDateNoYear ?>" validate_message="Date : <?= $msgDateNoYear ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Color which will be used to show this holiday on the grid" for="textColor">Text Color </label>
						<input value="<?= $holiday1->getTextColor() ?>" type="text" name="textColor" id="textColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Background Color which will be used to show this holiday on the grid" for="backgroundColor">Background Color </label>
						<input value="<?= $holiday1->getBackgroundColor() ?>" type="text" name="backgroundColor" id="backgroundColor" size="24" required pattern="<?= $exprHexColor ?>" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					
					
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $holiday1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageholiday_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageholiday_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$holiday1 = null;
		try {
			$holiday1 = new Holiday($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $holiday1->getHolidayName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Holiday Name</td>
						<td><?= $holiday1->getHolidayName() ?></td>
					</tr>
					<tr>
						<td>Date </td>
						<td>
<?php 
	if (! is_null($holiday1->getHolidayTime()))	{
		$holidayTime1 = $holiday1->getHolidayTime();
		$dtString = System::dayOfAMonthValueAdjustment($holidayTime1->getDay());
		$month1 = null;
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		try {
			$monthId = MonthOfAYear::getMonthOfAYearReferenceFromMonthNumber($database, $holidayTime1->getMonth(), $conn);
			$month1 = new MonthOfAYear($database, $monthId, $conn);
			$dtString .= " of ".$month1->getMonthName();
		} catch (Exception $e)	{ die($e->getMessage()); }
		mysql_close($conn);
					echo $dtString;
	}
?>	
						</td>
					</tr>
					<tr>
						<td>Text Color</td>
						<td>
<?php 
	$textColor = $holiday1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
					<tr>
						<td>Background Color</td>
						<td>
<?php 
	$textColor = $holiday1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
		
						</td>
					</tr>
<?php 
	if (! is_null($holiday1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $holiday1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageholiday_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $holiday1->getHolidayName() ?>" href="<?= $thispage ?>?page=manageholiday_edit&id=<?= $holiday1->getHolidayId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageholiday_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $holiday1->getHolidayName() ?>" href="<?= $thispage ?>?page=manageholiday_delete&id=<?= $holiday1->getHolidayId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
		</div>
	</div>
<?php
	} else if ($page == "manageholiday_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageholiday_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$holidayName = mysql_real_escape_string($_REQUEST['holidayName']);
		$holidayTime = mysql_real_escape_string($_REQUEST['holidayTime']);
		$textColor = mysql_real_escape_string($_REQUEST['textColor']);
		$backgroundColor = mysql_real_escape_string($_REQUEST['backgroundColor']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$holidayTime = $holidayTime."/*";
		$holidayTime = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat($holidayTime); 
		if ($textColor == "")	$textColor = "000000";
		if ($backgroundColor == "") $backgroundColor = "ffffff";
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $holidayName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO holiday (holidayName, holidayTime, textColor, backgroundColor, extraFilter, extraInformation) VALUES('$holidayName', '$holidayTime', '$textColor', '$backgroundColor', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Holiday[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Holiday <?= $holidayName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the holiday<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageholiday_add", "Added $holidayName");
	} else if ($page == "manageholiday_add" && Authorize::isAllowable($config, "manageholiday_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Holiday</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageholiday_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="holidayName">Holiday Name </label>
						<input type="text" name="holidayName" id="holidayName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Holiday Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="holidayTime">Date </label>
						<input type="text" name="holidayTime" id="holidayTime" size="24" required pattern="<?= $exprDateNoYear ?>" validate="true" validate_control="text" validate_expression="<?= $exprDateNoYear ?>" validate_message="Date : <?= $msgDateNoYear ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Color which will be used to show this holiday on the grid" for="textColor">Text Color </label>
						<input type="text" name="textColor" id="textColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Text Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Background Color which will be used to show this holiday on the grid" for="backgroundColor">Background Color </label>
						<input type="text" name="backgroundColor" id="backgroundColor" size="24" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprHexColor ?>" validate_message="Background Color : <?= $msgHexColor ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageholiday" && Authorize::isAllowable($config, "manageholiday", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Holidays Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-holiday-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageholiday" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageholiday_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name of the Holiday</th>
				<th>Date</th>
				<th>Text Color</th>
				<th>Background<br/>Color</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Holiday::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch holiday data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$holiday1 = null;
		try {
			$holiday1 = new Holiday($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($holiday1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $holiday1->getHolidayName() ?></td>
				<td>
<?php 
	if (! is_null($holiday1->getHolidayTime()))	{
		$holidayTime1 = $holiday1->getHolidayTime();
		$dtString = System::dayOfAMonthValueAdjustment($holidayTime1->getDay());
		$month1 = null;
		try {
			$monthId = MonthOfAYear::getMonthOfAYearReferenceFromMonthNumber($database, $holidayTime1->getMonth(), $conn);
			$month1 = new MonthOfAYear($database, $monthId, $conn);
			$dtString .= " of ".$month1->getMonthName();
		} catch (Exception $e)	{ die($e->getMessage()); }
					echo $dtString;
	}
?>				
				</td>
				<td>
<?php 
	$textColor = $holiday1->getTextColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	$textColor = $holiday1->getBackgroundColor();
?>				
					<span style="background-color: <?= $textColor ?>;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<?= $textColor ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageholiday_detail&id=<?= $holiday1->getHolidayId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageholiday_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageholiday_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageholiday_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Holiday" href="<?= $thispage ?>?page=manageholiday_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Holiday End*/ else/*Venue BEGIN*/if ($page == "managevenue_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managevenue_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a></div>
		</div>
<?php
	} else if ($page == "managevenue_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managevenue_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Venue::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Venue[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$venue1 = null;
			try	{
				$venue1 = new Venue($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($venue1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managevenue_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managevenue_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managevenue_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managevenue_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managevenue_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managevenue_csv" && Authorize::isAllowable($config, "managevenue_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managevenue_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Venue::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managevenue_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managevenue_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$venue1 = null;
		try {
			 $venue1 = new Venue($database, $_REQUEST['id'], $conn);
			 $venue1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Venue which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Venue <?= $venue1->getVenueName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Venue <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managevenue_delete", "Deleted ".$venue1->getVenueName());
	} else if ($page == "managevenue_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managevenue_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$venue1 = null;
		try {
			$venue1 = new Venue($database, $_REQUEST['id'], $conn);
			$venue1->setExtraFilter(System::getCodeString(8));
			$venue1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Venue <b><?= $venue1->getVenueName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Venue <?= $venue1->getVenueName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managevenue_delete&report=io&id=<?= $venue1->getVenueId() ?>&rndx=<?= $venue1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managevenue">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managevenue_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managevenue_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$venue1 = null;
		try {
			$venue1 = new Venue($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$venueName = mysql_real_escape_string($_REQUEST['venueName']);
		$venueCode = mysql_real_escape_string($_REQUEST['venueCode']);
		$capacity = mysql_real_escape_string($_REQUEST['capacity']);
		$numberOfConcurrentAllocations = mysql_real_escape_string($_REQUEST['numberOfConcurrentAllocations']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($venueName != $venue1->getVenueName())	{
			$venue1->setVenueName($venueName); $enableUpdate = true;
		}
		if ($venueCode != $venue1->getVenueCode())	{
			$venue1->setVenueCode($venueCode); $enableUpdate = true;
		}
		if ($capacity != $venue1->getCapacity())	{
			$venue1->setCapacity($capacity); $enableUpdate = true;
		}
		if ($numberOfConcurrentAllocations != $venue1->getNumberOfConcurrentAllocations())	{
			$venue1->setNumberOfConcurrentAllocations($numberOfConcurrentAllocations); $enableUpdate = true;
		}
		if ($extraInformation != $venue1->getExtraInformation())	{
			$venue1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $venue1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$venue1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$venue1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venue Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Venue <?= $venue1->getVenueName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the venue <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managevenue_edit", "Edited ".$venue1->getVenueName());
	} else if ($page == "managevenue_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managevenue_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$venue1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$venue1 = new Venue($database, $_REQUEST['id'], $conn);
			$venue1->setExtraFilter($extraFilter);
			$venue1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Venue <?= $venue1->getVenueName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managevenue_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $venue1->getVenueId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $venue1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="venueName">Venue Name </label>
						<input value="<?= $venue1->getVenueName() ?>" type="text" name="venueName" id="venueName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Venue Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="venueCode">Venue Code </label>
						<input value="<?= $venue1->getVenueCode() ?>" type="text" name="venueCode" id="venueCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Venue Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="capacity">Capacity </label>
						<input value="<?= $venue1->getCapacity() ?>" class="text-can-not-be-zero" type="text" name="capacity" id="capacity" size="24" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Capacity : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="numberOfConcurrentAllocations" title="Maximum Number of Concurrent Allocations, recommended value is 1">Concurrency Limit </label>
						<input value="<?= $venue1->getNumberOfConcurrentAllocations() ?>" class="text-can-not-be-zero" type="text" name="numberOfConcurrentAllocations" id="numberOfConcurrentAllocations" size="24" required placeholder="1" pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Max Concurrent Allocations : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $venue1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Records Count Can not be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managevenue_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managevenue_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$venue1 = null;
		try {
			$venue1 = new Venue($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $venue1->getVenueName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Venue Name</td>
						<td><?= $venue1->getVenueName() ?></td>
					</tr>
					<tr>
						<td>Venue Code</td>
						<td><?= $venue1->getVenueCode() ?></td>
					</tr>
					<tr>
						<td>Capacity</td>
						<td><?= $venue1->getCapacity() ?></td>
					</tr>
					<tr>
						<td>Current Allocations</td>
						<td><?= $venue1->getNumberOfConcurrentAllocations() ?></td>
					</tr>
<?php 
	if (! is_null($venue1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $venue1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managevenue_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $venue1->getVenueName() ?>" href="<?= $thispage ?>?page=managevenue_edit&id=<?= $venue1->getVenueId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managevenue_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $venue1->getVenueName() ?>" href="<?= $thispage ?>?page=managevenue_delete&id=<?= $venue1->getVenueId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managevenue_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managevenue_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$venueName = mysql_real_escape_string($_REQUEST['venueName']);
		$venueCode = mysql_real_escape_string($_REQUEST['venueCode']);
		$capacity = mysql_real_escape_string($_REQUEST['capacity']);
		$numberOfConcurrentAllocations = mysql_real_escape_string($_REQUEST['numberOfConcurrentAllocations']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $venueName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO venue (venueName, venueCode, capacity, numberOfConcurrentAllocations, extraFilter, extraInformation) VALUES('$venueName', '$venueCode', '$capacity', '$numberOfConcurrentAllocations', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Venue[Adding]: Could not Add a Record into the System ".mysql_error());
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Venue <?= $venueName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the venue<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Venue";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managevenue_add", "Added $venueName");
	} else if ($page == "managevenue_add" && Authorize::isAllowable($config, "managevenue_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Venue</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managevenue_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="venueName">Venue Name </label>
						<input type="text" name="venueName" id="venueName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Venue Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="venueCode">Venue Code </label>
						<input type="text" name="venueCode" id="venueCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Venue Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="capacity">Capacity </label>
						<input class="text-can-not-be-zero" type="text" name="capacity" id="capacity" size="24" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Capacity : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="numberOfConcurrentAllocations" title="Maximum Number of Concurrent Allocations, recommended value is 1">Concurrency Limit </label>
						<input class="text-can-not-be-zero" type="text" name="numberOfConcurrentAllocations" id="numberOfConcurrentAllocations" size="24" required placeholder="1" pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Max Concurrent Allocations : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managevenue">Back to Venue Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Records Count Can not be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managevenue" && Authorize::isAllowable($config, "managevenue", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Venues Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-venue-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managevenue" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managevenue_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Venue Name</th>
				<th>Venue Code</th>
				<th>Capacity</th>
				<th>Concurrency<br/>Limit</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Venue::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch venue data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$venue1 = null;
		try {
			$venue1 = new Venue($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($venue1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $venue1->getVenueName() ?></td>
				<td><?= $venue1->getVenueCode() ?></td>
				<td><?= $venue1->getCapacity() ?></td>
				<td><?= $venue1->getNumberOfConcurrentAllocations() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managevenue_detail&id=<?= $venue1->getVenueId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managevenue_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managevenue_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managevenue_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Venue" href="<?= $thispage ?>?page=managevenue_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Venue End*/ else/*MonthOfAYear BEGIN*/if ($page == "managemonthofayear_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managemonthofayear_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MonthOfAYear CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "managemonthofayear_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managemonthofayear_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MonthOfAYear CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = MonthOfAYear::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("MonthOfAYear[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$moy1 = null;
			try	{
				$moy1 = new MonthOfAYear($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($moy1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managemonthofayear_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managemonthofayear_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managemonthofayear_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MonthOfAYear CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managemonthofayear_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managemonthofayear_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managemonthofayear_csv" && Authorize::isAllowable($config, "managemonthofayear_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MonthOfAYear CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managemonthofayear_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, MonthOfAYear::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managemonthofayear_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managemonthofayear_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$moy1 = null;
		try {
			 $moy1 = new MonthOfAYear($database, $_REQUEST['id'], $conn);
			 $moy1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a MonthOfAYear which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">MonthOfAYear Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The MonthOfAYear <?= $moy1->getMonthOfAYearName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the MonthOfAYear <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managemonthofayear_delete", "Deleted ".$moy1->getMonthOfAYearName());
	} else if ($page == "managemonthofayear" && Authorize::isAllowable($config, "managemonthofayear", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Months of A Year</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-monthOfAYear-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managemonthofayear" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name of A Month</th>
				<th>Month <br/>Abbreviation</th>
				<th>Month Number</th>
				<th>Extra <br/>Information</th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = MonthOfAYear::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch monthOfAYear data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$moy1 = null;
		try {
			$moy1 = new MonthOfAYear($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($moy1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $moy1->getMonthName() ?></td>
				<td><?= $moy1->getMonthAbbreviation() ?></td>
				<td><?= $moy1->getMonthNumber() ?></td>
				<td><?= $moy1->getExtraInformation() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managemonthofayear_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managemonthofayear_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*MonthOfAYear End*/ else/*DaysOfAWeek BEGIN*/if ($page == "managedaysofaweek_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managedaysofaweek_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">DaysOfAWeek CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "managedaysofaweek_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managedaysofaweek_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">DaysOfAWeek CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = DaysOfAWeek::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("DaysOfAWeek[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$dow1 = null;
			try	{
				$dow1 = new DaysOfAWeek($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($dow1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managedaysofaweek_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managedaysofaweek_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managedaysofaweek_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">DaysOfAWeek CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managedaysofaweek_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managedaysofaweek_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managedaysofaweek_csv" && Authorize::isAllowable($config, "managedaysofaweek_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">DaysOfAWeek CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managedaysofaweek_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, DaysOfAWeek::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managedaysofaweek_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managedaysofaweek_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$dow1 = null;
		try {
			 $dow1 = new DaysOfAWeek($database, $_REQUEST['id'], $conn);
			 $dow1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a DaysOfAWeek which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">DaysOfAWeek Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The DaysOfAWeek <?= $dow1->getDaysOfAWeekName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the DaysOfAWeek <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managedaysofaweek_delete", "Deleted ".$dow1->getDaysOfAWeekName());
	} else if ($page == "managedaysofaweek" && Authorize::isAllowable($config, "managedaysofaweek", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Days of A Week</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-daysOfAWeek-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managedaysofaweek" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name of A Day</th>
				<th>Day <br/>Abbreviation</th>
				<th>Offset</th>
				<th>Extra <br/>Information</th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = DaysOfAWeek::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch daysOfAWeek data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$dow1 = null;
		try {
			$dow1 = new DaysOfAWeek($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($dow1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $dow1->getDayName() ?></td>
				<td><?= $dow1->getDayAbbreviation() ?></td>
				<td><?= $dow1->getOffsetValue() ?></td>
				<td><?= $dow1->getExtraInformation() ?></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managedaysofaweek_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managedaysofaweek_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*DaysOfAWeek End*/ else if ($page == "managesystemlogs" && Authorize::isAllowable($config, "managesystemlogs", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Logs</div>
			<div class="ui-sys-panel-body">
				<!--Block ONE BEGIN Search box-->
					<div class="pure-form ui-sys-search-container">
						<input title="Atleast Three Characters should be supplied" type="text" required placeholder="ABC" size="32" /> 
						<a title="Click To Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managesystemlogs" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
					</div>
					<!--Block ONE ENDS-->
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		/*Block Two Begin Search Results*/
?>
		<div class="ui-sys-search-results">
			<label id="statustextlabel"></label>
			<table class="pure-table pure-table-horizontal ui-sys-table-search-results">
				<thead>
					<tr>
						<th></th>
						<th>Time</th>
						<th>Actor</th>
						<th>Action</th>
						<th>Acted To</th>
					</tr>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	$list=SystemLogs::searchFromSystemLogs($database, $conn, $searchtext, 512); //Does not Allowed to exceed 512, due to memory leakage 
	foreach ($list as $alist)	{
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
?>
		<tr>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $alist['when'] ?></td>
			<td><?= $alist['who'] ?></td>
			<td><?= $alist['what'] ?></td>
			<td><?= $alist['towhom'] ?></td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}//end-foreach
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
				</thead>
			</table>
			<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
			<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
		</div>
<?php		
		/*Block Two Ending Search Results*/
	} //end-if-searchtext
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else if ($page == "managesystemfirewall_graph" && $login1->isRoot() && isset($_REQUEST['searchtext']) && isset($_REQUEST['type']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "setlog", "-1", "-1")) {
		$type = $_REQUEST['type'];
		$searchtext = $_REQUEST['searchtext'];
		$object1 = null;
		$objectText = "UNKNOWN";
		$targetObjectName = "UNKNOWN";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		if ($type == "login")	{
			try {
				$object1 = new Login($database, $_REQUEST['id'], $conn);
				$targetObjectName = $object1->getClassName();
				$targetText = $object1->getFullname();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else if ($type == "group")	{
			try {
				$object1 = new Group($database, $_REQUEST['id'], $conn);
				$targetObjectName = $object1->getClassName();
				$targetText = $object1->getGroupName();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else {
			$promise1->setReason("The System has received an Invalid Instruction, the Object Type could not be Identified");
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Authorization Graph for <?= $targetText ?><br/>(<?= $targetObjectName ?>)</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising() && ($object1->getClassName() == "Login") && $object1->isRoot())	{
?>
		<div class="ui-state-highlight">
			This is a SUPER USER, This User can perform ALL Operations in the System<br/>
			This User is ABOVE All the Firewall Rules
		</div>
<?php
	} else if ($promise1->isPromising())	{
		//General Non Root 
		$ds1 = Authorize::getAuthorizationGraphDataStructure($database, $conn, $object1, $type, $searchtext);
		if (! is_null($ds1))	{
			$numberOfColumns = sizeof($ds1['header']);
?>
			<table class="pure-table ui-sys-graph-drawable ui-sys-table-search-results">
				<thead>
					<tr>
						<th></th>
<?php 
	foreach ($ds1['header'] as $aheader)	{
?>
		<th><?= $aheader ?></th>
<?php
	}
?>
					</tr>
					<tr>
						<th></th>
<?php 
	foreach ($ds1['caption'] as $acaption)	{
?>
		<th><?= $acaption ?></th>
<?php
	}
?>
					</tr>
				</thead>
<?php 
	$row = "row";
	$viewableText = "";
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$tbodyClosed=true;
	for ($i=0; $i < sizeof($ds1) -2; $i++)	{
		$sqlReturnedRowCount = $i;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		$rowIndex = $row.$i;
		$contextId = $ds1[$rowIndex][0];
		$context1 = null;
		try {
			$context1 = new ContextPosition($database, $contextId, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$colorToDraw = "black";
		$viewableText = "";
		if ($ds1[$rowIndex][$numberOfColumns-1] == 1)	{
			$colorToDraw = "blue";
			$viewableText = "Allowed by";
		} else if ($ds1[$rowIndex][$numberOfColumns-1] == 0)	{
			$colorToDraw = "red";
			$viewableText = "Denied by";
		}
		$rowClassName = "";
		if (($perTbodyCounter % 2) == 1)	$rowClassName="pure-table-odd";
?>
		<tr class="<?= $rowClassName ?>">
			<td><?= $i+1 ?></td>
			<td><?= $context1->getContextCaption() ?></td>
<?php 
	$lengthToMark = 0;
	$markValue="X";
	for ($lengthToMark=1; $lengthToMark < $numberOfColumns; $lengthToMark++)	{
		if (isset($ds1[$rowIndex][$lengthToMark]))	{
			$markValue=$ds1[$rowIndex][$lengthToMark];
			if ($markValue != "X")	{
				break;
			}
		} else {
			break;
		}
	}//end-for-lengthToMark
	$tempText = $ds1['header'][$lengthToMark]."[".$ds1['caption'][$lengthToMark]."]";
	$viewableText = $viewableText." ".$tempText;
	$remainingLength = $numberOfColumns-($lengthToMark+1);
?>
			<td title="<?= $context1->getContextCaption() ?>" colspan="<?= $lengthToMark ?>" style="background-color: <?= $colorToDraw ?>;">&nbsp;</td>
			<td colspan="<?= $remainingLength ?>" style="font-style: italic; font-size: 0.8em;">(<?= $viewableText ?>)</td>
		</tr>
<?php
		$perTbodyCounter++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>				
			</table>
<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
<?php
		} else {
?>
			<div class="ui-state-error">
				There were no related Authorization Graph 
			</div>
<?php
		}
	} else {
		//Error Here 
?>
		<div class="ui-state-error">
			Could not load Graph for Authorization <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managesystemfirewall_graph&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>">Back to System Firewall Graph Manager for <?= $targetText ?> (<?= $_REQUEST['type'] ?>)</a></div>
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managesystemfirewall_graph" && $login1->isRoot() && isset($_REQUEST['type']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "setlog", "-1", "-1"))	{
		$type = $_REQUEST['type'];
		$object1 = null;
		$targetText = "UNKNOWN";
		$targetObjectName = "UNKNOWN";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		if ($type == "login")	{
			try {
				$object1 = new Login($database, $_REQUEST['id'], $conn);
				$targetObjectName = $object1->getClassName();
				$targetText = $object1->getFullname();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else if ($type == "group")	{
			try {
				$object1 = new Group($database, $_REQUEST['id'], $conn);
				$targetObjectName = $object1->getClassName();
				$targetText = $object1->getGroupName();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else {
			$promise1->setReason("Could not load the Object, The System received an Invalid Instruction");
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Authorization Graph for <?= $targetText ?><br/>(<?= $targetObjectName ?>)</div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<!--Begin Search UIs now comes here-->
			<div class="ui-sys-search-container pure-form">
				<input type="text" title="Atleast Three Characters should be supplied" required placeholder="ABC" size="32"/>
				<a title="Click To Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managesystemfirewall_graph&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
			</div>
		<!--End Search UIs comes to end-->
<?php
	} else {
?>
				<div class="ui-state-error">
					The System Could not load graph <br/>
					Details: <?= $promise1->getReason() ?>
				</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if (trim($_REQUEST['type']) != "login")	{
?>
		<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['id'] ?>">Back to <?= Object::getCaptionLabelFromPropertyName($_REQUEST['type']) ?> Manager (Details)</a></div>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managesystemfirewall" && $login1->isRoot() && isset($_REQUEST['report']) && isset($_REQUEST['type']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesystemfirewall", "normal", "setlog", "-1", "-1"))	{
		$type=$_REQUEST['type'];
		$object1 = null;
		$objectName = "";
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		if ($type == "login")	{
			$object1 = new Login($database, $_REQUEST['id'], $conn);
			$objectName = $object1->getFullname();
		} else if ($type == "group")	{
			$object1 = new Group($database, $_REQUEST['id'], $conn);
			$objectName = $object1->getGroupName();
		} else if ($type == "jobtitle")	{
			$object1 = new JobTitle($database, $_REQUEST['id'], $conn);
			$objectName = $object1->getJobName();
		} else {
			$promise1->setReason("Perhaps the system has received a wrong Instruction OR invalid Object Type");
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Firewall Report for <?= $objectName ?></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
		$enableUpdate = true;
?>
		<div class="ui-state-highlight">
			Firewall for <?= $objectName ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in updating the firewall or generating a report<br/>
			Details of a problem: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>">Back to System Firewall for <?= $objectName ?> (<?= $_REQUEST['type'] ?>)</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managesystemfirewall", "Changed for $objectName ($type)");
	} else if ($page == "managesystemfirewall" && $login1->isRoot() && isset($_REQUEST['type']) && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesystemfirewall", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$type = trim($_REQUEST['type']);
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$object1 = null;
		$objectName = "";
		$contextString1 = "";
		if ($type == "login")	{
			try {
				$object1 = new Login($database, $_REQUEST['id'], $conn);
				$objectName = $object1->getFullname();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else if ($type == "group")	{
			try {
				$object1 = new Group($database, $_REQUEST['id'], $conn);
				$objectName = $object1->getGroupName();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else if ($type == "jobtitle")	{
			 try {
				$object1 = new JobTitle($database, $_REQUEST['id'], $conn);
				$objectName = $object1->getJobName();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		} else {
			$promise1->setReason("The type Object could not be Identified");
			$promise1->setPromise(false);
		}
		if ($promise1->isPromising())	{
			$contextString1 = $object1->getContext();
			$object1->setExtraFilter(System::getCodeString(8));
			try {
				$object1->commitUpdate();
			} catch (Exception $e)	{
				$promise1->setReason("Can not set filter, ".$e->getMessage());
				$promise1->setPromise(false);
			}
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Firewall for <?= $objectName ?></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<!--Begin Search Box-->
		<div class="pure-form pure-group-control ui-sys-search-container">
			<input title="Atleast Three Characters should be supplied" type="text" required placeholder="ABC" size="32" />
			<a title="Click To Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
		</div>
		<!--End Search Box-->
		<!--Begin Box with Allow/Deny Do Not Care All-->
		<div class="ui-sys-firewall-all">
			<span>
				<input type="checkbox" value="1"/><input type="button" value="Allow All" title="Set All Actions to Allow" data-secure-code="<?= $object1->getExtraFilter() ?>" data-context-string="<?= $contextString1 ?>" data-server-path="../server/service_systemfirewall_save.php" data-context-character="1" data-object-type="<?= $_REQUEST['type'] ?>" data-object-id="<?= $_REQUEST['id'] ?>" data-context-target="perror" data-next-page="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>&report=kdiie&rndx=<?= $object1->getExtraFilter() ?>" disabled/>
			</span>
			<span>
				<input type="checkbox" value="0"/><input type="button" value="Deny All" title="Set All Actions to Deny" data-secure-code="<?= $object1->getExtraFilter() ?>" data-context-string="<?= $contextString1 ?>" data-server-path="../server/service_systemfirewall_save.php" data-context-character="0" data-object-type="<?= $_REQUEST['type'] ?>" data-object-id="<?= $_REQUEST['id'] ?>" data-context-target="perror" data-next-page="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>&report=kdiie&rndx=<?= $object1->getExtraFilter() ?>" disabled/>
			</span>
			<span>
				<input type="checkbox" value="X"/><input type="button" value="Do Not Care All" title="Set All Actions to Do Not Care" data-secure-code="<?= $object1->getExtraFilter() ?>" data-context-string="<?= $contextString1 ?>" data-server-path="../server/service_systemfirewall_save.php" data-context-character="X" data-object-type="<?= $_REQUEST['type'] ?>" data-object-id="<?= $_REQUEST['id'] ?>" data-context-target="perror" data-next-page="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>&report=kdiie&rndx=<?= $object1->getExtraFilter() ?>" disabled/>
			</span>
		</div>

		<!--End Box with Allow/Deny Do Not Care All-->
		<!--Begin Another Block with Search Results-->
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		$query = ContextPosition::getQueryText();
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$result = mysql_db_query($database, $query, $conn) or die("Could not connect execute Context Query");
?>
		<!--Block Two Begins: with search results-->
		<div class="ui-sys-search-results">
			<label id="statustextlabel"></label>
			<table class="pure-table ui-sys-table-search-results ui-sys-context-table">
		<thead>
			<tr>
				<th></th>
				<th>Caption</th>
				<th>Level</th>
				<th>Allow</th>
				<th>Deny</th>
				<th>Do Not Care</th>
			</tr>
		</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$context1 = null;
		try {
			$context1 = new ContextPosition($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$pos = $context1->getCharacterPosition();
		$char1 = Authorize::getContextCharacter($contextString1, $pos);
		//Marker for display
		$action="";
		$level = 0;
		$chkAllow="";
		$chkDeny="";
		$chkDoNotCare="";
		if ($char1=="X")	{
			$action="donotcare";
			$chkDoNotCare="Checked";
		} else {
			$val=-1;
			try {
				$val = ContextDefinition::getValueFromCharacter($database, $char1, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			if ($val == 0)	{
				$action="deny";
				$chkDeny="checked";
			} else {
				$action="allow";
				$level=$val;
				$chkAllow="checked";
			}//end-if-else 
		}//end-if-else 
		$selectEnable="disabled";
		if ($action == "allow") $selectEnable="";
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($context1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			$disabled = "";
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?> ui-sys-context-data-row" data-context-id="<?= $context1->getContextId() ?>" data-context-position="<?= $pos ?>" data-context-character="<?= $char1 ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $context1->getContextCaption() ?></td>
				<td><label><select class="ui-sys-context-allow-select" <?= $selectEnable ?>>
<?php 
	for ($i=1; $i<=30; $i++)	{
		$selected = "";
		if (($action=="allow") && ($i==$level)) $selected="selected";
?>
		<option <?= $selected ?> value="<?= ContextDefinition::getCharacterFromValue($database, $i, $conn) ?>"><?= $i ?></option>
<?php
	} //end-for
?>				
				</select></label></td>
				<td><label><input <?= $chkAllow ?> value="1" class="ui-sys-control-radio control-radio-allow" type="radio" name="radauth<?= $id ?>"/>Allow</label></td>
				<td><label><input <?= $chkDeny ?> value="0" class="ui-sys-control-radio control-radio-deny" type="radio" name="radauth<?= $id ?>"/>Deny</label></td>
				<td><label><input <?= $chkDoNotCare ?> value="X" class="ui-sys-control-radio control-radio-donotcare" type="radio" name="radauth<?= $id ?>"/>Do Not Care</label></td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
			<div class="ui-sys-right">
				<input id="firewallRulesSavingCommand" type="button" title="Save the Customized Firewall Roles for <?= $objectName ?>" data-secure-code="<?= $object1->getExtraFilter() ?>" data-context-string="<?= $contextString1 ?>" data-server-path="../server/service_systemfirewall_save.php" data-object-type="<?= $_REQUEST['type'] ?>" data-object-id="<?= $_REQUEST['id'] ?>" data-context-target="perror" data-next-page="<?= $thispage ?>?page=managesystemfirewall&type=<?= $_REQUEST['type'] ?>&id=<?= $_REQUEST['id'] ?>&report=kdiie&rndx=<?= $object1->getExtraFilter() ?>" value="Save Firewall Rules"/>
			</div>
		</div>
		<!--Block Two Ends: with search result-->
<?php
		mysql_close($conn);
	} //end-if-search-text
?>		
		<!--End Another Block with Search Results-->
		<div id="perror" class="ui-sys-error-message"></div>
<?php
	} else {
?>
		<div class="ui-state-error">
			Could not load the reference Object, perhaps wrong Instruction<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	if (trim($_REQUEST['type']) != "login")	{
?>				
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manage<?= $_REQUEST['type'] ?>_detail&id=<?= $_REQUEST['id'] ?>">Back to <?= Object::getCaptionLabelFromPropertyName($_REQUEST['type']) ?> Manager (Details)</a>
<?php
	}
?>	
			</div>
		</div>
<?php
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['report']) && isset($_REQUEST['regnumbers']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setReason("Nothing has been updated");
		$profile1 = null;
		$enableUpdate = false;
		try {
			$profile1 = new Profile($database, $__profileId, $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		$nextRegistrationNumber = mysql_real_escape_string($_REQUEST['nextRegistrationNumber']);
		$registrationNumberWidth = mysql_real_escape_string($_REQUEST['registrationNumberWidth']);
		$nextExaminationNumber = mysql_real_escape_string($_REQUEST['nextExaminationNumber']);
		$examinationNumberWidth = mysql_real_escape_string($_REQUEST['examinationNumberWidth']);
		if ($nextRegistrationNumber != $profile1->getNextRegistrationNumber())	{
			$profile1->setNextRegistrationNumber($nextRegistrationNumber); $enableUpdate = true;
		}
		if ($registrationNumberWidth != $profile1->getRegistrationNumberWidth())	{
			$profile1->setRegistrationNumberWidth($registrationNumberWidth); $enableUpdate = true;
		}
		if ($nextExaminationNumber != $profile1->getNextExaminationNumber())	{
			$profile1->setNextExaminationNumber($nextExaminationNumber); $enableUpdate = true;
		}
		if ($examinationNumberWidth != $profile1->getExaminationNumberWidth())	{
			$profile1->setExaminationNumberWidth($examinationNumberWidth); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $profile1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now Proceed 
		$profile1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$profile1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Registration and Examination Numbers <br/>Global Settings (Update)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			You have successful updated the Registration or Examination Numbers
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in updating the Registration OR Examination Numbers<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_edit", "Registration OR Examination Numbers");
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['regnumbers']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$extraFilter = System::getCodeString(8);
		$profile1 = null;
		try {
			$profile1 = new Profile($database, $__profileId, $conn);
			$profile1->setExtraFilter($extraFilter);
			$profile1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Registration and Examination Numbers <br/>Global Settings</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					Please take a time to review these settings, we kindly recommend not to change these values often. We strongly discourage changing these values on production environment. If these values are wrongly set it would results to the system failing to generate either registration OR examination number
				</div>
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageprofile_edit"/>
					<input type="hidden" name="regnumbers" value="true"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="rndx" value="<?= $profile1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="nextRegistrationNumber">Next Registration Number </label>
						<input value="<?= $profile1->getNextRegistrationNumber() ?>" class="text-can-not-be-zero" type="text" name="nextRegistrationNumber" id="nextRegistrationNumber" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Next Registration Number : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="registrationNumberWidth">Registration Number Width </label>
						<input value="<?= $profile1->getRegistrationNumberWidth() ?>" class="text-can-not-be-zero" type="text" name="registrationNumberWidth" id="registrationNumberWidth" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Registration Number Width : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="nextExaminationNumber">Next Examination Number </label>
						<input value="<?= $profile1->getNextExaminationNumber() ?>" class="text-can-not-be-zero" type="text" name="nextExaminationNumber" id="nextExaminationNumber" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Next Examination Number : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="examinationNumberWidth">Examination Number Width </label>
						<input value="<?= $profile1->getExaminationNumberWidth() ?>" class="text-can-not-be-zero" type="text" name="examinationNumberWidth" id="examinationNumberWidth" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Examination Number Width : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Update Reg OR Exam Numbers"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Numbers can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['rndx']) && isset($_REQUEST['report']) && isset($_REQUEST['certificates']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$secured = 0;
		$strictSecured = 0;
		if (isset($_REQUEST['isSecured'])) $secured = 1;
		if (isset($_REQUEST['isStrictSecured'])) $strictSecured = 1;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
		$uprofile1 = null;
		try {
			$uprofile1 = new Profile($database, $profile1->getProfileId(), $conn);
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		$logText = "";
		if (($secured == 1) xor $uprofile1->isSecureConnectionRequired())	{
			$uprofile1->setSecureConnectionRequired($secured); $enableUpdate = true;
			$logText = "To INSECURED";
			if ($secured == 1)	{
				$logText = "To SECURED";
			} 
		}
		if (($secured == 1) && (($strictSecured == 1) xor $uprofile1->isStrictSecureConnectionRequired()))	{
			$uprofile1->setStrictSecureConnectionRequired($strictSecured); $enableUpdate = true;
			$tempText = " To Loose Secured";
			if ($strictSecured == 1) $tempText = " To Strict Secured";
			$logText .= $tempText;
		}
		
		if (trim($_REQUEST['rndx']) != $uprofile1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window or someone else is updating profile information");
			$promise1->setPromise(false);
		}
		$uprofile1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$uprofile1->commitUpdate();
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">SSL/TLS Certificates</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Certificates has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Certificates Update <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_edit", $logText);
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['certificates']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1")) {
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$uprofile1 = null;
		try {
			$uprofile1 = new Profile($database, $profile1->getProfileId(), $conn);
			$uprofile1->setExtraFilter(System::getCodeString(8));
			$uprofile1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
		$secureConnectionChecked = "";
		if ($uprofile1->isSecureConnectionRequired()) $secureConnectionChecked = "checked";
		$strictSecureConnectionChecked = "";
		if ($uprofile1->isStrictSecureConnectionRequired()) $strictSecureConnectionChecked = "checked";
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">SSL/TLS Certificates</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning" style="padding: 1px; margin: 1px; border: 1px dotted white;">
					Enabling <b>Secure Connection</b> will cause connection to this server to encrypted. The Server will use certificates as configured on the server or if there is a link to a Trusted Certificate Authority (CA)<br/>
					<b>RECOMMENDATION: </b>We strongly recommend to Enable Secure Connection , If you disable this feature you are vulnerable to Man In the Middle Attack <br/><br/>
					Enabling <b>Strict Secure Connection</b> will cause both LAN (Local Area Network) and WAN (Wide Area Network) connections to be secure. However disabling this feature will cause only WAN connections to be secure and LAN to be insecure<br/>
					<b>RECOMMENDATION: </b> You can disable this feature if your network is secured, otherwise enable this feature
				</div>
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageprofile_edit"/>
					<input type="hidden" name="certificates" value="ndimangwa.zoomtong.hk786"/>
					<input type="hidden" name="report" value="true"/>
					<input type="hidden" name="rndx" value="<?= $uprofile1->getExtraFilter() ?>"/>
					<div style="width: 90%; margin: 2px; margin-left: auto; margin-right: auto;">
						<table class="pure-table">
							<thead><tr><th>Certificate</th><th>LAN/WAN Security</th></tr></thead>
							<tbody>
								<tr>
									<td><label title="Check this Box for Secure Connection"><input <?= $secureConnectionChecked ?> type="checkbox" id="isSecured" name="isSecured" value="1"/>&nbsp;&nbsp;Enable/Disable Secure Connection</label></td>
									<td><label title="Check this Box for both LAN and WAN Secure Connection, Uncheck for WAN Secure Connection"><input <?= $strictSecureConnectionChecked ?> type="checkbox" id="isStrictSecured" name="isStrictSecured" value="1"/>&nbsp;&nbsp;Enable/Disable Strict Secure Connection</label></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="ui-sys-inline-controls-right"><input type="submit" value="Enable/Disable Certificates"/></div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	function uiMaintainance($secureCheck1, $strictSecureCheck1)	{
		if (! $secureCheck1.length) return;
		if (! $strictSecureCheck1.length) return;
		$strictSecureCheck1.prop('disabled', ! $secureCheck1.prop('checked'));
	}
	$(function()	{
		$('#isSecured').on('change', function(event)	{
			uiMaintainance($(this), $('#isStrictSecured'));
		});
		uiMaintainance($('#isSecured'), $('#isStrictSecured'));
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['report']) && isset($_REQUEST['record']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$maximumNumberOfReturnedSearchRecords = mysql_real_escape_string($_REQUEST['maximumNumberOfReturnedSearchRecords']);
		$maximumNumberOfDisplayedRowsPerPage = mysql_real_escape_string($_REQUEST['maximumNumberOfDisplayedRowsPerPage']);
		$profile1 = null;
		try {
			$profile1 = new profile($database, $__profileId, $conn);
			if ($maximumNumberOfReturnedSearchRecords != $profile1->getMaximumNumberOfReturnedSearchRecords())	{
				$profile1->setMaximumNumberOfReturnedSearchRecords($maximumNumberOfReturnedSearchRecords); $enableUpdate = true;
			}
			if ($maximumNumberOfDisplayedRowsPerPage != $profile1->getMaximumNumberOfDisplayedRowsPerPage())	{
				$profile1->setMaximumNumberOfDisplayedRowsPerPage($maximumNumberOfDisplayedRowsPerPage); $enableUpdate = true;
			}
			if ($enableUpdate) {
				$profile1->commitUpdate();
			}
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
			$enableUpdate = false;
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Records Size (Report)</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div ui-state-highlight>
			You have successful updated the records limit
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems on saving the record limits<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_edit", "Records Count Updates");
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['record']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Records Size</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageprofile_edit"/>
					<input type="hidden" name="record" value="<?= $_REQUEST['record'] ?>"/>
					<input type="hidden" name="report" value="true"/>
					<div class="pure-control-group">
						<label for="maximumNumberOfReturnedSearchRecords">Maximum Number of Returned Search Records </label>
						<input value="<?= $profile1->getMaximumNumberOfReturnedSearchRecords() ?>" class="text-can-not-be-zero" type="text" name="maximumNumberOfReturnedSearchRecords" id="maximumNumberOfReturnedSearchRecords" size="48" required pattern="<?= $exprRecordCount ?>" validate="true" validate_control="text" validate_expression="<?= $exprRecordCount ?>" validate_message="Maximu Number of Returned Search Records : <?= $msgRecordCount ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="maximumNumberOfDisplayedRowsPerPage">Maximum Number of Displayed Rows Per Page </label>
						<input value="<?= $profile1->getMaximumNumberOfDisplayedRowsPerPage() ?>" class="text-can-not-be-zero" type="text" name="maximumNumberOfDisplayedRowsPerPage" id="maximumNumberOfDisplayedRowsPerPage" size="48" required pattern="<?= $exprRecordCount ?>" validate="true" validate_control="text" validate_expression="<?= $exprRecordCount ?>" validate_message="Maximu Number of Displayed Rows Per Page : <?= $msgRecordCount ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Records Count Can not be Zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageprofile_edit" && $login1->isRoot() && isset($_REQUEST['warmreload']) && Authorize::isAllowable($config, "manageprofile_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$profile1 = null;
		try	{
			$profile1 = new Profile($database, $__profileId, $conn);
			//Hapa hapa tunamaliza kila kitu 
			$profile1->setInstallationComplete("0");
			$profile1->setApplicationCounter(intval($profile1->getApplicationCounter()) - 1);
			$profile1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Changing Installation Data<br/>Warm Reload</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
				<div>
					To complete this action, <a href="../">Click Here</a>
				</div>
<?php	
	} else {
?>
				<div class="ui-state-error">
					There were problems in attempting to change Installation Data <br/>
					Reason: <?= $promise1->getReason() ?>
				</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageprofile_edit", "Warm Reload of the System");
	} else if ($page == "manageprofile" && $login1->isRoot() && Authorize::isAllowable($config, "manageprofile", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">System Settings</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<table class="pure-table pure-table-horizontal">
					<thead>
						<tr>
							<th></th>
							<th>Details of Operation</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>1</td>
							<td>
								Change Installation Data, this is all the installation data you supplied during Installation <br/>
								NOTE: This will not affect the rest of existing system data
							</td>
							<td>
								<a href="<?= $thispage ?>?page=manageprofile_edit&warmreload=true" class="button-link" title="Changing Installation Data">Change</a>
							</td>
						</tr>
						<tr>
							<td>2</td>
							<td>
								This will change the size of maximum number of returned search records, it is also used to change <br/>
								maximum number of rows the system is allowed to display per page
							</td>
							<td>
								<a href="<?= $thispage ?>?page=manageprofile_edit&record=io" class="button-link" title="Changing Records Sizes">Change</a>
							</td>
						</tr>
						<tr>
							<td>3</td>
							<td>
								<b>SSL/TLS Certificate </b> This will enable/disable your server to use a trusted connection. It is Recommended to use a trusted connection especially during connection from a Wider Area Network (WAN)
							</td>
							<td>
								<a href="<?= $thispage ?>?page=manageprofile_edit&certificates=ndimangwa.zoomtong.dom.iks.co.en9732" class="button-link" title="Enable/Disable SSL/TLS Certificates">Certificates</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	} else /*CourseAndSubjectTransaction BEGIN*/if ($page == "managecourseandsubjecttransaction_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseAndSubjectTransaction CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a></div>
		</div>
<?php
	} else if ($page == "managecourseandsubjecttransaction_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseAndSubjectTransaction CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = CourseAndSubjectTransaction::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("CourseAndSubjectTransaction[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$transaction1 = null;
			try	{
				$transaction1 = new CourseAndSubjectTransaction($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($transaction1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseandsubjecttransaction_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseAndSubjectTransaction CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseandsubjecttransaction_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourseandsubjecttransaction_csv" && Authorize::isAllowable($config, "managecourseandsubjecttransaction_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseAndSubjectTransaction CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managecourseandsubjecttransaction_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, CourseAndSubjectTransaction::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourseandsubjecttransaction_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$transaction1 = null;
		try {
			 $transaction1 = new CourseAndSubjectTransaction($database, $_REQUEST['id'], $conn);
			 $transaction1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a CourseAndSubject Mapping which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course & Subject Mapping Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Course and Subject Mapping has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the CourseAndSubjectTransaction <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseandsubjecttransaction_delete", "Deleted [Course & Subject] Mapping");
	} else if ($page == "managecourseandsubjecttransaction_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $_REQUEST['id'], $conn);
			$transaction1->setExtraFilter(System::getCodeString(8));
			$transaction1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Course & Subject Mapping from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Course And Subject Mapping from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_delete&report=io&id=<?= $transaction1->getTransactionId() ?>&rndx=<?= $transaction1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseandsubjecttransaction_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$subjectId = mysql_real_escape_string($_REQUEST['subjectId']);
		$lectureHours = mysql_real_escape_string($_REQUEST['lectureHours']);
		$seminarAndTutorialHours = mysql_real_escape_string($_REQUEST['seminarAndTutorialHours']);
		$assignmentHours = mysql_real_escape_string($_REQUEST['assignmentHours']);
		$independentStudiesAndResearchHours = mysql_real_escape_string($_REQUEST['independentStudiesAndResearchHours']);
		$practicalTrainingHours = mysql_real_escape_string($_REQUEST['practicalTrainingHours']);
		$extraHours = mysql_real_escape_string($_REQUEST['extraHours']);
		$creditHours = mysql_real_escape_string($_REQUEST['creditHours']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$compulsory = 0;
		if (isset($_REQUEST['compulsory'])) $compulsory = 1;
		$coremodule = 0;
		if (isset($_REQUEST['coremodule'])) $coremodule = 1;
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if (is_null($transaction1->getCourse()) || ($courseId != $transaction1->getCourse()->getCourseId()))	{
			$transaction1->setCourse($courseId); $enableUpdate = true;
		}
		if (is_null($transaction1->getSubject()) || ($subjectId != $transaction1->getSubject()->getSubjectId()))	{
			$transaction1->setSubject($subjectId); $enableUpdate = true;
		}
		if ($lectureHours != $transaction1->getLectureHours())	{
			$transaction1->setLectureHours($lectureHours); $enableUpdate = true;
		}
		if ($seminarAndTutorialHours != $transaction1->getSeminarAndTutorialHours())	{
			$transaction1->setSeminarAndTutorialHours($seminarAndTutorialHours); $enableUpdate = true;
		}
		if ($assignmentHours != $transaction1->getAssignmentHours())	{
			$transaction1->setAssignmentHours($assignmentHours); $enableUpdate = true;
		}
		if ($independentStudiesAndResearchHours != $transaction1->getIndependentStudiesAndResearchHours())	{
			$transaction1->setIndependentStudiesAndResearchHours($independentStudiesAndResearchHours); $enableUpdate = true;
		}
		if ($practicalTrainingHours != $transaction1->getPracticalTrainingHours())	{
			$transaction1->setPracticalTrainingHours($practicalTrainingHours); $enableUpdate = true;
		}
		if ($extraHours != $transaction1->getExtraHours())	{
			$transaction1->setExtraHours($extraHours); $enableUpdate = true;
		}
		if ($creditHours != $transaction1->getCreditHours())	{
			$transaction1->setCreditHours($creditHours); $enableUpdate = true;
		}
		if ($year != $transaction1->getYear())	{
			$transaction1->setYear($year); $enableUpdate = true;
		}
		if ($semester != $transaction1->getSemester())	{
			$transaction1->setSemester($semester); $enableUpdate = true;
		}
		if (($compulsory == 1) xor $transaction1->isCompulsory())	{
			$transaction1->setCompulsory($compulsory); $enableUpdate = true;
		}
		if (($coremodule == 1) xor $transaction1->isCoreModule())	{
			$transaction1->setCoreModule($coremodule); $enableUpdate = true;
		}
		if ($extraInformation != $transaction1->getExtraInformation())	{
			$transaction1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $transaction1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$transaction1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				//Check valid Year and Semester 
				$course1 = new Course($database, $courseId, $conn);
				if (intval($year) > intval($course1->getDuration())) Object::shootException("Year Problem; The reference Course does not have the year supplied");
				if (intval($semester) > intval($profile1->getNumberOfSemestersPerYear())) Object::shootException("Semester Problem; ".$profile1->getProfileName()." does not have the supplied semester in a year");
				$transaction1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course & Subject Mapping Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Course And Subject Mapping has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the transaction <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseandsubjecttransaction_edit", "Edited [Course & Subject] Mapping");
	} else if ($page == "managecourseandsubjecttransaction_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$transaction1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $_REQUEST['id'], $conn);
			$transaction1->setExtraFilter($extraFilter);
			$transaction1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Course & Subject Mapping</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseandsubjecttransaction_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $transaction1->getTransactionId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $transaction1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="extraInformation">Map Name </label>
						<input title="Any Valid Name which will Identify your Map" value="<?= $transaction1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" required pattern="<?= $epxrL64Name  ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Map Name : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($transaction1->getCourse()) && ($alist1['id'] == $transaction1->getCourse()->getCourseId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="subjectId">Subject </label>
						<select id="subjectId" name="subjectId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Subject/Module">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Subject::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($transaction1->getSubject()) && ($alist1['id'] == $transaction1->getSubject()->getSubjectId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="lectureHours">Lecture Hours </label>
						<input value="<?= $transaction1->getLectureHours() ?>" type="text" name="lectureHours" id="lectureHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Lecture Hours : <?= $msgDecimalNumber ?>%Lecture Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="seminarAndTutorialHours">Seminar and Tutorial Hours </label>
						<input value="<?= $transaction1->getSeminarAndTutorialHours() ?>" type="text" name="seminarAndTutorialHours" id="seminarAndTutorialHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Seminar and Tutorial Hours : <?= $msgDecimalNumber ?>%Seminar and Tutorial Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="assignmentHours">Assignment Hours </label>
						<input value="<?= $transaction1->getAssignmentHours() ?>" type="text" name="assignmentHours" id="assignmentHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Assignment Hours : <?= $msgDecimalNumber ?>%Assignment Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="independentStudiesAndResearchHours">Independet Studies/Research Hours </label>
						<input value="<?= $transaction1->getIndependentStudiesAndResearchHours() ?>" type="text" name="independentStudiesAndResearchHours" id="independentStudiesAndResearchHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Independent Studies/Research Hours : <?= $msgDecimalNumber ?>%Independent Studies/Research Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="practicalTrainingHours">Practical Training Hours </label>
						<input value="<?= $transaction1->getPracticalTrainingHours() ?>" type="text" name="practicalTrainingHours" id="practicalTrainingHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Practical Training Hours : <?= $msgDecimalNumber ?>%Practical Training Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraHours">Extra Hours </label>
						<input value="<?= $transaction1->getExtraHours() ?>" type="text" name="extraHours" id="extraHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Extra Hours : <?= $msgDecimalNumber ?>%Extra Hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Credit Hours is different from other hours, this is the weight a subject will be carrying, it is usually the result of all hours" for="creditHours"><b>CREDIT HOURS</b> </label>
						<input value="<?= $transaction1->getCreditHours() ?>" type="text" name="creditHours" id="creditHours" size="8" required pattern="<?= $exprDecimalNumber ?>" validate="true" validate_control="text" validate_expression="<?= $exprDecimalNumber ?>%<?= $exprL8Name ?>" validate_message="Credit Hours : <?= $msgDecimalNumber ?>%Credit hours : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="year">Year </label>
						<input value="<?= $transaction1->getYear() ?>" class="text-can-not-be-zero" type="text" name="year" id="year" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Year : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="semester">Semester </label>
						<input value="<?= $transaction1->getSemester() ?>" class="text-can-not-be-zero" type="text" name="semester" id="semester" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Semester : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-controls">
<?php 
	$chkCompulsory = "";
	if ($transaction1->isCompulsory()) $chkCompulsory="checked";
?>
						<label><input <?= $chkCompulsory ?> type="checkbox" name="compulsory" value="1"/>&nbsp;&nbsp;Is A Compulsory?</label>
					</div>
					<div class="pure-controls">
<?php 
	$chkCoreModule = "";
	if ($transaction1->isCoreModule()) $chkCoreModule="checked";
?>
						<label><input <?= $chkCoreModule ?> type="checkbox" name="coremodule" value="1"/>&nbsp;&nbsp;Is A Core Module?</label>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Neither Year Nor Semester Can be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseandsubjecttransaction_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for Course & Subject Map</div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
<?php 
	
	if (! is_null($transaction1->getExtraInformation()))	{
?>
					<tr>
						<td>Map Name</td>
						<td><?= $transaction1->getExtraInformation() ?></td>
					</tr>
<?php
	} 
	if (! is_null($transaction1->getCourse()))	{
?>
					<tr>
						<td>Course</td>
						<td><?= $transaction1->getCourse()->getCourseName() ?></td>
					</tr>
<?php 
	}
	if (! is_null($transaction1->getSubject()))	{
?>
					<tr>
						<td>Subject</td>
						<td><?= $transaction1->getSubject()->getSubjectName() ?></td>
					</tr>
<?php 
	}
?>
					<tr>
						<td>Lecture Hours </td>
						<td><?= $transaction1->getLectureHours() ?></td>
					</tr>
					<tr>
						<td>Seminar and Tutorial Hours </td>
						<td><?= $transaction1->getSeminarAndTutorialHours() ?></td>
					</tr>
					<tr>
						<td>Assignment Hours </td>
						<td><?= $transaction1->getAssignmentHours() ?></td>
					</tr>
					<tr>
						<td>Independent Studies/ Research Hours </td>
						<td><?= $transaction1->getIndependentStudiesAndResearchHours() ?></td>
					</tr>
					<tr>
						<td>Practical Training Hours </td>
						<td><?= $transaction1->getPracticalTrainingHours() ?></td>
					</tr>
					<tr>
						<td>Extra Hours </td>
						<td><?= $transaction1->getExtraHours() ?></td>
					</tr>
					<tr>
						<td><i>Total Hours</i> </td>
						<td><?= $transaction1->getTotalHours() ?></td>
					</tr>
					<tr title="Credit Hours is different from normal Hours, it is the weight of subject, in most cases is derived from total hours">
						<td><b>CREDIT HOURS</b></td>
						<td><b><?= $transaction1->getCreditHours() ?></b></td>
					</tr>
					<tr>
						<td>Year</td>
						<td><?= $transaction1->getYear() ?></td>
					</tr>
					<tr>
						<td>Semester</td>
						<td><?= $transaction1->getSemester() ?></td>
					</tr>
					<tr>
						<td colspan="2">
<?php 
	$compulsoryText = "Optional Module";
	if ($transaction1->isCompulsory()) $compulsoryText = "Compulsory Module";
?>						
							<?= $compulsoryText ?>
						</td>
					</tr>
					<tr>
						<td colspan="2">
<?php 
	$coremoduleText = "Is A General Module";
	if ($transaction1->isCoreModule())	{
		$coremoduleText = "Is A Core Module";
	}
	echo $coremoduleText;
?>			
						</td>
					</tr>
			</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecourseandsubjecttransaction_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit Mapping" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_edit&id=<?= $transaction1->getTransactionId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourseandsubjecttransaction_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete Mapping" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_delete&id=<?= $transaction1->getTransactionId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managecourseandsubjecttransaction_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managecourseandsubjecttransaction_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$courseId = mysql_real_escape_string($_REQUEST['courseId']);
		$subjectId = mysql_real_escape_string($_REQUEST['subjectId']);
		$year = mysql_real_escape_string($_REQUEST['year']);
		$semester = mysql_real_escape_string($_REQUEST['semester']);
		$compulsory = 0;
		if (isset($_REQUEST['compulsory'])) $compulsory = 1;
		$flags = 15;
		if (isset($_REQUEST['coremodule']))	{
			$flags = $flags | pow(2, CourseAndSubjectTransaction::$__IS_CORE_MODULE);
		}
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for Course & Subject Mapping</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO courseAndSubjectTransaction (courseId, subjectId, year, semester, compulsory, extraFilter, extraInformation, flags) VALUES('$courseId', '$subjectId', '$year', '$semester', '$compulsory', '$extraFilter', '$extraInformation', '$flags')";
	try {
		//Check valid Year and Semester 
		$course1 = new Course($database, $courseId, $conn);
		if (intval($year) > intval($course1->getDuration())) Object::shootException("Year Problem; The reference Course does not have the year supplied");
		if (intval($semester) > intval($profile1->getNumberOfSemestersPerYear())) Object::shootException("Semester Problem; ".$profile1->getProfileName()." does not have the supplied semester in a year");
		mysql_db_query($database, $query, $conn) or Object::shootException("CourseAndSubjectTransaction[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Map for Course and Subject has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the Mapping<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Course & Subject Mapping";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseandsubjecttransaction_add", "Added Map [Course & Subject]");
	} else if ($page == "managecourseandsubjecttransaction_add" && Authorize::isAllowable($config, "managecourseandsubjecttransaction_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Course And Subject Mappings</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseandsubjecttransaction_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="extraInformation">Map Name </label>
						<input title="Any Valid Name which will identify your map" type="text" name="extraInformation" id="extraInformation" size="48" required pattern="<?= $exprL64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Map Name : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseId">Course </label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Course::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="subjectId">Subject </label>
						<select id="subjectId" name="subjectId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Subject/Module">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Subject::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="year">Year </label>
						<input class="text-can-not-be-zero" type="text" name="year" id="year" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Year : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="semester">Semester </label>
						<input class="text-can-not-be-zero" type="text" name="semester" id="semester" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Semester : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-controls">
						<label><input checked type="checkbox" name="compulsory" value="1"/>&nbsp;&nbsp;Is A Compulsory?</label>
					</div>
					<div class="pure-controls">
						<label><input checked type="checkbox" name="coremodule" value="1"/>&nbsp;&nbsp;Is A Core Module?</label>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseandsubjecttransaction">Back to Course & Subject Mapping Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Neither Year Nor Semester Can be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseandsubjecttransaction" && Authorize::isAllowable($config, "managecourseandsubjecttransaction", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseAndSubjectTransactions Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managecourseandsubjecttransaction" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managecourseandsubjecttransaction_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Map Name</th>
				<th>Course</th>
				<th>Subject/Module</th>
				<th>Year</th>
				<th>Semester</th>
				<th>Status</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = CourseAndSubjectTransaction::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getExtraInformation() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getCourse()))	{
?>
		<?= $transaction1->getCourse()->getCourseName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($transaction1->getSubject()))	{
?>
		<?= $transaction1->getSubject()->getSubjectName() ?>
<?php
	}
?>				
				</td>
				<td><?= $transaction1->getYear() ?></td>
				<td><?= $transaction1->getSemester() ?></td>
				<td>
<?php 
	$compulsoryText = "Optional";
	if ($transaction1->isCompulsory())	{
		$compulsoryText = "Compulsory";
	}
?>					<?= $compulsoryText ?>
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managecourseandsubjecttransaction_detail&id=<?= $transaction1->getTransactionId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecourseandsubjecttransaction_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourseandsubjecttransaction_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System CourseAndSubjectTransaction" href="<?= $thispage ?>?page=managecourseandsubjecttransaction_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*CourseAndSubjectTransaction End*/ else/*Subject BEGIN*/if ($page == "managesubject_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managesubject_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a></div>
		</div>
<?php
	} else if ($page == "managesubject_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managesubject_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Subject::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Subject[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$subject1 = null;
			try	{
				$subject1 = new Subject($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($subject1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managesubject_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managesubject_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managesubject_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managesubject_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managesubject_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managesubject_csv" && Authorize::isAllowable($config, "managesubject_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managesubject_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Subject::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managesubject_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managesubject_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$subject1 = null;
		try {
			 $subject1 = new Subject($database, $_REQUEST['id'], $conn);
			 $subject1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Subject which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Subject <?= $subject1->getSubjectName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Subject <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managesubject_delete", "Deleted ".$subject1->getSubjectName());
	} else if ($page == "managesubject_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesubject_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$subject1 = null;
		try {
			$subject1 = new Subject($database, $_REQUEST['id'], $conn);
			$subject1->setExtraFilter(System::getCodeString(8));
			$subject1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Subject <b><?= $subject1->getSubjectName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Subject <?= $subject1->getSubjectName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managesubject_delete&report=io&id=<?= $subject1->getSubjectId() ?>&rndx=<?= $subject1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managesubject">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managesubject_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managesubject_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$subject1 = null;
		try {
			$subject1 = new Subject($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$subjectName = mysql_real_escape_string($_REQUEST['subjectName']);
		$subjectCode = mysql_real_escape_string($_REQUEST['subjectCode']);
		$lectureHours = mysql_real_escape_string($_REQUEST['lectureHours']);
		$lectureUnits = mysql_real_escape_string($_REQUEST['lectureUnits']);
		$practicalHours = mysql_real_escape_string($_REQUEST['practicalHours']);
		$practicalUnits = mysql_real_escape_string($_REQUEST['practicalUnits']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($subjectName != $subject1->getSubjectName())	{
			$subject1->setSubjectName($subjectName); $enableUpdate = true;
		}
		if ($subjectCode != $subject1->getSubjectCode())	{
			$subject1->setSubjectCode($subjectCode); $enableUpdate = true;
		}
		if ($lectureHours != $subject1->getLectureHours())	{
			$subject1->setLectureHours($lectureHours); $enableUpdate = true;
		}
		if ($lectureUnits != $subject1->getLectureUnits())	{
			$subject1->setLectureUnits($lectureUnits); $enableUpdate = true;
		}
		if ($practicalHours != $subject1->getPracticalHours())	{
			$subject1->setPracticalHours($practicalHours); $enableUpdate = true;
		}
		if ($practicalUnits != $subject1->getPracticalUnits())	{
			$subject1->setPracticalUnits($practicalUnits); $enableUpdate = true;
		}
		if ($extraInformation != $subject1->getExtraInformation())	{
			$subject1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $subject1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$subject1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$subject1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subject Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Subject <?= $subject1->getSubjectName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the subject <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managesubject_edit", "Edited ".$subject1->getSubjectName());
	} else if ($page == "managesubject_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesubject_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$subject1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$subject1 = new Subject($database, $_REQUEST['id'], $conn);
			$subject1->setExtraFilter($extraFilter);
			$subject1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Subject <?= $subject1->getSubjectName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managesubject_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $subject1->getSubjectId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $subject1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="subjectName">Subject Name </label>
						<input value="<?= $subject1->getSubjectName() ?>" type="text" name="subjectName" id="subjectName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Subject Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="subjectCode">Subject Code </label>
						<input value="<?= $subject1->getSubjectCode() ?>" type="text" name="subjectCode" id="subjectCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Subject Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lectureHours">Lecture Hours </label>
						<input value="<?= $subject1->getLectureHours() ?>" type="text" name="lectureHours" id="lectureHours" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Lecture Hours : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lectureUnits">Lecture Units </label>
						<input value="<?= $subject1->getLectureUnits() ?>" type="text" name="lectureUnits" id="lectureUnits" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Lecture Units : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="practicalHours">Practical Hours </label>
						<input value="<?= $subject1->getPracticalHours() ?>" type="text" name="practicalHours" id="practicalHours" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Practical Hours : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="practicalUnits">Practical Units </label>
						<input value="<?= $subject1->getPracticalUnits() ?>" type="text" name="practicalUnits" id="practicalUnits" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Practical Units : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $subject1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Lecture Units or Lecture Hours can not be zero')
				.appendTo($target1);
			$('<br/>').appendTo($target1);
			$('<span/>').html('and Practical Units or Practical Hours can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managesubject_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managesubject_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$subject1 = null;
		try {
			$subject1 = new Subject($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $subject1->getSubjectName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Subject Name</td>
						<td><?= $subject1->getSubjectName() ?></td>
					</tr>
					<tr>
						<td>Subject Code</td>
						<td><?= $subject1->getSubjectCode() ?></td>
					</tr>
					<tr>
						<td>Lecture Hours</td>
						<td><?= $subject1->getLectureHours() ?></td>
					</tr>
					<tr>
						<td>Lecture Units</td>
						<td><?= $subject1->getLectureUnits() ?></td>
					</tr>
					<tr>
						<td>Practical Hours</td>
						<td><?= $subject1->getPracticalHours() ?></td>
					</tr>
					<tr>
						<td>Practical Units</td>
						<td><?= $subject1->getPracticalUnits() ?></td>
					</tr>
<?php 
	if (! is_null($subject1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $subject1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managesubject_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $subject1->getSubjectName() ?>" href="<?= $thispage ?>?page=managesubject_edit&id=<?= $subject1->getSubjectId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managesubject_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $subject1->getSubjectName() ?>" href="<?= $thispage ?>?page=managesubject_delete&id=<?= $subject1->getSubjectId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managesubject_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managesubject_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$subjectName = mysql_real_escape_string($_REQUEST['subjectName']);
		$subjectCode = mysql_real_escape_string($_REQUEST['subjectCode']);
		$lectureHours = mysql_real_escape_string($_REQUEST['lectureHours']);
		$lectureUnits = mysql_real_escape_string($_REQUEST['lectureUnits']);
		$practicalHours = mysql_real_escape_string($_REQUEST['practicalHours']);
		$practicalUnits = mysql_real_escape_string($_REQUEST['practicalUnits']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $subjectName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO subject (subjectName, subjectCode, lectureHours, lectureUnits, practicalHours, practicalUnits, extraFilter, extraInformation) VALUES('$subjectName', '$subjectCode', '$lectureHours', '$lectureUnits', '$practicalHours', '$practicalUnits', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Subject[Adding]: Could not Add a Record into the System ".mysql_error());
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Subject <?= $subjectName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the subject<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Subject";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managesubject_add", "Added $subjectName");
	} else if ($page == "managesubject_add" && Authorize::isAllowable($config, "managesubject_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Subject</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managesubject_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="subjectName">Subject Name </label>
						<input type="text" name="subjectName" id="subjectName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Subject Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="subjectCode">Subject Code </label>
						<input type="text" name="subjectCode" id="subjectCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Subject Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lectureHours">Lecture Hours </label>
						<input  type="text" name="lectureHours" id="lectureHours" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Lecture Hours : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lectureUnits">Lecture Units </label>
						<input type="text" name="lectureUnits" id="lectureUnits" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Lecture Units : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="practicalHours">Practical Hours </label>
						<input type="text" name="practicalHours" id="practicalHours" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Practical Hours : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="practicalUnits">Practical Units </label>
						<input type="text" name="practicalUnits" id="practicalUnits" size="16" required pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Practical Units : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managesubject">Back to Subject Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Lecture Units or Lecture Hours can not be zero')
				.appendTo($target1);
			$('<br/>').appendTo($target1);
			$('<span/>').html('and Practical Units or Practical Hours can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managesubject" && Authorize::isAllowable($config, "managesubject", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Subjects Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-subject-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managesubject" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managesubject_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Subject Name</th>
				<th>Subject <br/>Code</th>
				<th title="Lecture Hours">L.H</th>
				<th title="Lecture Units">L.U</th>
				<th title="Practical Hours">P.H</th>
				<th title="Practical Units">P.U</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Subject::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch subject data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$subject1 = null;
		try {
			$subject1 = new Subject($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($subject1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $subject1->getSubjectName() ?></td>
				<td><?= $subject1->getSubjectCode() ?></td>
				<td><?= $subject1->getLectureHours() ?></td>
				<td><?= $subject1->getLectureUnits() ?></td>
				<td><?= $subject1->getPracticalHours() ?></td>
				<td><?= $subject1->getPracticalUnits() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managesubject_detail&id=<?= $subject1->getSubjectId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managesubject_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managesubject_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managesubject_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Subject" href="<?= $thispage ?>?page=managesubject_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Subject End*/ else/*Course BEGIN*/if ($page == "managecourse_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourse_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
<?php
	} else if ($page == "managecourse_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourse_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Course::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Course[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$course1 = null;
			try	{
				$course1 = new Course($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($course1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managecourse_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourse_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managecourse_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourse_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managecourse_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourse_csv" && Authorize::isAllowable($config, "managecourse_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managecourse_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Course::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourse_synchronize" && Authorize::isAllowable($config, "managecourse_synchronize", "normal", "setlog", "-1", "-1"))	{
		$conn =mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course & Groups Synchronization</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	try {
		$promise1 = Course::synchronize($database, $conn, $profile1);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Course and Groups have been synchronized successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in synchronizing courses and groups<br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourse_synchronize", "Synchronize Course and Groups");
	} else if ($page == "managecourse_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourse_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$course1 = null;
		try {
			 $course1 = new Course($database, $_REQUEST['id'], $conn);
			 $course1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Course which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Course <?= $course1->getCourseName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Course <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourse_delete", "Deleted ".$course1->getCourseName());
	} else if ($page == "managecourse_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourse_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$course1 = null;
		try {
			$course1 = new Course($database, $_REQUEST['id'], $conn);
			$course1->setExtraFilter(System::getCodeString(8));
			$course1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Course <b><?= $course1->getCourseName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Course <?= $course1->getCourseName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managecourse_delete&report=io&id=<?= $course1->getCourseId() ?>&rndx=<?= $course1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managecourse">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourse_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourse_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$course1 = null;
		try {
			$course1 = new Course($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$courseName = mysql_real_escape_string($_REQUEST['courseName']);
		$courseCode = mysql_real_escape_string($_REQUEST['courseCode']);
		$duration = mysql_real_escape_string($_REQUEST['duration']);
		$departmentId = mysql_real_escape_string($_REQUEST['departmentId']);
		$nextRegistrationNumber = mysql_real_escape_string($_REQUEST['nextRegistrationNumber']);
		$registrationNumberWidth = mysql_real_escape_string($_REQUEST['registrationNumberWidth']);
		$nextExaminationNumber = mysql_real_escape_string($_REQUEST['nextExaminationNumber']);
		$examinationNumberWidth = mysql_real_escape_string($_REQUEST['examinationNumberWidth']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$minimumPoints = mysql_real_escape_string($_REQUEST['minimumPoints']);
		$maximumPoints = mysql_real_escape_string($_REQUEST['maximumPoints']);
		$minimumGPABeforeSupplimentary = mysql_real_escape_string($_REQUEST['minimumGPABeforeSupplimentary']);
		$minimumGPAAfterSupplimentary = mysql_real_escape_string($_REQUEST['minimumGPAAfterSupplimentary']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($courseName != $course1->getCourseName())	{
			$course1->setCourseName($courseName); $enableUpdate = true;
		}
		if ($courseCode != $course1->getCourseCode())	{
			$course1->setCourseCode($courseCode); $enableUpdate = true;
		}
		if ($duration != $course1->getDuration())	{
			$course1->setDuration($duration); $enableUpdate = true;
		}
		if (is_null($course1->getDepartment()) || ($departmentId != $course1->getDepartment()->getDepartmentId()))	{
			$course1->setDepartment($departmentId); $enableUpdate = true;
		}
		if ($nextRegistrationNumber != $course1->getNextRegistrationNumber())	{
			$course1->setNextRegistrationNumber($nextRegistrationNumber); $enableUpdate = true;
		}
		if ($registrationNumberWidth != $course1->getRegistrationNumberWidth())	{
			$course1->setRegistrationNumberWidth($registrationNumberWidth); $enableUpdate = true;
		}
		if ($nextExaminationNumber != $course1->getNextExaminationNumber())	{
			$course1->setNextExaminationNumber($nextExaminationNumber); $enableUpdate = true;
		}
		if ($examinationNumberWidth != $course1->getExaminationNumberWidth())	{
			$course1->setExaminationNumberWidth($examinationNumberWidth); $enableUpdate = true;
		}
		if (is_null($course1->getEducationLevel()) || ($levelId != $course1->getEducationLevel()->getLevelId()))	{
			$course1->setEducationLevel($levelId); $enableUpdate = true;
		}
		if ($minimumPoints != $course1->getMinimumPoints())	{
			$course1->setMinimumPoints($minimumPoints); $enableUpdate = true;
		}
		if ($maximumPoints != $course1->getMaximumPoints())	{
			$course1->setMaximumPoints($maximumPoints); $enableUpdate = true;
		}
		if ($minimumGPABeforeSupplimentary != $course1->getMinimumGPABeforeSupplimentary())	{
			$course1->setMinimumGPABeforeSupplimentary($minimumGPABeforeSupplimentary); $enableUpdate = true;
		}
		if ($minimumGPAAfterSupplimentary != $course1->getMinimumGPAAfterSupplimentary())	{
			$course1->setMinimumGPAAfterSupplimentary($minimumGPAAfterSupplimentary); $enableUpdate = true;
		}
		if ($extraInformation != $course1->getExtraInformation())	{
			$course1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $course1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$course1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$course1->updateMyCourseGroup();
				$course1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Course Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Course <?= $course1->getCourseName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the course <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourse_edit", "Edited ".$course1->getCourseName());
	} else if ($page == "managecourse_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourse_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$course1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$course1 = new Course($database, $_REQUEST['id'], $conn);
			$course1->setExtraFilter($extraFilter);
			$course1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Course <?= $course1->getCourseName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourse_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $course1->getCourseId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $course1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="courseName">Course Name </label>
						<input value="<?= $course1->getCourseName() ?>" type="text" name="courseName" id="courseName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Course Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseCode">Course Code </label>
						<input value="<?= $course1->getCourseCode() ?>" type="text" name="courseCode" id="courseCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Course Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="duration">Course Duration(years) </label>
						<input value="<?= $course1->getDuration() ?>" type="text" name="duration" id="duration" size="4" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Course Duration(Years) : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="departmentId">Department </label>
						<select id="departmentId" name="departmentId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Department">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Department::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($course1->getDepartment()) && ($alist1['id'] == $course1->getDepartment()->getDepartmentId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="nextRegistrationNumber">Next Registration Number </label>
						<input class="text-can-not-be-zero" value="<?= $course1->getNextRegistrationNumber() ?>" type="text" name="nextRegistrationNumber" id="nextRegistrationNumber" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Next Registration Number : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="registrationNumberWidth">Registration Number Width </label>
						<input class="text-can-not-be-zero" value="<?= $course1->getRegistrationNumberWidth() ?>" type="text" name="registrationNumberWidth" id="registrationNumberWidth" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Registration Number Width : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="nextExaminationNumber">Next Examination Number </label>
						<input class="text-can-not-be-zero" value="<?= $course1->getNextExaminationNumber() ?>" type="text" name="nextExaminationNumber" id="nextExaminationNumber" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Next Examination Number : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="examinationNumberWidth">Examination Number Width </label>
						<input class="text-can-not-be-zero" value="<?= $course1->getExaminationNumberWidth() ?>" type="text" name="examinationNumberWidth" id="examinationNumberWidth" size="16" required pattern="<?= $exprD8Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD8Number ?>" validate_message="Examination Number Width : <?= $msgD8Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Level this course belong to">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($course1->getEducationLevel()) && ($alist1['id'] == $course1->getEducationLevel()->getLevelId())) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="minimumPoints">Minimum Points </label>
						<input value="<?= $course1->getMinimumPoints() ?>" type="text" name="minimumPoints" id="minimumPoints" size="8" pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Minimum Points : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="maximumPoints">Maximum Points </label>
						<input value="<?= $course1->getMaximumPoints() ?>" type="text" name="maximumPoints" id="maximumPoints" size="8" pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Maximum Points : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="minimumGPABeforeSupplimentary">Minimum GPA Before Supplimentary </label>
						<input value="<?= $course1->getMinimumGPABeforeSupplimentary() ?>" type="text" name="minimumGPABeforeSupplimentary" id="minimumGPABeforeSupplimentary" size="8" pattern="<?= $exprGPA ?>" validate="true" validate_control="text" validate_expression="<?= $exprGPA ?>" validate_message="Minimum GPA Before Supplimentary : <?= $msgGPA ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="minimumGPAAfterSupplimentary">Minimum GPA After Supplimentary </label>
						<input value="<?= $course1->getMinimumGPAAfterSupplimentary() ?>" type="text" name="minimumGPAAfterSupplimentary" id="minimumGPAAfterSupplimentary" size="8" pattern="<?= $exprGPA ?>" validate="true" validate_control="text" validate_expression="<?= $exprGPA ?>" validate_message="Minimum GPA After Supplimentary : <?= $msgGPA ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $course1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		//Process here 
		$('input.text-can-not-be-zero').each(function(i, val)	{
			var $text1 = $(val);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html("None of Registration or Examination Number can start at zero")
						.appendTo($target1);
			$('<br/>').appendTo($target1);
			$('<span/>').html("Neither their width can be zero")
						.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourse_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourse_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$course1 = null;
		try {
			$course1 = new Course($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $course1->getCourseName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Course Name</td>
						<td><?= $course1->getCourseName() ?></td>
					</tr>
					<tr>
						<td>Course Code</td>
						<td><?= $course1->getCourseCode() ?></td>
					</tr>
					<tr>
						<td>Course Duration (Year)</td>
						<td><?= $course1->getDuration() ?></td>
					</tr>
<?php 
	if (! is_null($course1->getDepartment()))	{
?>
					<tr>
						<td>Department</td>
						<td><?= $course1->getDepartment()->getDepartmentName() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Next Registration Number</td>
						<td><?= $course1->getNextRegistrationNumber() ?></td>
					</tr>
					<tr>
						<td>Registration Numnber Width</td>
						<td><?= $course1->getRegistrationNumberWidth() ?></td>
					</tr>
					<tr>
						<td>Next Examination Number</td>
						<td><?= $course1->getNextExaminationNumber() ?></td>
					</tr>
					<tr>
						<td>Examination Number Width</td>
						<td><?= $course1->getExaminationNumberWidth() ?></td>
					</tr>
<?php
	if (! is_null($course1->getEducationLevel()))	{
?>
					<tr>
						<td>Education Level</td>
						<td><?= $course1->getEducationLevel()->getLevelName() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Minimum Points </td>
						<td><?= $course1->getMinimumPoints() ?></td>
					</tr>
					<tr>
						<td>Maximum Points </td>
						<td><?= $course1->getMaximumPoints() ?></td>
					</tr>
					<tr>
						<td>Minimum GPA (Before Supplimentary) </td>
						<td><?= $course1->getMinimumGPABeforeSupplimentary() ?></td>
					</tr>
					<tr>
						<td>Minimum GPA (After Supplimentary) </td>
						<td><?= $course1->getMinimumGPAAfterSupplimentary() ?></td>
					</tr>
<?php
	if (! is_null($course1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $course1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecourse_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $course1->getCourseName() ?>" href="<?= $thispage ?>?page=managecourse_edit&id=<?= $course1->getCourseId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourse_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $course1->getCourseName() ?>" href="<?= $thispage ?>?page=managecourse_delete&id=<?= $course1->getCourseId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "managecourse_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managecourse_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$courseName = mysql_real_escape_string($_REQUEST['courseName']);
		$courseCode = mysql_real_escape_string($_REQUEST['courseCode']);
		$duration = mysql_real_escape_string($_REQUEST['duration']);
		$departmentId = mysql_real_escape_string($_REQUEST['departmentId']);
		$levelId = mysql_real_escape_string($_REQUEST['levelId']);
		$minimumPoints = mysql_real_escape_string($_REQUEST['minimumPoints']);
		$maximumPoints = mysql_real_escape_string($_REQUEST['maximumPoints']);
		$minimumGPABeforeSupplimentary = mysql_real_escape_string($_REQUEST['minimumGPABeforeSupplimentary']);
		$minimumGPAAfterSupplimentary = mysql_real_escape_string($_REQUEST['minimumGPAAfterSupplimentary']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $courseName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO course (courseName, courseCode, duration, departmentId, levelId, minimumPoints, maximumPoints, minimumGPABeforeSupplimentary, minimumGPAAfterSupplimentary, extraFilter, extraInformation) VALUES('$courseName', '$courseCode', '$duration', '$departmentId', '$levelId', '$minimumPoints', '$maximumPoints', '$minimumGPABeforeSupplimentary', '$minimumGPAAfterSupplimentary', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Course[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Course <?= $courseName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the course<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Course";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourse_add", "Added $courseName");
	} else if ($page == "managecourse_add" && Authorize::isAllowable($config, "managecourse_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Course</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourse_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="courseName">Course Name </label>
						<input type="text" name="courseName" id="courseName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Course Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="courseCode">Course Code </label>
						<input type="text" name="courseCode" id="courseCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Course Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="duration">Course Duration(years) </label>
						<input type="text" name="duration" id="duration" size="4" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Course Duration(Years) : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="departmentId">Department </label>
						<select id="departmentId" name="departmentId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Department">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Department::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="levelId">Education Level </label>
						<select id="levelId" name="levelId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Level this course belong to">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = EducationLevel::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="minimumPoints">Minimum Points </label>
						<input type="text" name="minimumPoints" id="minimumPoints" size="8" pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Minimum Points : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="maximumPoints">Maximum Points </label>
						<input type="text" name="maximumPoints" id="maximumPoints" size="8" pattern="<?= $expr4Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr4Number ?>" validate_message="Maximum Points : <?= $msg4Number ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="minimumGPABeforeSupplimentary">Minimum GPA Before Supplimentary </label>
						<input type="text" name="minimumGPABeforeSupplimentary" id="minimumGPABeforeSupplimentary" size="8" pattern="<?= $exprGPA ?>" validate="true" validate_control="text" validate_expression="<?= $exprGPA ?>" validate_message="Minimum GPA Before Supplimentary : <?= $msgGPA ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="minimumGPAAfterSupplimentary">Minimum GPA After Supplimentary </label>
						<input type="text" name="minimumGPAAfterSupplimentary" id="minimumGPAAfterSupplimentary" size="8" pattern="<?= $exprGPA ?>" validate="true" validate_control="text" validate_expression="<?= $exprGPA ?>" validate_message="Minimum GPA After Supplimentary : <?= $msgGPA ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourse">Back to Course Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourse" && Authorize::isAllowable($config, "managecourse", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Courses Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-course-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managecourse" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managecourse_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Course Name</th>
				<th>Course Code</th>
				<th>Course <br/>Duration</th>
				<th>Department</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Course::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch course data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$course1 = null;
		try {
			$course1 = new Course($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($course1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $course1->getCourseName() ?></td>
				<td><?= $course1->getCourseCode() ?></td>
				<td><?= $course1->getDuration() ?></td>
				<td>
<?php 
	if (! is_null($course1->getDepartment()))	{
?>
					<?= $course1->getDepartment()->getDepartmentName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managecourse_detail&id=<?= $course1->getCourseId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecourse_synchronize", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Synchronize Course and its corresponding groups" href="<?= $thispage ?>?page=managecourse_synchronize"><img alt="DAT" src="../sysimage/synchronize.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourse_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managecourse_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourse_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Course" href="<?= $thispage ?>?page=managecourse_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Course End*/ else/*EducationLevel BEGIN*/if ($page == "manageeducationlevel_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageeducationlevel_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a></div>
		</div>
<?php
	} else if ($page == "manageeducationlevel_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageeducationlevel_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = EducationLevel::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("EducationLevel[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$level1 = null;
			try	{
				$level1 = new EducationLevel($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($level1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageeducationlevel_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageeducationlevel_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageeducationlevel_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageeducationlevel_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageeducationlevel_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageeducationlevel_csv" && Authorize::isAllowable($config, "manageeducationlevel_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageeducationlevel_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, EducationLevel::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageeducationlevel_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageeducationlevel_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$level1 = null;
		try {
			 $level1 = new EducationLevel($database, $_REQUEST['id'], $conn);
			 $level1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a EducationLevel which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The EducationLevel <?= $level1->getLevelName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the EducationLevel <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageeducationlevel_delete", "Deleted ".$level1->getLevelName());
	} else if ($page == "manageeducationlevel_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageeducationlevel_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$level1 = null;
		try {
			$level1 = new EducationLevel($database, $_REQUEST['id'], $conn);
			$level1->setExtraFilter(System::getCodeString(8));
			$level1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a EducationLevel <b><?= $level1->getLevelName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the EducationLevel <?= $level1->getLevelName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageeducationlevel_delete&report=io&id=<?= $level1->getLevelId() ?>&rndx=<?= $level1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageeducationlevel">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageeducationlevel_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageeducationlevel_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$level1 = null;
		try {
			$level1 = new EducationLevel($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$levelName = mysql_real_escape_string($_REQUEST['levelName']);
		$levelCode = mysql_real_escape_string($_REQUEST['levelCode']);
		$indexNumberExpression = mysql_real_escape_string($_REQUEST['indexNumberExpression']);
		$indexNumberMessage = mysql_real_escape_string($_REQUEST['indexNumberMessage']);
		$gradeEarnedExpression = mysql_real_escape_string($_REQUEST['gradeEarnedExpression']);
		$gradeEarnedMessage = mysql_real_escape_string($_REQUEST['gradeEarnedMessage']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($levelName != $level1->getLevelName())	{
			$level1->setLevelName($levelName); $enableUpdate = true;
		}
		if ($levelCode != $level1->getLevelCode())	{
			$level1->setLevelCode($levelCode); $enableUpdate = true;
		}
		if ($indexNumberExpression != $level1->getIndexNumberExpression())	{
			$level1->setIndexNumberExpression($indexNumberExpression); $enableUpdate = true;
		}
		if ($indexNumberMessage != $level1->getIndexNumberMessage())	{
			$level1->setIndexNumberMessage($indexNumberMessage); $enableUpdate = true;
		}
		if ($gradeEarnedExpression != $level1->getGradeEarnedExpression())	{
			$level1->setGradeEarnedExpression($gradeEarnedExpression); $enableUpdate = true;
		}
		if ($gradeEarnedMessage != $level1->getGradeEarnedMessage())	{
			$level1->setGradeEarnedMessage($gradeEarnedMessage); $enableUpdate = true;
		}
		if ($extraInformation != $level1->getExtraInformation())	{
			$level1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $level1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$level1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$level1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevel Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			EducationLevel <?= $level1->getLevelName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the level <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageeducationlevel_edit", "Edited ".$level1->getLevelName());
	} else if ($page == "manageeducationlevel_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageeducationlevel_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$level1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$level1 = new EducationLevel($database, $_REQUEST['id'], $conn);
			$level1->setExtraFilter($extraFilter);
			$level1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit EducationLevel <?= $level1->getLevelName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageeducationlevel_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $level1->getLevelId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $level1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="levelName">EducationLevel Name </label>
						<input value="<?= $level1->getLevelName() ?>" type="text" name="levelName" id="levelName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="EducationLevel Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelCode">EducationLevel Code </label>
						<input value="<?= $level1->getLevelCode() ?>" type="text" name="levelCode" id="levelCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="EducationLevel Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Will be used during student Registration Process to control the Format of the index number in <?= $level1->getLevelName() ?>" for="indexNumberExpression">Regular Expression for Index Number </label>
						<input value="<?= $level1->getIndexNumberExpression() ?>" type="text" name="indexNumberExpression" id="indexNumberExpression" size="24" required pattern="<?= $exprL128Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL128Name ?>" validate_message="Index Number Expression : <?= $msgL128Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Message to student when he/she provide a wrong format of Index Number  for <?= $level1->getLevelName() ?>" for="indexNumberMessage">Error message for Index Number </label>
						<input value="<?= $level1->getIndexNumberMessage() ?>" type="text" name="indexNumberMessage" id="indexNumberMessage" size="24" required pattern="<?= $exprL128Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL128Name ?>" validate_message="Index Number Error Message : <?= $msgL128Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Will be used during student Registration Process to control the Format of the Grade Earned in <?= $level1->getLevelName() ?>" for="gradeEarnedExpression">Regular Expression for Grade Earned </label>
						<input value="<?= $level1->getGradeEarnedExpression() ?>" type="text" name="gradeEarnedExpression" id="gradeEarnedExpression" size="24" required pattern="<?= $exprL128Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL128Name ?>" validate_message="Grade Earned Expression : <?= $msgL128Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label title="Message to student when he/she provide a wrong format of Grade Earned  for <?= $level1->getLevelName() ?>" for="gradeEarnedMessage">Error message for Grade Earned </label>
						<input value="<?= $level1->getGradeEarnedMessage() ?>" type="text" name="gradeEarnedMessage" id="gradeEarnedMessage" size="24" required pattern="<?= $exprL128Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL128Name ?>" validate_message="Grade Earned Error Message : <?= $msgL128Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $level1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageeducationlevel_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageeducationlevel_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$level1 = null;
		try {
			$level1 = new EducationLevel($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $level1->getLevelName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>EducationLevel Name</td>
						<td><?= $level1->getLevelName() ?></td>
					</tr>
					<tr>
						<td>EducationLevel Code</td>
						<td><?= $level1->getLevelCode() ?></td>
					</tr>
<?php 
	if (! is_null($level1->getIndexNumberExpression()))	{
?>
					<tr>
						<td>Regular Expression for Index Number </td>
						<td><?= $level1->getIndexNumberExpression() ?></td>
					</tr>
<?php
	}
	if (! is_null($level1->getIndexNumberMessage()))	{
?>
					<tr>
						<td>Error Message for Index Number </td>
						<td><?= $level1->getIndexNumberMessage() ?></td>
					</tr>
<?php
	}
	if (! is_null($level1->getGradeEarnedExpression()))	{
?>
					<tr>
						<td>Regular Expression for Grade Earned </td>
						<td><?= $level1->getGradeEarnedExpression() ?></td>
					</tr>
<?php
	}
	if (! is_null($level1->getGradeEarnedMessage()))	{
?>
					<tr>
						<td>Error Message for Grade Earned </td>
						<td><?= $level1->getGradeEarnedMessage() ?></td>
					</tr>
<?php
	}
	if (! is_null($level1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $level1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageeducationlevel_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $level1->getLevelName() ?>" href="<?= $thispage ?>?page=manageeducationlevel_edit&id=<?= $level1->getLevelId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageeducationlevel_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $level1->getLevelName() ?>" href="<?= $thispage ?>?page=manageeducationlevel_delete&id=<?= $level1->getLevelId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div><a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a></div>
		</div>
	</div>
<?php
	} else if ($page == "manageeducationlevel_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageeducationlevel_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$levelName = mysql_real_escape_string($_REQUEST['levelName']);
		$levelCode = mysql_real_escape_string($_REQUEST['levelCode']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $levelName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO educationLevel (levelName, levelCode, extraFilter, extraInformation) VALUES('$levelName', '$levelCode', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("EducationLevel[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The EducationLevel <?= $levelName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the level<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Education Level";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageeducationlevel_add", "Added $levelName");
	} else if ($page == "manageeducationlevel_add" && Authorize::isAllowable($config, "manageeducationlevel_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New EducationLevel</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageeducationlevel_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="levelName">EducationLevel Name </label>
						<input type="text" name="levelName" id="levelName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="EducationLevel Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="levelCode">EducationLevel Code </label>
						<input type="text" name="levelCode" id="levelCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="EducationLevel Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageeducationlevel">Back to Education Level Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageeducationlevel" && Authorize::isAllowable($config, "manageeducationlevel", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">EducationLevels Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-level-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageeducationlevel" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageeducationlevel_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>EducationLevel Name</th>
				<th>EducationLevel Code</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = EducationLevel::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch level data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$level1 = null;
		try {
			$level1 = new EducationLevel($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($level1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $level1->getLevelName() ?></td>
				<td><?= $level1->getLevelCode() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageeducationlevel_detail&id=<?= $level1->getLevelId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageeducationlevel_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageeducationlevel_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageeducationlevel_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System EducationLevel" href="<?= $thispage ?>?page=manageeducationlevel_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*EducationLevel End*/ else/*Department BEGIN*/if ($page == "managedepartment_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managedepartment_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a></div>
		</div>
<?php
	} else if ($page == "managedepartment_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managedepartment_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Department::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Department[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$department1 = null;
			try	{
				$department1 = new Department($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($department1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managedepartment_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managedepartment_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managedepartment_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managedepartment_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managedepartment_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managedepartment_csv" && Authorize::isAllowable($config, "managedepartment_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managedepartment_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Department::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managedepartment_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managedepartment_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$department1 = null;
		try {
			 $department1 = new Department($database, $_REQUEST['id'], $conn);
			 $department1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Department which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Department <?= $department1->getDepartmentName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Department <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managedepartment_delete", "Deleted ".$department1->getDepartmentName());
	} else if ($page == "managedepartment_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managedepartment_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$department1 = null;
		try {
			$department1 = new Department($database, $_REQUEST['id'], $conn);
			$department1->setExtraFilter(System::getCodeString(8));
			$department1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Department <b><?= $department1->getDepartmentName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Department <?= $department1->getDepartmentName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managedepartment_delete&report=io&id=<?= $department1->getDepartmentId() ?>&rndx=<?= $department1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managedepartment">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managedepartment_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managedepartment_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$department1 = null;
		try {
			$department1 = new Department($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$departmentName = mysql_real_escape_string($_REQUEST['departmentName']);
		$departmentCode = mysql_real_escape_string($_REQUEST['departmentCode']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($departmentName != $department1->getDepartmentName())	{
			$department1->setDepartmentName($departmentName); $enableUpdate = true;
		}
		if ($departmentCode != $department1->getDepartmentCode())	{
			$department1->setDepartmentCode($departmentCode); $enableUpdate = true;
		}
		if ($extraInformation != $department1->getExtraInformation())	{
			$department1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $department1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$department1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$department1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Department Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Department <?= $department1->getDepartmentName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the department <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managedepartment_edit", "Edited ".$department1->getDepartmentName());
	} else if ($page == "managedepartment_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managedepartment_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$department1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$department1 = new Department($database, $_REQUEST['id'], $conn);
			$department1->setExtraFilter($extraFilter);
			$department1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Department <?= $department1->getDepartmentName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managedepartment_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $department1->getDepartmentId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $department1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="departmentName">Department Name </label>
						<input value="<?= $department1->getDepartmentName() ?>" type="text" name="departmentName" id="departmentName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Department Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="departmentCode">Department Code </label>
						<input value="<?= $department1->getDepartmentCode() ?>" type="text" name="departmentCode" id="departmentCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Department Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $department1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managedepartment_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managedepartment_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$department1 = null;
		try {
			$department1 = new Department($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $department1->getDepartmentName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Department Name</td>
						<td><?= $department1->getDepartmentName() ?></td>
					</tr>
					<tr>
						<td>Department Code</td>
						<td><?= $department1->getDepartmentCode() ?></td>
					</tr>
<?php 
	if (! is_null($department1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $department1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managedepartment_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $department1->getDepartmentName() ?>" href="<?= $thispage ?>?page=managedepartment_edit&id=<?= $department1->getDepartmentId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managedepartment_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $department1->getDepartmentName() ?>" href="<?= $thispage ?>?page=managedepartment_delete&id=<?= $department1->getDepartmentId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managedepartment_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managedepartment_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$departmentName = mysql_real_escape_string($_REQUEST['departmentName']);
		$departmentCode = mysql_real_escape_string($_REQUEST['departmentCode']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $departmentName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO departments (departmentName, departmentCode, extraFilter, extraInformation) VALUES('$departmentName', '$departmentCode', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Department[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Department <?= $departmentName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the department<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another Department";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managedepartment_add", "Added $departmentName");
	} else if ($page == "managedepartment_add" && Authorize::isAllowable($config, "managedepartment_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Department</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managedepartment_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="departmentName">Department Name </label>
						<input type="text" name="departmentName" id="departmentName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Department Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="departmentCode">Department Code </label>
						<input type="text" name="departmentCode" id="departmentCode" size="24" required pattern="<?= $exprL8Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprL8Name ?>" validate_message="Department Code : <?= $msgL8Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managedepartment">Back to Department Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managedepartment" && Authorize::isAllowable($config, "managedepartment", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Departments Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managedepartment" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managedepartment_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Department Name</th>
				<th>Department Code</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Department::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch department data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$department1 = null;
		try {
			$department1 = new Department($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($department1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $department1->getDepartmentName() ?></td>
				<td><?= $department1->getDepartmentCode() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managedepartment_detail&id=<?= $department1->getDepartmentId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managedepartment_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managedepartment_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managedepartment_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Department" href="<?= $thispage ?>?page=managedepartment_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer">
				
			</div>
		</div>
<?php
	}/*Department End*/ else/*CourseInstructor BEGIN*/if ($page == "managecourseinstructor_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['detach_courseAndSubjectTransaction']) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$instructor1 = null;
		$ulogin1 = null;
		$headerText = "UNKNOWN";
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$headerText = "De-Assign Course & Subject Map from ".$ulogin1->getFullname();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::detachIdListFromObjectList($instructor1->getCourseAndSubjectTransactionList(), $_REQUEST['did']);
			$instructor1->setCourseAndSubjectTransactionList($listToUpdate);
			$instructor1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Course and Subject List Attachment were removed successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in De-Attaching Course and Subject List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseinstructor_edit", "Detach Course & Subjects for ".$ulogin1->getFullname());
	} else if ($page == "managecourseinstructor_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['attach_courseAndSubjectTransaction']) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$instructor1 = null;
		$ulogin1 = null;
		$headerText = "UNKNOWN";
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$headerText = "Assign Course & Subject Map to ".$ulogin1->getFullname();
			if (! isset($_REQUEST['did'])) Object::shootException("There were nothing to Attach");
			$listToUpdate = Object::attachIdListToObjectList($instructor1->getCourseAndSubjectTransactionList(), $_REQUEST['did']);
			$instructor1->setCourseAndSubjectTransactionList($listToUpdate);
			$instructor1->commitUpdate();
			$enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"></div>
			<div class="ui-sys-panel-body">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Course and Subject List Attachment were done successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Attaching Course and Subject List <br/>
			Details: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseinstructor_edit", "Attach Course & Subjects for ".$ulogin1->getFullname());
	} else if ($page == "managecourseinstructor_edit" && isset($_REQUEST['id']) && isset($_REQUEST['attach_courseAndSubjectTransaction']) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "setlog", "-1", "-1")) {
		$conn  = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$instructor1 = null;
		$ulogin1 = null;
		$headerText = "UNKNOWN";
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$headerText = "Assign Course & Subject Map to ".$ulogin1->getFullname();
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$promise1->setPromise(false);
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header"><?= $headerText ?></div>
			<div class="ui-sys-panel-body ui-sys-search-results">
<?php 
	if ($promise1->isPromising())	{
/*Begin of BLOCK ONE */
		if (! is_null($instructor1->getCourseAndSubjectTransactionList()) && sizeof($instructor1->getCourseAndSubjectTransactionList()) > 0)	{
			$objectList1 = $instructor1->getCourseAndSubjectTransactionList();
?>
			<form method="POST" action="<?= $thispage ?>">
				<input type="hidden" name="page" value="managecourseinstructor_edit"/>
				<input type="hidden" name="id" value="<?= $instructor1->getInstructorId() ?>"/>
				<input type="hidden" name="report" value="true"/>
				<input type="hidden" name="detach_courseAndSubjectTransaction" value="true"/>
				<table class="pure-table pure-table-aligned ui-sys-search-results-1">
					<thead>
						<tr>
							<th colspan="8">Course & Subjects Attached To</th>
						</tr>
						<tr>
							<th></th>
							<th></th>
							<th>Map Name</th>
							<th>Course</th>
							<th>Subject/Module</th>
							<th>Year</th>
							<th>Semester</th>
							<th>Status</th>
						</tr>
					</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $obj1->getTransactionId() ?>"/></td>
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getExtraInformation() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
?>
		<?= $obj1->getCourse()->getCourseName() ?>
<?php
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getSubject()))	{
?>
		<?= $obj1->getSubject()->getSubjectName() ?>
<?php
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
			<td>
<?php 
	$compulsoryText="Optional";
	if ($obj1->isCompulsory())	$compulsoryText="Compulsory";
	echo $compulsoryText;
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<div class="ui-sys-right">
				<input type="submit" value="Detach Course & Subject Mapping"/>
			</div>
		</form>
		<ul class="ui-sys-pagination-1"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-1').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-1 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
		}
/*End of BLOCK ONE*/
/*Begin of BLOCK TWO -- Extra*/
?>
	<div style="padding: 1px; border: 1px gold dotted;">
		<!--Content of Block Two Extra BEgins-->
		<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-transaction-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managecourseinstructor_edit&id=<?= $instructor1->getInstructorId() ?>&attach_courseAndSubjectTransaction=true" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<form method="POST" action="<?= $thispage ?>">
		<input type="hidden" name="page" value="managecourseinstructor_edit"/>
		<input type="hidden" name="id" value="<?= $instructor1->getInstructorId() ?>"/>
		<input type="hidden" name="report" value="true"/>
		<input type="hidden" name="attach_courseAndSubjectTransaction" value="true"/>
		<table class="pure-table ui-sys-table-search-results-2">
			<thead>
				<tr>
					<th></th>
					<th>S/N</th>
					<th>Map Name</th>
					<th>Course</th>
					<th>Subject/Module</th>
					<th>Year</th>
					<th>Semester</th>
					<th>Status</th>
				</tr>
			</thead>
<?php 
	$query = CourseAndSubjectTransaction::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch transaction data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$transaction1 = null;
		try {
			$transaction1 = new CourseAndSubjectTransaction($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($transaction1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><input type="checkbox" name="did[<?= $sqlReturnedRowCount ?>]" value="<?= $transaction1->getTransactionId() ?>"/></td>
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $transaction1->getExtraInformation() ?></td>
				<td>
<?php 
	if (! is_null($transaction1->getCourse()))	{
?>
		<?= $transaction1->getCourse()->getCourseName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($transaction1->getSubject()))	{
?>
		<?= $transaction1->getSubject()->getSubjectName() ?>
<?php
	}
?>				
				</td>
				<td><?= $transaction1->getYear() ?></td>
				<td><?= $transaction1->getSemester() ?></td>
				<td>
<?php 
	$compulsoryText = "Optional";
	if ($transaction1->isCompulsory())	{
		$compulsoryText = "Compulsory";
	}
?>					<?= $compulsoryText ?>
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
		</table>
		<div class="ui-sys-right">
			<input type="submit" value="Attach Course & Subject Mapping"/>
		</div>
	</form>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination-2"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination-2').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results-2 tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
		<!--Content of Block Two Extra Ends-->
	</div>
<?php
/*End of BLOCK TWO -- Extra*/
	} else {
?>
		<div class="ui-state-error">
			There were problems in the initial setup of Assignment <br/>
			Reason : <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseinstructor_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourseinstructor_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
	} else if ($page == "managecourseinstructor_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managecourseinstructor_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = CourseInstructor::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("CourseInstructor[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$instructor1 = null;
			try	{
				$instructor1 = new CourseInstructor($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($instructor1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managecourseinstructor_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseinstructor_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managecourseinstructor_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseinstructor_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managecourseinstructor_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourseinstructor_csv" && Authorize::isAllowable($config, "managecourseinstructor_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managecourseinstructor_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, CourseInstructor::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managecourseinstructor_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourseinstructor_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$instructor1 = null;
		$ulogin1 = null;
		try {
			 $instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			 $ulogin1 = $instructor1->getLogin();
			 $instructor1->commitDelete();
			 $ulogin1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a CourseInstructor which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The CourseInstructor <?= $ulogin1->getFullname() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the CourseInstructor <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseinstructor_delete", "Deleted ".$ulogin1->getLoginName());
	} else if ($page == "managecourseinstructor_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseinstructor_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$instructor1 = null;
		$ulogin1 = null;
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$instructor1->setExtraFilter(System::getCodeString(8));
			$instructor1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a CourseInstructor <b><?= $ulogin1->getFullname() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the CourseInstructor <?= $ulogin1->getFullname() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managecourseinstructor_delete&report=io&id=<?= $instructor1->getInstructorId() ?>&rndx=<?= $instructor1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managecourseinstructor">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseinstructor_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$instructor1 = null;
		$ulogin1 = null;
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$statusId = mysql_real_escape_string($_REQUEST['statusId']);
		$departmentId = mysql_real_escape_string($_REQUEST['departmentId']);
		$jobId = mysql_real_escape_string($_REQUEST['jobId']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$isroot = 0;
		if (isset($_REQUEST['isroot'])) $isroot = 1;
		if (is_null($ulogin1->getUserStatus()) || ($statusId != $ulogin1->getUserStatus()->getStatusId()))	{
			$ulogin1->setCourseInstructorStatus($statusId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getJobTitle()) || ($jobId != $ulogin1->getJobTitle()->getJobId()))	{
			$ulogin1->setJobTitle($jobId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getGroup()) || ($groupId != $ulogin1->getGroup()->getGroupId()))	{
			$ulogin1->setGroup($groupId); $enableUpdate = true;
		}
		if ($extraInformation != $ulogin1->getExtraInformation())	{
			$ulogin1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		if (($isroot == 1) xor $ulogin1->isRoot())	{
			$ulogin1->setRoot($isroot); $enableUpdate = true;
		}
		if (is_null($instructor1->getDepartment()) || ($instructor1->getDepartment()->getDepartmentId() != $departmentId))	{
			$instructor1->setDepartment($departmentId); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $instructor1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$instructor1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$instructor1->commitUpdate();
				$ulogin1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructor Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			CourseInstructor <?= $ulogin1->getFullname() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the instructor <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseinstructor_edit", "Edited ".$ulogin1->getLoginName());
	} else if ($page == "managecourseinstructor_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$instructor1 = null;
		$ulogin1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$instructor1->setExtraFilter($extraFilter);
			$instructor1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit CourseInstructor <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseinstructor_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $instructor1->getInstructorId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $instructor1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="statusId">User Status </label>
						<select id="statusId" name="statusId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select User Status">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = UserStatus::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getUserStatus()) && ($ulogin1->getUserStatus()->getStatusId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="departmentId">Department </label>
						<select id="departmentId" name="departmentId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Department">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Department::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($instructor1->getDepartment()) && ($instructor1->getDepartment()->getDepartmentId() == $alist1['id'])) $selected="selected";
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="jobId">Job Title </label>
						<select id="jobId" name="jobId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getJobTitle()) && ($ulogin1->getJobTitle()->getJobId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getGroup()) && ($ulogin1->getGroup()->getGroupId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	if ($login1->isRoot() && ($login1->getLoginId() != $ulogin1->getLoginId()))	{
		//Only those logged in as root instructors are allowed to change 
		//this status
		//And as usual you can not change this for yourself even if you are the root instructor
		$chkEnable = "";
		if ($ulogin1->isRoot()) $chkEnable = "checked";
?>
					<div class="pure-controls">
						<label><input type="checkbox" name="isroot" value="1" <?= $chkEnable ?>/>Enable/Disable System User Status</label>
					</div>
<?php
	}
?>
					
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $ulogin1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseinstructor_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managecourseinstructor_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$instructor1 = null;
		$ulogin1 = null;
		try {
			$instructor1 = new CourseInstructor($database, $_REQUEST['id'], $conn);
			$ulogin1 = $instructor1->getLogin();
			$photoname = "default.png";
			if (! is_null($ulogin1->getSex()))	{
				if (strtolower($ulogin1->getSex()->getSexName()) == "male") $photoname="default_male.png";
				else if (strtolower($ulogin1->getSex()->getSexName()) == "female") $photoname="default_female.png";
			}
			if (! is_null($ulogin1->getPhoto())) $photoname = $ulogin1->getPhoto();
			$ulogin1->setExtraFilter("../data/instructors/photo/".$photoname);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $ulogin1->getFullname() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td colspan="2">
							<div class="ui-sys-instructor-photo-detail"><img alt="PDET" src="<?= $ulogin1->getExtraFilter() ?>"/></div>
						</td>
					</tr>
					<tr>
						<td>Firstname</td>
						<td><?= $ulogin1->getFirstname() ?></td>
					</tr>
					<tr>
						<td>Middlename</td>
						<td><?= $ulogin1->getMiddlename() ?></td>
					</tr>
					<tr>
						<td>Lastname</td>
						<td><?= $ulogin1->getLastname() ?></td>
					</tr>
<?php 
	if (! is_null($instructor1->getDepartment()))	{
?>
					<tr>
						<td>Department</td>
						<td><?= $instructor1->getDepartment()->getDepartmentName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getUserStatus()))	{
?>
					<tr>
						<td>Status</td>
						<td><?= $ulogin1->getUserStatus()->getStatusName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getDOB()))	{
?>
					<tr>
						<td>Date of Birth</td>
						<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB()) ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getSex()))	{
?>
					<tr>
						<td>Sex</td>
						<td><?= $ulogin1->getSex()->getSexName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getMarital()))	{
?>
					<tr>
						<td>Marital</td>
						<td><?= $ulogin1->getMarital()->getMaritalName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getUserType()))	{
?>
					<tr>
						<td>Type of User</td>
						<td><?= $ulogin1->getUserType()->getTypeName() ?></td>
					</tr>
<?php		
	}
	$rootCourseInstructorText = "Normal User";
	if ($ulogin1->isRoot()) $rootCourseInstructorText = "System User";
?>
					<tr>
						<td colspan="2">This is a <b><i><?= $rootCourseInstructorText ?></i></b></td>
					</tr>
					<tr>
						<td>Email</td>
						<td><?= $ulogin1->getEmail() ?></td>
					</tr>
					<tr>
						<td>Username </td>
						<td><?= $ulogin1->getLoginName() ?></td>
					</tr>
					<tr>
						<td>Phone</td>
						<td><?= $ulogin1->getPhone() ?></td>
					</tr>
<?php 
	if (! is_null($ulogin1->getJobTitle()))	{
?>
					<tr>
						<td>Job Title</td>
						<td><?= $ulogin1->getJobTitle()->getJobName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getGroup()))	{
?>
					<tr>
						<td>Group</td>
						<td><?= $ulogin1->getGroup()->getGroupName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getTheme()))	{
?>
					<tr>
						<td>CourseInstructor Theme</td>
						<td><?= $ulogin1->getTheme()->getThemeName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getFirstDayOfAWeek()))	{
?>
					<tr>
						<td>First Day of a Week</td>
						<td><?= $ulogin1->getFirstDayOfAWeek()->getDayName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getAdmissionTime()))	{
?>
					<tr>
						<td>Time of Admission </td>
						<td><?= $ulogin1->getAdmissionTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getLastLoginTime()))	{
?>
					<tr>
						<td>Time of Last Login </td>
						<td><?= $ulogin1->getLastLoginTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $ulogin1->getExtraInformation() ?><br/><?= $instructor1->getExtraInformation() ?></td>
					</tr>
				</tbody>
			</table><br/>
<?php 
	if (! is_null($instructor1->getCourseAndSubjectTransactionList()) && sizeof($instructor1->getCourseAndSubjectTransactionList()) > 0)	{
		$objectList1 = $instructor1->getCourseAndSubjectTransactionList();
?>
			<table class="pure-table pure-table-aligned ui-sys-search-results">
				<thead>
					<tr>
						<th colspan="7">Course & Subjects Attached To</th>
					</tr>
					<tr>
						<th></th>
						<th>Map Name</th>
						<th>Course</th>
						<th>Subject/Module</th>
						<th>Year</th>
						<th>Semester</th>
						<th>Status</th>
					</tr>
				</thead>
<?php 
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	foreach ($objectList1 as $obj1)	{
		if (is_null($obj1)) continue;
		if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
			$numberOfTBodies++;
			$tbodyClosed = false;
		} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
			echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
			$numberOfTBodies++;
			$perTbodyCounter = 0;
		}
		//In All Cases we need to display tr
		$pureTableOddClass = "";
		if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
		<tr class="<?= $pureTableOddClass ?>">
			<td><?= $sqlReturnedRowCount + 1 ?></td>
			<td><?= $obj1->getExtraInformation() ?></td>
			<td>
<?php 
	if (! is_null($obj1->getCourse()))	{
?>
		<?= $obj1->getCourse()->getCourseName() ?>
<?php
	}
?>			
			</td>
			<td>
<?php 
	if (! is_null($obj1->getSubject()))	{
?>
		<?= $obj1->getSubject()->getSubjectName() ?>
<?php
	}
?>			
			</td>
			<td><?= $obj1->getYear() ?></td>
			<td><?= $obj1->getSemester() ?></td>
			<td>
<?php 
	$compulsoryText="Optional";
	if ($obj1->isCompulsory())	$compulsoryText="Compulsory";
	echo $compulsoryText;
?>			
			</td>
		</tr>
<?php
		$perTbodyCounter++;
		$sqlReturnedRowCount++;
	}
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
?>
			</table>
			<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>

<?php
	}
?>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managelogin_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Password Change for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managelogin_edit&id=<?= $ulogin1->getLoginId() ?>&password_token=true"><img alt="DAT" src="../sysimage/buttonpassword.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managecourseinstructor_edit&id=<?= $instructor1->getInstructorId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managecourseinstructor_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managecourseinstructor_delete&id=<?= $instructor1->getInstructorId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managecourseinstructor_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Attach Course and Subject Mappings" href="<?= $thispage ?>?page=managecourseinstructor_edit&id=<?= $instructor1->getInstructorId() ?>&attach_courseAndSubjectTransaction=true"><img alt="DAT" src="../sysimage/buttonattach.png"/></a>
<?php
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall", "normal", "donsetlog", "-1", "-1"))	{
?>
		<a title="Set System Firewall for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttonfirewall.png"/></a>
<?php	
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="View Authorization Graph for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall_graph&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttongraph.png"/></a>
<?php	
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managecourseinstructor_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managecourseinstructor_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$firstname = mysql_real_escape_string($_REQUEST['firstname']);
		$middlename = mysql_real_escape_string($_REQUEST['middlename']);
		$lastname = mysql_real_escape_string($_REQUEST['lastname']);
		$fullname = mysql_real_escape_string($_REQUEST['fullname']);
		$departmentId = mysql_real_escape_string($_REQUEST['departmentId']);
		$dob = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat(mysql_real_escape_string($_REQUEST['dob']));
		$sexId = mysql_real_escape_string($_REQUEST['sexId']);
		$maritalId = mysql_real_escape_string($_REQUEST['maritalId']);
		$jobId = mysql_real_escape_string($_REQUEST['jobId']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$email = mysql_real_escape_string($_REQUEST['email']);
		$phone = mysql_real_escape_string($_REQUEST['phone']);
		$loginName = mysql_real_escape_string($_REQUEST['loginName']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $fullname ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$ulogin1 = null;
	try {
		$loginId = Login::initializeLoginRecordForCourseInstructor($database, $conn, $loginName);
		$query="INSERT INTO courseInstructors (loginId, departmentId, extraFilter, extraInformation) VALUES('$loginId', '$departmentId', '$extraFilter', '$extraInformation')";
		mysql_db_query($database, $query, $conn) or Object::shootException("CourseInstructor[Adding]: Could not Add a Record into the System");
		$ulogin1 = new Login($database, $loginId, $conn);
		/*Proceed on Updating*/
		$ulogin1->setFirstname($firstname);
		$ulogin1->setMiddlename($middlename);
		$ulogin1->setLastname($lastname);
		$ulogin1->setFullname($fullname);
		$ulogin1->setDOB($dob);
		$ulogin1->setSex($sexId);
		$ulogin1->setMarital($maritalId);
		$ulogin1->setJobTitle($jobId);
		$ulogin1->setGroup($groupId);
		$ulogin1->setEmail($email);
		$ulogin1->setPhone($phone);
		//instructorname/loginName is alredy set during initialization 
		$ulogin1->setAdmitted("1");
		$ulogin1->setUsingDefaultPassword("1");
		$ulogin1->setPassword(sha1(Object::$defaultPassword));
		$ulogin1->setAdmissionTime($systemDate1->getDateAndTimeString());
		$ulogin1->commitUpdate();
		/*Ending Update*/
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Course Instructor <?= $ulogin1->getFullname() ?>, has successful Added to the system<br/>
			<br/>
			This Course Instructor is using a default password <b><?= Object::$defaultPassword ?></b>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the Course Instructor<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another Course Instructor";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managecourseinstructor_add", "Added $loginName");
	} else if ($page == "managecourseinstructor_add" && Authorize::isAllowable($config, "managecourseinstructor_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New CourseInstructor</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managecourseinstructor_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="firstname">Firstname </label>
						<input type="text" name="firstname" id="firstname" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Firstname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="middlename">Middlename </label>
						<input type="text" name="middlename" id="middlename" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Middlename : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lastname">Lastname </label>
						<input type="text" name="lastname" id="lastname" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Lastname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="fullname">Full Name </label>
						<input type="text" name="fullname" id="fullname" size="48" required pattern="<?= $exprA64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA64Name ?>" validate_message="Accademic Name : <?= $msgA64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="departmentId">Department </label>
						<select id="departmentId" name="departmentId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Department">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Department::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="dob">Date of Birth </label>
						<input class="datepicker" type="text" name="dob" id="dob" size="48" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Date: <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="sexId">Sex </label>
						<select id="sexId" name="sexId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Sex">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Sex::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="maritalId">Marital Status</label>
						<select id="maritalId" name="maritalId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Marital">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Marital::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="phone">Phone/Telephone </label>
						<input type="text" name="phone" id="phone" size="32" required pattern="<?= $exprPhone ?>" validate="true" validate_control="text" validate_expression="<?= $exprPhone ?>" validate_message="Phone/Telephone : <?= $msgPhone ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="email">Email Address</label>
						<input type="text" name="email" id="email" size="48" required pattern="<?= $exprEmail ?>" validate="true" validate_control="text" validate_expression="<?= $exprEmail ?>%<?= $exprL32Name ?>" validate_message="Email Format : <?= $msgEmail ?>%Email Length: <?= $msgL32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="loginName">User Name </label>
						<input type="text" name="loginName" id="loginName" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="CourseInstructorname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="jobId">Job Title </label>
						<select id="jobId" name="jobId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managecourseinstructor">Back to Course Instructor Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var $loginName1 = $('#loginName');
		if (! $loginName1.length) return;
		var $email1 = $('#email');
		if (! $email1.length) return;
		$target1.empty();
		$.ajax({
			url: "../server/service_username_email_availability.php",
			method: "POST",
			data: { param1: $loginName1.val(), param2: $email1.val() },
			dataType: "json",
			cache: false,
			async: false
		}).done(function(data, textStatus, jqXHR)	{
			if (parseInt(data.code) === 0)	{
				generalFormSubmission(this, 'form1', 'perror');
			} else	{
				//Failed 
				$target1.html("1-- Failed " + data.message); return;
			}
		}).fail(function(jqXHR, textStatus, errorThrown)	{
			$target1.html("2-- Failed " + textStatus); return;
		}).always(function(data, textStatus, jqXHR)	{
			//Default Always
		})
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managecourseinstructor" && Authorize::isAllowable($config, "managecourseinstructor", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">CourseInstructors Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-instructor-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managecourseinstructor" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managecourseinstructor_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name</th>
				<th>Department</th>
				<th>Status</th>
				<th>Sex</th>
				<th>Email</th>
				<th>Phone</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = CourseInstructor::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch instructor data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$instructor1 = null;
		$ulogin1 = null;
		try {
			$instructor1 = new CourseInstructor($database, $id, $conn);
			$ulogin1 = $instructor1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($instructor1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $ulogin1->getFullname() ?></td>
				<td>
<?php 
	if (! is_null($instructor1->getDepartment()))	{
?>
					<?= $instructor1->getDepartment()->getDepartmentName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
		<?= $ulogin1->getUserStatus()->getStatusName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($ulogin1->getSex()))	{
?>
		<?= $ulogin1->getSex()->getSexName() ?>
<?php
	}
?>				
				</td>
				<td><?= $ulogin1->getEmail() ?></td>
				<td><?= $ulogin1->getPhone() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managecourseinstructor_detail&id=<?= $instructor1->getInstructorId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managecourseinstructor_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managecourseinstructor_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managecourseinstructor_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System CourseInstructor" href="<?= $thispage ?>?page=managecourseinstructor_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*CourseInstructor End*/ else/*User BEGIN*/if ($page == "manageuser_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageuser_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a></div>
		</div>
<?php
	} else if ($page == "manageuser_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "manageuser_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = User::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("User[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$user1 = null;
			try	{
				$user1 = new User($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($user1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=manageuser_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageuser_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "manageuser_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageuser_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=manageuser_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageuser_csv" && Authorize::isAllowable($config, "manageuser_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="manageuser_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, User::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "manageuser_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageuser_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$user1 = null;
		$ulogin1 = null;
		try {
			 $user1 = new User($database, $_REQUEST['id'], $conn);
			 $ulogin1 = $user1->getLogin();
			 $user1->commitDelete();
			 $ulogin1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a User which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The User <?= $ulogin1->getFullname() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the User <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageuser_delete", "Deleted ".$ulogin1->getLoginName());
	} else if ($page == "manageuser_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageuser_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$user1 = null;
		$ulogin1 = null;
		try {
			$user1 = new User($database, $_REQUEST['id'], $conn);
			$ulogin1 = $user1->getLogin();
			$user1->setExtraFilter(System::getCodeString(8));
			$user1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a User <b><?= $ulogin1->getFullname() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the User <?= $ulogin1->getFullname() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=manageuser_delete&report=io&id=<?= $user1->getUserId() ?>&rndx=<?= $user1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=manageuser">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "manageuser_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "manageuser_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$user1 = null;
		$ulogin1 = null;
		try {
			$user1 = new User($database, $_REQUEST['id'], $conn);
			$ulogin1 = $user1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$statusId = mysql_real_escape_string($_REQUEST['statusId']);
		$jobId = mysql_real_escape_string($_REQUEST['jobId']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$isroot = 0;
		if (isset($_REQUEST['isroot'])) $isroot = 1;
		if (is_null($ulogin1->getUserStatus()) || ($statusId != $ulogin1->getUserStatus()->getStatusId()))	{
			$ulogin1->setUserStatus($statusId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getJobTitle()) || ($jobId != $ulogin1->getJobTitle()->getJobId()))	{
			$ulogin1->setJobTitle($jobId); $enableUpdate = true;
		}
		if (is_null($ulogin1->getGroup()) || ($groupId != $ulogin1->getGroup()->getGroupId()))	{
			$ulogin1->setGroup($groupId); $enableUpdate = true;
		}
		if ($extraInformation != $ulogin1->getExtraInformation())	{
			$ulogin1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		if (($isroot == 1) xor $ulogin1->isRoot())	{
			$ulogin1->setRoot($isroot); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $user1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$user1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$user1->commitUpdate();
				$ulogin1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">User Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			User <?= $ulogin1->getFullname() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the user <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageuser_edit", "Edited ".$ulogin1->getLoginName());
	} else if ($page == "manageuser_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageuser_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$user1 = null;
		$ulogin1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$user1 = new User($database, $_REQUEST['id'], $conn);
			$ulogin1 = $user1->getLogin();
			$user1->setExtraFilter($extraFilter);
			$user1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit User <?= $ulogin1->getFullname() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageuser_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $user1->getUserId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $user1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="statusId">User Status </label>
						<select id="statusId" name="statusId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select User Status">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = UserStatus::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getUserStatus()) && ($ulogin1->getUserStatus()->getStatusId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="jobId">Job Title </label>
						<select id="jobId" name="jobId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getJobTitle()) && ($ulogin1->getJobTitle()->getJobId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
		$selected = "";
		if (! is_null($ulogin1->getGroup()) && ($ulogin1->getGroup()->getGroupId() == $alist1['id'])) $selected="selected"; 
?>
			<option <?= $selected ?> value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
<?php 
	if ($login1->isRoot() && ($login1->getLoginId() != $ulogin1->getLoginId()))	{
		//Only those logged in as root users are allowed to change 
		//this status
		//And as usual you can not change this for yourself even if you are the root user
		$chkEnable = "";
		if ($ulogin1->isRoot()) $chkEnable = "checked";
?>
					<div class="pure-controls">
						<label><input type="checkbox" name="isroot" value="1" <?= $chkEnable ?>/>Enable/Disable System User Status</label>
					</div>
<?php
	}
?>
					
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $ulogin1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageuser_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "manageuser_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$user1 = null;
		$ulogin1 = null;
		try {
			$user1 = new User($database, $_REQUEST['id'], $conn);
			$ulogin1 = $user1->getLogin();
			$photoname = "default.png";
			if (! is_null($ulogin1->getSex()))	{
				if (strtolower($ulogin1->getSex()->getSexName()) == "male") $photoname="default_male.png";
				else if (strtolower($ulogin1->getSex()->getSexName()) == "female") $photoname="default_female.png";
			}
			if (! is_null($ulogin1->getPhoto())) $photoname = $ulogin1->getPhoto();
			$ulogin1->setExtraFilter("../data/users/photo/".$photoname);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $ulogin1->getFullname() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td colspan="2">
							<div class="ui-sys-user-photo-detail"><img alt="PDET" src="<?= $ulogin1->getExtraFilter() ?>"/></div>
						</td>
					</tr>
					<tr>
						<td>Firstname</td>
						<td><?= $ulogin1->getFirstname() ?></td>
					</tr>
					<tr>
						<td>Middlename</td>
						<td><?= $ulogin1->getMiddlename() ?></td>
					</tr>
					<tr>
						<td>Lastname</td>
						<td><?= $ulogin1->getLastname() ?></td>
					</tr>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
					<tr>
						<td>Status</td>
						<td><?= $ulogin1->getUserStatus()->getStatusName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getDOB()))	{
?>
					<tr>
						<td>Date of Birth</td>
						<td><?= DateAndTime::convertFromDateTimeObjectToGUIDateFormat($ulogin1->getDOB()) ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getSex()))	{
?>
					<tr>
						<td>Sex</td>
						<td><?= $ulogin1->getSex()->getSexName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getMarital()))	{
?>
					<tr>
						<td>Marital</td>
						<td><?= $ulogin1->getMarital()->getMaritalName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getUserType()))	{
?>
					<tr>
						<td>Type of User</td>
						<td><?= $ulogin1->getUserType()->getTypeName() ?></td>
					</tr>
<?php		
	}
	$rootUserText = "Normal User";
	if ($ulogin1->isRoot()) $rootUserText = "System User";
?>
					<tr>
						<td colspan="2">This is a <b><i><?= $rootUserText ?></i></b></td>
					</tr>
					<tr>
						<td>Email</td>
						<td><?= $ulogin1->getEmail() ?></td>
					</tr>
					<tr>
						<td>Username </td>
						<td><?= $ulogin1->getLoginName() ?></td>
					</tr>
					<tr>
						<td>Phone</td>
						<td><?= $ulogin1->getPhone() ?></td>
					</tr>
<?php 
	if (! is_null($ulogin1->getJobTitle()))	{
?>
					<tr>
						<td>Job Title</td>
						<td><?= $ulogin1->getJobTitle()->getJobName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getGroup()))	{
?>
					<tr>
						<td>Group</td>
						<td><?= $ulogin1->getGroup()->getGroupName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getTheme()))	{
?>
					<tr>
						<td>User Theme</td>
						<td><?= $ulogin1->getTheme()->getThemeName() ?></td>
					</tr>
<?php		
	}
	if (! is_null($ulogin1->getFirstDayOfAWeek()))	{
?>
					<tr>
						<td>First Day of a Week</td>
						<td><?= $ulogin1->getFirstDayOfAWeek()->getDayName() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getAdmissionTime()))	{
?>
					<tr>
						<td>Time of Admission </td>
						<td><?= $ulogin1->getAdmissionTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
	if (! is_null($ulogin1->getLastLoginTime()))	{
?>
					<tr>
						<td>Time of Last Login </td>
						<td><?= $ulogin1->getLastLoginTime()->getDateAndTimeString() ?></td>
					</tr>
<?php
	}
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $ulogin1->getExtraInformation() ?><br/><?= $user1->getExtraInformation() ?></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managelogin_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Password Change for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managelogin_edit&id=<?= $ulogin1->getLoginId() ?>&password_token=true"><img alt="DAT" src="../sysimage/buttonpassword.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "manageuser_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=manageuser_edit&id=<?= $user1->getUserId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "manageuser_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=manageuser_delete&id=<?= $user1->getUserId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall", "normal", "donsetlog", "-1", "-1"))	{
?>
		<a title="Set System Firewall for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttonfirewall.png"/></a>
<?php	
	}
	if ($login1->isRoot() && Login::shouldAllowUpdateControls($login1, $ulogin1) && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="View Authorization Graph for <?= $ulogin1->getFullname() ?>" href="<?= $thispage ?>?page=managesystemfirewall_graph&type=login&id=<?= $ulogin1->getLoginId() ?>"><img alt="DAT" src="../sysimage/buttongraph.png"/></a>
<?php	
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "manageuser_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "manageuser_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$firstname = mysql_real_escape_string($_REQUEST['firstname']);
		$middlename = mysql_real_escape_string($_REQUEST['middlename']);
		$lastname = mysql_real_escape_string($_REQUEST['lastname']);
		$fullname = mysql_real_escape_string($_REQUEST['fullname']);
		$dob = DateAndTime::convertFromGUIDateFormatToSystemDateAndTimeFormat(mysql_real_escape_string($_REQUEST['dob']));
		$sexId = mysql_real_escape_string($_REQUEST['sexId']);
		$maritalId = mysql_real_escape_string($_REQUEST['maritalId']);
		$jobId = mysql_real_escape_string($_REQUEST['jobId']);
		$groupId = mysql_real_escape_string($_REQUEST['groupId']);
		$email = mysql_real_escape_string($_REQUEST['email']);
		$phone = mysql_real_escape_string($_REQUEST['phone']);
		$loginName = mysql_real_escape_string($_REQUEST['loginName']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $fullname ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$ulogin1 = null;
	try {
		$loginId = Login::initializeLoginRecordForUser($database, $conn, $loginName);
		$query="INSERT INTO users (loginId, extraFilter, extraInformation) VALUES('$loginId', '$extraFilter', '$extraInformation')";
		mysql_db_query($database, $query, $conn) or Object::shootException("User[Adding]: Could not Add a Record into the System");
		$ulogin1 = new Login($database, $loginId, $conn);
		/*Proceed on Updating*/
		$ulogin1->setFirstname($firstname);
		$ulogin1->setMiddlename($middlename);
		$ulogin1->setLastname($lastname);
		$ulogin1->setFullname($fullname);
		$ulogin1->setDOB($dob);
		$ulogin1->setSex($sexId);
		$ulogin1->setMarital($maritalId);
		$ulogin1->setJobTitle($jobId);
		$ulogin1->setGroup($groupId);
		$ulogin1->setEmail($email);
		$ulogin1->setPhone($phone);
		//username/loginName is alredy set during initialization 
		$ulogin1->setAdmitted("1");
		$ulogin1->setUsingDefaultPassword("1");
		$ulogin1->setPassword(sha1(Object::$defaultPassword));
		$ulogin1->setAdmissionTime($systemDate1->getDateAndTimeString());
		$ulogin1->commitUpdate();
		/*Ending Update*/
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
		$enableUpdate = false;
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The User <?= $ulogin1->getFullname() ?>, has successful Added to the system<br/>
			<br/>
			This user is using a default password <b><?= Object::$defaultPassword ?></b>
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the user<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$commentText = "Try Again";
	if ($enableUpdate) $commentText = "Add Another User";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser_add"><?= $commentText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "manageuser_add", "Added $loginName");
	} else if ($page == "manageuser_add" && Authorize::isAllowable($config, "manageuser_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New User</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="manageuser_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="firstname">Firstname </label>
						<input type="text" name="firstname" id="firstname" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Firstname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="middlename">Middlename </label>
						<input type="text" name="middlename" id="middlename" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Middlename : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="lastname">Lastname </label>
						<input type="text" name="lastname" id="lastname" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Lastname : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="fullname">Full Name </label>
						<input type="text" name="fullname" id="fullname" size="48" required pattern="<?= $exprA64Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA64Name ?>" validate_message="Accademic Name : <?= $msgA64Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="dob">Date of Birth </label>
						<input class="datepicker" type="text" name="dob" id="dob" size="48" required pattern="<?= $exprDate ?>" validate="true" validate_control="text" validate_expression="<?= $exprDate ?>" validate_message="Date: <?= $msgDate ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="sexId">Sex </label>
						<select id="sexId" name="sexId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Sex">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Sex::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="maritalId">Marital Status</label>
						<select id="maritalId" name="maritalId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Marital">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Marital::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="phone">Phone/Telephone </label>
						<input type="text" name="phone" id="phone" size="32" required pattern="<?= $exprPhone ?>" validate="true" validate_control="text" validate_expression="<?= $exprPhone ?>" validate_message="Phone/Telephone : <?= $msgPhone ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="email">Email Address</label>
						<input type="text" name="email" id="email" size="48" required pattern="<?= $exprEmail ?>" validate="true" validate_control="text" validate_expression="<?= $exprEmail ?>%<?= $exprL32Name ?>" validate_message="Email Format : <?= $msgEmail ?>%Email Length: <?= $msgL32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="loginName">Login Username </label>
						<input type="text" name="loginName" id="loginName" size="48" required pattern="<?= $exprA32Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA32Name ?>" validate_message="Username : <?= $msgA32Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="jobId">Job Title </label>
						<select id="jobId" name="jobId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Job Title">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = JobTitle::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="groupId">Group </label>
						<select id="groupId" name="groupId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list1 = Group::loadAllData($database, $conn);
	foreach ($list1 as $alist1)	{
?>
			<option value="<?= $alist1['id'] ?>"><?= $alist1['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=manageuser">Back to User Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var $loginName1 = $('#loginName');
		if (! $loginName1.length) return;
		var $email1 = $('#email');
		if (! $email1.length) return;
		$target1.empty();
		$.ajax({
			url: "../server/service_username_email_availability.php",
			method: "POST",
			data: { param1: $loginName1.val(), param2: $email1.val() },
			dataType: "json",
			cache: false,
			async: false
		}).done(function(data, textStatus, jqXHR)	{
			if (parseInt(data.code) === 0)	{
				generalFormSubmission(this, 'form1', 'perror');
			} else	{
				//Failed 
				$target1.html("1-- Failed " + data.message); return;
			}
		}).fail(function(jqXHR, textStatus, errorThrown)	{
			$target1.html("2-- Failed " + textStatus); return;
		}).always(function(data, textStatus, jqXHR)	{
			//Default Always
		})
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "manageuser" && Authorize::isAllowable($config, "manageuser", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Users Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-user-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=manageuser" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "manageuser_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Name</th>
				<th>Status</th>
				<th>Sex</th>
				<th>Email</th>
				<th>Phone</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = User::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch user data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$user1 = null;
		$ulogin1 = null;
		try {
			$user1 = new User($database, $id, $conn);
			$ulogin1 = $user1->getLogin();
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($user1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $ulogin1->getFullname() ?></td>
				<td>
<?php 
	if (! is_null($ulogin1->getUserStatus()))	{
?>
		<?= $ulogin1->getUserStatus()->getStatusName() ?>
<?php
	}
?>				
				</td>
				<td>
<?php 
	if (! is_null($ulogin1->getSex()))	{
?>
		<?= $ulogin1->getSex()->getSexName() ?>
<?php
	}
?>				
				</td>
				<td><?= $ulogin1->getEmail() ?></td>
				<td><?= $ulogin1->getPhone() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=manageuser_detail&id=<?= $user1->getUserId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "manageuser_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=manageuser_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "manageuser_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System User" href="<?= $thispage ?>?page=manageuser_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*User End*/ else/*JobTitle BEGIN*/if ($page == "managejobtitle_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managejobtitle_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitle CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a></div>
		</div>
<?php
	} else if ($page == "managejobtitle_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managejobtitle_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitle CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = JobTitle::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("JobTitle[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$job1 = null;
			try	{
				$job1 = new JobTitle($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($job1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managejobtitle_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>			
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managejobtitle_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managejobtitle_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitle CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managejobtitle_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managejobtitle_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managejobtitle_csv" && Authorize::isAllowable($config, "managejobtitle_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitle CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managejobtitle_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, JobTitle::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managejobtitle_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managejobtitle_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$job1 = null;
		try {
			 $job1 = new JobTitle($database, $_REQUEST['id'], $conn);
			 $job1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a JobTitle which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitle Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The JobTitle <?= $job1->getJobName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the JobTitle <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managejobtitle_delete", "Deleted ".$job1->getJobName());
	} else if ($page == "managejobtitle_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managejobtitle_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$job1 = null;
		try {
			$job1 = new JobTitle($database, $_REQUEST['id'], $conn);
			$job1->setExtraFilter(System::getCodeString(8));
			$job1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a JobTitle <b><?= $job1->getJobName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the JobTitle <?= $job1->getJobName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managejobtitle_delete&report=io&id=<?= $job1->getJobId() ?>&rndx=<?= $job1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managejobtitle">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managejobtitle_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managejobtitle_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$job1 = null;
		try {
			$job1 = new JobTitle($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$jobName = mysql_real_escape_string($_REQUEST['jobName']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		if ($jobName != $job1->getJobName())	{
			$job1->setJobName($jobName); $enableUpdate = true;
		}
		if ($extraInformation != $job1->getExtraInformation())	{
			$job1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $job1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$job1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate)	{
			try {
				$job1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} 
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Job Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			JobTitle <?= $job1->getJobName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the job <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managejobtitle_edit", "Edited ".$job1->getJobName());
	} else if ($page == "managejobtitle_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managejobtitle_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$job1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$job1 = new JobTitle($database, $_REQUEST['id'], $conn);
			$job1->setExtraFilter($extraFilter);
			$job1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit JobTitle <?= $job1->getJobName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managejobtitle_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $job1->getJobId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $job1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="jobName">JobTitle Name </label>
						<input value="<?= $job1->getJobName() ?>" type="text" name="jobName" id="jobName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="JobTitle Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $job1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managejobtitle_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managejobtitle_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$job1 = null;
		try {
			$job1 = new JobTitle($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $job1->getJobName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>JobTitle Name</td>
						<td><?= $job1->getJobName() ?></td>
					</tr>
<?php 
	if (! is_null($job1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $job1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (! $job1->isRootJob() && Authorize::isAllowable($config, "managejobtitle_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $job1->getJobName() ?>" href="<?= $thispage ?>?page=managejobtitle_edit&id=<?= $job1->getJobId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (! $job1->isRootJob() && Authorize::isAllowable($config, "managejobtitle_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $job1->getJobName() ?>" href="<?= $thispage ?>?page=managejobtitle_delete&id=<?= $job1->getJobId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if ($login1->isRoot() && Authorize::isAllowable($config, "managesystemfirewall", "normal", "donsetlog", "-1", "-1"))	{
?>
		<a title="Set System Firewall for <?= $job1->getJobName() ?>" href="<?= $thispage ?>?page=managesystemfirewall&type=jobtitle&id=<?= $job1->getJobId() ?>"><img alt="DAT" src="../sysimage/buttonfirewall.png"/></a>
<?php	
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managejobtitle_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managejobtitle_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$jobName = mysql_real_escape_string($_REQUEST['jobName']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$context = Object::$defaultContextValue;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $jobName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO jobTitle (jobName, context, extraFilter, extraInformation) VALUES('$jobName', '$context', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("JobTitle[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The JobTitle <?= $jobName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the job<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Job Title";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managejobtitle_add", "Added $jobName");
	} else if ($page == "managejobtitle_add" && Authorize::isAllowable($config, "managejobtitle_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New JobTitle</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managejobtitle_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="jobName">Job Title Name </label>
						<input type="text" name="jobName" id="jobName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="JobTitle Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managejobtitle">Back to Job Title Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managejobtitle" && Authorize::isAllowable($config, "managejobtitle", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">JobTitles Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-job-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managejobtitle" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managejobtitle_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Job Name</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = JobTitle::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch job data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$job1 = null;
		try {
			$job1 = new JobTitle($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($job1->searchMatrix($matrix1)->evaluateResult())	{
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $job1->getJobName() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managejobtitle_detail&id=<?= $job1->getJobId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managejobtitle_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managejobtitle_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managejobtitle_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System JobTitle" href="<?= $thispage ?>?page=managejobtitle_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*JobTitle End*/ else /*Group BEGIN*/if ($page == "managegroup_csv" && isset($_REQUEST['report']) && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$filename=$_REQUEST['report'];
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group CSV File<br/> (Download Report)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (unlink($filename))	{
?>
		<div class="ui-state-highlight">
			The temporary file has been removed succesful from the Server
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problem on removing the temporary file from the Server
		</div>
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a></div>
		</div>
<?php
	} else if ($page == "managegroup_csv" && isset($_REQUEST['downloadable']) && Authorize::isAllowable($config, "managegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
		$promise1 = new Promise();
		$promise1->setPromise(true);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group CSV File <br/> (Downlad CSV File)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	$filename="";
	$tfname=$filename.$date;
	$tfname=$tfname.rand(100,999);
	$filename=sha1($tfname);
	$filename=$filename.".csv";
	$filename="../temp/".$filename;
	$searchText = Object::getSearchTextFromUserFieldData($_REQUEST['controlIndex'], $_REQUEST['fieldname'], $_REQUEST['op'], $_REQUEST['namespaceTag'], $_REQUEST['fieldvalue']);
	$lineCounter = 0;
	$file1 = fopen($filename, "w") or die("Could not Open the File for writing");
	$csvProcessor1 = null;
	try {
		$csvProcessor1 = new CSVProcessor($searchText, $file1);
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$primise1->setPromise(false);
	}
	$result = null;
	if ($promise1->isPromising())	{
		$query = Group::getQueryText();
		try {
			$result = mysql_db_query($database, $query, $conn) or Object::shootException("Group[CSV]: Could not Execute Query");
		} catch (Exception $e)	{
			$promise1->setReason($e->getMessage());
			$primise1->setPromise(false);
		}
	}
	if ($promise1->isPromising())	{
		while (list($id) = mysql_fetch_row($result))	{
			$group1 = null;
			try	{
				$group1 = new Group($database, $id, $conn);
			} catch (Exception $e)	{ die($e->getMessage()); }
			$csvProcessor1->reload(); //Clear the Previous Object Properties 
			if ($group1->processCSV($csvProcessor1)->evaluateResult())	{
				$lineCounter++;
			}
		}//end-while 
	}//end-if-promising
	fclose($file1);
	if ($promise1->isPromising())	{
?>
		<div>
			Your file is Ready for downloading<br/>
			Number data rows it contains is <?= $lineCounter ?><br/><br/>
			<b style="font-size: 1.1em;"><a href="<?= $filename ?>">Click Here</a></b> to download your file<br/><br/>
			Once the download is complete, kindly click the proceed button 
		</div>
<?php	
	} else {
?>
		<div class="ui-state-error">
			There were problems in generating your file <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>					
			</div>
			<div class="ui-sys-panel-footer">
				<div id="perror" class="ui-sys-error-message"></div>
<?php 
	if ($promise1->isPromising())	{
		if ($lineCounter > 0)	{
?>
			<a id="__id_csv_previewer" data-error-control="perror" data-server-forward-path="../server/getcsvpreviewer.php" data-file-to-read="<?= $filename ?>" data-dialog-container="__id_general_dialog_holder" class="button-link">Preview</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php
		}
?>
		<a class="button-link" href="<?= $thispage ?>?page=managegroup_csv&report=<?= $filename ?>&downloadable=true">Continue</a>
<?php
	}
?>	
			</div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managegroup_csv" && isset($_REQUEST['sortable']) && Authorize::isAllowable($config, "managegroup_csv", "normal", "setlog", "-1", "-1"))	{
		$enableUpdate = false;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group CSV File <br/> (Column Sorting)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
<?php 
	if (isset($_REQUEST['fieldname']) && isset($_REQUEST['fieldtype']) && isset($_REQUEST['namespaceTag']) && isset($_REQUEST['fieldvalue']))	{
		$enableUpdate = true;
?>
				<form class="pure-form" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegroup_csv"/>
					<input type="hidden" name="downloadable" value="true"/>
<?php 
	$sortableContainer = Object::getUICSVDivSortable(Object::getLineToSortFromUserFieldData($_REQUEST['fieldname'], $_REQUEST['fieldtype'], $_REQUEST['namespaceTag'],$_REQUEST['fieldvalue']));
	echo $sortableContainer;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
<?php 
	} else {
?>
		Perhaps you did not select any column to be included in your CSV File <br/>
		Kindly go back to Column Selection and select atleast ONE Column
<?php
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
				<a class="button-link" href="<?= $thispage ?>?page=managegroup_csv">Back to Column Selection</a>&nbsp;&nbsp;&nbsp;&nbsp;
<?php 
	if ($enableUpdate)	{
?>				
				<input type="button" id="__add_record" value="Proceed"/>
<?php 
	}
?>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managegroup_csv" && Authorize::isAllowable($config, "managegroup_csv", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group CSV File <br/>(Column Selection)</div>
			<div class="ui-sys-panel-body ui-sys-csv-data-center">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
						<input type="hidden" name="page" value="managegroup_csv"/>
						<input type="hidden" name="sortable" value="true"/>
<?php
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	$listOfAvailableColumnsInTables = Object::getUICSVTables($database, Group::getAvailableViewableColumns(), $conn);
	mysql_close($conn);
	echo $listOfAvailableColumnsInTables;
?>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer">
				<input type="button" id="__add_record" value="Proceed"/><br/>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a>
			</div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
	} else if ($page == "managegroup_delete" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$promise1->setPromise(true);
		$group1 = null;
		try {
			 $group1 = new Group($database, $_REQUEST['id'], $conn);
			 $group1->commitDelete();
			 $enableUpdate = true;
		} catch (Exception $e)	{
			$promise1->setReason("You might be dealing with a Group which is no longer existing in the system or a None Empty Record");
			$promise1->setPromise(false);
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group Removal Report</div>
			<div class="ui-sys-panel-pody ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			The Group <?= $group1->getGroupName() ?> has been successful removed from the system
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Removing the Group <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php
	}
?>			
			</div>
			<div class="ui-sys-panel-footer">
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a>
			</div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegroup_delete", "Deleted ".$group1->getGroupName());
	} else if ($page == "managegroup_delete" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegroup_delete", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to database services");
		$group1 = null;
		try {
			$group1 = new Group($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter(System::getCodeString(8));
			$group1->commitUpdate();
		} catch (Exception $e)	{
			die($e->getMessage());
		}
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Delete Confirmation</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<div class="ui-sys-warning">
					You are about to remove a Group <b><?= $group1->getGroupName() ?></b> from the System <br/>
					<b>NOTE: This Operation Can not be reversed</b><br/>
					Are You Sure You want to remove the Group <?= $group1->getGroupName() ?> from the System?
				</div>
				<div class="ui-sys-center-text">
					<a class="button-link-warning" href="<?= $thispage ?>?page=managegroup_delete&report=io&id=<?= $group1->getGroupId() ?>&rndx=<?= $group1->getExtraFilter() ?>">Yes (Remove)</a>&nbsp;&nbsp;&nbsp;&nbsp;
					<a class="button-link" href="<?= $thispage ?>?page=managegroup">No (Cancel)</a>
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
		mysql_close($conn);
	} else if ($page == "managegroup_edit" && isset($_REQUEST['id']) && isset($_REQUEST['report']) && isset($_REQUEST['rndx']) && Authorize::isAllowable($config, "managegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new Group($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$promise1 = new Promise();
		$promise1->setReason("Nothing Has been Updated");
		$enableUpdate = false;
		$isLoopDetected = false;
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$pId = mysql_real_escape_string($_REQUEST['pId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$courseId = null;
		$year = null;
		$semester = null;
		$minimumPoints = null;
		if (isset($_REQUEST['courseId'])) $courseId = mysql_real_escape_string($_REQUEST['courseId']);
		if (isset($_REQUEST['year'])) $year = mysql_real_escape_string($_REQUEST['year']);
		if (isset($_REQUEST['semester'])) $semester = mysql_real_escape_string($_REQUEST['semester']);
		if (isset($_REQUEST['minimumPoints'])) $minimumPoints = mysql_real_escape_string($_REQUEST['minimumPoints']);
		if ($groupName != $group1->getGroupName())	{
			$group1->setGroupName($groupName); $enableUpdate = true;
		}
		if ($pId != $group1->getParentGroup()->getGroupId())	{
			try {
				$group1->setParentGroup($pId); $enableUpdate = true;
			} catch (Exception $e)	{
				$isLoopDetected = true;
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
			}
		}
		if ($extraInformation != $group1->getExtraInformation())	{
			$group1->setExtraInformation($extraInformation); $enableUpdate = true;
		}
		if (! is_null($courseId) && (is_null($group1->getCourse()) || ($group1->getCourse()->getCourseId() != $courseId)))	{
			$group1->setCourse($courseId); $enableUpdate = true; 
		}
		if (! is_null($year) && ($group1->getYear() != $year))	{
			$group1->setYear($year); $enableUpdate = true;
		}
		if (! is_null($semester) && ($group1->getSemester() != $semester))	{
			$group1->setSemester($semester); $enableUpdate = true;
		}
		if (! is_null($minimumPoints) && ($group1->getMinimumPoints() != $minimumPoints))	{
			$group1->setMinimumPoints($minimumPoints); $enableUpdate = true;
		}
		//This is the Last 
		if (trim($_REQUEST['rndx']) != $group1->getExtraFilter())	{
			$enableUpdate = false;
			$promise1->setReason("The System has Detected you are replaying data in your Browser window");
			$promise1->setPromise(false);
		}
		//Now proceed with general find a new value of extra Filter 
		$group1->setExtraFilter(System::getCodeString(8));
		if ($enableUpdate && ! $isLoopDetected)	{
			try {
				$group1->commitUpdate();
				$promise1->setPromise(true);
			} catch (Exception $e)	{
				$promise1->setReason($e->getMessage());
				$promise1->setPromise(false);
				$enableUpdate = false;
			}
		} else {
			$enableUpdate = false; //Use this for Group Only incase loopIs Detected shut do not keep logs
		}
		mysql_close($conn);
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Group Editing Report</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">
			Group <?= $group1->getGroupName() ?> has been updated successful
		</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were no updates for the group <br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>			
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a></div>
		</div>
<?php
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegroup_edit", "Edited ".$group1->getGroupName());
	} else if ($page == "managegroup_edit" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegroup_edit", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		$extraFilter = System::getCodeString(8);
		try {
			$group1 = new Group($database, $_REQUEST['id'], $conn);
			$group1->setExtraFilter($extraFilter);
			$group1->commitUpdate();
		} catch (Exception $e)	{ die($e->getMessage()); }
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Edit Group <?= $group1->getGroupName() ?></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegroup_edit"/>
					<input type="hidden" name="report" value="io"/>
					<input type="hidden" name="id" value="<?= $group1->getGroupId() ?>"/>
					<input type="hidden" name="rndx" value="<?= $group1->getExtraFilter() ?>"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input value="<?= $group1->getGroupName() ?>" type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Group Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="pId">Parent Group</label>
						<select id="pId" name="pId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Parent Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = Group::loadAllData($database, $conn);
	foreach ($list as $alist)	{
		$selected="";
		if ($group1->getGroupId() == $alist['id']) continue;
		if ($alist['id'] == $group1->getParentGroup()->getGroupId()) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input value="<?= $group1->getExtraInformation() ?>" type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
<?php 
	$checked = "";
	if (! is_null($group1->getCourse())) $checked="checked";
?>
					<div class="pure-controls">
						<label><input <?= $checked ?> type="checkbox" value="Abel" id="chk-course-control"/> Do you want to Add Course Information?</label>
					</div>
					<div class="pure-control-group block-course-control">
						<label for="courseId">Course Name</label>
						<select id="courseId" name="courseId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Course">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = Course::loadAllData($database, $conn);
	foreach ($list as $alist)	{
		$selected="";
		if (! is_null($group1->getCourse()) && ($alist['id'] == $group1->getCourse()->getCourseId())) $selected = "selected";
?>
		<option <?= $selected ?> value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group block-course-control">
						<label for="Year">Year </label>
						<input value="<?= $group1->getYear() ?>" type="text" name="year" id="year" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Year : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group block-course-control">
						<label for="semester">Semester </label>
						<input value="<?= $group1->getSemester() ?>" type="text" name="semester" id="semester" size="8" required pattern="<?= $expr2Number ?>" validate="true" validate_control="text" validate_expression="<?= $expr2Number ?>" validate_message="Semester : <?= $msg2Number ?>"/>
					</div>
					<div class="pure-control-group block-course-control">
						<label for="minimumPoints">Minimum Points </label>
						<input class="text-can-not-be-zero" value="<?= $group1->getMinimumPoints() ?>" type="text" name="minimumPoints" id="minimumPoints" size="8" required pattern="<?= $exprD4Number ?>" validate="true" validate_control="text" validate_expression="<?= $exprD4Number ?>" validate_message="Minimum Points : <?= $msgD4Number ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Edit Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	var $checkCourseControl1 = $('#chk-course-control');
	function courseControlUiMaintainance(_enable)	{
		$('#form1 div.block-course-control').each(function(i, val)	{
			var $block1 = $(val);
			$block1.find('input').prop('disabled', ! _enable);
			$block1.find('select').prop('disabled', ! _enable);
		});
	}
	$checkCourseControl1.on('change', function(event)	{
		event.preventDefault();
		courseControlUiMaintainance($(this).prop('checked'));
	});
	//Default Loader
	courseControlUiMaintainance($checkCourseControl1.prop('checked'));
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		var $target1 = $('#perror');
		if (! $target1.length) return;
		var enableSubmit = true;
		$('input.text-can-not-be-zero').each(function(i, v)	{
			var $text1 = $(v);
			enableSubmit = enableSubmit && (parseInt($text1.val()) != 0);
		});
		if (enableSubmit)	{
			generalFormSubmission(this, 'form1', 'perror');
		} else {
			$target1.empty();
			$('<span/>').html('Minimum Points can not be zero')
				.appendTo($target1);
		}
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managegroup_detail" && isset($_REQUEST['id']) && Authorize::isAllowable($config, "managegroup_detail", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$group1 = null;
		try {
			$group1 = new Group($database, $_REQUEST['id'], $conn);
		} catch (Exception $e)	{die($e->getMessage());}
		mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Details for <?= $group1->getGroupName() ?></div>
		<div class="ui-sys-panel-content ui-sys-data-capture">
			<table class="pure-table">
				<thead>
					<tr>
						<th>Field Name</th>
						<th>Field Value</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Group Name</td>
						<td><?= $group1->getGroupName() ?></td>
					</tr>
<?php 
	if (! is_null($group1->getParentGroup()))	{
?>
					<tr>
						<td>Parent Group</td>
						<td><?= $group1->getParentGroup()->getGroupName() ?></td>
					</tr>
<?php	
	}
	if (! is_null($group1->getCourse()))	{
?>
					<tr>
						<td>Course Name</td>
						<td><?= $group1->getCourse()->getCourseName() ?></td>
					</tr>
					<tr>
						<td>Year</td>
						<td><?= $group1->getYear() ?></td>
					</tr>
					<tr>
						<td>Semester</td>
						<td><?= $group1->getSemester() ?></td>
					</tr>
					<tr>
						<td>Minimum Points</td>
						<td><?= $group1->getMinimumPoints() ?></td>
					</tr>
<?php
	} 
	$typeOfGroupText = "Normal Group";
	if ($group1->isRootGroup())	{
		$typeOfGroupText = "System Group";
?>
					<tr>
						<td>Narure of the Group</td>
						<td><?= $typeOfGroupText ?></td>
					</tr>
<?php
	}
	if (! is_null($group1->getExtraInformation()))	{
?>
					<tr>
						<td>Extra Information</td>
						<td><?= $group1->getExtraInformation() ?></td>
					</tr>
<?php
	}
?>
				</tbody>
			</table>
		</div>
		<div class="ui-sys-panel-footer">
			<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (! $group1->isRootGroup() && Authorize::isAllowable($config, "managegroup_edit", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Edit <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managegroup_edit&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonedit.png"/></a>
<?php
	}
	if (! $group1->isRootGroup() && Authorize::isAllowable($config, "managegroup_delete", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Delete <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managegroup_delete&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttondelete.png"/></a>
<?php
	}
	if ($login1->isRoot() && Authorize::isAllowable($config, "managesystemfirewall", "normal", "donsetlog", "-1", "-1"))	{
?>
		<a title="Set System Firewall for <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managesystemfirewall&type=group&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttonfirewall.png"/></a>
<?php	
	}
	if ($login1->isRoot() && Authorize::isAllowable($config, "managesystemfirewall_graph", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="View Authorization Graph for <?= $group1->getGroupName() ?>" href="<?= $thispage ?>?page=managesystemfirewall_graph&type=group&id=<?= $group1->getGroupId() ?>"><img alt="DAT" src="../sysimage/buttongraph.png"/></a>
<?php	
	}
?>
				<span class="ui-sys-clear-both">&nbsp;</span><br />
			</div>
			<div>
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a>
			</div>
		</div>
	</div>
<?php
	} else if ($page == "managegroup_add" && isset($_REQUEST['report']) && Authorize::isAllowable($config, "managegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
		$enableUpdate = false;
		$promise1 = new Promise();
		$groupName = mysql_real_escape_string($_REQUEST['groupName']);
		$pId = mysql_real_escape_string($_REQUEST['pId']);
		$extraInformation = mysql_real_escape_string($_REQUEST['extraInformation']);
		$context = Object::$defaultContextValue;
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel header ui-widget-header">Summary Report for <i><?= $groupName ?></i></div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
<?php 
	$extraFilter = System::getCodeString(8);
	$query="INSERT INTO groups (groupName, pId, context, extraFilter, extraInformation) VALUES('$groupName', '$pId', '$context', '$extraFilter', '$extraInformation')";
	try {
		mysql_db_query($database, $query, $conn) or Object::shootException("Group[Adding]: Could not Add a Record into the System");
		$promise1->setPromise(true);
		$enableUpdate = true;
	} catch (Exception $e)	{
		$promise1->setReason($e->getMessage());
		$promise1->setPromise(false);
	}
	if ($promise1->isPromising())	{
?>
		<div class="ui-state-highlight">The Group <?= $groupName ?>, has successful Added to the system</div>
<?php
	} else {
?>
		<div class="ui-state-error">
			There were problems in Adding the group<br/>
			Reason: <?= $promise1->getReason() ?>
		</div>
<?php		
	}
?>
			</div>
			<div class="ui-sys-panel-footer">
<?php 
	$captionText = "Try Again";
	if ($enableUpdate) $captionText = "Add Another Group";
?>			
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup_add"><?= $captionText ?></a>&nbsp;&nbsp;
				<a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a>
			</div>
		</div>
<?php
		mysql_close($conn);
		if ($enableUpdate) Accounting::addLog($config, $date, $login1->getLoginName(), "managegroup_add", "Added $groupName");
	} else if ($page == "managegroup_add" && Authorize::isAllowable($config, "managegroup_add", "normal", "setlog", "-1", "-1"))	{
		$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Add a New Group</div>
			<div class="ui-sys-panel-body ui-sys-data-capture">
				<form class="pure-form pure-form-aligned" id="form1" method="POST" action="<?= $thispage ?>">
					<input type="hidden" name="page" value="managegroup_add"/>
					<input type="hidden" name="report" value="io"/>
					<div class="pure-control-group">
						<label for="groupName">Group Name </label>
						<input type="text" name="groupName" id="groupName" size="48" required pattern="<?= $exprA48Name ?>" validate="true" validate_control="text" validate_expression="<?= $exprA48Name ?>" validate_message="Group Name : <?= $msgA48Name ?>"/>
					</div>
					<div class="pure-control-group">
						<label for="pId">Parent Group</label>
						<select id="pId" name="pId" validate="true" validate_control="select" validate_expression="select" validate_message="Kindly Select a Parent Group">
							<option value="_@32767@_">--select--</option>
<?php 
	$list = Group::loadAllData($database, $conn);
	foreach ($list as $alist)	{
?>
		<option value="<?= $alist['id'] ?>"><?= $alist['val'] ?></option>
<?php
	}
?>
						</select>
					</div>
					<div class="pure-control-group">
						<label for="extraInformation">Extra Information </label>
						<input type="text" name="extraInformation" id="extraInformation" size="48" notrequired="true" validate="true" validate_control="text" validate_expression="<?= $exprL64Name ?>" validate_message="Extra Information : <?= $msgL64Name ?>"/>
					</div>
					<div class="pure-controls">
						<span id="perror" class="ui-sys-error-message"></span>
					</div>
					<div class="pure-controls">
						<input id="__add_record" type="button" value="Add Record"/>
					</div>
				</form>
			</div>
			<div class="ui-sys-panel-footer"><a class="ui-sys-back" href="<?= $thispage ?>?page=managegroup">Back to Group Manager</a></div>
		</div>
<script type="text/javascript">
(function($)	{
	$('#__add_record').on('click', function(event)	{
		event.preventDefault();
		generalFormSubmission(this, 'form1', 'perror');
	});
})(jQuery);
</script>
<?php
		mysql_close($conn);
	} else if ($page == "managegroup" && Authorize::isAllowable($config, "managegroup", "normal", "setlog", "-1", "-1"))	{
?>
		<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
			<div class="ui-sys-panel-header ui-widget-header">Groups Management</div>
			<div class="ui-sys-panel-body">
<!--Block ONE controls for searching-->
				<div class="ui-sys-search-container pure-form pure-group-control">
					<input type="text" title="At Least Three Characters should be supplied" required placeholder="ABC" size="32"/>
					<a title="Click to Search" class="click-to-search" data-next-page="<?= $thispage ?>?page=managegroup" data-min-character="3"><img src="../sysimage/buttonsearch.png" alt="DAT"/></a>
				</div>
<!--Block ONE ends-->	
<?php 
	if (isset($_REQUEST['searchtext']))	{
		$searchtext = $_REQUEST['searchtext'];
		//saving Authorization Rules 
		$blnAuthorizationDetail = Authorize::isAllowable($config, "managegroup_detail", "normal", "donotsetlog", "-1", "-1");
?>
<!--Block Two, Search Results-->
<div class="ui-sys-search-results">
	<label id="statustextlabel"></label>
	<table class="pure-table ui-sys-table-search-results">
		<thead>
			<tr>
				<th>S/N</th>
				<th>Group Name</th>
				<th>Parent Group</th>
				<th>Nature</th>
				<th>Year</th>
				<th>Semester</th>
				<th></th>
			</tr>
		</thead>
<?php 
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
	$query = Group::getQueryText();
	$sqlReturnedRowCount = 0;
	$perTbodyCounter = 0;
	$numberOfTBodies = 0;
	$result = mysql_db_query($database, $query, $conn) or die("Could not fetch group data from the storage");
	$maximumReturnedRows = intval($profile1->getMaximumNumberOfReturnedSearchRecords());
	$maximumRowsPerPage = intval($profile1->getMaximumNumberOfDisplayedRowsPerPage());
	$tbodyClosed = true;
	while (list($id) = mysql_fetch_row($result))	{
		if ($sqlReturnedRowCount > $maximumReturnedRows)	{
			//Finalize All House Keeping Here
			break;
		}
		$group1 = null;
		try {
			$group1 = new Group($database, $id, $conn);
		} catch (Exception $e)	{ die($e->getMessage()); }
		$matrix1 = new SearchMatrix($searchtext); //Need to be recreated per objects 
		if ($group1->searchMatrix($matrix1)->evaluateResult())	{
			$parentGroupName = "";
			if (! is_null($group1->getParentGroup())) $parentGroupName = $group1->getParentGroup()->getGroupName();
			$natureOfGroup = "Normal";
			if ($group1->isRootGroup()) $natureOfGroup = "System";
			if ($tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "<tbody tbody-index=\"$numberOfTBodies\">"; 
				$numberOfTBodies++;
				$tbodyClosed = false;
			} else if (! $tbodyClosed && ($sqlReturnedRowCount % $maximumRowsPerPage) == 0)	{
				echo "</tbody><tbody tbody-index=\"$numberOfTBodies\" class=\"ui-sys-hidden\">";
				$numberOfTBodies++;
				$perTbodyCounter = 0;
			}
			//In All Cases we need to display tr
			$pureTableOddClass = "";
			if (($perTbodyCounter % 2) != 0) $pureTableOddClass = "pure-table-odd";
?>
			<tr class="<?= $pureTableOddClass ?>">
				<td><?= $sqlReturnedRowCount + 1 ?></td>
				<td><?= $group1->getGroupName() ?></td>
				<td><?= $parentGroupName ?></td>
				<td><?= $natureOfGroup ?></td>
				<td><?= $group1->getYear() ?></td>
				<td><?= $group1->getSemester() ?></td>
				<td>
<?php 
	if ($blnAuthorizationDetail)	{
?>
		<a href="<?= $thispage ?>?page=managegroup_detail&id=<?= $group1->getGroupId() ?>" class="ui-sys-search-results-controls"><img alt="DAT" src="../sysimage/buttondetail.png"/></a>
<?php
	}
?>				
				</td>
			</tr>
<?php
			$perTbodyCounter++;
			$sqlReturnedRowCount++;
		}//end-evaluate-results
	}//end-while
	if (! $tbodyClosed)	{
		echo "</tbody>";
 		$tbodyClosed = true;
	}
	mysql_close($conn);
?>
	</table>
	<input type="hidden" id="saveresultsstorage" value="<?= $sqlReturnedRowCount ?>"/>
	<ul class="ui-sys-pagination"></ul>
<script type="text/javascript">
(function($)	{
	$(function()	{
		 $('ul.ui-sys-pagination').twbsPagination({
			totalPages: <?= $numberOfTBodies ?>,
			visiblePages: 5,
			onPageClick: function (event, page) {
				//page is page number 
				var $tbodyList1 = $('table.ui-sys-table-search-results tbody');
				if (! $tbodyList1.length) return;
				//Hide All tbody 
				$tbodyList1.addClass('ui-sys-hidden');
				//Now show only the one corresponding to this page
				$tbodyList1.eq(page-1).removeClass('ui-sys-hidden');			
			}
		});
	});
})(jQuery);
</script>
</div>
<!--Block Two Ends-->
<?php
	} //end-if-searchtext
?>		
<!--Beginning of Block Three-->
				<div class="ui-sys-search-controls ui-sys-right">
<?php 
	if (Authorize::isAllowable($config, "managegroup_csv", "normal", "donotsetlog", "-1", "-1")) {
?>
		<a title="Download CSV/EXCEL Formatted Data" href="<?= $thispage ?>?page=managegroup_csv"><img alt="DAT" src="../sysimage/buttoncsv.png"/></a>
<?php
	}
	if (Authorize::isAllowable($config, "managegroup_add", "normal", "donotsetlog", "-1", "-1"))	{
?>
		<a title="Add a New System Group" href="<?= $thispage ?>?page=managegroup_add"><img alt="DAT" src="../sysimage/buttonadd.png"/></a>
<?php	
	}
?>				
				</div>
			</div>
			<div class="ui-sys-panel-footer"></div>
		</div>
<?php
	}/*Group End*/ else {
		if (Authorize::isSessionSet())	{
			$op=Authorize::getSessionValue();;
			$conn=mysql_connect($hostname, $user, $pass) or die("Could not connect to a database service");
			$cid=ContextPosition::getContextIdFromName($database, $op, $conn);
			$context1=new ContextPosition($database, $cid, $conn);
			mysql_close($conn);
?>
	<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
		<div class="ui-sys-panel-header ui-widget-header">Permission Alert</div>
		<div class="ui-sys-panel-body">
			<div class="ui-sys-authorize-syslog ui-state-error">
				<b><i>OPERATION DENIED!!</i></b> <br />
				You do not have enough rights to perform <b><?= $context1->getContextCaption() ?></b> operation
			</div>
		</div>
		<div class="ui-sys-panel-footer"></div>
	</div>
<?php 
			Authorize::clearSession();
		} //end-if
		if ($login1->isStudent())	{
?>
			<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
				<div class="ui-sys-panel-header ui-widget-header">Welcome, <?= $login1->getFullname() ?></div>
				<div class="ui-sys-panel-body">
					Dear Student; <br/>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;We would like to welcome you to <?= $profile1->getSystemName() ?> of <?= $profile1->getProfileName() ?>;
						<br/>Every operation you are doing in this system is governed by <?= $profile1->getProfileName() ?> regulations
				</div>
				<div class="ui-sys-panel-footer">
<?php 
	$student1 = null;
	$conn = mysql_connect($hostname, $user, $pass) or die("Could not connect to a database services");
	try {
		$student1 = Login::getUserWithThisLogin($database, $conn, $login1);
	} catch (Exception $e)	{
		$student1 = null;
	}
	mysql_close($conn);
	if (! is_null($student1))	{
?>
		My Registration Number is <b><?= $student1->getRegistrationNumber() ?></b>
<?php
	}
?>				
				</div>
			</div>
<?php
		} else {
?>
			<div class="ui-sys-panel-container ui-sys-panel ui-widget ui-widget-content">
				<div class="ui-sys-panel-header ui-widget-header">Welcome, <?= $login1->getFullname() ?></div>
				<div class="ui-sys-panel-body">				
					This is the main operation windows of the system <br/>
					This window is menu controlled. Kindly note whatever changes you are making to the system is always recorded. Incase you are lost go to System Menu and click Home or click Profile<br/>
					Everything you are doing is governed by <i><?= $profile1->getProfileName() ?></i> regulations
				</div>
				<div class="ui-sys-panel-footer"></div>
			</div>
<?php
		}
	} //end--if-else-page-ladder
?>
</div>
<!--ENDING OF PUTTING CODE-->
	<div id="__ui_common_errors" class="ui-sys-error-message"></div>
	<div class="ui-sys-footer mobile-collapse">
<?php   
	//You must have a DateAndTime Object carrying date, we are interested with only year 
	//So any default_timezone is okay with us at this point 
	include("../template/footer.php");
?>
	</div>
</div>
</body>
</html>